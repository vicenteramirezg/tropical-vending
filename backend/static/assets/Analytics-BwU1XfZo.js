import{a as B}from"./api-BDI7RR6G.js";import{b as N,a as O}from"./dateUtils-CXdyRzwD.js";import{r as _,c as T,b as l,o as i,d as t,h as I,f as U,F as E,g as V,t as c,e as h,n as A,s as H,x as f,p as P}from"./index-CbGJeSZD.js";function Y(){const s=_(!0),x=_(null),o=_([]),n=_({locations:!1,revenue:!1,stock:!1,demand:!1}),e=_({dateRange:"30",startDate:"",endDate:"",location:""}),r=_({revenue:{total:0,change:0},profit:{total:0,change:0},margin:{total:0,change:0}}),p=_({low_stock_count:0,items:[]}),u=_({unit_counts:[],products:[]}),m=T(()=>u.value.unit_counts?[...u.value.unit_counts].sort((a,d)=>a.location_name!==d.location_name?a.location_name.localeCompare(d.location_name):a.machine_name!==d.machine_name?a.machine_name.localeCompare(d.machine_name):a.product_name!==d.product_name?a.product_name.localeCompare(d.product_name):new Date(d.end_date)-new Date(a.end_date)):[]),y=T(()=>Object.values(n.value).some(a=>a)||s.value),C=a=>a<=0?"bg-red-100 text-red-800":a<=3?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800",F=a=>a==null?"bg-gray-100 text-gray-800":a>10?"bg-green-100 text-green-800":a<-10?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800",L=a=>a==null?"+0.0%":`${a>=0?"+":""}${a.toFixed(1)}%`,S=a=>a==null?"0.0/day":a.toFixed(1)+"/day",b=()=>{const a={};return e.value.dateRange!=="custom"?a.days=e.value.dateRange:(a.start_date=e.value.startDate,a.end_date=e.value.endDate),e.value.location&&(a.location=e.value.location),a},D=async()=>{if(!(o.value.length>0)){n.value.locations=!0;try{const a=await B.getLocations();o.value=a.data.results||a.data}catch(a){console.error("Error fetching locations:",a)}finally{n.value.locations=!1}}},v=async a=>{var d,g,$,k,j,R;n.value.revenue=!0;try{const w=await B.getRevenueProfitData(a);if(!w.data){r.value={revenue:{total:0,change:0},profit:{total:0,change:0},margin:{total:0,change:0}};return}r.value={revenue:{total:((d=w.data.revenue)==null?void 0:d.total)||0,change:((g=w.data.revenue)==null?void 0:g.change)||0},profit:{total:(($=w.data.profit)==null?void 0:$.total)||0,change:((k=w.data.profit)==null?void 0:k.change)||0},margin:{total:((j=w.data.margin)==null?void 0:j.total)||0,change:((R=w.data.margin)==null?void 0:R.change)||0}}}catch(w){throw console.error("Error fetching revenue/profit data:",w),r.value={revenue:{total:0,change:0},profit:{total:0,change:0},margin:{total:0,change:0}},new Error("Failed to load revenue and profit data")}finally{n.value.revenue=!1}},M=async a=>{n.value.stock=!0;try{const d={location:a.location},g=await B.getStockLevels(d);if(!g.data){p.value={low_stock_count:0,items:[]};return}p.value={low_stock_count:g.data.low_stock_count||0,items:g.data.items||[]}}catch(d){throw console.error("Error fetching stock level data:",d),p.value={low_stock_count:0,items:[]},new Error("Failed to load stock level data")}finally{n.value.stock=!1}},q=async a=>{n.value.demand=!0;try{const d=await B.getDemandAnalysis(a);if(console.log("Demand analysis data:",d.data),!d.data){u.value={products:[],unit_counts:[]};return}Array.isArray(d.data)?u.value={products:d.data||[],unit_counts:[]}:(u.value={products:d.data.products||[],unit_counts:d.data.unit_counts||[]},u.value.unit_counts&&u.value.unit_counts.length>0&&u.value.unit_counts.forEach(g=>{g.start_date&&(g.start_date=new Date(g.start_date)),g.end_date&&(g.end_date=new Date(g.end_date))}))}catch(d){throw console.error("Error fetching demand analysis data:",d),u.value={products:[],unit_counts:[]},new Error("Failed to load demand analysis data")}finally{n.value.demand=!1}},z=async()=>{s.value=!0,x.value=null;try{if(e.value.dateRange==="custom"&&(!e.value.startDate||!e.value.endDate)){const k=O(),j=new Date;j.setDate(j.getDate()-30);const R=j.toLocaleDateString("en-CA",{timeZone:"America/New_York"});e.value.endDate||(e.value.endDate=k),e.value.startDate||(e.value.startDate=R)}const a=b(),d=[v(a),M(a),q(a)],$=(await Promise.allSettled(d)).filter(k=>k.status==="rejected");$.length>0&&(console.warn(`${$.length} API calls failed:`,$.map(k=>k.reason.message)),x.value=`Some data could not be loaded. ${$.length} of ${d.length} requests failed.`)}catch(a){console.error("Error refreshing data:",a),x.value="Failed to refresh analytics data"}finally{s.value=!1}};return{loading:s,error:x,locations:o,filters:e,revenueProfitData:r,stockLevelData:p,demandData:u,loadingStates:n,sortedDemandCounts:m,isAnyLoading:y,getStockLevelClass:C,getTrendClass:F,formatTrend:L,formatDailyDemand:S,formatDateShort:N,applyFilters:z,initialize:async()=>{s.value=!0,x.value=null;try{await D(),await z()}catch(a){console.error("Error initializing analytics:",a),x.value="Failed to load analytics data"}finally{s.value=!1}},refreshSection:async a=>{const d=b();try{switch(a){case"revenue":await v(d);break;case"stock":await M(d);break;case"demand":await q(d);break;default:await z()}}catch(g){console.error(`Error refreshing ${a}:`,g),x.value=`Failed to refresh ${a} data`}}}}const Z={class:"bg-white p-5 shadow-lg rounded-xl mb-6"},G={class:"flex flex-wrap items-center gap-4"},J=["value"],K={key:0,class:"flex space-x-2"},Q=["value"],W=["value"],X=["value"],tt=["value"],et={class:"self-end ml-auto mt-4"},at={__name:"FilterControls",props:{filters:{type:Object,required:!0},locations:{type:Array,required:!0}},emits:["apply-filters","update-filters"],setup(s,{emit:x}){const o=x,n=u=>{o("update-filters",{dateRange:u.target.value})},e=u=>{o("update-filters",{startDate:u.target.value})},r=u=>{o("update-filters",{endDate:u.target.value})},p=u=>{o("update-filters",{location:u.target.value})};return(u,m)=>(i(),l("div",Z,[t("div",G,[t("div",null,[m[2]||(m[2]=t("label",{for:"dateRange",class:"block text-sm font-medium text-gray-700 mb-1"},"Date Range",-1)),t("select",{id:"dateRange",value:s.filters.dateRange,onChange:n,class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm"},m[1]||(m[1]=[U('<option value="7">Last 7 days</option><option value="30">Last 30 days</option><option value="90">Last 90 days</option><option value="365">Last 12 months</option><option value="custom">Custom range</option>',5)]),40,J)]),s.filters.dateRange==="custom"?(i(),l("div",K,[t("div",null,[m[3]||(m[3]=t("label",{for:"startDate",class:"block text-sm font-medium text-gray-700 mb-1"},"Start Date",-1)),t("input",{type:"date",id:"startDate",value:s.filters.startDate,onInput:e,class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm"},null,40,Q)]),t("div",null,[m[4]||(m[4]=t("label",{for:"endDate",class:"block text-sm font-medium text-gray-700 mb-1"},"End Date",-1)),t("input",{type:"date",id:"endDate",value:s.filters.endDate,onInput:r,class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm"},null,40,W)])])):I("",!0),t("div",null,[m[6]||(m[6]=t("label",{for:"location",class:"block text-sm font-medium text-gray-700 mb-1"},"Location",-1)),t("select",{id:"location",value:s.filters.location,onChange:p,class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm"},[m[5]||(m[5]=t("option",{value:""},"All Locations",-1)),(i(!0),l(E,null,V(s.locations,y=>(i(),l("option",{key:y.id,value:y.id},c(y.name),9,tt))),128))],40,X)]),t("div",et,[t("button",{type:"button",onClick:m[0]||(m[0]=y=>u.$emit("apply-filters")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-150"},m[7]||(m[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})],-1),h(" Apply Filters ")]))])])]))}},st={class:"bg-white shadow-lg overflow-hidden sm:rounded-xl mb-6 transition-all duration-300 hover:shadow-xl"},ot={class:"grid grid-cols-1 md:grid-cols-3 divide-y md:divide-y-0 md:divide-x divide-gray-200"},nt={class:"px-6 py-5"},rt={class:"mt-2 text-3xl font-bold text-gray-900"},lt={class:"mt-2 text-sm text-gray-500 flex items-center"},it={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},dt={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ct={class:"px-6 py-5"},ut={class:"mt-2 text-3xl font-bold text-green-600"},mt={class:"mt-2 text-sm text-gray-500 flex items-center"},xt={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},gt={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},pt={class:"px-6 py-5"},ft={class:"mt-2 text-3xl font-bold text-gray-900"},vt={class:"mt-2 text-sm text-gray-500 flex items-center"},yt={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ht={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},wt={__name:"RevenueProfit",props:{data:{type:Object,required:!0,default:()=>({revenue:{total:0,change:0},profit:{total:0,change:0},margin:{total:0,change:0}})}},setup(s){return(x,o)=>{var n,e,r,p,u,m,y,C,F,L,S,b,D,v,M;return i(),l("div",st,[o[12]||(o[12]=t("div",{class:"px-6 py-5 border-b border-gray-100"},[t("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Revenue & Profit"),t("p",{class:"mt-1 text-sm text-gray-500"}," Financial performance for the selected period ")],-1)),t("div",null,[t("div",ot,[t("div",nt,[o[3]||(o[3]=t("div",{class:"text-sm font-medium text-gray-500"},"Total Revenue",-1)),t("div",rt,"$"+c((((n=s.data.revenue)==null?void 0:n.total)||0).toFixed(2)),1),t("div",lt,[t("span",{class:A([(((e=s.data.revenue)==null?void 0:e.change)||0)>=0?"text-green-600":"text-red-600","flex items-center"])},[(((r=s.data.revenue)==null?void 0:r.change)||0)>=0?(i(),l("svg",it,o[0]||(o[0]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"},null,-1)]))):(i(),l("svg",dt,o[1]||(o[1]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"},null,-1)]))),h(" "+c((((p=s.data.revenue)==null?void 0:p.change)||0)>=0?"+":"")+c((((u=s.data.revenue)==null?void 0:u.change)||0).toFixed(1))+"% ",1)],2),o[2]||(o[2]=t("span",{class:"ml-1"},"vs previous period",-1))])]),t("div",ct,[o[7]||(o[7]=t("div",{class:"text-sm font-medium text-gray-500"},"Total Profit",-1)),t("div",ut,"$"+c((((m=s.data.profit)==null?void 0:m.total)||0).toFixed(2)),1),t("div",mt,[t("span",{class:A([(((y=s.data.profit)==null?void 0:y.change)||0)>=0?"text-green-600":"text-red-600","flex items-center"])},[(((C=s.data.profit)==null?void 0:C.change)||0)>=0?(i(),l("svg",xt,o[4]||(o[4]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"},null,-1)]))):(i(),l("svg",gt,o[5]||(o[5]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"},null,-1)]))),h(" "+c((((F=s.data.profit)==null?void 0:F.change)||0)>=0?"+":"")+c((((L=s.data.profit)==null?void 0:L.change)||0).toFixed(1))+"% ",1)],2),o[6]||(o[6]=t("span",{class:"ml-1"},"vs previous period",-1))])]),t("div",pt,[o[11]||(o[11]=t("div",{class:"text-sm font-medium text-gray-500"},"Profit Margin",-1)),t("div",ft,c((((S=s.data.margin)==null?void 0:S.total)||0).toFixed(1))+"%",1),t("div",vt,[t("span",{class:A([(((b=s.data.margin)==null?void 0:b.change)||0)>=0?"text-green-600":"text-red-600","flex items-center"])},[(((D=s.data.margin)==null?void 0:D.change)||0)>=0?(i(),l("svg",yt,o[8]||(o[8]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"},null,-1)]))):(i(),l("svg",ht,o[9]||(o[9]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"},null,-1)]))),h(" "+c((((v=s.data.margin)==null?void 0:v.change)||0)>=0?"+":"")+c((((M=s.data.margin)==null?void 0:M.change)||0).toFixed(1))+"% ",1)],2),o[10]||(o[10]=t("span",{class:"ml-1"},"vs previous period",-1))])])])])])}}},kt={class:"bg-white shadow-lg overflow-hidden sm:rounded-xl mb-6 transition-all duration-300 hover:shadow-xl"},_t={class:"px-6 py-5 border-b border-gray-100 flex justify-between items-center"},bt={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Dt={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},$t={role:"list",class:"divide-y divide-gray-200"},Ct={class:"flex items-center justify-between"},Ft={class:"text-sm font-medium text-primary-600"},Lt={class:"text-sm text-gray-500 flex items-center mt-1"},St={__name:"StockLevels",props:{data:{type:Object,required:!0,default:()=>({low_stock_count:0,items:[]})}},setup(s){const x=o=>o<=0?"bg-red-100 text-red-800":o<=3?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800";return(o,n)=>(i(),l("div",kt,[t("div",_t,[n[2]||(n[2]=t("div",null,[t("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Stock Levels"),t("p",{class:"mt-1 text-sm text-gray-500"}," Current inventory levels across machines ")],-1)),t("span",{class:A(["inline-flex items-center px-3.5 py-1 rounded-full text-sm font-medium",s.data.low_stock_count>0?"bg-red-100 text-red-800":"bg-green-100 text-green-800"])},[s.data.low_stock_count>0?(i(),l("svg",bt,n[0]||(n[0]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"},null,-1)]))):(i(),l("svg",Dt,n[1]||(n[1]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))),h(" "+c(s.data.low_stock_count)+" items low stock ",1)],2)]),t("div",null,[t("ul",$t,[(i(!0),l(E,null,V(s.data.items,(e,r)=>(i(),l("li",{key:r,class:"px-6 py-4 hover:bg-gray-50 transition-colors duration-150"},[t("div",Ct,[t("div",null,[t("p",Ft,c(e.product_name),1),t("p",Lt,[n[3]||(n[3]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})],-1)),h(" "+c(e.machine_name)+" at "+c(e.location_name),1)])]),t("div",null,[t("span",{class:A(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",x(e.current_stock)])}," Stock: "+c(e.current_stock),3)])])]))),128))])])]))}},jt={class:"bg-white shadow-lg overflow-hidden sm:rounded-xl transition-all duration-300 hover:shadow-xl"},At={class:"overflow-x-auto"},Mt={class:"min-w-full divide-y divide-gray-200"},Rt={class:"bg-white divide-y divide-gray-200"},Bt={class:"px-6 py-4 whitespace-nowrap"},Pt={class:"text-sm font-medium text-gray-900"},Et={class:"px-6 py-4 whitespace-nowrap text-center"},Vt={class:"text-sm text-gray-900"},zt={class:"px-6 py-4 whitespace-nowrap text-center"},Tt={class:"text-sm text-gray-900"},qt={class:"px-6 py-4 whitespace-nowrap text-center"},Nt={class:"text-sm text-gray-900"},Ot={class:"px-6 py-4 whitespace-nowrap text-center"},It={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ut={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ht={key:2,xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Yt={key:0,class:"mt-6 px-6"},Zt={class:"border rounded-lg shadow-sm overflow-hidden"},Gt={class:"min-w-full divide-y divide-gray-200"},Jt={class:"bg-white divide-y divide-gray-200"},Kt={class:"px-4 py-3 text-sm text-gray-900"},Qt={class:"px-4 py-3 text-sm text-gray-900"},Wt={class:"px-4 py-3 text-sm text-gray-900"},Xt={class:"px-4 py-3 text-sm text-gray-500 text-center"},te={class:"text-xs text-gray-400"},ee={class:"px-4 py-3 text-sm text-gray-900 text-center font-medium"},ae={class:"px-4 py-3 text-sm text-gray-900 text-center"},se={class:"px-4 py-3 text-sm text-gray-900 text-center"},oe={key:1,class:"px-6 py-4 text-center"},ne={key:2,class:"px-6 py-4 text-center"},re={__name:"DemandAnalysis",props:{data:{type:Object,required:!0,default:()=>({products:[],unit_counts:[]})},formatDateShort:{type:Function,required:!0},formatDailyDemand:{type:Function,required:!0},formatTrend:{type:Function,required:!0},getTrendClass:{type:Function,required:!0}},setup(s){const x=s,o=T(()=>x.data.unit_counts?[...x.data.unit_counts].sort((n,e)=>n.location_name!==e.location_name?n.location_name.localeCompare(e.location_name):n.machine_name!==e.machine_name?n.machine_name.localeCompare(e.machine_name):n.product_name!==e.product_name?n.product_name.localeCompare(e.product_name):new Date(e.end_date)-new Date(n.end_date)):[]);return(n,e)=>(i(),l("div",jt,[e[8]||(e[8]=t("div",{class:"px-6 py-5 border-b border-gray-100"},[t("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Product Demand Analysis"),t("p",{class:"mt-1 text-sm text-gray-500"}," Sales performance and demand tracking based on restock data ")],-1)),t("div",null,[t("div",At,[t("table",Mt,[e[3]||(e[3]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Product "),t("th",{scope:"col",class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Units Sold "),t("th",{scope:"col",class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Revenue "),t("th",{scope:"col",class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Profit "),t("th",{scope:"col",class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Trend ")])],-1)),t("tbody",Rt,[(i(!0),l(E,null,V(s.data.products,r=>(i(),l("tr",{key:r.product_id,class:"hover:bg-gray-50 transition-colors duration-150"},[t("td",Bt,[t("div",Pt,c(r.product_name),1)]),t("td",Et,[t("div",Vt,c(r.units_sold),1)]),t("td",zt,[t("div",Tt,"$"+c((r.revenue||0).toFixed(2)),1)]),t("td",qt,[t("div",Nt,"$"+c((r.profit||0).toFixed(2)),1)]),t("td",Ot,[t("span",{class:A(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",s.getTrendClass(r.trend||0)])},[(r.trend||0)>0?(i(),l("svg",It,e[0]||(e[0]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"},null,-1)]))):(r.trend||0)<0?(i(),l("svg",Ut,e[1]||(e[1]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"},null,-1)]))):(i(),l("svg",Ht,e[2]||(e[2]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18 12H6"},null,-1)]))),h(" "+c(s.formatTrend(r.trend||0)),1)],2)])]))),128))])])]),s.data.unit_counts&&s.data.unit_counts.length>0?(i(),l("div",Yt,[e[5]||(e[5]=t("h4",{class:"text-base font-medium text-gray-700 mb-3"},"Detailed Demand By Machine & Product",-1)),t("div",Zt,[t("table",Gt,[e[4]||(e[4]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Location "),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Machine "),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Product "),t("th",{scope:"col",class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase"}," Period "),t("th",{scope:"col",class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase"}," Units Sold "),t("th",{scope:"col",class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase"}," Daily Demand "),t("th",{scope:"col",class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase"}," Revenue ")])],-1)),t("tbody",Jt,[(i(!0),l(E,null,V(o.value,(r,p)=>(i(),l("tr",{key:p,class:"hover:bg-gray-50"},[t("td",Kt,c(r.location_name),1),t("td",Qt,c(r.machine_name),1),t("td",Wt,c(r.product_name),1),t("td",Xt,[h(c(s.formatDateShort(r.start_date))+" - "+c(s.formatDateShort(r.end_date))+" ",1),t("div",te,"("+c(r.days_between)+" days)",1)]),t("td",ee,c(r.units_sold),1),t("td",ae,c(s.formatDailyDemand(r.daily_demand)),1),t("td",se," $"+c((r.revenue||0).toFixed(2)),1)]))),128))])])])])):s.data.products&&s.data.products.length>0&&(!s.data.unit_counts||s.data.unit_counts.length===0)?(i(),l("div",oe,e[6]||(e[6]=[t("p",{class:"text-sm text-gray-500"},[h(" No detailed demand data is available for the selected period. "),t("br"),h("Need at least two restock visits to the same machine to calculate demand. ")],-1)]))):(i(),l("div",ne,e[7]||(e[7]=[t("p",{class:"text-sm text-gray-500"}," No demand data available. Record restock visits to track product demand. ",-1)])))])]))}},le={key:0,class:"flex justify-center py-20"},ie={key:1,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-6 rounded-r-lg shadow-sm"},de={class:"flex"},ce={class:"ml-3"},ue={class:"text-sm text-red-700"},me={key:2},ye={__name:"Analytics",setup(s){const{loading:x,error:o,locations:n,filters:e,revenueProfitData:r,stockLevelData:p,demandData:u,formatDateShort:m,formatDailyDemand:y,formatTrend:C,getTrendClass:F,applyFilters:L,initialize:S}=Y(),b=D=>{Object.assign(e.value,D)};return H(()=>{S()}),(D,v)=>(i(),l("div",null,[v[2]||(v[2]=t("h1",{class:"text-2xl font-semibold text-gray-900 mb-6"},"Analytics",-1)),f(x)?(i(),l("div",le,v[0]||(v[0]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))):f(o)?(i(),l("div",ie,[t("div",de,[v[1]||(v[1]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])],-1)),t("div",ce,[t("p",ue,c(f(o)),1)])])])):(i(),l("div",me,[P(at,{filters:f(e),locations:f(n),onApplyFilters:f(L),onUpdateFilters:b},null,8,["filters","locations","onApplyFilters"]),P(wt,{data:f(r)},null,8,["data"]),P(St,{data:f(p)},null,8,["data"]),P(re,{data:f(u),"format-date-short":f(m),"format-daily-demand":f(y),"format-trend":f(C),"get-trend-class":f(F)},null,8,["data","format-date-short","format-daily-demand","format-trend","get-trend-class"])]))]))}};export{ye as default};
