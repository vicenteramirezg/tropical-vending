import{u as ve}from"./useMachines-C51XS9Ds.js";import{a as k}from"./api-CbtK-qE4.js";import{r as y,c as he,b as l,o as n,d as e,w as h,v as F,F as $,g as M,t as p,e as C,h as _,n as xe,y as W,j as E,s as be,p as B,u as we,x as f}from"./index-D8cAfORV.js";function ke(){const r=y([]),d=y([]),t=y(!1),o=y(null),s=y({product:"",price:"",slot:""}),i=he(()=>{const a=d.value.filter(u=>!u.editingSlot).map(u=>u.product);return r.value.filter(u=>!a.includes(u.id))}),S=async()=>{try{const a=await k.getAllProducts();r.value=a.data}catch(a){console.error("Error fetching products with getAllProducts, falling back to paginated method:",a);try{const u=await k.getProducts({page_size:1e3});r.value=u.data.results||u.data}catch(u){console.error("Fallback method also failed:",u),o.value="Failed to load products. Please try again."}}},P=async a=>{t.value=!0,o.value=null;try{const u={machine:a},g=await k.getMachineItems(u);if(g&&g.data){const z=(g.data.results||g.data).filter(x=>x.machine==a);d.value=z.map(x=>({...x,editing:!1,editingSlot:!1,newPrice:x.price,newSlot:x.slot,newProduct:x.product,price:typeof x.price=="string"?parseFloat(x.price):x.price}))}}catch(u){console.error("Error fetching machine products:",u),o.value="Failed to load machine products. Please try again."}finally{t.value=!1}};return{allProducts:r,machineProducts:d,loading:t,error:o,productForm:s,availableProducts:i,fetchAllProducts:S,fetchMachineProducts:P,addProductToMachine:async a=>{o.value=null;try{const u={machine:a,product:parseInt(s.value.product),price:parseFloat(s.value.price),slot:parseInt(s.value.slot)};return await k.createMachineItem(u),s.value={product:"",price:"",slot:""},await P(a),!0}catch(u){return console.error("Error adding product to machine:",u),u.response&&u.response.data?o.value=`Failed to add product: ${JSON.stringify(u.response.data)}`:o.value="Failed to add product to machine. Please try again.",!1}},updateProductPrice:async(a,u)=>{o.value=null;try{return await k.updateMachineItem(a.id,{machine:u,product:a.product,price:parseFloat(a.newPrice),slot:a.slot}),a.price=parseFloat(a.newPrice),a.editing=!1,await P(u),!0}catch(g){return console.error("Error updating product price:",g),o.value="Failed to update product price. Please try again.",!1}},updateProductSlot:async(a,u)=>{o.value=null;try{return await k.updateMachineItem(a.id,{machine:u,product:parseInt(a.newProduct),price:a.price,slot:parseInt(a.newSlot)}),a.slot=parseInt(a.newSlot),a.product=parseInt(a.newProduct),a.editingSlot=!1,await P(u),!0}catch(g){return console.error("Error updating product/slot:",g),o.value="Failed to update product/slot. Please try again.",g.response&&g.response.data&&g.response.data.non_field_errors&&(o.value=g.response.data.non_field_errors[0]),!1}},removeProductFromMachine:async(a,u)=>{try{return await k.deleteMachineItem(a.id),await P(u),!0}catch(g){return console.error("Error removing product from machine:",g),o.value="Failed to remove product from machine. Please try again.",!1}},editProductPrice:a=>{a.editing=!0,a.newPrice=a.price},editProductSlot:a=>{a.editingSlot=!0,a.newSlot=a.slot,a.newProduct=a.product},resetState:()=>{d.value=[],s.value={product:"",price:"",slot:""},o.value=null},clearError:()=>{o.value=null}}}function $e(){const r=y([]),d=y([]),t=y({}),o=y({}),s=y({location:"",machineType:"",route:""});return{locations:r,availableRoutes:d,locationInfo:t,locationNames:o,filters:s,fetchLocations:async()=>{try{const v=await k.getLocations(),A=v.data.results||v.data;r.value=A,A.forEach(w=>{o.value[w.id]=w.name,t.value[w.id]=w})}catch(v){console.error("Error fetching locations:",v)}},fetchRoutes:async()=>{try{const v=await k.getRoutes();d.value=v.data.routes}catch(v){console.error("Error fetching routes:",v)}},resetFilters:()=>{s.value={location:"",machineType:"",route:""}},openMapForLocation:v=>{if(!v||!v.address)return;const w=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(v.address)}`;window.open(w,"_blank")}}}const Me={class:"bg-white p-5 shadow-lg rounded-xl mb-6"},Pe={class:"flex flex-wrap items-center gap-4"},Ce=["value"],Fe=["value"],Se={class:"self-end ml-auto mt-4"},Ae={__name:"MachineFilters",props:{filters:{type:Object,required:!0},locations:{type:Array,required:!0},availableRoutes:{type:Array,required:!0}},emits:["filter-change"],setup(r){return(d,t)=>(n(),l("div",Me,[e("div",Pe,[e("div",null,[t[8]||(t[8]=e("label",{for:"locationFilter",class:"block text-sm font-medium text-gray-700 mb-1"},"Location",-1)),h(e("select",{id:"locationFilter","onUpdate:modelValue":t[0]||(t[0]=o=>r.filters.location=o),class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",onChange:t[1]||(t[1]=o=>d.$emit("filter-change"))},[t[7]||(t[7]=e("option",{value:""},"All Locations",-1)),(n(!0),l($,null,M(r.locations,o=>(n(),l("option",{key:o.id,value:o.id},p(o.name),9,Ce))),128))],544),[[F,r.filters.location]])]),e("div",null,[t[10]||(t[10]=e("label",{for:"typeFilter",class:"block text-sm font-medium text-gray-700 mb-1"},"Machine Type",-1)),h(e("select",{id:"typeFilter","onUpdate:modelValue":t[2]||(t[2]=o=>r.filters.machineType=o),class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",onChange:t[3]||(t[3]=o=>d.$emit("filter-change"))},t[9]||(t[9]=[e("option",{value:""},"All Types",-1),e("option",{value:"Snack"},"Snack",-1),e("option",{value:"Soda"},"Soda",-1),e("option",{value:"Combo"},"Combo",-1)]),544),[[F,r.filters.machineType]])]),e("div",null,[t[13]||(t[13]=e("label",{for:"routeFilter",class:"block text-sm font-medium text-gray-700 mb-1"},"Route",-1)),h(e("select",{id:"routeFilter","onUpdate:modelValue":t[4]||(t[4]=o=>r.filters.route=o),class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",onChange:t[5]||(t[5]=o=>d.$emit("filter-change"))},[t[11]||(t[11]=e("option",{value:""},"All Routes",-1)),t[12]||(t[12]=e("option",{value:"unassigned"},"Unassigned",-1)),(n(!0),l($,null,M(r.availableRoutes,o=>(n(),l("option",{key:o,value:o},p(o),9,Fe))),128))],544),[[F,r.filters.route]])]),e("div",Se,[e("button",{type:"button",onClick:t[6]||(t[6]=o=>d.$emit("filter-change")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-150"},t[14]||(t[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})],-1),C(" Apply Filters ")]))])])]))}},je={class:"space-y-6"},_e={class:"px-6 py-4 bg-gray-50 border-b border-gray-200 flex justify-between items-center"},Ve={class:"text-lg font-medium text-gray-900"},Ee={class:"text-sm text-gray-500"},qe=["onClick"],Le={role:"list",class:"divide-y divide-gray-200"},Ue={class:"flex items-center justify-between"},Be={class:"flex items-center"},Te={class:"text-sm font-medium text-primary-600"},ze={key:0,class:"text-sm text-gray-500 mt-1"},Ne={key:1,class:"text-sm text-primary-600 mt-1"},De={class:"inline-flex items-center"},Re={class:"text-sm text-gray-500 mt-1"},Oe={key:0,class:"text-primary-600 font-medium"},He={key:1,class:"text-gray-400 italic"},Ie={class:"flex space-x-2"},Ge=["onClick"],Je=["onClick"],Ke=["onClick"],Qe={__name:"MachineList",props:{groupedMachines:{type:Object,required:!0},locationNames:{type:Object,required:!0},locationInfo:{type:Object,required:!0}},emits:["open-map","edit-machine","manage-products","confirm-delete"],setup(r){return(d,t)=>(n(),l("div",je,[(n(!0),l($,null,M(r.groupedMachines,(o,s)=>(n(),l("div",{key:s,class:"bg-white shadow-lg rounded-xl overflow-hidden"},[e("div",_e,[e("div",null,[e("h2",Ve,p(r.locationNames[s]),1),e("p",Ee,p(o.length)+" machines",1)]),e("button",{onClick:i=>d.$emit("open-map",r.locationInfo[s]),class:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-150"},t[0]||(t[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1),C(" View on Maps ")]),8,qe)]),e("ul",Le,[(n(!0),l($,null,M(o,i=>(n(),l("li",{key:i.id,class:"px-6 py-5 hover:bg-gray-50 transition-colors duration-150"},[e("div",Ue,[e("div",null,[e("div",Be,[e("p",Te,p(i.name),1),e("span",{class:xe(["ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",{"bg-blue-100 text-blue-800":i.machine_type==="Soda","bg-green-100 text-green-800":i.machine_type==="Snack","bg-purple-100 text-purple-800":i.machine_type==="Combo"}])},p(i.machine_type),3)]),i.model?(n(),l("p",ze,"Model: "+p(i.model),1)):_("",!0),i.route?(n(),l("p",Ne,[e("span",De,[t[1]||(t[1]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1 text-primary-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})],-1)),C(" Route: "+p(i.route),1)])])):_("",!0),e("p",Re,[i.product_count?(n(),l("span",Oe,p(i.product_count)+" products",1)):(n(),l("span",He,"No products"))])]),e("div",Ie,[e("button",{onClick:S=>d.$emit("edit-machine",i),class:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-150"},t[2]||(t[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),C(" Edit ")]),8,Ge),e("button",{onClick:S=>d.$emit("manage-products",i),class:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-150"},t[3]||(t[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})],-1),C(" Products ")]),8,Je),e("button",{onClick:S=>d.$emit("confirm-delete",i),class:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-red-50 hover:text-red-700 hover:border-red-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-150"},t[4]||(t[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),C(" Delete ")]),8,Ke)])])]))),128))])]))),128))]))}},We={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Xe={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Ye={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Ze={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},et={class:"sm:flex sm:items-start"},tt={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},ot={class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"},st={class:"mt-4 space-y-4"},rt=["value"],nt=["value"],it={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},lt={type:"submit",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm"},at={__name:"MachineModal",props:{show:{type:Boolean,required:!0},isEditing:{type:Boolean,required:!0},machineForm:{type:Object,required:!0},locations:{type:Array,required:!0},machineModels:{type:Array,required:!0}},emits:["close","save"],setup(r){return(d,t)=>r.show?(n(),l("div",We,[e("div",Xe,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=o=>d.$emit("close"))}),t[14]||(t[14]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Ye,[e("form",{onSubmit:t[6]||(t[6]=W(o=>d.$emit("save",r.machineForm),["prevent"]))},[e("div",Ze,[e("div",et,[e("div",tt,[e("h3",ot,p(r.isEditing?"Edit Machine":"Add New Machine"),1),e("div",st,[e("div",null,[t[7]||(t[7]=e("label",{for:"name",class:"block text-sm font-medium text-gray-700"},"Machine Name",-1)),h(e("input",{type:"text",name:"name",id:"name","onUpdate:modelValue":t[1]||(t[1]=o=>r.machineForm.name=o),placeholder:"e.g. Building A Snack Machine",class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md",required:""},null,512),[[E,r.machineForm.name]])]),e("div",null,[t[9]||(t[9]=e("label",{for:"location",class:"block text-sm font-medium text-gray-700"},"Location",-1)),h(e("select",{id:"location",name:"location","onUpdate:modelValue":t[2]||(t[2]=o=>r.machineForm.location=o),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},[t[8]||(t[8]=e("option",{value:"",disabled:""},"Select a location",-1)),(n(!0),l($,null,M(r.locations,o=>(n(),l("option",{key:o.id,value:o.id},p(o.name),9,rt))),128))],512),[[F,r.machineForm.location]])]),e("div",null,[t[11]||(t[11]=e("label",{for:"machine_type",class:"block text-sm font-medium text-gray-700"},"Machine Type",-1)),h(e("select",{id:"machine_type",name:"machine_type","onUpdate:modelValue":t[3]||(t[3]=o=>r.machineForm.machine_type=o),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},t[10]||(t[10]=[e("option",{value:"",disabled:""},"Select a machine type",-1),e("option",{value:"Snack"},"Snack",-1),e("option",{value:"Soda"},"Soda",-1),e("option",{value:"Combo"},"Combo",-1)]),512),[[F,r.machineForm.machine_type]])]),e("div",null,[t[13]||(t[13]=e("label",{for:"model",class:"block text-sm font-medium text-gray-700"},"Model (Optional)",-1)),h(e("select",{id:"model",name:"model","onUpdate:modelValue":t[4]||(t[4]=o=>r.machineForm.model=o),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md"},[t[12]||(t[12]=e("option",{value:""},"Select a model (optional)",-1)),(n(!0),l($,null,M(r.machineModels,o=>(n(),l("option",{key:o,value:o},p(o),9,nt))),128))],512),[[F,r.machineForm.model]])])])])])]),e("div",it,[e("button",lt,p(r.isEditing?"Update":"Add"),1),e("button",{type:"button",onClick:t[5]||(t[5]=o=>d.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])],32)])])])):_("",!0)}},dt={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},ut={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},ct={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},mt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},pt={class:"sm:flex sm:items-start"},ft={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},yt={class:"mt-2"},gt={class:"text-sm text-gray-500"},vt={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},ht={__name:"DeleteConfirmationModal",props:{show:{type:Boolean,required:!0},machineToDelete:{type:Object,default:null}},emits:["close","confirm"],setup(r){return(d,t)=>{var o,s;return r.show?(n(),l("div",dt,[e("div",ut,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=i=>d.$emit("close"))}),t[5]||(t[5]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",ct,[e("div",mt,[e("div",pt,[t[4]||(t[4]=e("div",{class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"},[e("svg",{class:"h-6 w-6 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),e("div",ft,[t[3]||(t[3]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Delete Machine ",-1)),e("div",yt,[e("p",gt," Are you sure you want to delete the "+p((o=r.machineToDelete)==null?void 0:o.name)+" ("+p((s=r.machineToDelete)==null?void 0:s.machine_type)+")? This action cannot be undone. ",1)])])])]),e("div",vt,[e("button",{type:"button",onClick:t[1]||(t[1]=i=>d.$emit("confirm")),class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"}," Delete "),e("button",{type:"button",onClick:t[2]||(t[2]=i=>d.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])])])])):_("",!0)}}},xt={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},bt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},wt={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-3xl sm:w-full"},kt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},$t={class:"sm:flex sm:items-start"},Mt={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},Pt={class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"},Ct={class:"mt-4"},Ft={class:"bg-gray-50 rounded-lg p-4 mb-4"},St={key:0,class:"mb-4 bg-red-50 border-l-4 border-red-400 p-4 rounded-r-lg"},At={class:"flex"},jt={class:"ml-3"},_t={class:"text-sm text-red-700"},Vt={class:"sm:col-span-6"},Et=["value"],qt={class:"sm:col-span-2"},Lt={class:"sm:col-span-2"},Ut={class:"mt-1 relative rounded-md shadow-sm"},Bt={key:0,class:"border border-gray-200 rounded-md overflow-hidden"},Tt={class:"overflow-x-auto -mx-4 sm:mx-0"},zt={class:"inline-block min-w-full align-middle"},Nt={class:"min-w-full divide-y divide-gray-200"},Dt={class:"bg-white divide-y divide-gray-200"},Rt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Ot={key:0},Ht=["onUpdate:modelValue"],It=["value"],Gt=["value"],Jt={key:1},Kt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Qt={class:"flex items-center"},Wt={key:0},Xt={class:"relative rounded-md shadow-sm"},Yt=["onUpdate:modelValue"],Zt={key:1},eo={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},to={class:"flex items-center"},oo={key:0},so={class:"relative rounded-md shadow-sm"},ro=["onUpdate:modelValue"],no={key:1},io={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},lo={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2"},ao=["onClick"],uo=["onClick"],co=["onClick"],mo=["onClick"],po=["onClick"],fo={key:1,class:"text-center p-6 bg-gray-50 rounded-md"},yo={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},go={__name:"MachineProductsModal",props:{show:{type:Boolean,required:!0},selectedMachine:{type:Object,default:null},machineProducts:{type:Array,required:!0},availableProducts:{type:Array,required:!0},productForm:{type:Object,required:!0},error:{type:String,default:null}},emits:["close","add-product","edit-price","update-price","edit-slot","update-slot","remove-product"],setup(r){return(d,t)=>{var o;return r.show?(n(),l("div",xt,[e("div",bt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=s=>d.$emit("close"))}),t[17]||(t[17]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",wt,[e("div",kt,[e("div",$t,[e("div",Mt,[e("h3",Pt," Manage Products for "+p((o=r.selectedMachine)==null?void 0:o.name),1),e("div",Ct,[e("div",Ft,[t[13]||(t[13]=e("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Add Product to Machine",-1)),r.error?(n(),l("div",St,[e("div",At,[t[6]||(t[6]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])],-1)),e("div",jt,[e("p",_t,p(r.error),1)])])])):_("",!0),e("form",{onSubmit:t[4]||(t[4]=W(s=>d.$emit("add-product"),["prevent"])),class:"grid grid-cols-1 gap-y-3 sm:grid-cols-12 sm:gap-x-3"},[e("div",Vt,[t[8]||(t[8]=e("label",{for:"product",class:"block text-xs font-medium text-gray-700"},"Product",-1)),h(e("select",{id:"product","onUpdate:modelValue":t[1]||(t[1]=s=>r.productForm.product=s),class:"mt-1 block w-full pl-3 pr-10 py-2 text-sm border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 rounded-md",required:""},[t[7]||(t[7]=e("option",{value:"",disabled:""},"Select a product",-1)),(n(!0),l($,null,M(r.availableProducts,s=>(n(),l("option",{key:s.id,value:s.id},p(s.name),9,Et))),128))],512),[[F,r.productForm.product]])]),e("div",qt,[t[9]||(t[9]=e("label",{for:"slot",class:"block text-xs font-medium text-gray-700"},"Slot #",-1)),h(e("input",{type:"number",id:"slot",min:"1","onUpdate:modelValue":t[2]||(t[2]=s=>r.productForm.slot=s),placeholder:"1",class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full py-2 px-3 sm:text-sm border-gray-300 rounded-md",required:""},null,512),[[E,r.productForm.slot]])]),e("div",Lt,[t[11]||(t[11]=e("label",{for:"price",class:"block text-xs font-medium text-gray-700"},"Price",-1)),e("div",Ut,[t[10]||(t[10]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 sm:text-sm"},"$")],-1)),h(e("input",{type:"number",id:"price",step:"0.01",min:"0.01","onUpdate:modelValue":t[3]||(t[3]=s=>r.productForm.price=s),placeholder:"0.00",class:"focus:ring-primary-500 focus:border-primary-500 block w-full pl-7 pr-3 py-2 sm:text-sm border-gray-300 rounded-md",required:""},null,512),[[E,r.productForm.price]])])]),t[12]||(t[12]=e("div",{class:"sm:col-span-2 flex items-end"},[e("button",{type:"submit",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-sm font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Add ")],-1))],32)]),r.machineProducts.length>0?(n(),l("div",Bt,[e("div",Tt,[e("div",zt,[e("table",Nt,[t[15]||(t[15]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Product "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Slot "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Price "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Current Stock "),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",Dt,[(n(!0),l($,null,M(r.machineProducts,s=>(n(),l("tr",{key:s.id},[e("td",Rt,[s.editingSlot?(n(),l("div",Ot,[h(e("select",{"onUpdate:modelValue":i=>s.newProduct=i,class:"focus:ring-primary-500 focus:border-primary-500 block w-full py-1 px-3 sm:text-sm border-gray-300 rounded-md"},[e("option",{value:s.product},p(s.product_name),9,It),(n(!0),l($,null,M(r.availableProducts,i=>(n(),l("option",{key:i.id,value:i.id},p(i.name),9,Gt))),128))],8,Ht),[[F,s.newProduct]])])):(n(),l("div",Jt,p(s.product_name),1))]),e("td",Kt,[e("div",Qt,[s.editingSlot?(n(),l("span",Wt,[e("div",Xt,[h(e("input",{type:"number",min:"1","onUpdate:modelValue":i=>s.newSlot=i,class:"focus:ring-primary-500 focus:border-primary-500 block w-full py-1 px-3 sm:text-sm border-gray-300 rounded-md"},null,8,Yt),[[E,s.newSlot]])])])):(n(),l("span",Zt,p(s.slot),1))])]),e("td",eo,[e("div",to,[s.editing?(n(),l("span",oo,[e("div",so,[t[14]||(t[14]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 sm:text-sm"},"$")],-1)),h(e("input",{type:"number",step:"0.01",min:"0.01","onUpdate:modelValue":i=>s.newPrice=i,class:"focus:ring-primary-500 focus:border-primary-500 block w-full pl-7 pr-3 py-1 sm:text-sm border-gray-300 rounded-md"},null,8,ro),[[E,s.newPrice]])])])):(n(),l("span",no,"$"+p(typeof s.price=="number"?s.price.toFixed(2):Number(s.price).toFixed(2)),1))])]),e("td",io,p(s.current_stock||"Not set"),1),e("td",lo,[s.editingSlot?(n(),l("button",{key:0,onClick:i=>d.$emit("update-slot",s),class:"text-primary-600 hover:text-primary-900"}," Save Changes ",8,ao)):(n(),l("button",{key:1,onClick:i=>d.$emit("edit-slot",s),class:"text-primary-600 hover:text-primary-900"}," Edit Product/Slot ",8,uo)),s.editing?(n(),l("button",{key:2,onClick:i=>d.$emit("update-price",s),class:"text-primary-600 hover:text-primary-900"}," Save Price ",8,co)):(n(),l("button",{key:3,onClick:i=>d.$emit("edit-price",s),class:"text-primary-600 hover:text-primary-900"}," Edit Price ",8,mo)),e("button",{onClick:i=>d.$emit("remove-product",s),class:"text-red-600 hover:text-red-900"}," Remove ",8,po)])]))),128))])])])])])):(n(),l("div",fo,t[16]||(t[16]=[e("p",{class:"text-sm text-gray-500"},"No products added to this machine yet.",-1)])))])])])]),e("div",yo,[e("button",{type:"button",onClick:t[5]||(t[5]=s=>d.$emit("close")),class:"w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm"}," Close ")])])])])):_("",!0)}}},vo={key:0,class:"flex justify-center py-20"},ho={key:1,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-6 rounded-r-lg shadow-sm"},xo={class:"flex"},bo={class:"ml-3"},wo={class:"text-sm text-red-700"},ko={key:2,class:"bg-white shadow-lg rounded-xl overflow-hidden"},Fo={__name:"Machines",setup(r){const{loading:d,error:t,machineModels:o,groupedMachines:s,fetchMachines:i,createMachine:S,updateMachine:P,deleteMachine:T,clearError:v}=ve(),{machineProducts:A,productForm:w,availableProducts:R,error:O,fetchAllProducts:H,fetchMachineProducts:I,addProductToMachine:a,updateProductPrice:u,updateProductSlot:g,removeProductFromMachine:G,editProductPrice:z,editProductSlot:x,resetState:J}=ke(),{locations:K,availableRoutes:X,locationInfo:Y,locationNames:Z,filters:j,fetchLocations:ee,fetchRoutes:te,openMapForLocation:oe}=$e(),V=y(!1),q=y(!1),N=y(!1),L=y(!1),U=y(null),b=y(null),D=y({id:null,name:"",location:"",machine_type:"",model:""}),se=()=>{i(j.value)},Q=()=>{L.value=!1,D.value={id:null,name:"",location:"",machine_type:"",model:""},V.value=!0},re=c=>{L.value=!0,D.value={id:c.id,name:c.name,location:c.location,machine_type:c.machine_type,model:c.model},V.value=!0},ne=()=>{V.value=!1,v()},ie=async c=>{let m=!1;L.value?m=await P(c.id,c):m=await S(c),m&&(V.value=!1,await i(j.value))},le=c=>{U.value=c,q.value=!0},ae=async()=>{if(!U.value)return;await T(U.value.id)&&(q.value=!1,await i(j.value))},de=async c=>{b.value=c,J();try{await H(),await I(c.id),N.value=!0}catch(m){console.error("Error opening products modal:",m)}},ue=()=>{N.value=!1,J(),b.value=null},ce=async()=>{if(!b.value)return;await a(b.value.id)&&await i(j.value)},me=c=>{z(c)},pe=async c=>{b.value&&await u(c,b.value.id)},fe=c=>{x(c)},ye=async c=>{b.value&&await g(c,b.value.id)},ge=async c=>{if(!confirm(`Are you sure you want to remove ${c.product_name} from this machine?`)||!b.value)return;await G(c,b.value.id)&&await i(j.value)};return be(async()=>{await Promise.all([ee(),te()]),await i()}),(c,m)=>(n(),l("div",null,[e("div",{class:"flex justify-between items-center mb-6"},[m[2]||(m[2]=e("h1",{class:"text-2xl font-bold text-gray-900"},"Machines",-1)),e("button",{onClick:Q,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-150"},m[1]||(m[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),C(" Add Machine ")]))]),B(Ae,{filters:f(j),locations:f(K),"available-routes":f(X),onFilterChange:se},null,8,["filters","locations","available-routes"]),f(d)?(n(),l("div",vo,m[3]||(m[3]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))):f(t)?(n(),l("div",ho,[e("div",xo,[m[4]||(m[4]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])],-1)),e("div",bo,[e("p",wo,p(f(t)),1)])])])):Object.keys(f(s)).length===0?(n(),l("div",ko,[e("div",{class:"px-6 py-8 text-center"},[m[6]||(m[6]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 mx-auto text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"})],-1)),m[7]||(m[7]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900 mb-2"},"No machines found",-1)),m[8]||(m[8]=e("div",{class:"mt-2 max-w-xl text-sm text-gray-500 mx-auto mb-6"},[e("p",null,"Get started by adding your first machine.")],-1)),e("button",{onClick:Q,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-150"},m[5]||(m[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),C(" Add Machine ")]))])])):(n(),we(Qe,{key:3,"grouped-machines":f(s),"location-names":f(Z),"location-info":f(Y),onOpenMap:f(oe),onEditMachine:re,onManageProducts:de,onConfirmDelete:le},null,8,["grouped-machines","location-names","location-info","onOpenMap"])),B(at,{show:V.value,"is-editing":L.value,"machine-form":D.value,locations:f(K),"machine-models":f(o),onClose:ne,onSave:ie},null,8,["show","is-editing","machine-form","locations","machine-models"]),B(ht,{show:q.value,"machine-to-delete":U.value,onClose:m[0]||(m[0]=$o=>q.value=!1),onConfirm:ae},null,8,["show","machine-to-delete"]),B(go,{show:N.value,"selected-machine":b.value,"machine-products":f(A),"available-products":f(R),"product-form":f(w),error:f(O),onClose:ue,onAddProduct:ce,onEditPrice:me,onUpdatePrice:pe,onEditSlot:fe,onUpdateSlot:ye,onRemoveProduct:ge},null,8,["show","selected-machine","machine-products","available-products","product-form","error"])]))}};export{Fo as default};
