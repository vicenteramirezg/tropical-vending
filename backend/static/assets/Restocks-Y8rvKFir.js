import{r as S,y as Z,b as r,o as l,d as e,t as m,F,f as A,u as D,c as ee,l as _,n as T,e as te,g as E,i as M,q as J,m as K,w as z,s as q,k as ue}from"./index-QwUTnthM.js";import{a as $}from"./api-BumTtRSs.js";import{u as me}from"./useLocations-B6ux8Vnl.js";import{u as fe}from"./useMachines-Bpu_ArNl.js";import{g as ve,f as H}from"./dateUtils-CXdyRzwD.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";function be(){const o=S([]),a=S(!1),t=S(null),s=async()=>{a.value=!0,t.value=null;try{const c=await $.getVisits(),d=c.data.results||c.data;o.value=d.map(y=>({id:y.id,location_id:y.location,location_name:y.location_name,visit_date:y.visit_date,notes:y.notes,user_name:y.user_name}))}catch(c){console.error("Error fetching visits:",c),t.value="Failed to load visits. Please try again later."}finally{a.value=!1}};return{restocks:o,loading:a,error:t,fetchRestocks:s,createVisit:async c=>{try{return(await $.createVisit(c)).data}catch(d){throw console.error("Error creating visit:",d),d}},updateVisit:async(c,d)=>{try{return(await $.updateVisit(c,d)).data}catch(y){throw console.error("Error updating visit:",y),y}},deleteVisit:async c=>{try{await $.deleteVisit(c),await s()}catch(d){throw console.error("Error deleting visit:",d),d}},getVisitDetails:async c=>{try{const d=await $.getRestocks({visit:c}),y=d.data.results||d.data;let i=[];for(const n of y){const B=await $.getRestockEntries({visit_machine_restock:n.id}),L=B.data.results||B.data,v=await $.getMachineItems({machine:n.machine}),R=v.data.results||v.data,C=L.map(f=>{const g=R.find(x=>x.product===f.product);return{...f,slot:g?g.slot:null}});i.push(...C)}return i.sort((n,B)=>n.visit_machine_restock!==B.visit_machine_restock?0:(n.slot||999)-(B.slot||999)),i.map(n=>({id:n.id,product_name:n.product_name,product_id:n.product,previous_quantity:n.stock_before,quantity_discarded:n.discarded,quantity_added:n.restocked,machine_name:n.machine_name,machine_type:n.machine_type,machine_model:n.machine_model,slot:n.slot}))}catch(d){throw console.error("Error fetching visit details:",d),d}}}}function ye(){const o=Z(),a=S(!1),t=S(""),s=S(null),u=S(!1),b=S({id:null,visit_date:"",notes:"",location:"",machines:[]}),w=(v=null)=>{v?(a.value=!0,t.value=v.location_id,b.value={id:v.id,visit_date:v.visit_date,notes:v.notes,location:v.location_id}):(a.value=!1,t.value="",b.value={id:null,visit_date:ve(),notes:"",location:"",machines:[]})},p=v=>v.some(f=>f.products.some(g=>c(g)))?v.some(f=>f.products.some(g=>c(g)?g.stock_before===""||g.restocked==="":!1))?(s.value="Please complete all fields for products being restocked (stock before and restock amount are required)",!1):!0:(s.value="Please record stock levels for at least one product",!1),c=v=>v.stock_before!==""||v.restocked!==""||v.discarded!=="",d=async v=>{var R,C;try{if(u.value=!0,s.value=null,!p(v))return!1;const f=y(v);return console.log("Saving visit with bulk data:",f),a.value&&b.value.id?await $.updateVisitBulk(b.value.id,f):await $.createVisitBulk(f),!0}catch(f){return console.error("Error saving restock visit:",f),s.value=((C=(R=f.response)==null?void 0:R.data)==null?void 0:C.error)||"Failed to save visit. Please try again.",!1}finally{u.value=!1}},y=v=>{var f;const R={location:t.value,visit_date:b.value.visit_date,notes:b.value.notes,user:(f=o.user)==null?void 0:f.id},C=v.filter(g=>g.products.some(x=>c(x))).map(g=>{const x=g.products.filter(k=>c(k)).map(k=>({product:k.id,stock_before:parseInt(k.stock_before)||0,discarded:parseInt(k.discarded)||0,restocked:parseInt(k.restocked)||0}));return{machine:g.id,notes:"",restock_entries:x}});return{visit:R,machine_restocks:C}},i=async(v,R,C)=>{var f;console.warn("Using legacy saveRestock - consider migrating to saveRestockOptimized for better performance");try{if(s.value=null,!p(v))return!1;let g;const x={location:t.value,visit_date:b.value.visit_date,notes:b.value.notes,user:(f=o.user)==null?void 0:f.id};return console.log("Saving visit with data:",x),a.value&&b.value.id?g=(await C(b.value.id,x)).id:g=(await R(x)).id,await n(g,v),!0}catch(g){return console.error("Error saving restock visit:",g),s.value="Failed to save visit. Please try again.",!1}},n=async(v,R)=>{const C=R.filter(f=>f.products.some(g=>c(g)));for(const f of C){let g;if(a.value)try{const x=await $.getRestocks({visit:v,machine:f.id});if(x.data.length>0){const k=x.data[0],N={visit:v,machine:f.id,notes:k.notes||""};await $.updateRestock(k.id,N),g=k.id}else{const k={visit:v,machine:f.id,notes:""};g=(await $.createRestock(k)).data.id}}catch(x){throw console.error("Error handling machine restock:",x),x}else{const x={visit:v,machine:f.id,notes:""};g=(await $.createRestock(x)).data.id}await B(g,f.products)}},B=async(v,R)=>{const C=R.filter(f=>c(f));for(const f of C)try{const g={visit_machine_restock:v,product:f.id,stock_before:parseInt(f.stock_before)||0,discarded:parseInt(f.discarded)||0,restocked:parseInt(f.restocked)||0};if(a.value){const x=await $.getRestockEntries({visit_machine_restock:v,product:f.id});x.data.length>0?await $.updateRestockEntry(x.data[0].id,g):await $.createRestockEntry(g)}else await $.createRestockEntry(g)}catch(g){throw console.error("Error handling restock entry:",g),g}};return{restockForm:b,isEditing:a,selectedLocation:t,error:s,saving:u,initializeForm:w,validateForm:p,saveRestock:i,saveRestockOptimized:d,resetForm:()=>{w(),s.value=null}}}const pe={key:0,class:"flex justify-center"},xe={key:1,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-4"},he={class:"flex"},ke={class:"ml-3"},we={class:"text-sm text-red-700"},$e={key:2,class:"bg-white shadow overflow-hidden sm:rounded-lg"},_e={class:"px-4 py-5 sm:p-6 text-center"},Re={class:"mt-5"},Ve={key:3,class:"bg-white shadow overflow-hidden sm:rounded-lg"},Ce={role:"list",class:"divide-y divide-gray-200"},De={class:"flex items-center justify-between"},Se={class:"flex-1 min-w-0"},Ee={class:"text-sm font-medium text-primary-600 truncate"},Me={class:"text-sm text-gray-500"},Fe={class:"ml-4 flex-shrink-0 flex space-x-2"},Ae=["onClick"],Be=["onClick"],Ie=["onClick"],Le={__name:"RestockList",props:{restocks:Array,loading:Boolean,error:String},emits:["add-restock","view-details","edit-restock","delete-restock"],setup(o){return(a,t)=>(l(),r("div",null,[o.loading?(l(),r("div",pe,t[1]||(t[1]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))):o.error?(l(),r("div",xe,[e("div",he,[t[2]||(t[2]=e("div",{class:"flex-shrink-0"},[e("span",{class:"text-red-400"},"⚠")],-1)),e("div",ke,[e("p",we,m(o.error),1)])])])):o.restocks.length===0?(l(),r("div",$e,[e("div",_e,[t[3]||(t[3]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"No visits recorded",-1)),t[4]||(t[4]=e("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[e("p",null,"Get started by recording your first location visit.")],-1)),e("div",Re,[e("button",{onClick:t[0]||(t[0]=s=>a.$emit("add-restock")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Record New Visit ")])])])):(l(),r("div",Ve,[e("ul",Ce,[(l(!0),r(F,null,A(o.restocks,s=>(l(),r("li",{key:s.id,class:"px-4 py-4 sm:px-6"},[e("div",De,[e("div",Se,[e("p",Ee,m(s.location_name),1),e("p",Me,m(D(H)(s.visit_date)),1)]),e("div",Fe,[e("button",{onClick:u=>a.$emit("view-details",s),class:"inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," View Details ",8,Ae),e("button",{onClick:u=>a.$emit("edit-restock",s),class:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Edit ",8,Be),e("button",{onClick:u=>a.$emit("delete-restock",s),class:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," Delete ",8,Ie)])])]))),128))])]))]))}},je={class:"mt-1 flex rounded-md shadow-sm relative"},Ne=["disabled"],Ue={class:"sr-only"},Pe=["id","value","min","max","placeholder","disabled"],ze=["disabled"],qe={class:"sr-only"},Te={__name:"ResponsiveNumberInput",props:{modelValue:{type:[String,Number],default:""},min:{type:[String,Number],default:0},max:{type:[String,Number],default:null},placeholder:{type:String,default:"0"},disabled:{type:Boolean,default:!1},label:{type:String,default:""},inputId:{type:String,default:""},showSteppers:{type:Boolean,default:!0}},emits:["update:modelValue","focus","blur"],setup(o,{emit:a}){const t=o,s=a,u=S(!1),b=ee(()=>{const i="focus:ring-primary-500 focus:border-primary-500 block w-full text-center sm:text-sm number-input-mobile";return t.showSteppers?`${i} border-gray-300 rounded-none sm:border-l-0 sm:border-r-0 sm:rounded-none rounded-md`:`${i} border-gray-300 rounded-md`}),w=i=>{const n=i.target.value;s("update:modelValue",n)},p=()=>{if(t.disabled)return;const i=t.modelValue===""?0:parseInt(t.modelValue)||0,n=t.max!==null?Math.min(i+1,parseInt(t.max)):i+1;s("update:modelValue",n)},c=()=>{if(t.disabled)return;const i=t.modelValue===""?0:parseInt(t.modelValue)||0,n=Math.max(parseInt(t.min),i-1);s("update:modelValue",n)},d=i=>{u.value=!0,s("focus",i)},y=i=>{u.value=!1,s("blur",i)};return(i,n)=>(l(),r("div",je,[o.showSteppers?(l(),r("button",{key:0,type:"button",onClick:c,class:"hidden sm:inline-flex relative items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",disabled:o.disabled},[e("span",Ue,"Decrease "+m(o.label||"value"),1),n[0]||(n[0]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 12H4"})],-1))],8,Ne)):_("",!0),e("input",{id:o.inputId,type:"number",value:o.modelValue,onInput:w,onFocus:d,onBlur:y,min:o.min,max:o.max,placeholder:o.placeholder,disabled:o.disabled,class:T(b.value),inputmode:"numeric",pattern:"[0-9]*"},null,42,Pe),o.showSteppers?(l(),r("button",{key:1,type:"button",onClick:p,class:"hidden sm:inline-flex relative items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",disabled:o.disabled},[e("span",qe,"Increase "+m(o.label||"value"),1),n[1]||(n[1]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1))],8,ze)):_("",!0)]))}},I=ge(Te,[["__scopeId","data-v-8ace7785"]]),Oe={class:"space-y-4"},We={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-3 sm:mb-2"},He={class:"text-sm font-medium text-gray-900 mb-2 sm:mb-0"},Qe={key:0,class:"ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"},Ge={class:"text-sm text-gray-500"},Ye={key:0,class:"ml-2 text-green-600"},Je={class:"space-y-3 sm:space-y-2"},Ke={key:0,class:"text-sm text-gray-500 italic p-2 text-center"},Xe={class:"flex items-center justify-between mb-3"},Ze={class:"flex items-center space-x-2"},et={class:"text-sm font-medium text-gray-900 bg-gray-100 rounded-md px-2 py-1 min-w-[2rem] text-center"},tt={class:"text-sm font-medium text-gray-900"},st={key:0,class:"ml-1 inline-flex items-center w-2 h-2 bg-green-500 rounded-full",title:"Will be restocked"},ot={class:"space-y-3"},it={class:"text-sm text-gray-500 font-medium pt-2 border-t"},nt={class:"col-span-1 text-sm font-medium text-gray-900 text-center bg-gray-100 rounded-md py-1"},at={class:"col-span-3 text-sm font-medium text-gray-900"},lt={key:0,class:"ml-1 inline-flex items-center w-2 h-2 bg-green-500 rounded-full",title:"Will be restocked"},rt={class:"col-span-2"},dt={class:"col-span-2"},ct={class:"col-span-2"},ut={class:"col-span-2 text-sm text-gray-500"},X={__name:"MachineProductsSection",props:{machines:Array},setup(o){const a=(c,d,y)=>{c[d]=y},t=c=>(parseInt(c.stock_before)||0)-(parseInt(c.discarded)||0)+(parseInt(c.restocked)||0),s=c=>c.stock_before!==""||c.restocked!==""||c.discarded!=="",u=c=>c.products.some(d=>s(d)),b=c=>c.products.filter(d=>s(d)).length,w=c=>u(c)?"border-green-300 bg-green-50":"border-gray-200",p=c=>s(c)?"bg-green-50 rounded-md p-2":"p-2";return(c,d)=>(l(),r("div",null,[d[6]||(d[6]=te('<h4 class="text-sm font-medium text-gray-700 mb-2">Machines at Location</h4><div class="mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"><div class="flex items-center"><svg class="h-5 w-5 text-blue-400 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><div class="text-sm text-blue-700"><p class="font-medium">Partial Restock Allowed</p><p class="text-blue-600">You can restock only the machines/products you need. Leave others empty to skip them.</p></div></div></div>',2)),e("div",Oe,[(l(!0),r(F,null,A(o.machines,y=>(l(),r("div",{key:y.id,class:T(["border rounded-lg p-3 sm:p-4",w(y)])},[e("div",We,[e("h5",He,[E(m(y.name)+" ("+m(y.machine_type)+" "+m(y.model)+") ",1),u(y)?(l(),r("span",Qe," Will be restocked ")):_("",!0)]),e("div",Ge,[E(m(y.products.length)+" products ",1),u(y)?(l(),r("span",Ye," ("+m(b(y))+" being restocked) ",1)):_("",!0)])]),e("div",Je,[y.products.length===0?(l(),r("div",Ke," No products in this machine ")):_("",!0),(l(!0),r(F,null,A(y.products,i=>(l(),r("div",{key:i.id,class:"sm:hidden"},[e("div",{class:T(["border rounded-lg p-3",p(i)])},[e("div",Xe,[e("div",Ze,[e("div",et,m(i.slot),1),e("div",tt,[E(m(i.name)+" ",1),s(i)?(l(),r("span",st)):_("",!0)])])]),e("div",ot,[e("div",null,[d[0]||(d[0]=e("label",{class:"block text-xs text-gray-500 mb-1"},"Current Stock",-1)),M(I,{modelValue:i.stock_before,"onUpdate:modelValue":[n=>i.stock_before=n,n=>a(i,"stock_before",n)],min:0,placeholder:"0",label:"Current Stock"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[d[1]||(d[1]=e("label",{class:"block text-xs text-gray-500 mb-1"},"Discarded Amount",-1)),M(I,{modelValue:i.discarded,"onUpdate:modelValue":[n=>i.discarded=n,n=>a(i,"discarded",n)],min:0,placeholder:"0",label:"Discarded Amount"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[d[2]||(d[2]=e("label",{class:"block text-xs text-gray-500 mb-1"},"Restock Amount",-1)),M(I,{modelValue:i.restocked,"onUpdate:modelValue":[n=>i.restocked=n,n=>a(i,"restocked",n)],min:0,placeholder:"0",label:"Restock Amount"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",it," New Total: "+m(t(i)),1)])],2)]))),128)),(l(!0),r(F,null,A(y.products,i=>(l(),r("div",{key:i.id,class:T(["hidden sm:grid grid-cols-12 gap-4 items-center",p(i)])},[e("div",nt,m(i.slot),1),e("div",at,[E(m(i.name)+" ",1),s(i)?(l(),r("span",lt)):_("",!0)]),e("div",rt,[d[3]||(d[3]=e("label",{class:"block text-xs text-gray-500"},"Current Stock",-1)),M(I,{modelValue:i.stock_before,"onUpdate:modelValue":[n=>i.stock_before=n,n=>a(i,"stock_before",n)],min:0,placeholder:"0",label:"Current Stock"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",dt,[d[4]||(d[4]=e("label",{class:"block text-xs text-gray-500"},"Discarded Amount",-1)),M(I,{modelValue:i.discarded,"onUpdate:modelValue":[n=>i.discarded=n,n=>a(i,"discarded",n)],min:0,placeholder:"0",label:"Discarded Amount"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",ct,[d[5]||(d[5]=e("label",{class:"block text-xs text-gray-500"},"Restock Amount",-1)),M(I,{modelValue:i.restocked,"onUpdate:modelValue":[n=>i.restocked=n,n=>a(i,"restocked",n)],min:0,placeholder:"0",label:"Restock Amount"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",ut," New Total: "+m(t(i)),1)],2))),128))])],2))),128))])]))}},mt={key:0,class:"fixed inset-0 overflow-y-auto z-50","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},ft={class:"sm:hidden min-h-screen bg-white"},vt={class:"flex items-center justify-between p-4 border-b border-gray-200 bg-white sticky top-0 z-10"},gt={class:"text-lg font-medium text-gray-900",id:"modal-title"},bt={class:"flex-1 overflow-y-auto p-4 pb-safe"},yt={class:"space-y-6"},pt=["value"],xt=["value"],ht=["value"],kt={for:"location-mobile",class:"block text-sm font-medium text-gray-700 mb-2"},wt={class:"text-xs text-gray-500 ml-1"},$t=["value"],_t=["value"],Rt={key:0,class:"text-gray-500"},Vt={class:"border-t border-gray-200 bg-white p-4 space-y-3 sticky bottom-0"},Ct=["disabled"],Dt={key:0,class:"inline-flex items-center"},St={key:1},Et={class:"hidden sm:flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Mt={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-5xl sm:w-full max-h-[90vh] flex flex-col"},Ft={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4 flex-1 overflow-y-auto"},At={class:"sm:flex sm:items-start"},Bt={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},It={class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"},Lt={class:"mt-4 space-y-4"},jt=["value"],Nt=["value"],Ut=["value"],Pt={for:"location",class:"block text-sm font-medium text-gray-700"},zt={class:"text-xs text-gray-500 ml-1"},qt=["value"],Tt=["value"],Ot={key:0,class:"text-gray-500"},Wt={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse border-t"},Ht=["disabled"],Qt={key:0,class:"inline-flex items-center"},Gt={key:1},Yt={__name:"RestockFormModal",props:{show:Boolean,isEditing:Boolean,restockForm:Object,selectedLocation:String,selectedRoute:String,locationSearchText:String,locations:Array,routes:Array,locationMachines:Array,saving:Boolean},emits:["close","save","route-change","location-search","location-change"],setup(o){return(a,t)=>o.show?(l(),r("div",mt,[e("div",ft,[e("form",{onSubmit:t[7]||(t[7]=J(s=>a.$emit("save"),["prevent"])),novalidate:"",class:"h-full flex flex-col"},[e("div",vt,[e("h3",gt,m(o.isEditing?"Edit Visit":"Record New Visit"),1),e("button",{type:"button",onClick:t[0]||(t[0]=s=>a.$emit("close")),class:"text-gray-400 hover:text-gray-500 focus:outline-none focus:text-gray-500 transition ease-in-out duration-150"},t[16]||(t[16]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",bt,[e("div",yt,[e("div",null,[t[19]||(t[19]=e("label",{for:"route-mobile",class:"block text-sm font-medium text-gray-700 mb-2"},"Filter by Route (Optional)",-1)),e("select",{id:"route-mobile",name:"route",value:o.selectedRoute,onChange:t[1]||(t[1]=s=>a.$emit("route-change",s.target.value)),class:"block w-full pl-3 pr-10 py-3 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 rounded-md"},[t[17]||(t[17]=e("option",{value:""},"All Routes",-1)),t[18]||(t[18]=e("option",{value:"unassigned"},"Unassigned",-1)),(l(!0),r(F,null,A(o.routes,s=>(l(),r("option",{key:s,value:s},m(s),9,xt))),128))],40,pt)]),e("div",null,[t[20]||(t[20]=e("label",{for:"location-search-mobile",class:"block text-sm font-medium text-gray-700 mb-2"},"Search Location",-1)),e("input",{id:"location-search-mobile",name:"location-search",type:"text",value:o.locationSearchText,onInput:t[2]||(t[2]=s=>a.$emit("location-search",s.target.value)),placeholder:"Type to search locations...",class:"block w-full pl-3 pr-3 py-3 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 rounded-md"},null,40,ht)]),e("div",null,[e("label",kt,[t[21]||(t[21]=E(" Location ")),e("span",wt,"("+m(o.locations.length)+" locations)",1)]),e("select",{id:"location-mobile",name:"location",value:o.selectedLocation,onChange:t[3]||(t[3]=s=>a.$emit("location-change",s.target.value)),class:"block w-full pl-3 pr-10 py-3 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 rounded-md",required:""},[t[22]||(t[22]=e("option",{value:"",disabled:""},"Select a location",-1)),(l(!0),r(F,null,A(o.locations,s=>(l(),r("option",{key:s.id,value:s.id},[E(m(s.name)+" ",1),s.route?(l(),r("span",Rt," - "+m(s.route),1)):_("",!0)],8,_t))),128))],40,$t)]),e("div",null,[t[23]||(t[23]=e("label",{for:"visit_date_mobile",class:"block text-sm font-medium text-gray-700 mb-2"},"Visit Date",-1)),z(e("input",{type:"datetime-local",name:"visit_date",id:"visit_date_mobile","onUpdate:modelValue":t[4]||(t[4]=s=>o.restockForm.visit_date=s),class:"focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm text-base border-gray-300 rounded-md text-gray-900 py-3",required:""},null,512),[[q,o.restockForm.visit_date]])]),o.locationMachines.length>0?(l(),K(X,{key:0,machines:o.locationMachines},null,8,["machines"])):_("",!0),e("div",null,[t[24]||(t[24]=e("label",{for:"notes-mobile",class:"block text-sm font-medium text-gray-700 mb-2"},"Visit Notes",-1)),z(e("textarea",{id:"notes-mobile",name:"notes",rows:"3","onUpdate:modelValue":t[5]||(t[5]=s=>o.restockForm.notes=s),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full text-base border border-gray-300 rounded-md py-3",placeholder:"Add any notes about this visit..."},null,512),[[q,o.restockForm.notes]])])])]),e("div",Vt,[e("button",{type:"submit",disabled:o.saving,class:"w-full inline-flex justify-center items-center rounded-md border border-transparent shadow-sm px-4 py-3 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed min-h-[48px]"},[o.saving?(l(),r("span",Dt,t[25]||(t[25]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),E(" Saving... ")]))):(l(),r("span",St,"Save Visit"))],8,Ct),e("button",{type:"button",onClick:t[6]||(t[6]=s=>a.$emit("close")),class:"w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-3 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 min-h-[48px]"}," Cancel ")])],32)]),e("div",Et,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[8]||(t[8]=s=>a.$emit("close"))}),t[35]||(t[35]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Mt,[e("form",{onSubmit:t[15]||(t[15]=J(s=>a.$emit("save"),["prevent"])),novalidate:"",class:"flex flex-col h-full"},[e("div",Ft,[e("div",At,[e("div",Bt,[e("h3",It,m(o.isEditing?"Edit Visit":"Record New Visit"),1),e("div",Lt,[e("div",null,[t[28]||(t[28]=e("label",{for:"route",class:"block text-sm font-medium text-gray-700"},"Filter by Route (Optional)",-1)),e("select",{id:"route",name:"route",value:o.selectedRoute,onChange:t[9]||(t[9]=s=>a.$emit("route-change",s.target.value)),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md"},[t[26]||(t[26]=e("option",{value:""},"All Routes",-1)),t[27]||(t[27]=e("option",{value:"unassigned"},"Unassigned",-1)),(l(!0),r(F,null,A(o.routes,s=>(l(),r("option",{key:s,value:s},m(s),9,Nt))),128))],40,jt)]),e("div",null,[t[29]||(t[29]=e("label",{for:"location-search",class:"block text-sm font-medium text-gray-700"},"Search Location",-1)),e("input",{id:"location-search",name:"location-search",type:"text",value:o.locationSearchText,onInput:t[10]||(t[10]=s=>a.$emit("location-search",s.target.value)),placeholder:"Type to search locations...",class:"mt-1 block w-full pl-3 pr-3 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md"},null,40,Ut)]),e("div",null,[e("label",Pt,[t[30]||(t[30]=E(" Location ")),e("span",zt,"("+m(o.locations.length)+" locations)",1)]),e("select",{id:"location",name:"location",value:o.selectedLocation,onChange:t[11]||(t[11]=s=>a.$emit("location-change",s.target.value)),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},[t[31]||(t[31]=e("option",{value:"",disabled:""},"Select a location",-1)),(l(!0),r(F,null,A(o.locations,s=>(l(),r("option",{key:s.id,value:s.id},[E(m(s.name)+" ",1),s.route?(l(),r("span",Ot," - "+m(s.route),1)):_("",!0)],8,Tt))),128))],40,qt)]),e("div",null,[t[32]||(t[32]=e("label",{for:"visit_date",class:"block text-sm font-medium text-gray-700"},"Visit Date",-1)),z(e("input",{type:"datetime-local",name:"visit_date",id:"visit_date","onUpdate:modelValue":t[12]||(t[12]=s=>o.restockForm.visit_date=s),class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md text-gray-900",required:""},null,512),[[q,o.restockForm.visit_date]])]),o.locationMachines.length>0?(l(),K(X,{key:0,machines:o.locationMachines},null,8,["machines"])):_("",!0),e("div",null,[t[33]||(t[33]=e("label",{for:"notes",class:"block text-sm font-medium text-gray-700"},"Visit Notes",-1)),z(e("textarea",{id:"notes",name:"notes",rows:"2","onUpdate:modelValue":t[13]||(t[13]=s=>o.restockForm.notes=s),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md"},null,512),[[q,o.restockForm.notes]])])])])])]),e("div",Wt,[e("button",{type:"submit",disabled:o.saving,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed"},[o.saving?(l(),r("span",Qt,t[34]||(t[34]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),E(" Saving... ")]))):(l(),r("span",Gt,"Save Visit"))],8,Ht),e("button",{type:"button",onClick:t[14]||(t[14]=s=>a.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])],32)])])])):_("",!0)}},Jt={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Kt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Xt={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full"},Zt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},es={class:"sm:flex sm:items-start"},ts={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},ss={key:0,class:"mt-4"},os={class:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2"},is={class:"sm:col-span-1"},ns={class:"mt-1 text-sm text-gray-900"},as={class:"sm:col-span-1"},ls={class:"mt-1 text-sm text-gray-900"},rs={class:"sm:col-span-1"},ds={class:"mt-1 text-sm text-gray-900"},cs={class:"sm:col-span-2"},us={class:"mt-1 text-sm text-gray-900"},ms={key:0,class:"mt-6"},fs={class:"text-sm font-semibold text-gray-700 mb-2 bg-gray-100 px-3 py-2 rounded-md"},vs={class:"border border-gray-200 rounded-md overflow-hidden"},gs={class:"divide-y divide-gray-200"},bs={class:"grid grid-cols-6 gap-2 items-center"},ys={class:"col-span-1 text-center bg-gray-100 rounded-md py-1 text-sm font-medium text-gray-900"},ps={class:"col-span-1 text-sm font-medium text-gray-900"},xs={class:"col-span-1 text-center text-sm text-gray-500"},hs={class:"col-span-1 text-center text-sm text-gray-500"},ks={class:"col-span-1 text-center text-sm text-green-600 font-medium"},ws={class:"col-span-1 text-center text-sm font-medium text-gray-900"},$s={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},_s={__name:"RestockDetailsModal",props:{show:Boolean,restock:Object},emits:["close"],setup(o){const a=o,t=ee(()=>{var u;if(!((u=a.restock)!=null&&u.entries))return{};const s={};return a.restock.entries.forEach(b=>{`${b.machine_name||"Unknown"}${b.machine_type||""}${b.machine_model||""}`;const w=`${b.machine_name||"Unknown Machine"} (${b.machine_type||"Unknown Type"}${b.machine_model?" "+b.machine_model:""})`;s[w]||(s[w]=[]),s[w].push(b)}),Object.keys(s).forEach(b=>{s[b].sort((w,p)=>{const c=w.slot||999,d=p.slot||999;return c-d})}),s});return(s,u)=>o.show?(l(),r("div",Jt,[e("div",Kt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:u[0]||(u[0]=b=>s.$emit("close"))}),u[9]||(u[9]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Xt,[e("div",Zt,[e("div",es,[e("div",ts,[u[8]||(u[8]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Restock Details ",-1)),o.restock?(l(),r("div",ss,[e("dl",os,[e("div",is,[u[2]||(u[2]=e("dt",{class:"text-sm font-medium text-gray-500"},"Location",-1)),e("dd",ns,m(o.restock.location_name),1)]),e("div",as,[u[3]||(u[3]=e("dt",{class:"text-sm font-medium text-gray-500"},"Visit Date",-1)),e("dd",ls,m(D(H)(o.restock.visit_date)),1)]),e("div",rs,[u[4]||(u[4]=e("dt",{class:"text-sm font-medium text-gray-500"},"Restocked By",-1)),e("dd",ds,m(o.restock.user_name),1)]),e("div",cs,[u[5]||(u[5]=e("dt",{class:"text-sm font-medium text-gray-500"},"Notes",-1)),e("dd",us,m(o.restock.notes||"No notes"),1)])]),o.restock.entries&&o.restock.entries.length>0?(l(),r("div",ms,[u[7]||(u[7]=e("h4",{class:"text-sm font-medium text-gray-500 mb-4"},"Restocked Items",-1)),(l(!0),r(F,null,A(t.value,(b,w)=>(l(),r("div",{key:w,class:"mb-6"},[e("h5",fs,m(w),1),e("div",vs,[u[6]||(u[6]=te('<div class="px-4 py-3 bg-gray-50 text-xs font-medium text-gray-500 uppercase tracking-wider"><div class="grid grid-cols-6 gap-2"><div class="col-span-1 text-center">Slot</div><div class="col-span-1">Product</div><div class="col-span-1 text-center">Prev Qty</div><div class="col-span-1 text-center">Discarded</div><div class="col-span-1 text-center">Added</div><div class="col-span-1 text-center">New Qty</div></div></div>',1)),e("div",gs,[(l(!0),r(F,null,A(b,p=>(l(),r("div",{key:p.id,class:"px-4 py-3"},[e("div",bs,[e("div",ys,m(p.slot||"-"),1),e("div",ps,m(p.product_name),1),e("div",xs,m(p.previous_quantity),1),e("div",hs,m(p.quantity_discarded),1),e("div",ks," +"+m(p.quantity_added),1),e("div",ws,m(p.previous_quantity+p.quantity_added-p.quantity_discarded),1)])]))),128))])])]))),128))])):_("",!0)])):_("",!0)])])]),e("div",$s,[e("button",{type:"button",onClick:u[1]||(u[1]=b=>s.$emit("close")),class:"w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:w-auto sm:text-sm"}," Close ")])])])])):_("",!0)}},Rs={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Vs={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Cs={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Ds={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Ss={class:"sm:flex sm:items-start"},Es={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},Ms={key:0,class:"mt-2"},Fs={class:"text-sm text-gray-500"},As={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Bs={__name:"DeleteConfirmationModal",props:{show:Boolean,restock:Object},emits:["close","confirm"],setup(o){return(a,t)=>o.show?(l(),r("div",Rs,[e("div",Vs,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=s=>a.$emit("close"))}),t[5]||(t[5]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Cs,[e("div",Ds,[e("div",Ss,[t[4]||(t[4]=e("div",{class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"},[e("svg",{class:"h-6 w-6 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),e("div",Es,[t[3]||(t[3]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Delete Visit ",-1)),o.restock?(l(),r("div",Ms,[e("p",Fs," Are you sure you want to delete this visit to "+m(o.restock.location_name)+" on "+m(D(H)(o.restock.visit_date))+"? This action will also reverse all inventory changes made during this visit. This action cannot be undone. ",1)])):_("",!0)])])]),e("div",As,[e("button",{type:"button",onClick:t[1]||(t[1]=s=>a.$emit("confirm")),class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"}," Delete "),e("button",{type:"button",onClick:t[2]||(t[2]=s=>a.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])])])])):_("",!0)}},zs={__name:"Restocks",setup(o){const a=Z(),{restocks:t,loading:s,error:u,fetchRestocks:b,deleteVisit:w,getVisitDetails:p}=be(),{filteredLocations:c,routes:d,selectedRoute:y,locationSearchText:i,fetchLocations:n,fetchRoutes:B,resetFilters:L}=me(),{locationMachines:v,fetchLocationMachines:R,updateMachineProductData:C,resetMachineData:f}=fe(),{restockForm:g,isEditing:x,selectedLocation:k,saving:N,initializeForm:Q,saveRestockOptimized:se}=ye(),j=S(!1),O=S(!1),U=S(!1),W=S(null),P=S(null),G=()=>{Q(),L(),f(),j.value=!0},oe=async h=>{Q(h),L(),await R(h.location_id);try{for(const V of v.value)await C(h.id,V.id);j.value=!0}catch(V){console.error("Error loading visit for editing:",V),u.value="Failed to load visit details for editing. Please try again."}},ie=async h=>{W.value=h;try{const V=await p(h.id);W.value={...h,entries:V},O.value=!0}catch(V){console.error("Error fetching visit details:",V),u.value="Failed to load visit details. Please try again."}},ne=h=>{P.value=h,U.value=!0},ae=async()=>{try{await w(P.value.id),U.value=!1,P.value=null}catch(h){console.error("Error deleting visit:",h),u.value="Failed to delete visit. Please try again."}},le=async()=>{await se(v.value)&&(j.value=!1,await b())},re=h=>{y.value=h,k.value="",f()},de=h=>{i.value=h},ce=h=>{k.value=h,R(h)};return ue(async()=>{a.isAuthenticated&&!a.user&&await a.fetchUser(),console.log("Current user:",a.user),await Promise.all([b(),n(),B()])}),(h,V)=>(l(),r("div",null,[e("div",{class:"flex justify-between items-center mb-6"},[V[3]||(V[3]=e("h1",{class:"text-2xl font-semibold text-gray-900"},"Location Visits",-1)),e("button",{onClick:G,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Record New Visit ")]),M(Le,{restocks:D(t),loading:D(s),error:D(u),onAddRestock:G,onViewDetails:ie,onEditRestock:oe,onDeleteRestock:ne},null,8,["restocks","loading","error"]),M(Yt,{show:j.value,"is-editing":D(x),"restock-form":D(g),"selected-location":D(k),"selected-route":D(y),"location-search-text":D(i),locations:D(c),routes:D(d),"location-machines":D(v),saving:D(N),onClose:V[0]||(V[0]=Y=>j.value=!1),onSave:le,onRouteChange:re,onLocationSearch:de,onLocationChange:ce},null,8,["show","is-editing","restock-form","selected-location","selected-route","location-search-text","locations","routes","location-machines","saving"]),M(_s,{show:O.value,restock:W.value,onClose:V[1]||(V[1]=Y=>O.value=!1)},null,8,["show","restock"]),M(Bs,{show:U.value,restock:P.value,onClose:V[2]||(V[2]=Y=>U.value=!1),onConfirm:ae},null,8,["show","restock"])]))}};export{zs as default};
