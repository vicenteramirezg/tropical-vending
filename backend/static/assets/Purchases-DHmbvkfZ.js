import{r as u,h as S,o as L,c as r,a as t,i as b,t as l,F as j,e as U,j as Q,w as v,v as $,k,g as n,u as z}from"./index-C_eu1tB3.js";import{a as y}from"./api-CnOhYW_x.js";import{a as M,f as W}from"./dateUtils-CXdyRzwD.js";const G={key:0,class:"flex justify-center"},J={key:1,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-4"},O={class:"flex"},R={class:"ml-3"},H={class:"text-sm text-red-700"},K={key:2,class:"bg-white shadow overflow-hidden sm:rounded-lg"},X={key:3,class:"bg-white shadow overflow-hidden sm:rounded-lg"},Y={role:"list",class:"divide-y divide-gray-200"},Z={class:"flex items-center justify-between"},tt={class:"flex items-center"},et={class:"text-sm font-medium text-primary-600"},st={class:"ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800"},ot={class:"ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"},at={key:0,class:"ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800"},lt={class:"mt-1"},rt={class:"text-sm text-gray-500"},nt={class:"text-sm text-gray-500"},it={class:"flex space-x-2"},dt=["onClick"],ut=["onClick"],ct={key:4,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},mt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},pt={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},ft={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},vt={class:"sm:flex sm:items-start"},yt={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},gt={class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"},xt={class:"mt-4 space-y-4"},bt=["value"],ht={class:"grid grid-cols-2 gap-4"},_t={class:"grid grid-cols-2 gap-4"},wt={class:"bg-gray-50 p-3 rounded-md"},kt={class:"text-lg font-bold text-primary-600"},qt={key:0,class:"bg-gray-50 p-3 rounded-md"},Ct={class:"text-lg font-bold text-primary-600"},Pt={class:"text-xs text-gray-500 mt-1"},Ft={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Dt={type:"submit",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm"},St={key:5,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},jt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Ut={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},$t={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Mt={class:"sm:flex sm:items-start"},Tt={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},Et={class:"mt-2"},Nt={key:0,class:"text-sm text-red-500 mt-2"},Vt={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Qt={__name:"Purchases",setup(At){const h=u([]),_=u([]),q=u(!0),c=u(null),d=u(null),p=u(!1),g=u(!1),f=u(!1),x=u(null),a=u({id:null,product:"",supplier:"",purchase_date:"",quantity:1,total_cost:0,notes:""});S(()=>(parseFloat(a.value.quantity),parseFloat(a.value.total_cost)||0));const F=S(()=>{const s=parseFloat(a.value.quantity)||0,e=parseFloat(a.value.total_cost)||0;return s>0?e/s:0}),T=()=>{if(!d.value)return 0;const s=d.value.inventory_quantity||0,e=parseInt(a.value.quantity)||0;if(f.value){const o=h.value.find(m=>m.id===a.value.id),i=o&&parseInt(o.quantity)||0;return s+(e-i)}return s+e},C=async()=>{q.value=!0;try{const s=await y.getPurchases();console.log("Purchases data:",s.data),h.value=s.data.map(e=>{const o=e.cost_per_unit||e.unit_cost||(e.total_cost&&e.quantity?e.total_cost/e.quantity:0),i=e.purchase_date||e.purchased_at;return{...e,purchase_date:i,total_cost:e.total_cost||e.cost_per_unit*e.quantity,cost_per_unit:o}})}catch(s){console.error("Error fetching purchases:",s),c.value="Failed to load purchases. Please try again later."}finally{q.value=!1}},P=async()=>{try{const s=await y.getProducts();_.value=s.data}catch(s){console.error("Error fetching products:",s)}},E=()=>{if(a.value.product){if(d.value=_.value.find(s=>s.id==a.value.product),d.value&&d.value.latest_cost){const s=parseFloat(d.value.latest_cost);s>0&&(a.value.total_cost=s*a.value.quantity,w())}}else d.value=null},D=()=>{f.value=!1,d.value=null,a.value={id:null,product:"",supplier:"",purchase_date:M(),quantity:1,total_cost:0,notes:""},p.value=!0},N=s=>{f.value=!0;const e=s.total_cost||s.cost_per_unit*s.quantity;let o=s.purchased_at||s.purchase_date,i=o?o.split("T")[0]:"";i||(i=M()),a.value={id:s.id,product:s.product,supplier:s.supplier||"",purchase_date:i,quantity:s.quantity,total_cost:e,notes:s.notes||""},s.product&&(d.value=_.value.find(m=>m.id==s.product)),w(),p.value=!0},V=async()=>{try{const s=parseInt(a.value.quantity)||0,e=parseFloat(a.value.total_cost)||0;if(s<=0){c.value="Quantity must be greater than zero";return}if(e<=0){c.value="Total cost must be greater than zero";return}const o=`${a.value.purchase_date}T12:00:00`,i={product:a.value.product,supplier:a.value.supplier,purchased_at:o,purchase_date:o,quantity:s,total_cost:e,notes:a.value.notes||"",cost_per_unit:Math.round(F.value*100)/100};console.log("Saving purchase with data:",i);let m;f.value?m=await y.updatePurchase(a.value.id,i):m=await y.createPurchase(i),console.log("Purchase saved successfully:",m.data);const B=await y.getProduct(a.value.product);console.log("Updated product:",B.data),p.value=!1,await Promise.all([C(),P()])}catch(s){console.error("Error saving purchase:",s),s.response&&s.response.data?(console.error("Server error details:",s.response.data),c.value=`Failed to save purchase: ${JSON.stringify(s.response.data)}`):c.value="Failed to save purchase. Please try again."}},A=s=>{x.value=s,g.value=!0},I=async()=>{if(x.value)try{await y.deletePurchase(x.value.id),g.value=!1,await Promise.all([C(),P()])}catch(s){console.error("Error deleting purchase:",s),c.value="Failed to delete purchase. Please try again."}},w=()=>{const s=parseFloat(a.value.quantity)||0,e=parseFloat(a.value.total_cost)||0;s>0?a.value.cost_per_unit=Math.round(e/s*100)/100:a.value.cost_per_unit=0};return L(async()=>{await Promise.all([C(),P()])}),(s,e)=>(n(),r("div",null,[t("div",{class:"flex justify-between items-center mb-6"},[e[10]||(e[10]=t("h1",{class:"text-2xl font-semibold text-gray-900"},"Wholesale Purchases",-1)),t("button",{onClick:D,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Add Purchase ")]),q.value?(n(),r("div",G,e[11]||(e[11]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))):c.value?(n(),r("div",J,[t("div",O,[e[12]||(e[12]=t("div",{class:"flex-shrink-0"},[t("span",{class:"text-red-400"},"⚠")],-1)),t("div",R,[t("p",H,l(c.value),1)])])])):h.value.length===0?(n(),r("div",K,[t("div",{class:"px-4 py-5 sm:p-6 text-center"},[e[13]||(e[13]=t("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"No purchases found",-1)),e[14]||(e[14]=t("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[t("p",null,"Get started by recording your first wholesale purchase.")],-1)),t("div",{class:"mt-5"},[t("button",{onClick:D,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Add Purchase ")])])])):(n(),r("div",X,[t("ul",Y,[(n(!0),r(j,null,U(h.value,o=>(n(),r("li",{key:o.id,class:"px-4 py-4 sm:px-6"},[t("div",Z,[t("div",null,[t("div",tt,[t("p",et,l(o.product_name),1),t("span",st,l(o.quantity)+" units ",1),t("span",ot,l(o.supplier||"Unknown"),1),o.current_inventory?(n(),r("span",at," Inventory: "+l(o.current_inventory),1)):b("",!0)]),t("div",lt,[t("p",rt," Date: "+l(z(W)(o.purchase_date)),1),t("p",nt," Total: $"+l(parseFloat(o.total_cost).toFixed(2))+" | Unit Cost: $"+l(parseFloat(o.cost_per_unit||o.total_cost/o.quantity).toFixed(2)),1)])]),t("div",it,[t("button",{onClick:i=>N(o),class:"inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Edit ",8,dt),t("button",{onClick:i=>A(o),class:"inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," Delete ",8,ut)])])]))),128))])])),p.value?(n(),r("div",ct,[t("div",mt,[t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:e[0]||(e[0]=o=>p.value=!1)}),e[25]||(e[25]=t("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),t("div",pt,[t("form",{onSubmit:Q(V,["prevent"])},[t("div",ft,[t("div",vt,[t("div",yt,[t("h3",gt,l(f.value?"Edit Purchase":"Add New Purchase"),1),t("div",xt,[t("div",null,[e[16]||(e[16]=t("label",{for:"product",class:"block text-sm font-medium text-gray-700"},"Product",-1)),v(t("select",{id:"product",name:"product","onUpdate:modelValue":e[1]||(e[1]=o=>a.value.product=o),onChange:E,class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},[e[15]||(e[15]=t("option",{value:"",disabled:""},"Select a product",-1)),(n(!0),r(j,null,U(_.value,o=>(n(),r("option",{key:o.id,value:o.id},l(o.name)+" ("+l(o.inventory_quantity)+" in stock) ",9,bt))),128))],544),[[$,a.value.product]])]),t("div",null,[e[18]||(e[18]=t("label",{for:"supplier",class:"block text-sm font-medium text-gray-700"},"Supplier",-1)),v(t("select",{id:"supplier",name:"supplier","onUpdate:modelValue":e[2]||(e[2]=o=>a.value.supplier=o),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},e[17]||(e[17]=[t("option",{value:"",disabled:""},"Select a supplier",-1),t("option",{value:"Sams"},"Sams",-1),t("option",{value:"Star"},"Star",-1)]),512),[[$,a.value.supplier]])]),t("div",null,[e[19]||(e[19]=t("label",{for:"purchase_date",class:"block text-sm font-medium text-gray-700"},"Purchase Date",-1)),v(t("input",{type:"date",name:"purchase_date",id:"purchase_date","onUpdate:modelValue":e[3]||(e[3]=o=>a.value.purchase_date=o),class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md",required:""},null,512),[[k,a.value.purchase_date]])]),t("div",ht,[t("div",null,[e[20]||(e[20]=t("label",{for:"quantity",class:"block text-sm font-medium text-gray-700"},"Quantity",-1)),v(t("input",{type:"number",name:"quantity",id:"quantity","onUpdate:modelValue":e[4]||(e[4]=o=>a.value.quantity=o),min:"1",onChange:w,class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md",required:""},null,544),[[k,a.value.quantity]])]),t("div",null,[e[21]||(e[21]=t("label",{for:"total_cost",class:"block text-sm font-medium text-gray-700"},"Total Cost ($)",-1)),v(t("input",{type:"number",name:"total_cost",id:"total_cost","onUpdate:modelValue":e[5]||(e[5]=o=>a.value.total_cost=o),min:"0.01",step:"0.01",onChange:w,class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md",required:""},null,544),[[k,a.value.total_cost]])])]),t("div",null,[e[22]||(e[22]=t("label",{for:"notes",class:"block text-sm font-medium text-gray-700"},"Notes",-1)),v(t("textarea",{id:"notes",name:"notes",rows:"3","onUpdate:modelValue":e[6]||(e[6]=o=>a.value.notes=o),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md"},null,512),[[k,a.value.notes]])]),t("div",_t,[t("div",wt,[e[23]||(e[23]=t("div",{class:"text-sm font-medium text-gray-700"},"Unit Cost:",-1)),t("div",kt," $"+l(F.value.toFixed(2))+" per unit ",1)]),d.value?(n(),r("div",qt,[e[24]||(e[24]=t("div",{class:"text-sm font-medium text-gray-700"},"Current Inventory:",-1)),t("div",Ct,l(d.value.inventory_quantity||0)+" units ",1),t("div",Pt," After purchase: "+l(T())+" units ",1)])):b("",!0)])])])])]),t("div",Ft,[t("button",Dt,l(f.value?"Update":"Add"),1),t("button",{type:"button",onClick:e[7]||(e[7]=o=>p.value=!1),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])],32)])])])):b("",!0),g.value?(n(),r("div",St,[t("div",jt,[t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:e[8]||(e[8]=o=>g.value=!1)}),e[29]||(e[29]=t("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),t("div",Ut,[t("div",$t,[t("div",Mt,[e[28]||(e[28]=t("div",{class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"},[t("svg",{class:"h-6 w-6 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),t("div",Tt,[e[27]||(e[27]=t("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Delete Purchase ",-1)),t("div",Et,[e[26]||(e[26]=t("p",{class:"text-sm text-gray-500"}," Are you sure you want to delete this purchase record? This action cannot be undone. ",-1)),x.value?(n(),r("p",Nt," Note: This will also reduce your inventory by "+l(x.value.quantity)+" units. ",1)):b("",!0)])])])]),t("div",Vt,[t("button",{type:"button",onClick:I,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"}," Delete "),t("button",{type:"button",onClick:e[9]||(e[9]=o=>g.value=!1),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])])])])):b("",!0)]))}};export{Qt as default};
