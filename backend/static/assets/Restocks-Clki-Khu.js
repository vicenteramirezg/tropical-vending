import{r,j as ee,k as te,o as se,c as n,a as e,g as q,t as i,F as b,d as h,h as oe,w as _,v as T,i as $,b as V,f as a}from"./index-CTXLI329.js";import{a as u}from"./api-B-_8r4R7.js";const ie={key:0,class:"flex justify-center"},ne={key:1,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-4"},ae={class:"flex"},le={class:"ml-3"},re={class:"text-sm text-red-700"},de={key:2,class:"bg-white shadow overflow-hidden sm:rounded-lg"},ce={key:3,class:"bg-white shadow overflow-hidden sm:rounded-lg"},me={role:"list",class:"divide-y divide-gray-200"},ue={class:"flex items-center justify-between"},ve={class:"flex items-center"},fe={class:"text-sm font-medium text-primary-600"},ge={class:"ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"},pe={class:"mt-1"},xe={class:"text-sm text-gray-500"},ye={class:"flex space-x-2"},be=["onClick"],he=["onClick"],_e=["onClick"],we={key:4,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},ke={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Ce={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Me={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Re={class:"sm:flex sm:items-start"},qe={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},De={class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"},Se={class:"mt-4 space-y-4"},je=["value"],$e=["disabled"],Ve={value:"",disabled:""},Ee=["value"],Le={key:0},Ne={class:"border border-gray-200 rounded-md overflow-hidden"},Pe={class:"divide-y divide-gray-200"},Ae={class:"grid grid-cols-6 gap-2 items-center"},Ie={class:"col-span-3 text-sm font-medium text-gray-900"},Fe={class:"col-span-1 text-center text-sm text-gray-500"},Ue={class:"col-span-1"},Be=["onUpdate:modelValue"],Qe={class:"col-span-1 text-center text-sm font-medium text-gray-900"},Te={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},ze={type:"submit",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm"},Ge={key:5,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},He={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Ye={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Je={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Ke={class:"sm:flex sm:items-start"},Oe={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},We={class:"mt-4"},Xe={class:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2"},Ze={class:"sm:col-span-1"},et={class:"mt-1 text-sm text-gray-900"},tt={class:"sm:col-span-1"},st={class:"mt-1 text-sm text-gray-900"},ot={class:"sm:col-span-1"},it={class:"mt-1 text-sm text-gray-900"},nt={class:"sm:col-span-1"},at={class:"mt-1 text-sm text-gray-900"},lt={class:"sm:col-span-2"},rt={class:"mt-1 text-sm text-gray-900"},dt={class:"mt-6"},ct={class:"mt-2 border border-gray-200 rounded-md overflow-hidden"},mt={class:"divide-y divide-gray-200"},ut={class:"grid grid-cols-5 gap-2 items-center"},vt={class:"col-span-2 text-sm font-medium text-gray-900"},ft={class:"col-span-1 text-center text-sm text-gray-500"},gt={class:"col-span-1 text-center text-sm text-green-600 font-medium"},pt={class:"col-span-1 text-center text-sm font-medium text-gray-900"},xt={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},yt={key:6,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},bt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},ht={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},_t={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Mt={__name:"Restocks",setup(wt){const D=r([]),E=r([]),g=r([]),m=r([]),S=r(!0),v=r(null),p=r(!1),w=r(!1),x=r(!1),y=r(!1),d=r(null),f=r(""),l=r({id:null,machine:"",visit_date:"",notes:"",entries:[]}),L=o=>o?new Date(o).toLocaleString():"",j=async()=>{S.value=!0;try{const o=await u.getRestocks();D.value=o.data}catch(o){console.error("Error fetching restocks:",o),v.value="Failed to load restocks. Please try again later."}finally{S.value=!1}},z=async()=>{try{const o=await u.getLocations();E.value=o.data}catch(o){console.error("Error fetching locations:",o)}},G=async()=>{if(!f.value){g.value=[];return}try{const o=await u.getMachines({location:f.value});g.value=o.data,l.value.machine="",m.value=[]}catch(o){console.error("Error fetching machines:",o)}},H=async()=>{if(!l.value.machine){m.value=[];return}try{const o=await u.getMachineItems({machine:l.value.machine});m.value=o.data.map(t=>({machine_item_id:t.id,product_id:t.product,product_name:t.product_name,current_quantity:t.current_quantity,quantity_added:0}))}catch(o){console.error("Error fetching machine items:",o)}},N=()=>{y.value=!1,f.value="",g.value=[],m.value=[];const o=new Date,t=o.getFullYear(),c=String(o.getMonth()+1).padStart(2,"0"),k=String(o.getDate()).padStart(2,"0"),C=String(o.getHours()).padStart(2,"0"),M=String(o.getMinutes()).padStart(2,"0");l.value={id:null,machine:"",visit_date:`${t}-${c}-${k}T${C}:${M}`,notes:"",entries:[]},p.value=!0},Y=o=>{d.value=o,w.value=!0},J=o=>{y.value=!0,d.value=o,alert("Editing restocks is complex and not fully implemented in this demo")},K=async()=>{try{const o=m.value.filter(c=>parseInt(c.quantity_added)>0).map(c=>({machine_item:c.machine_item_id,quantity_added:parseInt(c.quantity_added)}));if(o.length===0){v.value="Please add at least one restock entry";return}const t={machine:l.value.machine,visit_date:l.value.visit_date,notes:l.value.notes,entries:o};y.value?await u.updateRestock(l.value.id,t):await u.createRestock(t),p.value=!1,await j()}catch(o){console.error("Error saving restock:",o),v.value="Failed to save restock. Please try again."}},O=o=>{d.value=o,x.value=!0},W=async()=>{if(d.value)try{await u.deleteRestock(d.value.id),x.value=!1,await j()}catch(o){console.error("Error deleting restock:",o),v.value="Failed to delete restock. Please try again."}},X=ee(()=>l.value.machine);return te(X,o=>{o&&H()}),se(async()=>{await Promise.all([j(),z()])}),(o,t)=>{var c,k,C,M,P,A,I,F,U,B,Q;return a(),n("div",null,[e("div",{class:"flex justify-between items-center mb-6"},[t[10]||(t[10]=e("h1",{class:"text-2xl font-semibold text-gray-900"},"Restocks",-1)),e("button",{onClick:N,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Add Restock ")]),S.value?(a(),n("div",ie,t[11]||(t[11]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))):v.value?(a(),n("div",ne,[e("div",ae,[t[12]||(t[12]=e("div",{class:"flex-shrink-0"},[e("span",{class:"text-red-400"},"⚠")],-1)),e("div",le,[e("p",re,i(v.value),1)])])])):D.value.length===0?(a(),n("div",de,[e("div",{class:"px-4 py-5 sm:p-6 text-center"},[t[13]||(t[13]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"No restocks found",-1)),t[14]||(t[14]=e("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[e("p",null,"Get started by recording your first restock operation.")],-1)),e("div",{class:"mt-5"},[e("button",{onClick:N,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Add Restock ")])])])):(a(),n("div",ce,[e("ul",me,[(a(!0),n(b,null,h(D.value,s=>(a(),n("li",{key:s.id,class:"px-4 py-4 sm:px-6"},[e("div",ue,[e("div",null,[e("div",ve,[e("p",fe,"Visit: "+i(L(s.visit.visit_date)),1),e("span",ge,i(s.entry_count)+" items ",1)]),e("div",pe,[e("p",xe," Machine: "+i(s.machine.machine_type)+" at "+i(s.machine.location_name),1)])]),e("div",ye,[e("button",{onClick:R=>Y(s),class:"inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Details ",8,be),e("button",{onClick:R=>J(s),class:"inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Edit ",8,he),e("button",{onClick:R=>O(s),class:"inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," Delete ",8,_e)])])]))),128))])])),p.value?(a(),n("div",we,[e("div",ke,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=s=>p.value=!1)}),t[22]||(t[22]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Ce,[e("form",{onSubmit:oe(K,["prevent"])},[e("div",Me,[e("div",Re,[e("div",qe,[e("h3",De,i(y.value?"Edit Restock":"Add New Restock"),1),e("div",Se,[e("div",null,[t[16]||(t[16]=e("label",{for:"location",class:"block text-sm font-medium text-gray-700"},"Location",-1)),_(e("select",{id:"location",name:"location","onUpdate:modelValue":t[1]||(t[1]=s=>f.value=s),onChange:G,class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},[t[15]||(t[15]=e("option",{value:"",disabled:""},"Select a location",-1)),(a(!0),n(b,null,h(E.value,s=>(a(),n("option",{key:s.id,value:s.id},i(s.name),9,je))),128))],544),[[T,f.value]])]),e("div",null,[t[17]||(t[17]=e("label",{for:"machine",class:"block text-sm font-medium text-gray-700"},"Machine",-1)),_(e("select",{id:"machine",name:"machine","onUpdate:modelValue":t[2]||(t[2]=s=>l.value.machine=s),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:"",disabled:!f.value},[e("option",Ve,i(g.value.length?"Select a machine":"Select a location first"),1),(a(!0),n(b,null,h(g.value,s=>(a(),n("option",{key:s.id,value:s.id},i(s.machine_type)+" ("+i(s.model)+") ",9,Ee))),128))],8,$e),[[T,l.value.machine]])]),e("div",null,[t[18]||(t[18]=e("label",{for:"visit_date",class:"block text-sm font-medium text-gray-700"},"Visit Date",-1)),_(e("input",{type:"datetime-local",name:"visit_date",id:"visit_date","onUpdate:modelValue":t[3]||(t[3]=s=>l.value.visit_date=s),class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md",required:""},null,512),[[$,l.value.visit_date]])]),e("div",null,[t[19]||(t[19]=e("label",{for:"notes",class:"block text-sm font-medium text-gray-700"},"Notes",-1)),_(e("textarea",{id:"notes",name:"notes",rows:"2","onUpdate:modelValue":t[4]||(t[4]=s=>l.value.notes=s),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md"},null,512),[[$,l.value.notes]])]),m.value.length>0?(a(),n("div",Le,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Restock Items",-1)),e("div",Ne,[t[20]||(t[20]=V('<div class="px-4 py-3 bg-gray-50 text-xs font-medium text-gray-500 uppercase tracking-wider"><div class="grid grid-cols-6 gap-2"><div class="col-span-3">Product</div><div class="col-span-1 text-center">Prev Qty</div><div class="col-span-1 text-center">Add</div><div class="col-span-1 text-center">New Qty</div></div></div>',1)),e("div",Pe,[(a(!0),n(b,null,h(m.value,(s,R)=>(a(),n("div",{key:R,class:"px-4 py-3"},[e("div",Ae,[e("div",Ie,i(s.product_name),1),e("div",Fe,i(s.current_quantity),1),e("div",Ue,[_(e("input",{type:"number","onUpdate:modelValue":Z=>s.quantity_added=Z,min:"0",class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm"},null,8,Be),[[$,s.quantity_added]])]),e("div",Qe,i(s.current_quantity+(parseInt(s.quantity_added)||0)),1)])]))),128))])])])):q("",!0)])])])]),e("div",Te,[e("button",ze,i(y.value?"Update":"Add"),1),e("button",{type:"button",onClick:t[5]||(t[5]=s=>p.value=!1),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])],32)])])])):q("",!0),w.value?(a(),n("div",Ge,[e("div",He,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[6]||(t[6]=s=>w.value=!1)}),t[31]||(t[31]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Ye,[e("div",Je,[e("div",Ke,[e("div",Oe,[t[30]||(t[30]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Restock Details ",-1)),e("div",We,[e("dl",Xe,[e("div",Ze,[t[23]||(t[23]=e("dt",{class:"text-sm font-medium text-gray-500"},"Location",-1)),e("dd",et,i((k=(c=d.value)==null?void 0:c.machine)==null?void 0:k.location_name),1)]),e("div",tt,[t[24]||(t[24]=e("dt",{class:"text-sm font-medium text-gray-500"},"Machine",-1)),e("dd",st,i((M=(C=d.value)==null?void 0:C.machine)==null?void 0:M.machine_type),1)]),e("div",ot,[t[25]||(t[25]=e("dt",{class:"text-sm font-medium text-gray-500"},"Visit Date",-1)),e("dd",it,i(L((A=(P=d.value)==null?void 0:P.visit)==null?void 0:A.visit_date)),1)]),e("div",nt,[t[26]||(t[26]=e("dt",{class:"text-sm font-medium text-gray-500"},"Restocked By",-1)),e("dd",at,i((F=(I=d.value)==null?void 0:I.visit)==null?void 0:F.user_name),1)]),e("div",lt,[t[27]||(t[27]=e("dt",{class:"text-sm font-medium text-gray-500"},"Notes",-1)),e("dd",rt,i(((B=(U=d.value)==null?void 0:U.visit)==null?void 0:B.notes)||"No notes"),1)])]),e("div",dt,[t[29]||(t[29]=e("h4",{class:"text-sm font-medium text-gray-500"},"Restocked Items",-1)),e("div",ct,[t[28]||(t[28]=V('<div class="px-4 py-3 bg-gray-50 text-xs font-medium text-gray-500 uppercase tracking-wider"><div class="grid grid-cols-5 gap-2"><div class="col-span-2">Product</div><div class="col-span-1 text-center">Prev Qty</div><div class="col-span-1 text-center">Added</div><div class="col-span-1 text-center">New Qty</div></div></div>',1)),e("div",mt,[(a(!0),n(b,null,h((Q=d.value)==null?void 0:Q.entries,s=>(a(),n("div",{key:s.id,class:"px-4 py-3"},[e("div",ut,[e("div",vt,i(s.product_name),1),e("div",ft,i(s.previous_quantity),1),e("div",gt," +"+i(s.quantity_added),1),e("div",pt,i(s.previous_quantity+s.quantity_added),1)])]))),128))])])])])])])]),e("div",xt,[e("button",{type:"button",onClick:t[7]||(t[7]=s=>w.value=!1),class:"w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:w-auto sm:text-sm"}," Close ")])])])])):q("",!0),x.value?(a(),n("div",yt,[e("div",bt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[8]||(t[8]=s=>x.value=!1)}),t[33]||(t[33]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",ht,[t[32]||(t[32]=V('<div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"><div class="sm:flex sm:items-start"><div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"><svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg></div><div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"><h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title"> Delete Restock </h3><div class="mt-2"><p class="text-sm text-gray-500"> Are you sure you want to delete this restock record? This action cannot be undone. </p></div></div></div></div>',1)),e("div",_t,[e("button",{type:"button",onClick:W,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"}," Delete "),e("button",{type:"button",onClick:t[9]||(t[9]=s=>x.value=!1),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])])])])):q("",!0)])}}};export{Mt as default};
