import{a as g}from"./api-DGXZpFB6.js";import{r as v,a as z,c as L,b as d,o as i,d as t,w as _,v as k,e as A,F as j,f as R,t as c,g as D,h as P,i as x,n as T,j as E,k as M,l as B,m as q,u as m}from"./index-DJ1kStQD.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";function O(){const o=v(!0),r=v(null),e=v([]),a=v({locations:!1,dashboard:!1}),l=v({locations:0,machines:0,products:0,low_stock_items:[],low_stock_count:0,recent_restocks:0,revenue_total:0,profit_total:0,profit_margin:0}),u=z({timeRange:"30",location:"",machineType:""}),h=L(()=>Object.values(a.value).some(s=>s)||o.value),b=L(()=>l.value.locations>0||l.value.machines>0||l.value.products>0),p=()=>{const s={days:u.timeRange};return u.location&&(s.location=u.location),u.machineType&&(s.machine_type=u.machineType),s},y=async()=>{if(!(e.value.length>0)){a.value.locations=!0;try{const s=await g.getLocations();e.value=s.data.results||s.data}catch(s){console.error("Error fetching locations:",s)}finally{a.value.locations=!1}}},f=async s=>{a.value.dashboard=!0;try{const n=await g.getDashboardData(s);l.value={locations:n.data.locations||0,machines:n.data.machines||0,products:n.data.products||0,low_stock_items:n.data.low_stock_items||[],low_stock_count:n.data.low_stock_count||0,recent_restocks:n.data.recent_restocks||0,revenue_total:n.data.revenue_total||0,profit_total:n.data.profit_total||0,profit_margin:n.data.profit_margin||0}}catch(n){throw console.error("Error fetching dashboard data:",n),l.value={locations:0,machines:0,products:0,low_stock_items:[],low_stock_count:0,recent_restocks:0,revenue_total:0,profit_total:0,profit_margin:0},new Error("Failed to load dashboard data")}finally{a.value.dashboard=!1}},$=async()=>{o.value=!0,r.value=null;try{const s=p();await f(s)}catch(s){console.error("Error applying filters:",s),r.value="Failed to load dashboard data"}finally{o.value=!1}},C=async()=>{o.value=!0,r.value=null;try{const s=[y(),f(p())],n=await Promise.allSettled(s),w=n.filter(F=>F.status==="rejected");w.length>0&&(console.warn(`${w.length} dashboard API calls failed:`,w.map(V=>{var S;return(S=V.reason)==null?void 0:S.message})),n[1].status==="rejected"&&(r.value="Failed to load dashboard data"))}catch(s){console.error("Error initializing dashboard:",s),r.value="Failed to initialize dashboard"}finally{o.value=!1}};return{loading:o,error:r,locations:e,data:l,filters:u,loadingStates:a,isAnyLoading:h,hasData:b,fetchLocations:y,applyFilters:$,initializeDashboard:C,refreshSection:async s=>{try{switch(s){case"locations":await y();break;case"dashboard":await f(p());break;default:await $()}}catch(n){console.error(`Error refreshing ${s}:`,n),r.value=`Failed to refresh ${s} data`}},forceRefresh:async()=>{o.value=!0,r.value=null;try{g.invalidateCache("/dashboard"),g.invalidateCache("/locations"),e.value=[],await C()}catch(s){console.error("Error force refreshing dashboard:",s),r.value="Failed to refresh dashboard data"}finally{o.value=!1}},getStockLevelClass:s=>s<=0?"bg-red-100 text-red-800":s<=3?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}}const I={class:"bg-white p-4 sm:p-5 shadow-lg rounded-xl mb-6"},U={class:"flex flex-col sm:flex-row flex-wrap items-start sm:items-center gap-4"},H={class:"w-full sm:w-auto"},K={class:"w-full sm:w-auto"},Y=["value"],G={class:"w-full sm:w-auto"},J={class:"w-full sm:w-auto mt-2 sm:mt-0"},Q={__name:"FilterControls",props:{filters:{type:Object,required:!0},locations:{type:Array,required:!0}},emits:["apply-filters"],setup(o){return(r,e)=>(i(),d("div",I,[t("div",U,[t("div",H,[e[8]||(e[8]=t("label",{for:"timeRange",class:"block text-sm font-medium text-gray-700 mb-1"},"Time Period",-1)),_(t("select",{id:"timeRange","onUpdate:modelValue":e[0]||(e[0]=a=>o.filters.timeRange=a),class:"block w-full sm:w-48 border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",onChange:e[1]||(e[1]=a=>r.$emit("apply-filters"))},e[7]||(e[7]=[A('<option value="today">Today</option><option value="yesterday">Yesterday</option><option value="7">Last 7 days</option><option value="30">Last 30 days</option><option value="90">Last 90 days</option>',5)]),544),[[k,o.filters.timeRange]])]),t("div",K,[e[10]||(e[10]=t("label",{for:"location",class:"block text-sm font-medium text-gray-700 mb-1"},"Location",-1)),_(t("select",{id:"location","onUpdate:modelValue":e[2]||(e[2]=a=>o.filters.location=a),class:"block w-full sm:w-48 border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",onChange:e[3]||(e[3]=a=>r.$emit("apply-filters"))},[e[9]||(e[9]=t("option",{value:""},"All Locations",-1)),(i(!0),d(j,null,R(o.locations,a=>(i(),d("option",{key:a.id,value:a.id},c(a.name),9,Y))),128))],544),[[k,o.filters.location]])]),t("div",G,[e[12]||(e[12]=t("label",{for:"machineType",class:"block text-sm font-medium text-gray-700 mb-1"},"Machine Type",-1)),_(t("select",{id:"machineType","onUpdate:modelValue":e[4]||(e[4]=a=>o.filters.machineType=a),class:"block w-full sm:w-48 border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",onChange:e[5]||(e[5]=a=>r.$emit("apply-filters"))},e[11]||(e[11]=[t("option",{value:""},"All Types",-1),t("option",{value:"Snack"},"Snack",-1),t("option",{value:"Soda"},"Soda",-1),t("option",{value:"Combo"},"Combo",-1)]),544),[[k,o.filters.machineType]])]),t("div",J,[t("button",{type:"button",onClick:e[6]||(e[6]=a=>r.$emit("apply-filters")),class:"w-full sm:w-auto inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-150"},e[13]||(e[13]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})],-1),D(" Apply Filters ")]))])])]))}},W={class:"grid grid-cols-1 gap-4 sm:gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-8"},X={class:"bg-gradient-to-br from-white to-gray-50 overflow-hidden shadow-lg rounded-xl transition-transform duration-300 hover:scale-105 hover:shadow-xl"},Z={class:"px-4 py-5 sm:p-6"},tt={class:"mt-2 text-2xl sm:text-3xl font-bold text-primary-600"},et={class:"bg-gradient-to-br from-white to-gray-50 overflow-hidden shadow-lg rounded-xl transition-transform duration-300 hover:scale-105 hover:shadow-xl"},ot={class:"px-4 py-5 sm:p-6"},st={class:"mt-2 text-2xl sm:text-3xl font-bold text-primary-600"},at={class:"bg-gradient-to-br from-white to-gray-50 overflow-hidden shadow-lg rounded-xl transition-transform duration-300 hover:scale-105 hover:shadow-xl"},rt={class:"px-4 py-5 sm:p-6"},lt={class:"mt-2 text-2xl sm:text-3xl font-bold text-primary-600"},nt={class:"bg-gradient-to-br from-white to-gray-50 overflow-hidden shadow-lg rounded-xl transition-transform duration-300 hover:scale-105 hover:shadow-xl"},it={class:"px-4 py-5 sm:p-6"},dt={class:"mt-2 text-2xl sm:text-3xl font-bold text-primary-600"},ct={__name:"KpiCards",props:{data:{type:Object,required:!0}},setup(o){return(r,e)=>(i(),d("div",W,[t("div",X,[t("div",Z,[t("dl",null,[e[0]||(e[0]=t("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Total Locations",-1)),t("dd",tt,c(o.data.locations),1)])])]),t("div",et,[t("div",ot,[t("dl",null,[e[1]||(e[1]=t("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Total Machines",-1)),t("dd",st,c(o.data.machines),1)])])]),t("div",at,[t("div",rt,[t("dl",null,[e[2]||(e[2]=t("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Total Products",-1)),t("dd",lt,c(o.data.products),1)])])]),t("div",nt,[t("div",it,[t("dl",null,[e[3]||(e[3]=t("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Recent Restocks",-1)),t("dd",dt,c(o.data.recent_restocks),1)])])])]))}},ut={class:"bg-white shadow-lg overflow-hidden sm:rounded-xl mb-8 transition-all duration-300 hover:shadow-xl"},mt={class:"px-6 py-5 border-b border-gray-100 flex justify-between items-center"},ft={class:"flex items-center space-x-3"},pt={key:0,class:"px-6 py-8 text-center text-gray-500"},vt={key:1,role:"list",class:"divide-y divide-gray-200"},xt={class:"flex items-center justify-between"},yt={class:"text-sm font-medium text-primary-600 truncate"},gt={class:"text-sm text-gray-500"},ht={__name:"LowStockItems",props:{data:{type:Object,required:!0},getStockLevelClass:{type:Function,required:!0}},setup(o){return(r,e)=>{const a=P("router-link");return i(),d("div",ut,[t("div",mt,[e[1]||(e[1]=t("div",null,[t("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Low Stock Items"),t("p",{class:"mt-1 text-sm text-gray-500"}," Products with stock level below threshold ")],-1)),t("div",ft,[t("span",{class:T(["inline-flex items-center px-3.5 py-1 rounded-full text-sm font-medium",o.data.low_stock_count>0?"bg-red-100 text-red-800":"bg-green-100 text-green-800"])},c(o.data.low_stock_count)+" items ",3),x(a,{to:"/inventory",class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-primary-600 bg-primary-100 hover:bg-primary-200 transition-colors duration-150"},{default:E(()=>e[0]||(e[0]=[t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1),D(" Full Report ")])),_:1})])]),t("div",null,[o.data.low_stock_items.length===0?(i(),d("div",pt,e[2]||(e[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mx-auto text-green-400 mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),t("p",{class:"text-lg font-medium"},"No low stock items - everything is well stocked!",-1)]))):(i(),d("ul",vt,[(i(!0),d(j,null,R(o.data.low_stock_items,(l,u)=>(i(),d("li",{key:u,class:"px-6 py-4 hover:bg-gray-50 transition-colors duration-150"},[t("div",xt,[t("div",null,[t("p",yt,c(l.product),1),t("p",gt,c(l.machine)+" ("+c(l.location)+")",1)]),t("div",null,[t("span",{class:T(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",o.getStockLevelClass(l.current_stock)])}," Stock: "+c(l.current_stock),3)])])]))),128))]))])])}}},bt={class:"bg-white shadow-lg overflow-hidden sm:rounded-xl transition-all duration-300 hover:shadow-xl"},wt={class:"grid grid-cols-1 md:grid-cols-3 divide-y md:divide-y-0 md:divide-x divide-gray-200"},_t={class:"px-6 py-5"},kt={class:"mt-2 text-3xl font-bold text-gray-900"},$t={class:"px-6 py-5"},Ct={class:"mt-2 text-3xl font-bold text-green-600"},Ft={class:"px-6 py-5"},St={class:"mt-2 text-3xl font-bold text-gray-900"},Lt={__name:"RevenueSummary",props:{data:{type:Object,required:!0}},setup(o){return(r,e)=>(i(),d("div",bt,[e[3]||(e[3]=t("div",{class:"px-6 py-5 border-b border-gray-100"},[t("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Revenue & Profit"),t("p",{class:"mt-1 text-sm text-gray-500"}," Last 30 days performance ")],-1)),t("div",null,[t("div",wt,[t("div",_t,[e[0]||(e[0]=t("div",{class:"text-sm font-medium text-gray-500"},"Total Revenue",-1)),t("div",kt,"$"+c((o.data.revenue_total||0).toFixed(2)),1)]),t("div",$t,[e[1]||(e[1]=t("div",{class:"text-sm font-medium text-gray-500"},"Total Profit",-1)),t("div",Ct,"$"+c((o.data.profit_total||0).toFixed(2)),1)]),t("div",Ft,[e[2]||(e[2]=t("div",{class:"text-sm font-medium text-gray-500"},"Profit Margin",-1)),t("div",St,c((o.data.profit_margin||0).toFixed(1))+"%",1)])])])]))}},Tt={},jt={class:"flex justify-center py-20"};function Rt(o,r){return i(),d("div",jt,r[0]||(r[0]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))}const Dt=N(Tt,[["render",Rt]]),Vt={class:"min-h-screen flex flex-col"},zt={class:"flex-grow container mx-auto px-4 py-8"},At={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6"},Pt={key:2},It={__name:"Dashboard",setup(o){const{loading:r,error:e,locations:a,data:l,filters:u,applyFilters:h,initializeDashboard:b,getStockLevelClass:p}=O();return M(()=>{b()}),(y,f)=>(i(),d("div",Vt,[t("div",zt,[f[0]||(f[0]=t("h1",{class:"text-2xl font-bold text-gray-900 mb-6"},"Dashboard",-1)),x(Q,{filters:m(u),locations:m(a),onApplyFilters:m(h)},null,8,["filters","locations","onApplyFilters"]),m(e)?(i(),d("div",At,c(m(e)),1)):B("",!0),m(r)?(i(),q(Dt,{key:1})):(i(),d("div",Pt,[x(ct,{data:m(l)},null,8,["data"]),x(ht,{data:m(l),"get-stock-level-class":m(p)},null,8,["data","get-stock-level-class"]),x(Lt,{data:m(l)},null,8,["data"])]))])]))}};export{It as default};
