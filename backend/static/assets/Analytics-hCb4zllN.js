import{a as B}from"./api-DXyJzQ0V.js";import{b as I,a as Y}from"./dateUtils-CXdyRzwD.js";import{r as D,c as H,b as d,o as c,d as t,h as Z,f as G,F as R,g as E,t as i,e as $,n as V,s as J,x as v,p as N}from"./index-CFQYu4iu.js";function K(){const a=D(!0),h=D(null),s=D([]),u=D([]),o=D([]),n=D({locations:!1,machines:!1,products:!1,revenue:!1,stock:!1,demand:!1}),g=D({dateRange:"30",startDate:"",endDate:"",location:"",machine:"",product:""}),w=D({revenue:{total:0,change:0},profit:{total:0,change:0},margin:{total:0,change:0}}),k=D({low_stock_count:0,items:[]}),m=D({unit_counts:[],products:[]}),l=H(()=>m.value.unit_counts?[...m.value.unit_counts].sort((e,r)=>e.location_name!==r.location_name?e.location_name.localeCompare(r.location_name):e.machine_name!==r.machine_name?e.machine_name.localeCompare(r.machine_name):e.product_name!==r.product_name?e.product_name.localeCompare(r.product_name):new Date(r.end_date)-new Date(e.end_date)):[]),f=H(()=>Object.values(n.value).some(e=>e)||a.value),F=e=>e<=0?"bg-red-100 text-red-800":e<=3?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800",L=e=>e==null?"bg-gray-100 text-gray-800":e>10?"bg-green-100 text-green-800":e<-10?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800",P=e=>e==null?"+0.0%":`${e>=0?"+":""}${e.toFixed(1)}%`,A=e=>e==null?"0.0/day":e.toFixed(1)+"/day",M=()=>{const e={};return g.value.dateRange!=="custom"?e.days=g.value.dateRange:(e.start_date=g.value.startDate,e.end_date=g.value.endDate),g.value.location&&(e.location=g.value.location),g.value.machine&&(e.machine=g.value.machine),g.value.product&&(e.product=g.value.product),e},S=async()=>{if(!(s.value.length>0)){n.value.locations=!0;try{const e=await B.getLocations();s.value=e.data.results||e.data}catch(e){console.error("Error fetching locations:",e)}finally{n.value.locations=!1}}},O=async e=>{n.value.machines=!0;try{if(!e){u.value=[];return}console.log("Fetching machines for location:",e);const r=await B.getMachines({location:e});console.log("Machines API response:",r.data),u.value=r.data.results||r.data,console.log("Machines set to:",u.value)}catch(r){console.error("Error fetching machines:",r),u.value=[]}finally{n.value.machines=!1}},U=async e=>{n.value.products=!0;try{if(!e){o.value=[];return}console.log("Fetching products for machine:",e);const r=await B.getMachineItems({machine:e});console.log("Machine items API response:",r.data);const p=r.data.results||r.data;console.log("Machine items extracted:",p);const b=new Map;p.forEach(y=>{b.has(y.product)||b.set(y.product,{id:y.product,name:y.product_name})}),o.value=Array.from(b.values()),console.log("Products set to:",o.value)}catch(r){console.error("Error fetching products:",r),o.value=[]}finally{n.value.products=!1}},z=async e=>{var r,p,b,y,j,q;n.value.revenue=!0;try{const C=await B.getRevenueProfitData(e);if(!C.data){w.value={revenue:{total:0,change:0},profit:{total:0,change:0},margin:{total:0,change:0}};return}w.value={revenue:{total:((r=C.data.revenue)==null?void 0:r.total)||0,change:((p=C.data.revenue)==null?void 0:p.change)||0},profit:{total:((b=C.data.profit)==null?void 0:b.total)||0,change:((y=C.data.profit)==null?void 0:y.change)||0},margin:{total:((j=C.data.margin)==null?void 0:j.total)||0,change:((q=C.data.margin)==null?void 0:q.change)||0}}}catch(C){throw console.error("Error fetching revenue/profit data:",C),w.value={revenue:{total:0,change:0},profit:{total:0,change:0},margin:{total:0,change:0}},new Error("Failed to load revenue and profit data")}finally{n.value.revenue=!1}},T=async e=>{n.value.stock=!0;try{const r={location:e.location},p=await B.getStockLevels(r);if(!p.data){k.value={low_stock_count:0,items:[]};return}k.value={low_stock_count:p.data.low_stock_count||0,items:p.data.items||[]}}catch(r){throw console.error("Error fetching stock level data:",r),k.value={low_stock_count:0,items:[]},new Error("Failed to load stock level data")}finally{n.value.stock=!1}},x=async e=>{n.value.demand=!0;try{const r=await B.getDemandAnalysis(e);if(console.log("Demand analysis data:",r.data),!r.data){m.value={products:[],unit_counts:[]};return}Array.isArray(r.data)?m.value={products:r.data||[],unit_counts:[]}:(m.value={products:r.data.products||[],unit_counts:r.data.unit_counts||[]},m.value.unit_counts&&m.value.unit_counts.length>0&&m.value.unit_counts.forEach(p=>{p.start_date&&(p.start_date=new Date(p.start_date)),p.end_date&&(p.end_date=new Date(p.end_date))}))}catch(r){throw console.error("Error fetching demand analysis data:",r),m.value={products:[],unit_counts:[]},new Error("Failed to load demand analysis data")}finally{n.value.demand=!1}},_=async()=>{a.value=!0,h.value=null;try{if(g.value.dateRange==="custom"&&(!g.value.startDate||!g.value.endDate)){const y=Y(),j=new Date;j.setDate(j.getDate()-30);const q=j.toLocaleDateString("en-CA",{timeZone:"America/New_York"});g.value.endDate||(g.value.endDate=y),g.value.startDate||(g.value.startDate=q)}const e=M(),r=[z(e),T(e),x(e)],b=(await Promise.allSettled(r)).filter(y=>y.status==="rejected");b.length>0&&(console.warn(`${b.length} API calls failed:`,b.map(y=>y.reason.message)),h.value=`Some data could not be loaded. ${b.length} of ${r.length} requests failed.`)}catch(e){console.error("Error refreshing data:",e),h.value="Failed to refresh analytics data"}finally{a.value=!1}};return{loading:a,error:h,locations:s,machines:u,products:o,filters:g,revenueProfitData:w,stockLevelData:k,demandData:m,loadingStates:n,sortedDemandCounts:l,isAnyLoading:f,getStockLevelClass:F,getTrendClass:L,formatTrend:P,formatDailyDemand:A,formatDateShort:I,applyFilters:_,initialize:async()=>{a.value=!0,h.value=null;try{await S(),await _()}catch(e){console.error("Error initializing analytics:",e),h.value="Failed to load analytics data"}finally{a.value=!1}},refreshSection:async e=>{const r=M();try{switch(e){case"revenue":await z(r);break;case"stock":await T(r);break;case"demand":await x(r);break;default:await _()}}catch(p){console.error(`Error refreshing ${e}:`,p),h.value=`Failed to refresh ${e} data`}},fetchMachines:O,fetchProducts:U}}const Q={class:"bg-white p-5 shadow-lg rounded-xl mb-6"},W={class:"flex flex-wrap items-center gap-4"},X=["value"],tt={key:0,class:"flex space-x-2"},et=["value"],at=["value"],st=["value"],ot=["value"],nt=["value","disabled"],rt={value:""},lt=["value"],it=["value","disabled"],dt={value:""},ct=["value"],ut={class:"self-end ml-auto mt-4"},mt={__name:"FilterControls",props:{filters:{type:Object,required:!0},locations:{type:Array,required:!0},machines:{type:Array,default:()=>[]},products:{type:Array,default:()=>[]},loadingMachines:{type:Boolean,default:!1},loadingProducts:{type:Boolean,default:!1}},emits:["apply-filters","update-filters","location-changed","machine-changed"],setup(a,{emit:h}){const s=h,u=m=>{s("update-filters",{dateRange:m.target.value})},o=m=>{s("update-filters",{startDate:m.target.value})},n=m=>{s("update-filters",{endDate:m.target.value})},g=m=>{const l=m.target.value;console.log("FilterControls: Location changed to:",l),s("update-filters",{location:l,machine:"",product:""}),s("location-changed",l)},w=m=>{const l=m.target.value;console.log("FilterControls: Machine changed to:",l),s("update-filters",{machine:l,product:""}),s("machine-changed",l)},k=m=>{s("update-filters",{product:m.target.value})};return(m,l)=>(c(),d("div",Q,[t("div",W,[t("div",null,[l[2]||(l[2]=t("label",{for:"dateRange",class:"block text-sm font-medium text-gray-700 mb-1"},"Date Range",-1)),t("select",{id:"dateRange",value:a.filters.dateRange,onChange:u,class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm"},l[1]||(l[1]=[G('<option value="7">Last 7 days</option><option value="30">Last 30 days</option><option value="90">Last 90 days</option><option value="365">Last 12 months</option><option value="custom">Custom range</option>',5)]),40,X)]),a.filters.dateRange==="custom"?(c(),d("div",tt,[t("div",null,[l[3]||(l[3]=t("label",{for:"startDate",class:"block text-sm font-medium text-gray-700 mb-1"},"Start Date",-1)),t("input",{type:"date",id:"startDate",value:a.filters.startDate,onInput:o,class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm"},null,40,et)]),t("div",null,[l[4]||(l[4]=t("label",{for:"endDate",class:"block text-sm font-medium text-gray-700 mb-1"},"End Date",-1)),t("input",{type:"date",id:"endDate",value:a.filters.endDate,onInput:n,class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm"},null,40,at)])])):Z("",!0),t("div",null,[l[6]||(l[6]=t("label",{for:"location",class:"block text-sm font-medium text-gray-700 mb-1"},"Location",-1)),t("select",{id:"location",value:a.filters.location,onChange:g,class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm"},[l[5]||(l[5]=t("option",{value:""},"All Locations",-1)),(c(!0),d(R,null,E(a.locations,f=>(c(),d("option",{key:f.id,value:f.id},i(f.name),9,ot))),128))],40,st)]),t("div",null,[l[7]||(l[7]=t("label",{for:"machine",class:"block text-sm font-medium text-gray-700 mb-1"},"Machine",-1)),t("select",{id:"machine",value:a.filters.machine,onChange:w,disabled:!a.filters.location||a.loadingMachines,class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm disabled:bg-gray-100 disabled:cursor-not-allowed"},[t("option",rt,i(a.loadingMachines?"Loading...":"All Machines"),1),(c(!0),d(R,null,E(a.machines,f=>(c(),d("option",{key:f.id,value:f.id},i(f.name)+" - "+i(f.machine_type),9,lt))),128))],40,nt)]),t("div",null,[l[8]||(l[8]=t("label",{for:"product",class:"block text-sm font-medium text-gray-700 mb-1"},"Product",-1)),t("select",{id:"product",value:a.filters.product,onChange:k,disabled:!a.filters.machine||a.loadingProducts,class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm disabled:bg-gray-100 disabled:cursor-not-allowed"},[t("option",dt,i(a.loadingProducts?"Loading...":"All Products"),1),(c(!0),d(R,null,E(a.products,f=>(c(),d("option",{key:f.id,value:f.id},i(f.name),9,ct))),128))],40,it)]),t("div",ut,[t("button",{type:"button",onClick:l[0]||(l[0]=f=>m.$emit("apply-filters")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-150"},l[9]||(l[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})],-1),$(" Apply Filters ")]))])])]))}},gt={class:"bg-white shadow-lg overflow-hidden sm:rounded-xl mb-6 transition-all duration-300 hover:shadow-xl"},ft={class:"grid grid-cols-1 md:grid-cols-3 divide-y md:divide-y-0 md:divide-x divide-gray-200"},pt={class:"px-6 py-5"},ht={class:"mt-2 text-3xl font-bold text-gray-900"},vt={class:"mt-2 text-sm text-gray-500 flex items-center"},xt={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},yt={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},wt={class:"px-6 py-5"},kt={class:"mt-2 text-3xl font-bold text-green-600"},bt={class:"mt-2 text-sm text-gray-500 flex items-center"},_t={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Dt={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},$t={class:"px-6 py-5"},Ct={class:"mt-2 text-3xl font-bold text-gray-900"},Mt={class:"mt-2 text-sm text-gray-500 flex items-center"},Ft={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Lt={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Pt={__name:"RevenueProfit",props:{data:{type:Object,required:!0,default:()=>({revenue:{total:0,change:0},profit:{total:0,change:0},margin:{total:0,change:0}})}},setup(a){return(h,s)=>{var u,o,n,g,w,k,m,l,f,F,L,P,A,M,S;return c(),d("div",gt,[s[12]||(s[12]=t("div",{class:"px-6 py-5 border-b border-gray-100"},[t("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Revenue & Profit"),t("p",{class:"mt-1 text-sm text-gray-500"}," Financial performance for the selected period ")],-1)),t("div",null,[t("div",ft,[t("div",pt,[s[3]||(s[3]=t("div",{class:"text-sm font-medium text-gray-500"},"Total Revenue",-1)),t("div",ht,"$"+i((((u=a.data.revenue)==null?void 0:u.total)||0).toFixed(2)),1),t("div",vt,[t("span",{class:V([(((o=a.data.revenue)==null?void 0:o.change)||0)>=0?"text-green-600":"text-red-600","flex items-center"])},[(((n=a.data.revenue)==null?void 0:n.change)||0)>=0?(c(),d("svg",xt,s[0]||(s[0]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"},null,-1)]))):(c(),d("svg",yt,s[1]||(s[1]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"},null,-1)]))),$(" "+i((((g=a.data.revenue)==null?void 0:g.change)||0)>=0?"+":"")+i((((w=a.data.revenue)==null?void 0:w.change)||0).toFixed(1))+"% ",1)],2),s[2]||(s[2]=t("span",{class:"ml-1"},"vs previous period",-1))])]),t("div",wt,[s[7]||(s[7]=t("div",{class:"text-sm font-medium text-gray-500"},"Total Profit",-1)),t("div",kt,"$"+i((((k=a.data.profit)==null?void 0:k.total)||0).toFixed(2)),1),t("div",bt,[t("span",{class:V([(((m=a.data.profit)==null?void 0:m.change)||0)>=0?"text-green-600":"text-red-600","flex items-center"])},[(((l=a.data.profit)==null?void 0:l.change)||0)>=0?(c(),d("svg",_t,s[4]||(s[4]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"},null,-1)]))):(c(),d("svg",Dt,s[5]||(s[5]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"},null,-1)]))),$(" "+i((((f=a.data.profit)==null?void 0:f.change)||0)>=0?"+":"")+i((((F=a.data.profit)==null?void 0:F.change)||0).toFixed(1))+"% ",1)],2),s[6]||(s[6]=t("span",{class:"ml-1"},"vs previous period",-1))])]),t("div",$t,[s[11]||(s[11]=t("div",{class:"text-sm font-medium text-gray-500"},"Profit Margin",-1)),t("div",Ct,i((((L=a.data.margin)==null?void 0:L.total)||0).toFixed(1))+"%",1),t("div",Mt,[t("span",{class:V([(((P=a.data.margin)==null?void 0:P.change)||0)>=0?"text-green-600":"text-red-600","flex items-center"])},[(((A=a.data.margin)==null?void 0:A.change)||0)>=0?(c(),d("svg",Ft,s[8]||(s[8]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"},null,-1)]))):(c(),d("svg",Lt,s[9]||(s[9]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"},null,-1)]))),$(" "+i((((M=a.data.margin)==null?void 0:M.change)||0)>=0?"+":"")+i((((S=a.data.margin)==null?void 0:S.change)||0).toFixed(1))+"% ",1)],2),s[10]||(s[10]=t("span",{class:"ml-1"},"vs previous period",-1))])])])])])}}},At={class:"bg-white shadow-lg overflow-hidden sm:rounded-xl mb-6 transition-all duration-300 hover:shadow-xl"},St={class:"px-6 py-5 border-b border-gray-100 flex justify-between items-center"},jt={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Bt={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Rt={role:"list",class:"divide-y divide-gray-200"},Et={class:"flex items-center justify-between"},Vt={class:"text-sm font-medium text-primary-600"},zt={class:"text-sm text-gray-500 flex items-center mt-1"},Tt={__name:"StockLevels",props:{data:{type:Object,required:!0,default:()=>({low_stock_count:0,items:[]})}},setup(a){const h=s=>s<=0?"bg-red-100 text-red-800":s<=3?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800";return(s,u)=>(c(),d("div",At,[t("div",St,[u[2]||(u[2]=t("div",null,[t("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Stock Levels"),t("p",{class:"mt-1 text-sm text-gray-500"}," Current inventory levels across machines ")],-1)),t("span",{class:V(["inline-flex items-center px-3.5 py-1 rounded-full text-sm font-medium",a.data.low_stock_count>0?"bg-red-100 text-red-800":"bg-green-100 text-green-800"])},[a.data.low_stock_count>0?(c(),d("svg",jt,u[0]||(u[0]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"},null,-1)]))):(c(),d("svg",Bt,u[1]||(u[1]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))),$(" "+i(a.data.low_stock_count)+" items low stock ",1)],2)]),t("div",null,[t("ul",Rt,[(c(!0),d(R,null,E(a.data.items,(o,n)=>(c(),d("li",{key:n,class:"px-6 py-4 hover:bg-gray-50 transition-colors duration-150"},[t("div",Et,[t("div",null,[t("p",Vt,i(o.product_name),1),t("p",zt,[u[3]||(u[3]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})],-1)),$(" "+i(o.machine_name)+" at "+i(o.location_name),1)])]),t("div",null,[t("span",{class:V(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",h(o.current_stock)])}," Stock: "+i(o.current_stock),3)])])]))),128))])])]))}},qt={class:"bg-white shadow-lg overflow-hidden sm:rounded-xl transition-all duration-300 hover:shadow-xl"},Nt={class:"overflow-x-auto"},Ot={class:"min-w-full divide-y divide-gray-200"},Ut={class:"bg-white divide-y divide-gray-200"},Ht={class:"px-6 py-4 whitespace-nowrap"},It={class:"text-sm font-medium text-gray-900"},Yt={class:"px-6 py-4 whitespace-nowrap text-center"},Zt={class:"text-sm text-gray-900"},Gt={class:"px-6 py-4 whitespace-nowrap text-center"},Jt={class:"text-sm text-gray-900"},Kt={class:"px-6 py-4 whitespace-nowrap text-center"},Qt={class:"text-sm text-gray-900"},Wt={class:"px-6 py-4 whitespace-nowrap text-center"},Xt={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},te={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ee={key:2,xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ae={key:0,class:"mt-6 px-6"},se={class:"border rounded-lg shadow-sm overflow-hidden"},oe={class:"min-w-full divide-y divide-gray-200"},ne={class:"bg-white divide-y divide-gray-200"},re={class:"px-4 py-3 text-sm text-gray-900"},le={class:"px-4 py-3 text-sm text-gray-900"},ie={class:"px-4 py-3 text-sm text-gray-900"},de={class:"px-4 py-3 text-sm text-gray-500 text-center"},ce={class:"text-xs text-gray-400"},ue={class:"px-4 py-3 text-sm text-gray-900 text-center font-medium"},me={class:"px-4 py-3 text-sm text-gray-900 text-center"},ge={class:"px-4 py-3 text-sm text-gray-900 text-center"},fe={key:1,class:"px-6 py-4 text-center"},pe={key:2,class:"px-6 py-4 text-center"},he={__name:"DemandAnalysis",props:{data:{type:Object,required:!0,default:()=>({products:[],unit_counts:[]})},formatDateShort:{type:Function,required:!0},formatDailyDemand:{type:Function,required:!0},formatTrend:{type:Function,required:!0},getTrendClass:{type:Function,required:!0}},setup(a){const h=a,s=H(()=>h.data.unit_counts?[...h.data.unit_counts].sort((u,o)=>u.location_name!==o.location_name?u.location_name.localeCompare(o.location_name):u.machine_name!==o.machine_name?u.machine_name.localeCompare(o.machine_name):u.product_name!==o.product_name?u.product_name.localeCompare(o.product_name):new Date(o.end_date)-new Date(u.end_date)):[]);return(u,o)=>(c(),d("div",qt,[o[8]||(o[8]=t("div",{class:"px-6 py-5 border-b border-gray-100"},[t("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Product Demand Analysis"),t("p",{class:"mt-1 text-sm text-gray-500"}," Sales performance and demand tracking based on restock data ")],-1)),t("div",null,[t("div",Nt,[t("table",Ot,[o[3]||(o[3]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Product "),t("th",{scope:"col",class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Units Sold "),t("th",{scope:"col",class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Revenue "),t("th",{scope:"col",class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Profit "),t("th",{scope:"col",class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Trend ")])],-1)),t("tbody",Ut,[(c(!0),d(R,null,E(a.data.products,n=>(c(),d("tr",{key:n.product_id,class:"hover:bg-gray-50 transition-colors duration-150"},[t("td",Ht,[t("div",It,i(n.product_name),1)]),t("td",Yt,[t("div",Zt,i(n.units_sold),1)]),t("td",Gt,[t("div",Jt,"$"+i((n.revenue||0).toFixed(2)),1)]),t("td",Kt,[t("div",Qt,"$"+i((n.profit||0).toFixed(2)),1)]),t("td",Wt,[t("span",{class:V(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",a.getTrendClass(n.trend||0)])},[(n.trend||0)>0?(c(),d("svg",Xt,o[0]||(o[0]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"},null,-1)]))):(n.trend||0)<0?(c(),d("svg",te,o[1]||(o[1]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"},null,-1)]))):(c(),d("svg",ee,o[2]||(o[2]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18 12H6"},null,-1)]))),$(" "+i(a.formatTrend(n.trend||0)),1)],2)])]))),128))])])]),a.data.unit_counts&&a.data.unit_counts.length>0?(c(),d("div",ae,[o[5]||(o[5]=t("h4",{class:"text-base font-medium text-gray-700 mb-3"},"Detailed Demand By Machine & Product",-1)),t("div",se,[t("table",oe,[o[4]||(o[4]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Location "),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Machine "),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Product "),t("th",{scope:"col",class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase"}," Period "),t("th",{scope:"col",class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase"}," Units Sold "),t("th",{scope:"col",class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase"}," Daily Demand "),t("th",{scope:"col",class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase"}," Revenue ")])],-1)),t("tbody",ne,[(c(!0),d(R,null,E(s.value,(n,g)=>(c(),d("tr",{key:g,class:"hover:bg-gray-50"},[t("td",re,i(n.location_name),1),t("td",le,i(n.machine_name),1),t("td",ie,i(n.product_name),1),t("td",de,[$(i(a.formatDateShort(n.start_date))+" - "+i(a.formatDateShort(n.end_date))+" ",1),t("div",ce,"("+i(n.days_between)+" days)",1)]),t("td",ue,i(n.units_sold),1),t("td",me,i(a.formatDailyDemand(n.daily_demand)),1),t("td",ge," $"+i((n.revenue||0).toFixed(2)),1)]))),128))])])])])):a.data.products&&a.data.products.length>0&&(!a.data.unit_counts||a.data.unit_counts.length===0)?(c(),d("div",fe,o[6]||(o[6]=[t("p",{class:"text-sm text-gray-500"},[$(" No detailed demand data is available for the selected period. "),t("br"),$("Need at least two restock visits to the same machine to calculate demand. ")],-1)]))):(c(),d("div",pe,o[7]||(o[7]=[t("p",{class:"text-sm text-gray-500"}," No demand data available. Record restock visits to track product demand. ",-1)])))])]))}},ve={key:0,class:"flex justify-center py-20"},xe={key:1,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-6 rounded-r-lg shadow-sm"},ye={class:"flex"},we={class:"ml-3"},ke={class:"text-sm text-red-700"},be={key:2},Fe={__name:"Analytics",setup(a){const{loading:h,error:s,locations:u,machines:o,products:n,filters:g,revenueProfitData:w,stockLevelData:k,demandData:m,loadingStates:l,formatDateShort:f,formatDailyDemand:F,formatTrend:L,getTrendClass:P,applyFilters:A,initialize:M,fetchMachines:S,fetchProducts:O}=K(),U=x=>{Object.assign(g.value,x)},z=async x=>{console.log("Location changed to:",x),x?(await S(x),console.log("Machines loaded:",o.value.length)):(o.value=[],n.value=[])},T=async x=>{console.log("Machine changed to:",x),x?(await O(x),console.log("Products loaded:",n.value.length)):n.value=[]};return J(()=>{M()}),(x,_)=>(c(),d("div",null,[_[2]||(_[2]=t("h1",{class:"text-2xl font-semibold text-gray-900 mb-6"},"Analytics",-1)),v(h)?(c(),d("div",ve,_[0]||(_[0]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))):v(s)?(c(),d("div",xe,[t("div",ye,[_[1]||(_[1]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])],-1)),t("div",we,[t("p",ke,i(v(s)),1)])])])):(c(),d("div",be,[N(mt,{filters:v(g),locations:v(u),machines:v(o),products:v(n),"loading-machines":v(l).machines,"loading-products":v(l).products,onApplyFilters:v(A),onUpdateFilters:U,onLocationChanged:z,onMachineChanged:T},null,8,["filters","locations","machines","products","loading-machines","loading-products","onApplyFilters"]),N(Pt,{data:v(w)},null,8,["data"]),N(Tt,{data:v(k)},null,8,["data"]),N(he,{data:v(m),"format-date-short":v(f),"format-daily-demand":v(F),"format-trend":v(L),"get-trend-class":v(P)},null,8,["data","format-date-short","format-daily-demand","format-trend","get-trend-class"])]))]))}};export{Fe as default};
