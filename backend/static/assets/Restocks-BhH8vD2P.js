import{r as S,y as X,b as c,o as d,d as e,t as v,F,f as B,u as D,c as Z,l as _,n as T,e as ee,g as E,i as M,p as ce,z as ue,q as J,m as me,w as z,s as q,k as fe}from"./index-CYFOxbSL.js";import{a as $}from"./api-l68qjDAq.js";import{u as ve}from"./useLocations-CUpZbHrO.js";import{u as ge}from"./useMachines-DeGVg8Ai.js";import{g as be,f as H}from"./dateUtils-CXdyRzwD.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";function pe(){const s=S([]),f=S(!1),l=S(null),r=async()=>{f.value=!0,l.value=null;try{const m=await $.getVisits(),u=m.data.results||m.data;s.value=u.map(p=>({id:p.id,location_id:p.location,location_name:p.location_name,visit_date:p.visit_date,notes:p.notes,user_name:p.user_name}))}catch(m){console.error("Error fetching visits:",m),l.value="Failed to load visits. Please try again later."}finally{f.value=!1}};return{restocks:s,loading:f,error:l,fetchRestocks:r,createVisit:async m=>{try{return(await $.createVisit(m)).data}catch(u){throw console.error("Error creating visit:",u),u}},updateVisit:async(m,u)=>{try{return(await $.updateVisit(m,u)).data}catch(p){throw console.error("Error updating visit:",p),p}},deleteVisit:async m=>{try{await $.deleteVisit(m),await r()}catch(u){throw console.error("Error deleting visit:",u),u}},getVisitDetails:async m=>{try{const u=await $.getRestocks({visit:m}),p=u.data.results||u.data;let n=[];for(const a of p){const A=await $.getRestockEntries({visit_machine_restock:a.id}),j=A.data.results||A.data,b=await $.getMachineItems({machine:a.machine}),R=b.data.results||b.data,C=j.map(g=>{const y=R.find(h=>h.product===g.product);return{...g,slot:y?y.slot:null}});n.push(...C)}return n.sort((a,A)=>a.visit_machine_restock!==A.visit_machine_restock?0:(a.slot||999)-(A.slot||999)),n.map(a=>({id:a.id,product_name:a.product_name,product_id:a.product,previous_quantity:a.stock_before,quantity_discarded:a.discarded,quantity_added:a.restocked,machine_name:a.machine_name,machine_type:a.machine_type,machine_model:a.machine_model,slot:a.slot}))}catch(u){throw console.error("Error fetching visit details:",u),u}}}}function xe(){const s=X(),f=S(!1),l=S(""),r=S(null),i=S(!1),t=S({id:null,visit_date:"",notes:"",location:"",machines:[]}),o=(b=null)=>{b?(f.value=!0,l.value=b.location_id,t.value={id:b.id,visit_date:b.visit_date,notes:b.notes,location:b.location_id}):(f.value=!1,l.value="",t.value={id:null,visit_date:be(),notes:"",location:"",machines:[]})},x=b=>b.some(g=>g.products.some(y=>m(y)))?b.some(g=>g.products.some(y=>m(y)?y.stock_before===""||y.restocked==="":!1))?(r.value="Please complete all fields for products being restocked (stock before and restock amount are required)",!1):!0:(r.value="Please record stock levels for at least one product",!1),m=b=>b.stock_before!==""||b.restocked!==""||b.discarded!=="",u=async b=>{var R,C;try{if(i.value=!0,r.value=null,!x(b))return!1;const g=p(b);return console.log("Saving visit with bulk data:",g),f.value&&t.value.id?await $.updateVisitBulk(t.value.id,g):await $.createVisitBulk(g),!0}catch(g){return console.error("Error saving restock visit:",g),r.value=((C=(R=g.response)==null?void 0:R.data)==null?void 0:C.error)||"Failed to save visit. Please try again.",!1}finally{i.value=!1}},p=b=>{var g;const R={location:l.value,visit_date:t.value.visit_date,notes:t.value.notes,user:(g=s.user)==null?void 0:g.id},C=b.filter(y=>y.products.some(h=>m(h))).map(y=>{const h=y.products.filter(w=>m(w)).map(w=>({product:w.id,stock_before:parseInt(w.stock_before)||0,discarded:parseInt(w.discarded)||0,restocked:parseInt(w.restocked)||0}));return{machine:y.id,notes:"",restock_entries:h}});return{visit:R,machine_restocks:C}},n=async(b,R,C)=>{var g;console.warn("Using legacy saveRestock - consider migrating to saveRestockOptimized for better performance");try{if(r.value=null,!x(b))return!1;let y;const h={location:l.value,visit_date:t.value.visit_date,notes:t.value.notes,user:(g=s.user)==null?void 0:g.id};return console.log("Saving visit with data:",h),f.value&&t.value.id?y=(await C(t.value.id,h)).id:y=(await R(h)).id,await a(y,b),!0}catch(y){return console.error("Error saving restock visit:",y),r.value="Failed to save visit. Please try again.",!1}},a=async(b,R)=>{const C=R.filter(g=>g.products.some(y=>m(y)));for(const g of C){let y;if(f.value)try{const h=await $.getRestocks({visit:b,machine:g.id});if(h.data.length>0){const w=h.data[0],N={visit:b,machine:g.id,notes:w.notes||""};await $.updateRestock(w.id,N),y=w.id}else{const w={visit:b,machine:g.id,notes:""};y=(await $.createRestock(w)).data.id}}catch(h){throw console.error("Error handling machine restock:",h),h}else{const h={visit:b,machine:g.id,notes:""};y=(await $.createRestock(h)).data.id}await A(y,g.products)}},A=async(b,R)=>{const C=R.filter(g=>m(g));for(const g of C)try{const y={visit_machine_restock:b,product:g.id,stock_before:parseInt(g.stock_before)||0,discarded:parseInt(g.discarded)||0,restocked:parseInt(g.restocked)||0};if(f.value){const h=await $.getRestockEntries({visit_machine_restock:b,product:g.id});h.data.length>0?await $.updateRestockEntry(h.data[0].id,y):await $.createRestockEntry(y)}else await $.createRestockEntry(y)}catch(y){throw console.error("Error handling restock entry:",y),y}};return{restockForm:t,isEditing:f,selectedLocation:l,error:r,saving:i,initializeForm:o,validateForm:x,saveRestock:n,saveRestockOptimized:u,resetForm:()=>{o(),r.value=null}}}const he={key:0,class:"flex justify-center"},ke={key:1,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-4"},we={class:"flex"},$e={class:"ml-3"},_e={class:"text-sm text-red-700"},Re={key:2,class:"bg-white shadow overflow-hidden sm:rounded-lg"},Ve={class:"px-4 py-5 sm:p-6 text-center"},Ce={class:"mt-5"},De={key:3,class:"bg-white shadow overflow-hidden sm:rounded-lg"},Se={role:"list",class:"divide-y divide-gray-200"},Me={class:"flex items-center justify-between"},Ee={class:"flex-1 min-w-0"},Fe={class:"text-sm font-medium text-primary-600 truncate"},Be={class:"text-sm text-gray-500"},Ae={class:"ml-4 flex-shrink-0 flex space-x-2"},Le=["onClick"],je=["onClick"],Ie=["onClick"],Ne={__name:"RestockList",props:{restocks:Array,loading:Boolean,error:String},emits:["add-restock","view-details","edit-restock","delete-restock"],setup(s){return(f,l)=>(d(),c("div",null,[s.loading?(d(),c("div",he,l[1]||(l[1]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))):s.error?(d(),c("div",ke,[e("div",we,[l[2]||(l[2]=e("div",{class:"flex-shrink-0"},[e("span",{class:"text-red-400"},"⚠")],-1)),e("div",$e,[e("p",_e,v(s.error),1)])])])):s.restocks.length===0?(d(),c("div",Re,[e("div",Ve,[l[3]||(l[3]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"No visits recorded",-1)),l[4]||(l[4]=e("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[e("p",null,"Get started by recording your first location visit.")],-1)),e("div",Ce,[e("button",{onClick:l[0]||(l[0]=r=>f.$emit("add-restock")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Record New Visit ")])])])):(d(),c("div",De,[e("ul",Se,[(d(!0),c(F,null,B(s.restocks,r=>(d(),c("li",{key:r.id,class:"px-4 py-4 sm:px-6"},[e("div",Me,[e("div",Ee,[e("p",Fe,v(r.location_name),1),e("p",Be,v(D(H)(r.visit_date)),1)]),e("div",Ae,[e("button",{onClick:i=>f.$emit("view-details",r),class:"inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," View Details ",8,Le),e("button",{onClick:i=>f.$emit("edit-restock",r),class:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Edit ",8,je),e("button",{onClick:i=>f.$emit("delete-restock",r),class:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," Delete ",8,Ie)])])]))),128))])]))]))}},Ue={class:"mt-1 flex rounded-md shadow-sm relative"},Pe=["disabled"],ze={class:"sr-only"},qe=["id","value","min","max","placeholder","disabled"],Te=["disabled"],Oe={class:"sr-only"},We={__name:"ResponsiveNumberInput",props:{modelValue:{type:[String,Number],default:""},min:{type:[String,Number],default:0},max:{type:[String,Number],default:null},placeholder:{type:String,default:"0"},disabled:{type:Boolean,default:!1},label:{type:String,default:""},inputId:{type:String,default:""},showSteppers:{type:Boolean,default:!0}},emits:["update:modelValue","focus","blur"],setup(s,{emit:f}){const l=s,r=f,i=S(!1),t=Z(()=>{const n="focus:ring-primary-500 focus:border-primary-500 block w-full text-center sm:text-sm number-input-mobile";return l.showSteppers?`${n} border-gray-300 rounded-none sm:border-l-0 sm:border-r-0 sm:rounded-none rounded-md`:`${n} border-gray-300 rounded-md`}),o=n=>{const a=n.target.value;r("update:modelValue",a)},x=()=>{if(l.disabled)return;const n=l.modelValue===""?0:parseInt(l.modelValue)||0,a=l.max!==null?Math.min(n+1,parseInt(l.max)):n+1;r("update:modelValue",a)},m=()=>{if(l.disabled)return;const n=l.modelValue===""?0:parseInt(l.modelValue)||0,a=Math.max(parseInt(l.min),n-1);r("update:modelValue",a)},u=n=>{i.value=!0,r("focus",n)},p=n=>{i.value=!1,r("blur",n)};return(n,a)=>(d(),c("div",Ue,[s.showSteppers?(d(),c("button",{key:0,type:"button",onClick:m,class:"hidden sm:inline-flex relative items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",disabled:s.disabled},[e("span",ze,"Decrease "+v(s.label||"value"),1),a[0]||(a[0]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 12H4"})],-1))],8,Pe)):_("",!0),e("input",{id:s.inputId,type:"number",value:s.modelValue,onInput:o,onFocus:u,onBlur:p,min:s.min,max:s.max,placeholder:s.placeholder,disabled:s.disabled,class:T(t.value),inputmode:"numeric",pattern:"[0-9]*"},null,42,qe),s.showSteppers?(d(),c("button",{key:1,type:"button",onClick:x,class:"hidden sm:inline-flex relative items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",disabled:s.disabled},[e("span",Oe,"Increase "+v(s.label||"value"),1),a[1]||(a[1]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1))],8,Te)):_("",!0)]))}},L=ye(We,[["__scopeId","data-v-8ace7785"]]),He={class:"space-y-4"},Qe={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-3 sm:mb-2"},Ge={class:"text-sm font-medium text-gray-900 mb-2 sm:mb-0"},Ye={key:0,class:"ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"},Je={class:"text-sm text-gray-500"},Ke={key:0,class:"ml-2 text-green-600"},Xe={class:"space-y-3 sm:space-y-2"},Ze={key:0,class:"text-sm text-gray-500 italic p-2 text-center"},et={class:"flex items-center justify-between mb-3"},tt={class:"flex items-center space-x-2"},st={class:"text-sm font-medium text-gray-900 bg-gray-100 rounded-md px-2 py-1 min-w-[2rem] text-center"},ot={class:"text-sm font-medium text-gray-900"},it={key:0,class:"ml-1 inline-flex items-center w-2 h-2 bg-green-500 rounded-full",title:"Will be restocked"},nt={class:"space-y-3"},at={class:"text-sm text-gray-500 font-medium pt-2 border-t"},lt={class:"col-span-1 text-sm font-medium text-gray-900 text-center bg-gray-100 rounded-md py-1"},rt={class:"col-span-3 text-sm font-medium text-gray-900"},dt={key:0,class:"ml-1 inline-flex items-center w-2 h-2 bg-green-500 rounded-full",title:"Will be restocked"},ct={class:"col-span-2"},ut={class:"col-span-2"},mt={class:"col-span-2"},ft={class:"col-span-2 text-sm text-gray-500"},K={__name:"MachineProductsSection",props:{machines:Array},setup(s){const f=(m,u,p)=>{m[u]=p},l=m=>(parseInt(m.stock_before)||0)-(parseInt(m.discarded)||0)+(parseInt(m.restocked)||0),r=m=>m.stock_before!==""||m.restocked!==""||m.discarded!=="",i=m=>m.products.some(u=>r(u)),t=m=>m.products.filter(u=>r(u)).length,o=m=>i(m)?"border-green-300 bg-green-50":"border-gray-200",x=m=>r(m)?"bg-green-50 rounded-md p-2":"p-2";return(m,u)=>(d(),c("div",null,[u[6]||(u[6]=ee('<h4 class="text-sm font-medium text-gray-700 mb-2">Machines at Location</h4><div class="mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"><div class="flex items-center"><svg class="h-5 w-5 text-blue-400 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><div class="text-sm text-blue-700"><p class="font-medium">Partial Restock Allowed</p><p class="text-blue-600">You can restock only the machines/products you need. Leave others empty to skip them.</p></div></div></div>',2)),e("div",He,[(d(!0),c(F,null,B(s.machines,p=>(d(),c("div",{key:p.id,class:T(["border rounded-lg p-3 sm:p-4",o(p)])},[e("div",Qe,[e("h5",Ge,[E(v(p.name)+" ("+v(p.machine_type)+" "+v(p.model)+") ",1),i(p)?(d(),c("span",Ye," Will be restocked ")):_("",!0)]),e("div",Je,[E(v(p.products.length)+" products ",1),i(p)?(d(),c("span",Ke," ("+v(t(p))+" being restocked) ",1)):_("",!0)])]),e("div",Xe,[p.products.length===0?(d(),c("div",Ze," No products in this machine ")):_("",!0),(d(!0),c(F,null,B(p.products,n=>(d(),c("div",{key:n.id,class:"sm:hidden"},[e("div",{class:T(["border rounded-lg p-3",x(n)])},[e("div",et,[e("div",tt,[e("div",st,v(n.slot),1),e("div",ot,[E(v(n.name)+" ",1),r(n)?(d(),c("span",it)):_("",!0)])])]),e("div",nt,[e("div",null,[u[0]||(u[0]=e("label",{class:"block text-xs text-gray-500 mb-1"},"Current Stock",-1)),M(L,{modelValue:n.stock_before,"onUpdate:modelValue":[a=>n.stock_before=a,a=>f(n,"stock_before",a)],min:0,placeholder:"0",label:"Current Stock"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[u[1]||(u[1]=e("label",{class:"block text-xs text-gray-500 mb-1"},"Discarded Amount",-1)),M(L,{modelValue:n.discarded,"onUpdate:modelValue":[a=>n.discarded=a,a=>f(n,"discarded",a)],min:0,placeholder:"0",label:"Discarded Amount"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[u[2]||(u[2]=e("label",{class:"block text-xs text-gray-500 mb-1"},"Restock Amount",-1)),M(L,{modelValue:n.restocked,"onUpdate:modelValue":[a=>n.restocked=a,a=>f(n,"restocked",a)],min:0,placeholder:"0",label:"Restock Amount"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",at," New Total: "+v(l(n)),1)])],2)]))),128)),(d(!0),c(F,null,B(p.products,n=>(d(),c("div",{key:n.id,class:T(["hidden sm:grid grid-cols-12 gap-4 items-center",x(n)])},[e("div",lt,v(n.slot),1),e("div",rt,[E(v(n.name)+" ",1),r(n)?(d(),c("span",dt)):_("",!0)]),e("div",ct,[u[3]||(u[3]=e("label",{class:"block text-xs text-gray-500"},"Current Stock",-1)),M(L,{modelValue:n.stock_before,"onUpdate:modelValue":[a=>n.stock_before=a,a=>f(n,"stock_before",a)],min:0,placeholder:"0",label:"Current Stock"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",ut,[u[4]||(u[4]=e("label",{class:"block text-xs text-gray-500"},"Discarded Amount",-1)),M(L,{modelValue:n.discarded,"onUpdate:modelValue":[a=>n.discarded=a,a=>f(n,"discarded",a)],min:0,placeholder:"0",label:"Discarded Amount"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",mt,[u[5]||(u[5]=e("label",{class:"block text-xs text-gray-500"},"Restock Amount",-1)),M(L,{modelValue:n.restocked,"onUpdate:modelValue":[a=>n.restocked=a,a=>f(n,"restocked",a)],min:0,placeholder:"0",label:"Restock Amount"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",ft," New Total: "+v(l(n)),1)],2))),128))])],2))),128))])]))}},vt={key:0,class:"fixed inset-0 overflow-y-auto z-50","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},gt={class:"sm:hidden min-h-screen bg-white"},bt={class:"flex items-center justify-between p-4 border-b border-gray-200 bg-white sticky top-0 z-10"},yt={class:"text-lg font-medium text-gray-900",id:"modal-title"},pt={class:"flex-1 overflow-y-auto p-4 pb-safe"},xt={class:"space-y-6"},ht=["value"],kt=["value"],wt=["value"],$t={for:"location-mobile",class:"block text-sm font-medium text-gray-700 mb-2"},_t={class:"text-xs text-gray-500 ml-1"},Rt=["value"],Vt=["value"],Ct={key:0,class:"text-gray-500"},Dt={class:"border-t border-gray-200 bg-white p-4 space-y-3 sticky bottom-0"},St=["disabled"],Mt={key:0,class:"inline-flex items-center"},Et={key:1},Ft={class:"hidden sm:block modal-overlay"},Bt={class:"flex items-center justify-center min-h-full pt-4 px-4 pb-20 text-center"},At={class:"modal-content inline-block align-bottom bg-white rounded-lg text-left shadow-xl transform transition-all my-8 align-middle max-w-5xl w-full"},Lt={class:"bg-white px-4 pt-5 pb-4 sm:px-6 border-b border-gray-200 flex-shrink-0"},jt={class:"flex items-center justify-between"},It={class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"},Nt={class:"modal-scrollable bg-white px-4 py-4 sm:px-6"},Ut={class:"space-y-4"},Pt=["value"],zt=["value"],qt=["value"],Tt={for:"location",class:"block text-sm font-medium text-gray-700"},Ot={class:"text-xs text-gray-500 ml-1"},Wt=["value"],Ht=["value"],Qt={key:0,class:"text-gray-500"},Gt={key:0},Yt={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse border-t flex-shrink-0"},Jt=["disabled"],Kt={key:0,class:"inline-flex items-center"},Xt={key:1},Zt={__name:"RestockFormModal",props:{show:Boolean,isEditing:Boolean,restockForm:Object,selectedLocation:String,selectedRoute:String,locationSearchText:String,locations:Array,routes:Array,locationMachines:Array,saving:Boolean},emits:["close","save","route-change","location-search","location-change"],setup(s){const f=s,l=()=>{const i=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=i}};let r=null;return ce(()=>f.show,i=>{i?r=l():r&&(r(),r=null)},{immediate:!0}),ue(()=>{r&&r()}),(i,t)=>s.show?(d(),c("div",vt,[e("div",gt,[e("form",{onSubmit:t[7]||(t[7]=J(o=>i.$emit("save"),["prevent"])),novalidate:"",class:"h-full flex flex-col"},[e("div",bt,[e("h3",yt,v(s.isEditing?"Edit Visit":"Record New Visit"),1),e("button",{type:"button",onClick:t[0]||(t[0]=o=>i.$emit("close")),class:"text-gray-400 hover:text-gray-500 focus:outline-none focus:text-gray-500 transition ease-in-out duration-150"},t[17]||(t[17]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",pt,[e("div",xt,[e("div",null,[t[20]||(t[20]=e("label",{for:"route-mobile",class:"block text-sm font-medium text-gray-700 mb-2"},"Filter by Route (Optional)",-1)),e("select",{id:"route-mobile",name:"route",value:s.selectedRoute,onChange:t[1]||(t[1]=o=>i.$emit("route-change",o.target.value)),class:"block w-full pl-3 pr-10 py-3 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 rounded-md"},[t[18]||(t[18]=e("option",{value:""},"All Routes",-1)),t[19]||(t[19]=e("option",{value:"unassigned"},"Unassigned",-1)),(d(!0),c(F,null,B(s.routes,o=>(d(),c("option",{key:o,value:o},v(o),9,kt))),128))],40,ht)]),e("div",null,[t[21]||(t[21]=e("label",{for:"location-search-mobile",class:"block text-sm font-medium text-gray-700 mb-2"},"Search Location",-1)),e("input",{id:"location-search-mobile",name:"location-search",type:"text",value:s.locationSearchText,onInput:t[2]||(t[2]=o=>i.$emit("location-search",o.target.value)),placeholder:"Type to search locations...",class:"block w-full pl-3 pr-3 py-3 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 rounded-md"},null,40,wt)]),e("div",null,[e("label",$t,[t[22]||(t[22]=E(" Location ")),e("span",_t,"("+v(s.locations.length)+" locations)",1)]),e("select",{id:"location-mobile",name:"location",value:s.selectedLocation,onChange:t[3]||(t[3]=o=>i.$emit("location-change",o.target.value)),class:"block w-full pl-3 pr-10 py-3 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 rounded-md",required:""},[t[23]||(t[23]=e("option",{value:"",disabled:""},"Select a location",-1)),(d(!0),c(F,null,B(s.locations,o=>(d(),c("option",{key:o.id,value:o.id},[E(v(o.name)+" ",1),o.route?(d(),c("span",Ct," - "+v(o.route),1)):_("",!0)],8,Vt))),128))],40,Rt)]),e("div",null,[t[24]||(t[24]=e("label",{for:"visit_date_mobile",class:"block text-sm font-medium text-gray-700 mb-2"},"Visit Date",-1)),z(e("input",{type:"datetime-local",name:"visit_date",id:"visit_date_mobile","onUpdate:modelValue":t[4]||(t[4]=o=>s.restockForm.visit_date=o),class:"focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm text-base border-gray-300 rounded-md text-gray-900 py-3",required:""},null,512),[[q,s.restockForm.visit_date]])]),s.locationMachines.length>0?(d(),me(K,{key:0,machines:s.locationMachines},null,8,["machines"])):_("",!0),e("div",null,[t[25]||(t[25]=e("label",{for:"notes-mobile",class:"block text-sm font-medium text-gray-700 mb-2"},"Visit Notes",-1)),z(e("textarea",{id:"notes-mobile",name:"notes",rows:"3","onUpdate:modelValue":t[5]||(t[5]=o=>s.restockForm.notes=o),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full text-base border border-gray-300 rounded-md py-3",placeholder:"Add any notes about this visit..."},null,512),[[q,s.restockForm.notes]])])])]),e("div",Dt,[e("button",{type:"submit",disabled:s.saving,class:"w-full inline-flex justify-center items-center rounded-md border border-transparent shadow-sm px-4 py-3 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed min-h-[48px]"},[s.saving?(d(),c("span",Mt,t[26]||(t[26]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),E(" Saving... ")]))):(d(),c("span",Et,"Save Visit"))],8,St),e("button",{type:"button",onClick:t[6]||(t[6]=o=>i.$emit("close")),class:"w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-3 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 min-h-[48px]"}," Cancel ")])],32)]),e("div",Ft,[e("div",Bt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[8]||(t[8]=o=>i.$emit("close"))}),e("div",At,[e("form",{onSubmit:t[16]||(t[16]=J(o=>i.$emit("save"),["prevent"])),novalidate:"",class:"flex flex-col h-full"},[e("div",Lt,[e("div",jt,[e("h3",It,v(s.isEditing?"Edit Visit":"Record New Visit"),1),e("button",{type:"button",onClick:t[9]||(t[9]=o=>i.$emit("close")),class:"text-gray-400 hover:text-gray-500 focus:outline-none focus:text-gray-500 transition ease-in-out duration-150"},t[27]||(t[27]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])]),e("div",Nt,[e("div",Ut,[e("div",null,[t[30]||(t[30]=e("label",{for:"route",class:"block text-sm font-medium text-gray-700"},"Filter by Route (Optional)",-1)),e("select",{id:"route",name:"route",value:s.selectedRoute,onChange:t[10]||(t[10]=o=>i.$emit("route-change",o.target.value)),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md"},[t[28]||(t[28]=e("option",{value:""},"All Routes",-1)),t[29]||(t[29]=e("option",{value:"unassigned"},"Unassigned",-1)),(d(!0),c(F,null,B(s.routes,o=>(d(),c("option",{key:o,value:o},v(o),9,zt))),128))],40,Pt)]),e("div",null,[t[31]||(t[31]=e("label",{for:"location-search",class:"block text-sm font-medium text-gray-700"},"Search Location",-1)),e("input",{id:"location-search",name:"location-search",type:"text",value:s.locationSearchText,onInput:t[11]||(t[11]=o=>i.$emit("location-search",o.target.value)),placeholder:"Type to search locations...",class:"mt-1 block w-full pl-3 pr-3 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md"},null,40,qt)]),e("div",null,[e("label",Tt,[t[32]||(t[32]=E(" Location ")),e("span",Ot,"("+v(s.locations.length)+" locations)",1)]),e("select",{id:"location",name:"location",value:s.selectedLocation,onChange:t[12]||(t[12]=o=>i.$emit("location-change",o.target.value)),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},[t[33]||(t[33]=e("option",{value:"",disabled:""},"Select a location",-1)),(d(!0),c(F,null,B(s.locations,o=>(d(),c("option",{key:o.id,value:o.id},[E(v(o.name)+" ",1),o.route?(d(),c("span",Qt," - "+v(o.route),1)):_("",!0)],8,Ht))),128))],40,Wt)]),e("div",null,[t[34]||(t[34]=e("label",{for:"visit_date",class:"block text-sm font-medium text-gray-700"},"Visit Date",-1)),z(e("input",{type:"datetime-local",name:"visit_date",id:"visit_date","onUpdate:modelValue":t[13]||(t[13]=o=>s.restockForm.visit_date=o),class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md text-gray-900",required:""},null,512),[[q,s.restockForm.visit_date]])]),s.locationMachines.length>0?(d(),c("div",Gt,[M(K,{machines:s.locationMachines},null,8,["machines"])])):_("",!0),e("div",null,[t[35]||(t[35]=e("label",{for:"notes",class:"block text-sm font-medium text-gray-700"},"Visit Notes",-1)),z(e("textarea",{id:"notes",name:"notes",rows:"2","onUpdate:modelValue":t[14]||(t[14]=o=>s.restockForm.notes=o),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md"},null,512),[[q,s.restockForm.notes]])])])]),e("div",Yt,[e("button",{type:"submit",disabled:s.saving,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed"},[s.saving?(d(),c("span",Kt,t[36]||(t[36]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),E(" Saving... ")]))):(d(),c("span",Xt,"Save Visit"))],8,Jt),e("button",{type:"button",onClick:t[15]||(t[15]=o=>i.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])],32)])])])])):_("",!0)}},es={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},ts={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},ss={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full"},os={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},is={class:"sm:flex sm:items-start"},ns={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},as={key:0,class:"mt-4"},ls={class:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2"},rs={class:"sm:col-span-1"},ds={class:"mt-1 text-sm text-gray-900"},cs={class:"sm:col-span-1"},us={class:"mt-1 text-sm text-gray-900"},ms={class:"sm:col-span-1"},fs={class:"mt-1 text-sm text-gray-900"},vs={class:"sm:col-span-2"},gs={class:"mt-1 text-sm text-gray-900"},bs={key:0,class:"mt-6"},ys={class:"text-sm font-semibold text-gray-700 mb-2 bg-gray-100 px-3 py-2 rounded-md"},ps={class:"border border-gray-200 rounded-md overflow-hidden"},xs={class:"divide-y divide-gray-200"},hs={class:"grid grid-cols-6 gap-2 items-center"},ks={class:"col-span-1 text-center bg-gray-100 rounded-md py-1 text-sm font-medium text-gray-900"},ws={class:"col-span-1 text-sm font-medium text-gray-900"},$s={class:"col-span-1 text-center text-sm text-gray-500"},_s={class:"col-span-1 text-center text-sm text-gray-500"},Rs={class:"col-span-1 text-center text-sm text-green-600 font-medium"},Vs={class:"col-span-1 text-center text-sm font-medium text-gray-900"},Cs={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Ds={__name:"RestockDetailsModal",props:{show:Boolean,restock:Object},emits:["close"],setup(s){const f=s,l=Z(()=>{var i;if(!((i=f.restock)!=null&&i.entries))return{};const r={};return f.restock.entries.forEach(t=>{`${t.machine_name||"Unknown"}${t.machine_type||""}${t.machine_model||""}`;const o=`${t.machine_name||"Unknown Machine"} (${t.machine_type||"Unknown Type"}${t.machine_model?" "+t.machine_model:""})`;r[o]||(r[o]=[]),r[o].push(t)}),Object.keys(r).forEach(t=>{r[t].sort((o,x)=>{const m=o.slot||999,u=x.slot||999;return m-u})}),r});return(r,i)=>s.show?(d(),c("div",es,[e("div",ts,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:i[0]||(i[0]=t=>r.$emit("close"))}),i[9]||(i[9]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",ss,[e("div",os,[e("div",is,[e("div",ns,[i[8]||(i[8]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Restock Details ",-1)),s.restock?(d(),c("div",as,[e("dl",ls,[e("div",rs,[i[2]||(i[2]=e("dt",{class:"text-sm font-medium text-gray-500"},"Location",-1)),e("dd",ds,v(s.restock.location_name),1)]),e("div",cs,[i[3]||(i[3]=e("dt",{class:"text-sm font-medium text-gray-500"},"Visit Date",-1)),e("dd",us,v(D(H)(s.restock.visit_date)),1)]),e("div",ms,[i[4]||(i[4]=e("dt",{class:"text-sm font-medium text-gray-500"},"Restocked By",-1)),e("dd",fs,v(s.restock.user_name),1)]),e("div",vs,[i[5]||(i[5]=e("dt",{class:"text-sm font-medium text-gray-500"},"Notes",-1)),e("dd",gs,v(s.restock.notes||"No notes"),1)])]),s.restock.entries&&s.restock.entries.length>0?(d(),c("div",bs,[i[7]||(i[7]=e("h4",{class:"text-sm font-medium text-gray-500 mb-4"},"Restocked Items",-1)),(d(!0),c(F,null,B(l.value,(t,o)=>(d(),c("div",{key:o,class:"mb-6"},[e("h5",ys,v(o),1),e("div",ps,[i[6]||(i[6]=ee('<div class="px-4 py-3 bg-gray-50 text-xs font-medium text-gray-500 uppercase tracking-wider"><div class="grid grid-cols-6 gap-2"><div class="col-span-1 text-center">Slot</div><div class="col-span-1">Product</div><div class="col-span-1 text-center">Prev Qty</div><div class="col-span-1 text-center">Discarded</div><div class="col-span-1 text-center">Added</div><div class="col-span-1 text-center">New Qty</div></div></div>',1)),e("div",xs,[(d(!0),c(F,null,B(t,x=>(d(),c("div",{key:x.id,class:"px-4 py-3"},[e("div",hs,[e("div",ks,v(x.slot||"-"),1),e("div",ws,v(x.product_name),1),e("div",$s,v(x.previous_quantity),1),e("div",_s,v(x.quantity_discarded),1),e("div",Rs," +"+v(x.quantity_added),1),e("div",Vs,v(x.previous_quantity+x.quantity_added-x.quantity_discarded),1)])]))),128))])])]))),128))])):_("",!0)])):_("",!0)])])]),e("div",Cs,[e("button",{type:"button",onClick:i[1]||(i[1]=t=>r.$emit("close")),class:"w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:w-auto sm:text-sm"}," Close ")])])])])):_("",!0)}},Ss={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Ms={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Es={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Fs={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Bs={class:"sm:flex sm:items-start"},As={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},Ls={key:0,class:"mt-2"},js={class:"text-sm text-gray-500"},Is={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Ns={__name:"DeleteConfirmationModal",props:{show:Boolean,restock:Object},emits:["close","confirm"],setup(s){return(f,l)=>s.show?(d(),c("div",Ss,[e("div",Ms,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:l[0]||(l[0]=r=>f.$emit("close"))}),l[5]||(l[5]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Es,[e("div",Fs,[e("div",Bs,[l[4]||(l[4]=e("div",{class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"},[e("svg",{class:"h-6 w-6 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),e("div",As,[l[3]||(l[3]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Delete Visit ",-1)),s.restock?(d(),c("div",Ls,[e("p",js," Are you sure you want to delete this visit to "+v(s.restock.location_name)+" on "+v(D(H)(s.restock.visit_date))+"? This action will also reverse all inventory changes made during this visit. This action cannot be undone. ",1)])):_("",!0)])])]),e("div",Is,[e("button",{type:"button",onClick:l[1]||(l[1]=r=>f.$emit("confirm")),class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"}," Delete "),e("button",{type:"button",onClick:l[2]||(l[2]=r=>f.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])])])])):_("",!0)}},Ws={__name:"Restocks",setup(s){const f=X(),{restocks:l,loading:r,error:i,fetchRestocks:t,deleteVisit:o,getVisitDetails:x}=pe(),{filteredLocations:m,routes:u,selectedRoute:p,locationSearchText:n,fetchLocations:a,fetchRoutes:A,resetFilters:j}=ve(),{locationMachines:b,fetchLocationMachines:R,updateMachineProductData:C,resetMachineData:g}=ge(),{restockForm:y,isEditing:h,selectedLocation:w,saving:N,initializeForm:Q,saveRestockOptimized:te}=xe(),I=S(!1),O=S(!1),U=S(!1),W=S(null),P=S(null),G=()=>{Q(),j(),g(),I.value=!0},se=async k=>{Q(k),j(),await R(k.location_id);try{for(const V of b.value)await C(k.id,V.id);I.value=!0}catch(V){console.error("Error loading visit for editing:",V),i.value="Failed to load visit details for editing. Please try again."}},oe=async k=>{W.value=k;try{const V=await x(k.id);W.value={...k,entries:V},O.value=!0}catch(V){console.error("Error fetching visit details:",V),i.value="Failed to load visit details. Please try again."}},ie=k=>{P.value=k,U.value=!0},ne=async()=>{try{await o(P.value.id),U.value=!1,P.value=null}catch(k){console.error("Error deleting visit:",k),i.value="Failed to delete visit. Please try again."}},ae=async()=>{await te(b.value)&&(I.value=!1,await t())},le=k=>{p.value=k,w.value="",g()},re=k=>{n.value=k},de=k=>{w.value=k,R(k)};return fe(async()=>{f.isAuthenticated&&!f.user&&await f.fetchUser(),console.log("Current user:",f.user),await Promise.all([t(),a(),A()])}),(k,V)=>(d(),c("div",null,[e("div",{class:"flex justify-between items-center mb-6"},[V[3]||(V[3]=e("h1",{class:"text-2xl font-semibold text-gray-900"},"Location Visits",-1)),e("button",{onClick:G,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Record New Visit ")]),M(Ne,{restocks:D(l),loading:D(r),error:D(i),onAddRestock:G,onViewDetails:oe,onEditRestock:se,onDeleteRestock:ie},null,8,["restocks","loading","error"]),M(Zt,{show:I.value,"is-editing":D(h),"restock-form":D(y),"selected-location":D(w),"selected-route":D(p),"location-search-text":D(n),locations:D(m),routes:D(u),"location-machines":D(b),saving:D(N),onClose:V[0]||(V[0]=Y=>I.value=!1),onSave:ae,onRouteChange:le,onLocationSearch:re,onLocationChange:de},null,8,["show","is-editing","restock-form","selected-location","selected-route","location-search-text","locations","routes","location-machines","saving"]),M(Ds,{show:O.value,restock:W.value,onClose:V[1]||(V[1]=Y=>O.value=!1)},null,8,["show","restock"]),M(Ns,{show:U.value,restock:P.value,onClose:V[2]||(V[2]=Y=>U.value=!1),onConfirm:ne},null,8,["show","restock"])]))}};export{Ws as default};
