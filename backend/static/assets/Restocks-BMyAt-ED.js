import{r as E,y as Y,b as g,o as m,d as e,t as v,F,f as L,u as V,e as J,n as G,g as S,l as M,w as A,s as B,q as re,m as ae,c as le,k as de,i as q}from"./index-DbTf5vB-.js";import{a as _}from"./api-DXQxmCcL.js";import{u as ce}from"./useLocations-BtZRhYvy.js";import{u as me}from"./useMachines-BsBBdmt0.js";import{g as ue,f as O}from"./dateUtils-CXdyRzwD.js";function fe(){const i=E([]),a=E(!1),t=E(null),s=async()=>{a.value=!0,t.value=null;try{const y=await _.getVisits();i.value=y.data.map(o=>({id:o.id,location_id:o.location,location_name:o.location_name,visit_date:o.visit_date,notes:o.notes,user_name:o.user_name}))}catch(y){console.error("Error fetching visits:",y),t.value="Failed to load visits. Please try again later."}finally{a.value=!1}};return{restocks:i,loading:a,error:t,fetchRestocks:s,createVisit:async y=>{try{return(await _.createVisit(y)).data}catch(o){throw console.error("Error creating visit:",o),o}},updateVisit:async(y,o)=>{try{return(await _.updateVisit(y,o)).data}catch(n){throw console.error("Error updating visit:",n),n}},deleteVisit:async y=>{try{await _.deleteVisit(y),await s()}catch(o){throw console.error("Error deleting visit:",o),o}},getVisitDetails:async y=>{try{const n=(await _.getRestocks({visit:y})).data;let p=[];for(const l of n){const I=(await _.getRestockEntries({visit_machine_restock:l.id})).data,R=(await _.getMachineItems({machine:l.machine})).data,D=I.map(d=>{const c=R.find(h=>h.product===d.product);return{...d,slot:c?c.slot:null}});p.push(...D)}return p.sort((l,k)=>l.visit_machine_restock!==k.visit_machine_restock?0:(l.slot||999)-(k.slot||999)),p.map(l=>({id:l.id,product_name:l.product_name,product_id:l.product,previous_quantity:l.stock_before,quantity_discarded:l.discarded,quantity_added:l.restocked,machine_name:l.machine_name,machine_type:l.machine_type,machine_model:l.machine_model,slot:l.slot}))}catch(o){throw console.error("Error fetching visit details:",o),o}}}}function ge(){const i=Y(),a=E(!1),t=E(""),s=E(null),r=E(!1),u=E({id:null,visit_date:"",notes:"",location:"",machines:[]}),$=(f=null)=>{f?(a.value=!0,t.value=f.location_id,u.value={id:f.id,visit_date:f.visit_date,notes:f.notes,location:f.location_id}):(a.value=!1,t.value="",u.value={id:null,visit_date:ue(),notes:"",location:"",machines:[]})},x=f=>f.some(d=>d.products.some(c=>y(c)))?f.some(d=>d.products.some(c=>y(c)?c.stock_before===""||c.restocked==="":!1))?(s.value="Please complete all fields for products being restocked (stock before and restock amount are required)",!1):!0:(s.value="Please record stock levels for at least one product",!1),y=f=>f.stock_before!==""||f.restocked!==""||f.discarded!=="",o=async f=>{var R,D;try{if(r.value=!0,s.value=null,!x(f))return!1;const d=n(f);return console.log("Saving visit with bulk data:",d),a.value&&u.value.id?await _.updateVisitBulk(u.value.id,d):await _.createVisitBulk(d),!0}catch(d){return console.error("Error saving restock visit:",d),s.value=((D=(R=d.response)==null?void 0:R.data)==null?void 0:D.error)||"Failed to save visit. Please try again.",!1}finally{r.value=!1}},n=f=>{var d;const R={location:t.value,visit_date:u.value.visit_date,notes:u.value.notes,user:(d=i.user)==null?void 0:d.id},D=f.filter(c=>c.products.some(h=>y(h))).map(c=>{const h=c.products.filter(w=>y(w)).map(w=>({product:w.id,stock_before:parseInt(w.stock_before)||0,discarded:parseInt(w.discarded)||0,restocked:parseInt(w.restocked)||0}));return{machine:c.id,notes:"",restock_entries:h}});return{visit:R,machine_restocks:D}},p=async(f,R,D)=>{var d;console.warn("Using legacy saveRestock - consider migrating to saveRestockOptimized for better performance");try{if(s.value=null,!x(f))return!1;let c;const h={location:t.value,visit_date:u.value.visit_date,notes:u.value.notes,user:(d=i.user)==null?void 0:d.id};return console.log("Saving visit with data:",h),a.value&&u.value.id?c=(await D(u.value.id,h)).id:c=(await R(h)).id,await l(c,f),!0}catch(c){return console.error("Error saving restock visit:",c),s.value="Failed to save visit. Please try again.",!1}},l=async(f,R)=>{const D=R.filter(d=>d.products.some(c=>y(c)));for(const d of D){let c;if(a.value)try{const h=await _.getRestocks({visit:f,machine:d.id});if(h.data.length>0){const w=h.data[0],j={visit:f,machine:d.id,notes:w.notes||""};await _.updateRestock(w.id,j),c=w.id}else{const w={visit:f,machine:d.id,notes:""};c=(await _.createRestock(w)).data.id}}catch(h){throw console.error("Error handling machine restock:",h),h}else{const h={visit:f,machine:d.id,notes:""};c=(await _.createRestock(h)).data.id}await k(c,d.products)}},k=async(f,R)=>{const D=R.filter(d=>y(d));for(const d of D)try{const c={visit_machine_restock:f,product:d.id,stock_before:parseInt(d.stock_before)||0,discarded:parseInt(d.discarded)||0,restocked:parseInt(d.restocked)||0};if(a.value){const h=await _.getRestockEntries({visit_machine_restock:f,product:d.id});h.data.length>0?await _.updateRestockEntry(h.data[0].id,c):await _.createRestockEntry(c)}else await _.createRestockEntry(c)}catch(c){throw console.error("Error handling restock entry:",c),c}};return{restockForm:u,isEditing:a,selectedLocation:t,error:s,saving:r,initializeForm:$,validateForm:x,saveRestock:p,saveRestockOptimized:o,resetForm:()=>{$(),s.value=null}}}const ve={key:0,class:"flex justify-center"},ye={key:1,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-4"},pe={class:"flex"},he={class:"ml-3"},xe={class:"text-sm text-red-700"},be={key:2,class:"bg-white shadow overflow-hidden sm:rounded-lg"},ke={class:"px-4 py-5 sm:p-6 text-center"},we={class:"mt-5"},_e={key:3,class:"bg-white shadow overflow-hidden sm:rounded-lg"},$e={role:"list",class:"divide-y divide-gray-200"},Re={class:"flex items-center justify-between"},Ce={class:"flex-1 min-w-0"},De={class:"text-sm font-medium text-primary-600 truncate"},Ve={class:"text-sm text-gray-500"},Ee={class:"ml-4 flex-shrink-0 flex space-x-2"},Se=["onClick"],Me=["onClick"],Fe=["onClick"],Le={__name:"RestockList",props:{restocks:Array,loading:Boolean,error:String},emits:["add-restock","view-details","edit-restock","delete-restock"],setup(i){return(a,t)=>(m(),g("div",null,[i.loading?(m(),g("div",ve,t[1]||(t[1]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))):i.error?(m(),g("div",ye,[e("div",pe,[t[2]||(t[2]=e("div",{class:"flex-shrink-0"},[e("span",{class:"text-red-400"},"âš ")],-1)),e("div",he,[e("p",xe,v(i.error),1)])])])):i.restocks.length===0?(m(),g("div",be,[e("div",ke,[t[3]||(t[3]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"No visits recorded",-1)),t[4]||(t[4]=e("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[e("p",null,"Get started by recording your first location visit.")],-1)),e("div",we,[e("button",{onClick:t[0]||(t[0]=s=>a.$emit("add-restock")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Record New Visit ")])])])):(m(),g("div",_e,[e("ul",$e,[(m(!0),g(F,null,L(i.restocks,s=>(m(),g("li",{key:s.id,class:"px-4 py-4 sm:px-6"},[e("div",Re,[e("div",Ce,[e("p",De,v(s.location_name),1),e("p",Ve,v(V(O)(s.visit_date)),1)]),e("div",Ee,[e("button",{onClick:r=>a.$emit("view-details",s),class:"inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," View Details ",8,Se),e("button",{onClick:r=>a.$emit("edit-restock",s),class:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Edit ",8,Me),e("button",{onClick:r=>a.$emit("delete-restock",s),class:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," Delete ",8,Fe)])])]))),128))])]))]))}},Ie={class:"space-y-4"},Pe={class:"flex justify-between items-center mb-2"},Ae={class:"text-sm font-medium text-gray-900"},Be={key:0,class:"ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"},je={class:"text-sm text-gray-500"},Ne={key:0,class:"ml-2 text-green-600"},Ue={class:"space-y-2"},qe={key:0,class:"text-sm text-gray-500 italic p-2 text-center"},ze={class:"col-span-1 text-sm font-medium text-gray-900 text-center bg-gray-100 rounded-md py-1"},Te={class:"col-span-3 text-sm font-medium text-gray-900"},Oe={key:0,class:"ml-1 inline-flex items-center w-2 h-2 bg-green-500 rounded-full",title:"Will be restocked"},We={class:"col-span-2"},He={class:"mt-1 flex rounded-md shadow-sm"},Qe=["onClick"],Ge=["onUpdate:modelValue"],Ye=["onClick"],Je={class:"col-span-2"},Ke={class:"mt-1 flex rounded-md shadow-sm"},Xe=["onClick"],Ze=["onUpdate:modelValue"],et=["onClick"],tt={class:"col-span-2"},st={class:"mt-1 flex rounded-md shadow-sm"},ot=["onClick"],it=["onUpdate:modelValue"],nt=["onClick"],rt={class:"col-span-2 text-sm text-gray-500"},at={__name:"MachineProductsSection",props:{machines:Array},setup(i){const a=(o,n)=>{const p=o[n]===""?0:parseInt(o[n])||0;o[n]=p+1},t=(o,n)=>{const p=o[n]===""?0:parseInt(o[n])||0;o[n]=Math.max(0,p-1)},s=o=>(parseInt(o.stock_before)||0)-(parseInt(o.discarded)||0)+(parseInt(o.restocked)||0),r=o=>o.stock_before!==""||o.restocked!==""||o.discarded!=="",u=o=>o.products.some(n=>r(n)),$=o=>o.products.filter(n=>r(n)).length,x=o=>u(o)?"border-green-300 bg-green-50":"border-gray-200",y=o=>r(o)?"bg-green-50 rounded-md p-2":"p-2";return(o,n)=>(m(),g("div",null,[n[9]||(n[9]=J('<h4 class="text-sm font-medium text-gray-700 mb-2">Machines at Location</h4><div class="mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"><div class="flex items-center"><svg class="h-5 w-5 text-blue-400 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><div class="text-sm text-blue-700"><p class="font-medium">Partial Restock Allowed</p><p class="text-blue-600">You can restock only the machines/products you need. Leave others empty to skip them.</p></div></div></div>',2)),e("div",Ie,[(m(!0),g(F,null,L(i.machines,p=>(m(),g("div",{key:p.id,class:G(["border rounded-lg p-4",x(p)])},[e("div",Pe,[e("h5",Ae,[S(v(p.name)+" ("+v(p.machine_type)+" "+v(p.model)+") ",1),u(p)?(m(),g("span",Be," Will be restocked ")):M("",!0)]),e("div",je,[S(v(p.products.length)+" products ",1),u(p)?(m(),g("span",Ne," ("+v($(p))+" being restocked) ",1)):M("",!0)])]),e("div",Ue,[p.products.length===0?(m(),g("div",qe," No products in this machine ")):M("",!0),(m(!0),g(F,null,L(p.products,l=>(m(),g("div",{key:l.id,class:G(["grid grid-cols-12 gap-4 items-center",y(l)])},[e("div",ze,v(l.slot),1),e("div",Te,[S(v(l.name)+" ",1),r(l)?(m(),g("span",Oe)):M("",!0)]),e("div",We,[n[2]||(n[2]=e("label",{class:"block text-xs text-gray-500"},"Current Stock",-1)),e("div",He,[e("button",{type:"button",onClick:k=>t(l,"stock_before"),class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},n[0]||(n[0]=[e("span",{class:"sr-only"},"Decrease",-1),S(" - ")]),8,Qe),A(e("input",{type:"number","onUpdate:modelValue":k=>l.stock_before=k,min:"0",class:"focus:ring-primary-500 focus:border-primary-500 block w-full border-gray-300 rounded-none text-center sm:text-sm",placeholder:"0"},null,8,Ge),[[B,l.stock_before]]),e("button",{type:"button",onClick:k=>a(l,"stock_before"),class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},n[1]||(n[1]=[e("span",{class:"sr-only"},"Increase",-1),S(" + ")]),8,Ye)])]),e("div",Je,[n[5]||(n[5]=e("label",{class:"block text-xs text-gray-500"},"Discarded Amount",-1)),e("div",Ke,[e("button",{type:"button",onClick:k=>t(l,"discarded"),class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},n[3]||(n[3]=[e("span",{class:"sr-only"},"Decrease",-1),S(" - ")]),8,Xe),A(e("input",{type:"number","onUpdate:modelValue":k=>l.discarded=k,min:"0",class:"focus:ring-primary-500 focus:border-primary-500 block w-full border-gray-300 rounded-none text-center sm:text-sm",placeholder:"0"},null,8,Ze),[[B,l.discarded]]),e("button",{type:"button",onClick:k=>a(l,"discarded"),class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},n[4]||(n[4]=[e("span",{class:"sr-only"},"Increase",-1),S(" + ")]),8,et)])]),e("div",tt,[n[8]||(n[8]=e("label",{class:"block text-xs text-gray-500"},"Restock Amount",-1)),e("div",st,[e("button",{type:"button",onClick:k=>t(l,"restocked"),class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},n[6]||(n[6]=[e("span",{class:"sr-only"},"Decrease",-1),S(" - ")]),8,ot),A(e("input",{type:"number","onUpdate:modelValue":k=>l.restocked=k,min:"0",class:"focus:ring-primary-500 focus:border-primary-500 block w-full border-gray-300 rounded-none text-center sm:text-sm",placeholder:"0"},null,8,it),[[B,l.restocked]]),e("button",{type:"button",onClick:k=>a(l,"restocked"),class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},n[7]||(n[7]=[e("span",{class:"sr-only"},"Increase",-1),S(" + ")]),8,nt)])]),e("div",rt," New Total: "+v(s(l)),1)],2))),128))])],2))),128))])]))}},lt={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},dt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},ct={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full"},mt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},ut={class:"sm:flex sm:items-start"},ft={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},gt={class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"},vt={class:"mt-4 space-y-4"},yt=["value"],pt=["value"],ht=["value"],xt={for:"location",class:"block text-sm font-medium text-gray-700"},bt={class:"text-xs text-gray-500 ml-1"},kt=["value"],wt=["value"],_t={key:0,class:"text-gray-500"},$t={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Rt=["disabled"],Ct={key:0,class:"inline-flex items-center"},Dt={key:1},Vt={__name:"RestockFormModal",props:{show:Boolean,isEditing:Boolean,restockForm:Object,selectedLocation:String,selectedRoute:String,locationSearchText:String,locations:Array,routes:Array,locationMachines:Array,saving:Boolean},emits:["close","save","route-change","location-search","location-change"],setup(i){return(a,t)=>i.show?(m(),g("div",lt,[e("div",dt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=s=>a.$emit("close"))}),t[17]||(t[17]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"â€‹",-1)),e("div",ct,[e("form",{onSubmit:t[7]||(t[7]=re(s=>a.$emit("save"),["prevent"])),novalidate:""},[e("div",mt,[e("div",ut,[e("div",ft,[e("h3",gt,v(i.isEditing?"Edit Visit":"Record New Visit"),1),e("div",vt,[e("div",null,[t[10]||(t[10]=e("label",{for:"route",class:"block text-sm font-medium text-gray-700"},"Filter by Route (Optional)",-1)),e("select",{id:"route",name:"route",value:i.selectedRoute,onChange:t[1]||(t[1]=s=>a.$emit("route-change",s.target.value)),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md"},[t[8]||(t[8]=e("option",{value:""},"All Routes",-1)),t[9]||(t[9]=e("option",{value:"unassigned"},"Unassigned",-1)),(m(!0),g(F,null,L(i.routes,s=>(m(),g("option",{key:s,value:s},v(s),9,pt))),128))],40,yt)]),e("div",null,[t[11]||(t[11]=e("label",{for:"location-search",class:"block text-sm font-medium text-gray-700"},"Search Location",-1)),e("input",{id:"location-search",name:"location-search",type:"text",value:i.locationSearchText,onInput:t[2]||(t[2]=s=>a.$emit("location-search",s.target.value)),placeholder:"Type to search locations...",class:"mt-1 block w-full pl-3 pr-3 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md"},null,40,ht)]),e("div",null,[e("label",xt,[t[12]||(t[12]=S(" Location ")),e("span",bt,"("+v(i.locations.length)+" locations)",1)]),e("select",{id:"location",name:"location",value:i.selectedLocation,onChange:t[3]||(t[3]=s=>a.$emit("location-change",s.target.value)),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},[t[13]||(t[13]=e("option",{value:"",disabled:""},"Select a location",-1)),(m(!0),g(F,null,L(i.locations,s=>(m(),g("option",{key:s.id,value:s.id},[S(v(s.name)+" ",1),s.route?(m(),g("span",_t," - "+v(s.route),1)):M("",!0)],8,wt))),128))],40,kt)]),e("div",null,[t[14]||(t[14]=e("label",{for:"visit_date",class:"block text-sm font-medium text-gray-700"},"Visit Date",-1)),A(e("input",{type:"datetime-local",name:"visit_date",id:"visit_date","onUpdate:modelValue":t[4]||(t[4]=s=>i.restockForm.visit_date=s),class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md text-gray-900",required:""},null,512),[[B,i.restockForm.visit_date]])]),i.locationMachines.length>0?(m(),ae(at,{key:0,machines:i.locationMachines},null,8,["machines"])):M("",!0),e("div",null,[t[15]||(t[15]=e("label",{for:"notes",class:"block text-sm font-medium text-gray-700"},"Visit Notes",-1)),A(e("textarea",{id:"notes",name:"notes",rows:"2","onUpdate:modelValue":t[5]||(t[5]=s=>i.restockForm.notes=s),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md"},null,512),[[B,i.restockForm.notes]])])])])])]),e("div",$t,[e("button",{type:"submit",disabled:i.saving,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed"},[i.saving?(m(),g("span",Ct,t[16]||(t[16]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),S(" Saving... ")]))):(m(),g("span",Dt,"Save Visit"))],8,Rt),e("button",{type:"button",onClick:t[6]||(t[6]=s=>a.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])],32)])])])):M("",!0)}},Et={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},St={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Mt={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full"},Ft={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Lt={class:"sm:flex sm:items-start"},It={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},Pt={key:0,class:"mt-4"},At={class:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2"},Bt={class:"sm:col-span-1"},jt={class:"mt-1 text-sm text-gray-900"},Nt={class:"sm:col-span-1"},Ut={class:"mt-1 text-sm text-gray-900"},qt={class:"sm:col-span-1"},zt={class:"mt-1 text-sm text-gray-900"},Tt={class:"sm:col-span-2"},Ot={class:"mt-1 text-sm text-gray-900"},Wt={key:0,class:"mt-6"},Ht={class:"text-sm font-semibold text-gray-700 mb-2 bg-gray-100 px-3 py-2 rounded-md"},Qt={class:"border border-gray-200 rounded-md overflow-hidden"},Gt={class:"divide-y divide-gray-200"},Yt={class:"grid grid-cols-6 gap-2 items-center"},Jt={class:"col-span-1 text-center bg-gray-100 rounded-md py-1 text-sm font-medium text-gray-900"},Kt={class:"col-span-1 text-sm font-medium text-gray-900"},Xt={class:"col-span-1 text-center text-sm text-gray-500"},Zt={class:"col-span-1 text-center text-sm text-gray-500"},es={class:"col-span-1 text-center text-sm text-green-600 font-medium"},ts={class:"col-span-1 text-center text-sm font-medium text-gray-900"},ss={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},os={__name:"RestockDetailsModal",props:{show:Boolean,restock:Object},emits:["close"],setup(i){const a=i,t=le(()=>{var r;if(!((r=a.restock)!=null&&r.entries))return{};const s={};return a.restock.entries.forEach(u=>{`${u.machine_name||"Unknown"}${u.machine_type||""}${u.machine_model||""}`;const $=`${u.machine_name||"Unknown Machine"} (${u.machine_type||"Unknown Type"}${u.machine_model?" "+u.machine_model:""})`;s[$]||(s[$]=[]),s[$].push(u)}),Object.keys(s).forEach(u=>{s[u].sort(($,x)=>{const y=$.slot||999,o=x.slot||999;return y-o})}),s});return(s,r)=>i.show?(m(),g("div",Et,[e("div",St,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:r[0]||(r[0]=u=>s.$emit("close"))}),r[9]||(r[9]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"â€‹",-1)),e("div",Mt,[e("div",Ft,[e("div",Lt,[e("div",It,[r[8]||(r[8]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Restock Details ",-1)),i.restock?(m(),g("div",Pt,[e("dl",At,[e("div",Bt,[r[2]||(r[2]=e("dt",{class:"text-sm font-medium text-gray-500"},"Location",-1)),e("dd",jt,v(i.restock.location_name),1)]),e("div",Nt,[r[3]||(r[3]=e("dt",{class:"text-sm font-medium text-gray-500"},"Visit Date",-1)),e("dd",Ut,v(V(O)(i.restock.visit_date)),1)]),e("div",qt,[r[4]||(r[4]=e("dt",{class:"text-sm font-medium text-gray-500"},"Restocked By",-1)),e("dd",zt,v(i.restock.user_name),1)]),e("div",Tt,[r[5]||(r[5]=e("dt",{class:"text-sm font-medium text-gray-500"},"Notes",-1)),e("dd",Ot,v(i.restock.notes||"No notes"),1)])]),i.restock.entries&&i.restock.entries.length>0?(m(),g("div",Wt,[r[7]||(r[7]=e("h4",{class:"text-sm font-medium text-gray-500 mb-4"},"Restocked Items",-1)),(m(!0),g(F,null,L(t.value,(u,$)=>(m(),g("div",{key:$,class:"mb-6"},[e("h5",Ht,v($),1),e("div",Qt,[r[6]||(r[6]=J('<div class="px-4 py-3 bg-gray-50 text-xs font-medium text-gray-500 uppercase tracking-wider"><div class="grid grid-cols-6 gap-2"><div class="col-span-1 text-center">Slot</div><div class="col-span-1">Product</div><div class="col-span-1 text-center">Prev Qty</div><div class="col-span-1 text-center">Discarded</div><div class="col-span-1 text-center">Added</div><div class="col-span-1 text-center">New Qty</div></div></div>',1)),e("div",Gt,[(m(!0),g(F,null,L(u,x=>(m(),g("div",{key:x.id,class:"px-4 py-3"},[e("div",Yt,[e("div",Jt,v(x.slot||"-"),1),e("div",Kt,v(x.product_name),1),e("div",Xt,v(x.previous_quantity),1),e("div",Zt,v(x.quantity_discarded),1),e("div",es," +"+v(x.quantity_added),1),e("div",ts,v(x.previous_quantity+x.quantity_added-x.quantity_discarded),1)])]))),128))])])]))),128))])):M("",!0)])):M("",!0)])])]),e("div",ss,[e("button",{type:"button",onClick:r[1]||(r[1]=u=>s.$emit("close")),class:"w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:w-auto sm:text-sm"}," Close ")])])])])):M("",!0)}},is={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},ns={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},rs={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},as={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},ls={class:"sm:flex sm:items-start"},ds={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},cs={key:0,class:"mt-2"},ms={class:"text-sm text-gray-500"},us={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},fs={__name:"DeleteConfirmationModal",props:{show:Boolean,restock:Object},emits:["close","confirm"],setup(i){return(a,t)=>i.show?(m(),g("div",is,[e("div",ns,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=s=>a.$emit("close"))}),t[5]||(t[5]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"â€‹",-1)),e("div",rs,[e("div",as,[e("div",ls,[t[4]||(t[4]=e("div",{class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"},[e("svg",{class:"h-6 w-6 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),e("div",ds,[t[3]||(t[3]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Delete Visit ",-1)),i.restock?(m(),g("div",cs,[e("p",ms," Are you sure you want to delete this visit to "+v(i.restock.location_name)+" on "+v(V(O)(i.restock.visit_date))+"? This action will also reverse all inventory changes made during this visit. This action cannot be undone. ",1)])):M("",!0)])])]),e("div",us,[e("button",{type:"button",onClick:t[1]||(t[1]=s=>a.$emit("confirm")),class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"}," Delete "),e("button",{type:"button",onClick:t[2]||(t[2]=s=>a.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])])])])):M("",!0)}},xs={__name:"Restocks",setup(i){const a=Y(),{restocks:t,loading:s,error:r,fetchRestocks:u,deleteVisit:$,getVisitDetails:x}=fe(),{filteredLocations:y,routes:o,selectedRoute:n,locationSearchText:p,fetchLocations:l,fetchRoutes:k,resetFilters:I}=ce(),{locationMachines:f,fetchLocationMachines:R,updateMachineProductData:D,resetMachineData:d}=me(),{restockForm:c,isEditing:h,selectedLocation:w,saving:j,initializeForm:W,saveRestockOptimized:K}=ge(),P=E(!1),z=E(!1),N=E(!1),T=E(null),U=E(null),H=()=>{W(),I(),d(),P.value=!0},X=async b=>{W(b),I(),await R(b.location_id);try{for(const C of f.value)await D(b.id,C.id);P.value=!0}catch(C){console.error("Error loading visit for editing:",C),r.value="Failed to load visit details for editing. Please try again."}},Z=async b=>{T.value=b;try{const C=await x(b.id);T.value={...b,entries:C},z.value=!0}catch(C){console.error("Error fetching visit details:",C),r.value="Failed to load visit details. Please try again."}},ee=b=>{U.value=b,N.value=!0},te=async()=>{try{await $(U.value.id),N.value=!1,U.value=null}catch(b){console.error("Error deleting visit:",b),r.value="Failed to delete visit. Please try again."}},se=async()=>{await K(f.value)&&(P.value=!1,await u())},oe=b=>{n.value=b,w.value="",d()},ie=b=>{p.value=b},ne=b=>{w.value=b,R(b)};return de(async()=>{a.isAuthenticated&&!a.user&&await a.fetchUser(),console.log("Current user:",a.user),await Promise.all([u(),l(),k()])}),(b,C)=>(m(),g("div",null,[e("div",{class:"flex justify-between items-center mb-6"},[C[3]||(C[3]=e("h1",{class:"text-2xl font-semibold text-gray-900"},"Location Visits",-1)),e("button",{onClick:H,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Record New Visit ")]),q(Le,{restocks:V(t),loading:V(s),error:V(r),onAddRestock:H,onViewDetails:Z,onEditRestock:X,onDeleteRestock:ee},null,8,["restocks","loading","error"]),q(Vt,{show:P.value,"is-editing":V(h),"restock-form":V(c),"selected-location":V(w),"selected-route":V(n),"location-search-text":V(p),locations:V(y),routes:V(o),"location-machines":V(f),saving:V(j),onClose:C[0]||(C[0]=Q=>P.value=!1),onSave:se,onRouteChange:oe,onLocationSearch:ie,onLocationChange:ne},null,8,["show","is-editing","restock-form","selected-location","selected-route","location-search-text","locations","routes","location-machines","saving"]),q(os,{show:z.value,restock:T.value,onClose:C[1]||(C[1]=Q=>z.value=!1)},null,8,["show","restock"]),q(fs,{show:N.value,restock:U.value,onClose:C[2]||(C[2]=Q=>N.value=!1),onConfirm:te},null,8,["show","restock"])]))}};export{xs as default};
