import{D as h,A as p}from"./index-CB3oydmX.js";const m=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",g="/api",y="/media";let d=g,v=y;console.log("API Service - Current hostname:",window.location.hostname);console.log("API Service - isLocalhost:",m);console.log("API Service - API_URL:",d);console.log("API Service - MEDIA_URL:",v);console.log("API Service - Environment:","production");const k=2*60*60*1e3,o=new Map,f=(e,t={})=>{const a=new URLSearchParams(t).toString();return`${e}${a?"?"+a:""}`},$=e=>Date.now()-e.timestamp<k,P=e=>{const t=o.get(e);return t&&$(t)?(console.log("Cache hit:",e),t.data):(t&&o.delete(e),null)},R=(e,t)=>{o.set(e,{data:t,timestamp:Date.now()}),console.log("Cache set:",e)},s=e=>{const t=[];for(const a of o.keys())a.includes(e)&&t.push(a);t.forEach(a=>o.delete(a)),console.log("Cache invalidated for pattern:",e,"Keys removed:",t.length)},r=h.create({baseURL:d,headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{const t=p();return t.token&&(e.headers.Authorization=`Bearer ${t.token}`),console.log("API Request:",e.method,e.url),e},e=>(console.error("API Request Error:",e),Promise.reject(e)));r.interceptors.response.use(e=>(console.log("API Response:",e.status,e.config.url),e),async e=>{var c,i,u;console.error("API Response Error:",(c=e==null?void 0:e.response)==null?void 0:c.status,(i=e==null?void 0:e.config)==null?void 0:i.url,e.message);const t=e.config,a=p();if(((u=e.response)==null?void 0:u.status)===401&&!t._retry&&a.refreshToken){t._retry=!0;try{if((await a.refreshUserToken()).success)return t.headers.Authorization=`Bearer ${a.token}`,r(t)}catch(l){return a.logout(),window.location.href="/home",Promise.reject(l)}}return Promise.reject(e)});const n=async(e,t={},a=!1)=>{const c=f(e,t);if(!a){const u=P(c);if(u)return{data:u}}const i=await r.get(e,{params:t});return R(c,i.data),i},A=async e=>{try{return await Promise.all(e)}catch(t){throw console.error("Batch API call failed:",t),t}},I={apiClient:r,batchApiCalls:A,invalidateCache:s,clearCache:()=>{o.clear(),console.log("Cache cleared")},getLocations(e=!1){return n("/locations/",{},e)},getLocation(e){return n(`/locations/${e}/`)},createLocation(e){return s("/locations"),r.post("/locations/",e)},updateLocation(e,t){return s("/locations"),r.put(`/locations/${e}/`,t)},deleteLocation(e){return s("/locations"),r.delete(`/locations/${e}/`)},getRoutes(e=!1){return n("/locations/routes/",{},e)},getMachines(e={},t=!1){return n("/machines/",e,t)},getMachine(e){return n(`/machines/${e}/`)},createMachine(e){return s("/machines"),r.post("/machines/",e)},updateMachine(e,t){return s("/machines"),r.put(`/machines/${e}/`,t)},deleteMachine(e){return s("/machines"),r.delete(`/machines/${e}/`)},getProducts(e={},t=!1){return n("/products/",e,t)},getAllProducts(e=!1){return n("/products/all/",{},e)},getProduct(e){return n(`/products/${e}/`)},createProduct(e){return s("/products"),r.post("/products/",e)},updateProduct(e,t){return s("/products"),r.put(`/products/${e}/`,t)},deleteProduct(e){return s("/products"),r.delete(`/products/${e}/`)},getMachineItems(e={},t=!1){return n("/machine-items/",e,t)},getMachineItem(e){return n(`/machine-items/${e}/`)},createMachineItem(e){return s("/machine-items"),r.post("/machine-items/",e)},updateMachineItem(e,t){return s("/machine-items"),r.put(`/machine-items/${e}/`,t)},deleteMachineItem(e){return s("/machine-items"),r.delete(`/machine-items/${e}/`)},getSuppliers(e={},t=!1){return n("/suppliers/",e,t)},getSupplier(e){return n(`/suppliers/${e}/`)},createSupplier(e){return s("/suppliers"),r.post("/suppliers/",e)},updateSupplier(e,t){return s("/suppliers"),r.put(`/suppliers/${e}/`,t)},deleteSupplier(e){return s("/suppliers"),r.delete(`/suppliers/${e}/`)},getActiveSuppliers(e=!1){return n("/suppliers/active/",{},e)},toggleSupplierActive(e){return s("/suppliers"),r.post(`/suppliers/${e}/toggle_active/`)},getPurchases(e={},t=!1){return n("/purchases/",e,t)},getPurchase(e){return n(`/purchases/${e}/`)},createPurchase(e){return s("/purchases"),s("/products"),r.post("/purchases/",e)},updatePurchase(e,t){return s("/purchases"),s("/products"),r.put(`/purchases/${e}/`,t)},deletePurchase(e){return s("/purchases"),s("/products"),r.delete(`/purchases/${e}/`)},getVisits(e={},t=!1){return n("/visits/",e,t)},getVisit(e){return n(`/visits/${e}/`)},createVisit(e){return s("/visits"),s("/analytics"),s("/dashboard"),s("/inventory"),r.post("/visits/",e)},updateVisit(e,t){return s("/visits"),s("/analytics"),s("/dashboard"),s("/inventory"),r.put(`/visits/${e}/`,t)},createVisitBulk(e){return s("/visits"),s("/analytics"),s("/dashboard"),s("/inventory"),r.post("/visits/bulk-save/",e)},updateVisitBulk(e,t){return s("/visits"),s("/analytics"),s("/dashboard"),s("/inventory"),r.put(`/visits/${e}/bulk-update/`,t)},deleteVisit(e){return s("/visits"),s("/analytics"),s("/dashboard"),s("/inventory"),r.delete(`/visits/${e}/`)},getRestocks(e={},t=!1){return n("/restocks/",e,t)},getRestock(e){return n(`/restocks/${e}/`)},createRestock(e){return s("/restocks"),s("/analytics"),s("/dashboard"),s("/inventory"),r.post("/restocks/",e)},updateRestock(e,t){return s("/restocks"),s("/analytics"),s("/dashboard"),s("/inventory"),r.put(`/restocks/${e}/`,t)},deleteRestock(e){return s("/restocks"),s("/analytics"),s("/dashboard"),s("/inventory"),r.delete(`/restocks/${e}/`)},getRestockEntries(e={},t=!1){return n("/restock-entries/",e,t)},getRestockEntry(e){return n(`/restock-entries/${e}/`)},createRestockEntry(e){return s("/restock-entries"),s("/analytics"),s("/dashboard"),s("/inventory"),r.post("/restock-entries/",e)},updateRestockEntry(e,t){return s("/restock-entries"),s("/analytics"),s("/dashboard"),s("/inventory"),r.put(`/restock-entries/${e}/`,t)},deleteRestockEntry(e){return s("/restock-entries"),s("/analytics"),s("/dashboard"),s("/inventory"),r.delete(`/restock-entries/${e}/`)},getDashboardData(e={},t=!1){return n("/dashboard/",e,t)},getStockLevels(e={},t=!1){return n("/analytics/stock-levels/",e,t)},getDemandAnalysis(e={},t=!1){return n("/analytics/demand/",e,t)},getRevenueProfitData(e={},t=!1){return n("/analytics/revenue-profit/",e,t)},getAdvancedAnalytics(e={},t=!1){return n("/analytics/advanced-demand",e,t)},getProductCostHistory:async(e,t=!1)=>await n(`/product-costs/?product=${e}`,{},t),getCurrentStockReport(e={},t=!1){return n("/inventory/current-stock/",e,t)},getRestockSummary(e={},t=!1){return n("/inventory/restock-summary/",e,t)},getStockCoverageEstimate(e={},t=!1){return n("/inventory/stock-coverage/",e,t)}};export{I as a};
