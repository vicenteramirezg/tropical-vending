import{B as m,y as d}from"./index-QwUTnthM.js";const l=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";let h=l?"http://localhost:8000/api":"/api",g=l?"http://localhost:8000/media":"/media";console.log("API Service - Current hostname:",window.location.hostname);console.log("API Service - isLocalhost:",l);console.log("API Service - API_URL:",h);console.log("API Service - MEDIA_URL:",g);console.log("API Service - Environment:","production");const y=2*60*60*1e3,o=new Map,v=(e,t={})=>{const n=new URLSearchParams(t).toString();return`${e}${n?"?"+n:""}`},k=e=>Date.now()-e.timestamp<y,f=e=>{const t=o.get(e);return t&&k(t)?(console.log("Cache hit:",e),t.data):(t&&o.delete(e),null)},$=(e,t)=>{o.set(e,{data:t,timestamp:Date.now()}),console.log("Cache set:",e)},s=e=>{const t=[];for(const n of o.keys())n.includes(e)&&t.push(n);t.forEach(n=>o.delete(n)),console.log("Cache invalidated for pattern:",e,"Keys removed:",t.length)},r=m.create({baseURL:h,headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{const t=d();return t.token&&(e.headers.Authorization=`Bearer ${t.token}`),console.log("API Request:",e.method,e.url),e},e=>(console.error("API Request Error:",e),Promise.reject(e)));r.interceptors.response.use(e=>(console.log("API Response:",e.status,e.config.url),e),async e=>{var c,i,u;console.error("API Response Error:",(c=e==null?void 0:e.response)==null?void 0:c.status,(i=e==null?void 0:e.config)==null?void 0:i.url,e.message);const t=e.config,n=d();if(((u=e.response)==null?void 0:u.status)===401&&!t._retry&&n.refreshToken){t._retry=!0;try{if((await n.refreshUserToken()).success)return t.headers.Authorization=`Bearer ${n.token}`,r(t)}catch(p){return n.logout(),window.location.href="/home",Promise.reject(p)}}return Promise.reject(e)});const a=async(e,t={},n=!1)=>{const c=v(e,t);if(!n){const u=f(c);if(u)return{data:u}}const i=await r.get(e,{params:t});return $(c,i.data),i},P=async e=>{try{return await Promise.all(e)}catch(t){throw console.error("Batch API call failed:",t),t}},A={batchApiCalls:P,invalidateCache:s,clearCache:()=>{o.clear(),console.log("Cache cleared")},getLocations(e=!1){return a("/locations/",{},e)},getLocation(e){return a(`/locations/${e}/`)},createLocation(e){return s("/locations"),r.post("/locations/",e)},updateLocation(e,t){return s("/locations"),r.put(`/locations/${e}/`,t)},deleteLocation(e){return s("/locations"),r.delete(`/locations/${e}/`)},getRoutes(e=!1){return a("/locations/routes/",{},e)},getMachines(e={},t=!1){return a("/machines/",e,t)},getMachine(e){return a(`/machines/${e}/`)},createMachine(e){return s("/machines"),r.post("/machines/",e)},updateMachine(e,t){return s("/machines"),r.put(`/machines/${e}/`,t)},deleteMachine(e){return s("/machines"),r.delete(`/machines/${e}/`)},getProducts(e={},t=!1){return a("/products/",e,t)},getProduct(e){return a(`/products/${e}/`)},createProduct(e){return s("/products"),r.post("/products/",e)},updateProduct(e,t){return s("/products"),r.put(`/products/${e}/`,t)},deleteProduct(e){return s("/products"),r.delete(`/products/${e}/`)},getMachineItems(e={},t=!1){return a("/machine-items/",e,t)},getMachineItem(e){return a(`/machine-items/${e}/`)},createMachineItem(e){return s("/machine-items"),r.post("/machine-items/",e)},updateMachineItem(e,t){return s("/machine-items"),r.put(`/machine-items/${e}/`,t)},deleteMachineItem(e){return s("/machine-items"),r.delete(`/machine-items/${e}/`)},getSuppliers(e={},t=!1){return a("/suppliers/",e,t)},getSupplier(e){return a(`/suppliers/${e}/`)},createSupplier(e){return s("/suppliers"),r.post("/suppliers/",e)},updateSupplier(e,t){return s("/suppliers"),r.put(`/suppliers/${e}/`,t)},deleteSupplier(e){return s("/suppliers"),r.delete(`/suppliers/${e}/`)},getActiveSuppliers(e=!1){return a("/suppliers/active/",{},e)},toggleSupplierActive(e){return s("/suppliers"),r.post(`/suppliers/${e}/toggle_active/`)},getPurchases(e={},t=!1){return a("/purchases/",e,t)},getPurchase(e){return a(`/purchases/${e}/`)},createPurchase(e){return s("/purchases"),s("/products"),r.post("/purchases/",e)},updatePurchase(e,t){return s("/purchases"),s("/products"),r.put(`/purchases/${e}/`,t)},deletePurchase(e){return s("/purchases"),s("/products"),r.delete(`/purchases/${e}/`)},getVisits(e={},t=!1){return a("/visits/",e,t)},getVisit(e){return a(`/visits/${e}/`)},createVisit(e){return s("/visits"),s("/analytics"),s("/dashboard"),s("/inventory"),r.post("/visits/",e)},updateVisit(e,t){return s("/visits"),s("/analytics"),s("/dashboard"),s("/inventory"),r.put(`/visits/${e}/`,t)},createVisitBulk(e){return s("/visits"),s("/analytics"),s("/dashboard"),s("/inventory"),r.post("/visits/bulk-save/",e)},updateVisitBulk(e,t){return s("/visits"),s("/analytics"),s("/dashboard"),s("/inventory"),r.put(`/visits/${e}/bulk-update/`,t)},deleteVisit(e){return s("/visits"),s("/analytics"),s("/dashboard"),s("/inventory"),r.delete(`/visits/${e}/`)},getRestocks(e={},t=!1){return a("/restocks/",e,t)},getRestock(e){return a(`/restocks/${e}/`)},createRestock(e){return s("/restocks"),s("/analytics"),s("/dashboard"),s("/inventory"),r.post("/restocks/",e)},updateRestock(e,t){return s("/restocks"),s("/analytics"),s("/dashboard"),s("/inventory"),r.put(`/restocks/${e}/`,t)},deleteRestock(e){return s("/restocks"),s("/analytics"),s("/dashboard"),s("/inventory"),r.delete(`/restocks/${e}/`)},getRestockEntries(e={},t=!1){return a("/restock-entries/",e,t)},getRestockEntry(e){return a(`/restock-entries/${e}/`)},createRestockEntry(e){return s("/restock-entries"),s("/analytics"),s("/dashboard"),s("/inventory"),r.post("/restock-entries/",e)},updateRestockEntry(e,t){return s("/restock-entries"),s("/analytics"),s("/dashboard"),s("/inventory"),r.put(`/restock-entries/${e}/`,t)},deleteRestockEntry(e){return s("/restock-entries"),s("/analytics"),s("/dashboard"),s("/inventory"),r.delete(`/restock-entries/${e}/`)},getDashboardData(e={},t=!1){return a("/dashboard/",e,t)},getStockLevels(e={},t=!1){return a("/analytics/stock-levels/",e,t)},getDemandAnalysis(e={},t=!1){return a("/analytics/demand/",e,t)},getRevenueProfitData(e={},t=!1){return a("/analytics/revenue-profit/",e,t)},getProductCostHistory:async(e,t=!1)=>await a(`/product-costs/?product=${e}`,{},t),getCurrentStockReport(e={},t=!1){return a("/inventory/current-stock/",e,t)},getRestockSummary(e={},t=!1){return a("/inventory/restock-summary/",e,t)},getStockCoverageEstimate(e={},t=!1){return a("/inventory/stock-coverage/",e,t)}};export{A as a};
