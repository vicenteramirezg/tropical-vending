import{a as c}from"./api-DXLxWSa1.js";import{r as h,c as f}from"./index-BonLqaAG.js";function x(){const y=h([]),n=h([]),d=h(!1),o=h(null),S=h(["3D14","AMS 39640","AMS GB624","AMS-LB9 Combo","AP Snack Shop 111","AP Snack Shop 133","AP Snack Shop 152-D","AP Snack Shop 6600","AP Snack Shop III D20C","AP Studio 3","Crane 147","Crane 148","Crane 157","Crane 158","Crane 168","Crane 172","Crane 180","Crane 181","Crane 452","Crane 784","Dixie Narco","Dixie Narco 276E","Dixie Narco 348C","Dixie Narco 368","Dixie Narco 368 12","Dixie Narco 368 R","Dixie Narco 36812","Dixie Narco 414 CC","Dixie Narco 501-C","Dixie Narco 501E","ISI 3177","Lektro Vending V599C Serie II","Royal Vendor 390-9","Royal Vendor 462-9","Royal Vendor 550-6","Royal Vendor 630-10","Royal Vendor 650-10","Royal Vendor 660","Royal Vendor 660-8","Royal Vendor 660-9","Royal Vendor 804-","Royal Vendor 804-13","Royal Vendor 804-9","Snack Mart 111 3000/Model: 301A","Snack Shop 111","Snack Shop 111 D206","Snack Shop 113","Snack Shop 6000","Snack Shop 6600","Snack Shop III 400 / Model:3014","Snack Shop LCM2","USA 3129","USI 3014A","USI 3166"]),M=f(()=>{const a={};return y.value.forEach(e=>{a[e.location]||(a[e.location]=[]),a[e.location].push(e)}),a});return{machines:y,locationMachines:n,loading:d,error:o,machineModels:S,groupedMachines:M,fetchMachines:async(a={})=>{d.value=!0,o.value=null;try{const e={};a.location&&(e.location=a.location),a.route&&(e.route=a.route),a.machineType&&(e.machine_type=a.machineType);const r=await c.getMachines(e);y.value=r.data.results||r.data}catch(e){console.error("Error fetching machines:",e),o.value="Failed to load machines. Please try again."}finally{d.value=!1}},fetchLocationMachines:async a=>{if(!a){n.value=[];return}d.value=!0,o.value=null;try{const e=await c.getMachines({location:a}),r=e.data.results||e.data,p=await Promise.all(r.map(async t=>{try{const i=await c.getMachineItems({machine:t.id}),s=(i.data.results||i.data).map(l=>({id:l.product,name:l.product_name,slot:l.slot,current_stock:l.current_stock||0,stock_before:"",discarded:"",restocked:""}));return{...t,products:s}}catch(i){return console.error(`Error fetching products for machine ${t.id}:`,i),{...t,products:[]}}}));n.value=p}catch(e){console.error("Error fetching location machines:",e),o.value="Failed to load machines for this location. Please try again.",n.value=[]}finally{d.value=!1}},updateMachineProductData:async(a,e)=>{try{const r=n.value.find(t=>t.id===e);if(!r)return;const p=await c.getRestocks({visit:a,machine:e});if(p.data.length>0){const t=p.data[0],i=await c.getRestockEntries({visit_machine_restock:t.id});r.products.forEach(u=>{const s=i.data.find(l=>l.product===u.id);s&&(u.stock_before=s.stock_before||"",u.discarded=s.discarded||"",u.restocked=s.restocked||"")})}}catch(r){console.error("Error updating machine product data:",r)}},resetMachineData:()=>{n.value=[]},createMachine:async a=>{try{return await c.createMachine(a),!0}catch(e){return console.error("Error creating machine:",e),o.value="Failed to create machine. Please try again.",!1}},updateMachine:async(a,e)=>{try{return await c.updateMachine(a,e),!0}catch(r){return console.error("Error updating machine:",r),o.value="Failed to update machine. Please try again.",!1}},deleteMachine:async a=>{try{return await c.deleteMachine(a),!0}catch(e){return console.error("Error deleting machine:",e),o.value="Failed to delete machine. Please try again.",!1}},clearError:()=>{o.value=null}}}export{x as u};
