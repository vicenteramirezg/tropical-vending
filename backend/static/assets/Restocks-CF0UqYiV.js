import{r as E,y as Z,b as d,o as l,d as e,t as f,F as j,f as A,u as M,c as W,l as V,n as T,e as ee,g as F,i as B,p as ce,z as ue,q as K,m as me,w as z,s as q,k as fe}from"./index-DJ1kStQD.js";import{a as R}from"./api-DGXZpFB6.js";import{u as ve}from"./useLocations-c0MBWtZC.js";import{u as ge}from"./useMachines-BgS9A5e0.js";import{g as be,f as Q}from"./dateUtils-CXdyRzwD.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";function pe(){const s=E([]),y=E(!1),a=E(null),n=async()=>{y.value=!0,a.value=null;try{const x=await R.getVisits(),h=x.data.results||x.data;s.value=h.map(m=>({id:m.id,location_id:m.location,location_name:m.location_name,visit_date:m.visit_date,notes:m.notes,user_name:m.user_name}))}catch(x){console.error("Error fetching visits:",x),a.value="Failed to load visits. Please try again later."}finally{y.value=!1}};return{restocks:s,loading:y,error:a,fetchRestocks:n,createVisit:async x=>{try{return(await R.createVisit(x)).data}catch(h){throw console.error("Error creating visit:",h),h}},updateVisit:async(x,h)=>{try{return(await R.updateVisit(x,h)).data}catch(m){throw console.error("Error updating visit:",m),m}},deleteVisit:async x=>{try{await R.deleteVisit(x),await n()}catch(h){throw console.error("Error deleting visit:",h),h}},getVisitDetails:async x=>{try{const h=await R.getRestocks({visit:x}),m=h.data.results||h.data;let r=[];for(const c of m){const u=await R.getRestockEntries({visit_machine_restock:c.id}),p=u.data.results||u.data,g=await R.getMachineItems({machine:c.machine}),C=g.data.results||g.data,S=p.map(v=>{const b=C.find(k=>k.product===v.product);return{...v,slot:b?b.slot:null}});r.push(...S)}return r.sort((c,u)=>c.visit_machine_restock!==u.visit_machine_restock?0:(c.slot||999)-(u.slot||999)),r.map(c=>({id:c.id,product_name:c.product_name,product_id:c.product,previous_quantity:c.stock_before,quantity_discarded:c.discarded,quantity_added:c.restocked,machine_name:c.machine_name,machine_type:c.machine_type,machine_model:c.machine_model,slot:c.slot}))}catch(h){throw console.error("Error fetching visit details:",h),h}}}}function xe(){const s=Z(),y=E(!1),a=E(""),n=E(null),i=E(!1),t=E({id:null,visit_date:"",notes:"",location:"",machines:[]}),o=(g=null)=>{g?(y.value=!0,a.value=g.location_id,t.value={id:g.id,visit_date:g.visit_date,notes:g.notes,location:g.location_id}):(y.value=!1,a.value="",t.value={id:null,visit_date:be(),notes:"",location:"",machines:[]})},w=g=>g.some(v=>v.products.some(b=>x(b)))?g.some(v=>v.products.some(b=>x(b)?b.stock_before===""||b.restocked==="":!1))?(n.value="Please complete all fields for products being restocked (stock before and restock amount are required)",!1):!0:(n.value="Please record stock levels for at least one product",!1),x=g=>g.stock_before!==""||g.restocked!==""||g.discarded!=="",h=async g=>{var C,S;try{if(i.value=!0,n.value=null,!w(g))return!1;const v=m(g);return console.log("Saving visit with bulk data:",v),y.value&&t.value.id?await R.updateVisitBulk(t.value.id,v):await R.createVisitBulk(v),!0}catch(v){return console.error("Error saving restock visit:",v),n.value=((S=(C=v.response)==null?void 0:C.data)==null?void 0:S.error)||"Failed to save visit. Please try again.",!1}finally{i.value=!1}},m=g=>{var v;const C={location:a.value,visit_date:t.value.visit_date,notes:t.value.notes,user:(v=s.user)==null?void 0:v.id},S=g.filter(b=>b.products.some(k=>x(k))).map(b=>{const k=b.products.filter(_=>x(_)).map(_=>({product:_.id,stock_before:parseInt(_.stock_before)||0,discarded:parseInt(_.discarded)||0,restocked:parseInt(_.restocked)||0}));return{machine:b.id,notes:"",restock_entries:k}});return{visit:C,machine_restocks:S}},r=async(g,C,S)=>{var v;console.warn("Using legacy saveRestock - consider migrating to saveRestockOptimized for better performance");try{if(n.value=null,!w(g))return!1;let b;const k={location:a.value,visit_date:t.value.visit_date,notes:t.value.notes,user:(v=s.user)==null?void 0:v.id};return console.log("Saving visit with data:",k),y.value&&t.value.id?b=(await S(t.value.id,k)).id:b=(await C(k)).id,await c(b,g),!0}catch(b){return console.error("Error saving restock visit:",b),n.value="Failed to save visit. Please try again.",!1}},c=async(g,C)=>{const S=C.filter(v=>v.products.some(b=>x(b)));for(const v of S){let b;if(y.value)try{const k=await R.getRestocks({visit:g,machine:v.id});if(k.data.length>0){const _=k.data[0],N={visit:g,machine:v.id,notes:_.notes||""};await R.updateRestock(_.id,N),b=_.id}else{const _={visit:g,machine:v.id,notes:""};b=(await R.createRestock(_)).data.id}}catch(k){throw console.error("Error handling machine restock:",k),k}else{const k={visit:g,machine:v.id,notes:""};b=(await R.createRestock(k)).data.id}await u(b,v.products)}},u=async(g,C)=>{const S=C.filter(v=>x(v));for(const v of S)try{const b={visit_machine_restock:g,product:v.id,stock_before:parseInt(v.stock_before)||0,discarded:parseInt(v.discarded)||0,restocked:parseInt(v.restocked)||0};if(y.value){const k=await R.getRestockEntries({visit_machine_restock:g,product:v.id});k.data.length>0?await R.updateRestockEntry(k.data[0].id,b):await R.createRestockEntry(b)}else await R.createRestockEntry(b)}catch(b){throw console.error("Error handling restock entry:",b),b}};return{restockForm:t,isEditing:y,selectedLocation:a,error:n,saving:i,initializeForm:o,validateForm:w,saveRestock:r,saveRestockOptimized:h,resetForm:()=>{o(),n.value=null}}}const he={key:0,class:"flex justify-center"},ke={key:1,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-4"},we={class:"flex"},$e={class:"ml-3"},_e={class:"text-sm text-red-700"},Ve={key:2,class:"bg-white shadow overflow-hidden sm:rounded-lg"},Re={class:"px-4 py-5 sm:p-6 text-center"},Ce={class:"mt-5"},De={key:3,class:"bg-white shadow overflow-hidden sm:rounded-lg"},Se={role:"list",class:"divide-y divide-gray-200"},Me={class:"flex items-center justify-between"},Ee={class:"flex-1 min-w-0"},Fe={class:"text-sm font-medium text-primary-600 truncate"},Be={class:"text-sm text-gray-500"},je={class:"ml-4 flex-shrink-0 flex space-x-2"},Ae=["onClick"],Le=["onClick"],Ie=["onClick"],Ne={__name:"RestockList",props:{restocks:Array,loading:Boolean,error:String},emits:["add-restock","view-details","edit-restock","delete-restock"],setup(s){return(y,a)=>(l(),d("div",null,[s.loading?(l(),d("div",he,a[1]||(a[1]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))):s.error?(l(),d("div",ke,[e("div",we,[a[2]||(a[2]=e("div",{class:"flex-shrink-0"},[e("span",{class:"text-red-400"},"⚠")],-1)),e("div",$e,[e("p",_e,f(s.error),1)])])])):s.restocks.length===0?(l(),d("div",Ve,[e("div",Re,[a[3]||(a[3]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"No visits recorded",-1)),a[4]||(a[4]=e("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[e("p",null,"Get started by recording your first location visit.")],-1)),e("div",Ce,[e("button",{onClick:a[0]||(a[0]=n=>y.$emit("add-restock")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Record New Visit ")])])])):(l(),d("div",De,[e("ul",Se,[(l(!0),d(j,null,A(s.restocks,n=>(l(),d("li",{key:n.id,class:"px-4 py-4 sm:px-6"},[e("div",Me,[e("div",Ee,[e("p",Fe,f(n.location_name),1),e("p",Be,f(M(Q)(n.visit_date)),1)]),e("div",je,[e("button",{onClick:i=>y.$emit("view-details",n),class:"inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," View Details ",8,Ae),e("button",{onClick:i=>y.$emit("edit-restock",n),class:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Edit ",8,Le),e("button",{onClick:i=>y.$emit("delete-restock",n),class:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," Delete ",8,Ie)])])]))),128))])]))]))}},Ue={class:"mt-1 flex rounded-md shadow-sm relative"},Pe=["disabled"],ze={class:"sr-only"},qe=["id","value","min","max","placeholder","disabled"],Te=["disabled"],Oe={class:"sr-only"},He={__name:"ResponsiveNumberInput",props:{modelValue:{type:[String,Number],default:""},min:{type:[String,Number],default:0},max:{type:[String,Number],default:null},placeholder:{type:String,default:"0"},disabled:{type:Boolean,default:!1},label:{type:String,default:""},inputId:{type:String,default:""},showSteppers:{type:Boolean,default:!0}},emits:["update:modelValue","focus","blur"],setup(s,{emit:y}){const a=s,n=y,i=E(!1),t=W(()=>{const r="focus:ring-primary-500 focus:border-primary-500 block w-full text-center sm:text-sm number-input-mobile";return a.showSteppers?`${r} border-gray-300 rounded-none sm:border-l-0 sm:border-r-0 sm:rounded-none rounded-md`:`${r} border-gray-300 rounded-md`}),o=r=>{const c=r.target.value;n("update:modelValue",c)},w=()=>{if(a.disabled)return;const r=a.modelValue===""?0:parseInt(a.modelValue)||0,c=a.max!==null?Math.min(r+1,parseInt(a.max)):r+1;n("update:modelValue",c)},x=()=>{if(a.disabled)return;const r=a.modelValue===""?0:parseInt(a.modelValue)||0,c=Math.max(parseInt(a.min),r-1);n("update:modelValue",c)},h=r=>{i.value=!0,n("focus",r)},m=r=>{i.value=!1,n("blur",r)};return(r,c)=>(l(),d("div",Ue,[s.showSteppers?(l(),d("button",{key:0,type:"button",onClick:x,class:"hidden sm:inline-flex relative items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",disabled:s.disabled},[e("span",ze,"Decrease "+f(s.label||"value"),1),c[0]||(c[0]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 12H4"})],-1))],8,Pe)):V("",!0),e("input",{id:s.inputId,type:"number",value:s.modelValue,onInput:o,onFocus:h,onBlur:m,min:s.min,max:s.max,placeholder:s.placeholder,disabled:s.disabled,class:T(t.value),inputmode:"numeric",pattern:"[0-9]*"},null,42,qe),s.showSteppers?(l(),d("button",{key:1,type:"button",onClick:w,class:"hidden sm:inline-flex relative items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",disabled:s.disabled},[e("span",Oe,"Increase "+f(s.label||"value"),1),c[1]||(c[1]=e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1))],8,Te)):V("",!0)]))}},L=ye(He,[["__scopeId","data-v-8ace7785"]]),We={class:"flex flex-col"},Qe={class:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg flex-shrink-0"},Ge={class:"flex items-center"},Ye={key:0,class:"ml-3 text-xs text-blue-600 hidden sm:flex items-center"},Je={class:"flex-1 overflow-y-auto max-h-[50vh] sm:max-h-[60vh] border border-gray-200 rounded-lg"},Ke={class:"space-y-4 p-4"},Xe={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-3 sm:mb-2"},Ze={class:"text-sm font-medium text-gray-900 mb-2 sm:mb-0"},et={key:0,class:"ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"},tt={class:"text-sm text-gray-500"},st={key:0,class:"ml-2 text-green-600"},ot={class:"space-y-3 sm:space-y-2"},it={key:0,class:"text-sm text-gray-500 italic p-2 text-center"},nt={class:"flex items-center justify-between mb-3"},at={class:"flex items-center space-x-2"},rt={class:"text-sm font-medium text-gray-900 bg-gray-100 rounded-md px-2 py-1 min-w-[2rem] text-center"},lt={class:"text-sm font-medium text-gray-900"},dt={key:0,class:"ml-1 inline-flex items-center w-2 h-2 bg-green-500 rounded-full",title:"Will be restocked"},ct={class:"space-y-3"},ut={class:"text-sm text-gray-500 font-medium pt-2 border-t"},mt={class:"col-span-1 text-sm font-medium text-gray-900 text-center bg-gray-100 rounded-md py-1"},ft={class:"col-span-3 text-sm font-medium text-gray-900"},vt={key:0,class:"ml-1 inline-flex items-center w-2 h-2 bg-green-500 rounded-full",title:"Will be restocked"},gt={class:"col-span-2"},bt={class:"col-span-2"},yt={class:"col-span-2"},pt={class:"col-span-2 text-sm text-gray-500"},X={__name:"MachineProductsSection",props:{machines:Array},setup(s){const y=s,a=W(()=>{var m;return((m=y.machines)==null?void 0:m.reduce((r,c)=>{var u;return r+(((u=c.products)==null?void 0:u.length)||0)},0))||0}),n=(m,r,c)=>{m[r]=c},i=m=>(parseInt(m.stock_before)||0)-(parseInt(m.discarded)||0)+(parseInt(m.restocked)||0),t=m=>m.stock_before!==""||m.restocked!==""||m.discarded!=="",o=m=>m.products.some(r=>t(r)),w=m=>m.products.filter(r=>t(r)).length,x=m=>o(m)?"border-green-300 bg-green-50":"border-gray-200",h=m=>t(m)?"bg-green-50 rounded-md p-2":"p-2";return(m,r)=>(l(),d("div",We,[r[8]||(r[8]=e("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Machines at Location",-1)),e("div",Qe,[e("div",Ge,[r[1]||(r[1]=ee('<svg class="h-5 w-5 text-blue-400 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><div class="text-sm text-blue-700 flex-1"><p class="font-medium">Partial Restock Allowed</p><p class="text-blue-600">You can restock only the machines/products you need. Leave others empty to skip them.</p></div>',2)),a.value>10?(l(),d("div",Ye,r[0]||(r[0]=[e("svg",{class:"h-4 w-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),F(" Scroll to see all products ")]))):V("",!0)])]),e("div",Je,[e("div",Ke,[(l(!0),d(j,null,A(s.machines,c=>(l(),d("div",{key:c.id,class:T(["border rounded-lg p-3 sm:p-4",x(c)])},[e("div",Xe,[e("h5",Ze,[F(f(c.name)+" ("+f(c.machine_type)+" "+f(c.model)+") ",1),o(c)?(l(),d("span",et," Will be restocked ")):V("",!0)]),e("div",tt,[F(f(c.products.length)+" products ",1),o(c)?(l(),d("span",st," ("+f(w(c))+" being restocked) ",1)):V("",!0)])]),e("div",ot,[c.products.length===0?(l(),d("div",it," No products in this machine ")):V("",!0),(l(!0),d(j,null,A(c.products,u=>(l(),d("div",{key:u.id,class:"sm:hidden"},[e("div",{class:T(["border rounded-lg p-3",h(u)])},[e("div",nt,[e("div",at,[e("div",rt,f(u.slot),1),e("div",lt,[F(f(u.name)+" ",1),t(u)?(l(),d("span",dt)):V("",!0)])])]),e("div",ct,[e("div",null,[r[2]||(r[2]=e("label",{class:"block text-xs text-gray-500 mb-1"},"Current Stock",-1)),B(L,{modelValue:u.stock_before,"onUpdate:modelValue":[p=>u.stock_before=p,p=>n(u,"stock_before",p)],min:0,placeholder:"0",label:"Current Stock"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[r[3]||(r[3]=e("label",{class:"block text-xs text-gray-500 mb-1"},"Discarded Amount",-1)),B(L,{modelValue:u.discarded,"onUpdate:modelValue":[p=>u.discarded=p,p=>n(u,"discarded",p)],min:0,placeholder:"0",label:"Discarded Amount"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[r[4]||(r[4]=e("label",{class:"block text-xs text-gray-500 mb-1"},"Restock Amount",-1)),B(L,{modelValue:u.restocked,"onUpdate:modelValue":[p=>u.restocked=p,p=>n(u,"restocked",p)],min:0,placeholder:"0",label:"Restock Amount"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",ut," New Total: "+f(i(u)),1)])],2)]))),128)),(l(!0),d(j,null,A(c.products,u=>(l(),d("div",{key:u.id,class:T(["hidden sm:grid grid-cols-12 gap-4 items-center",h(u)])},[e("div",mt,f(u.slot),1),e("div",ft,[F(f(u.name)+" ",1),t(u)?(l(),d("span",vt)):V("",!0)]),e("div",gt,[r[5]||(r[5]=e("label",{class:"block text-xs text-gray-500"},"Current Stock",-1)),B(L,{modelValue:u.stock_before,"onUpdate:modelValue":[p=>u.stock_before=p,p=>n(u,"stock_before",p)],min:0,placeholder:"0",label:"Current Stock"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",bt,[r[6]||(r[6]=e("label",{class:"block text-xs text-gray-500"},"Discarded Amount",-1)),B(L,{modelValue:u.discarded,"onUpdate:modelValue":[p=>u.discarded=p,p=>n(u,"discarded",p)],min:0,placeholder:"0",label:"Discarded Amount"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",yt,[r[7]||(r[7]=e("label",{class:"block text-xs text-gray-500"},"Restock Amount",-1)),B(L,{modelValue:u.restocked,"onUpdate:modelValue":[p=>u.restocked=p,p=>n(u,"restocked",p)],min:0,placeholder:"0",label:"Restock Amount"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",pt," New Total: "+f(i(u)),1)],2))),128))])],2))),128))])])]))}},xt={key:0,class:"fixed inset-0 overflow-y-auto z-50","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},ht={class:"sm:hidden min-h-screen bg-white"},kt={class:"flex items-center justify-between p-4 border-b border-gray-200 bg-white sticky top-0 z-10"},wt={class:"text-lg font-medium text-gray-900",id:"modal-title"},$t={class:"flex-1 overflow-y-auto p-4 pb-safe"},_t={class:"space-y-6"},Vt=["value"],Rt=["value"],Ct=["value"],Dt={for:"location-mobile",class:"block text-sm font-medium text-gray-700 mb-2"},St={class:"text-xs text-gray-500 ml-1"},Mt=["value"],Et=["value"],Ft={key:0,class:"text-gray-500"},Bt={class:"border-t border-gray-200 bg-white p-4 space-y-3 sticky bottom-0"},jt=["disabled"],At={key:0,class:"inline-flex items-center"},Lt={key:1},It={class:"hidden sm:block modal-overlay"},Nt={class:"flex items-center justify-center min-h-full pt-4 px-4 pb-20 text-center"},Ut={class:"modal-content inline-block align-bottom bg-white rounded-lg text-left shadow-xl transform transition-all my-8 align-middle max-w-5xl w-full"},Pt={class:"bg-white px-4 pt-5 pb-4 sm:px-6 border-b border-gray-200 flex-shrink-0"},zt={class:"flex items-center justify-between"},qt={class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"},Tt={class:"modal-scrollable bg-white px-4 py-4 sm:px-6"},Ot={class:"space-y-4"},Ht=["value"],Wt=["value"],Qt=["value"],Gt={for:"location",class:"block text-sm font-medium text-gray-700"},Yt={class:"text-xs text-gray-500 ml-1"},Jt=["value"],Kt=["value"],Xt={key:0,class:"text-gray-500"},Zt={key:0},es={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse border-t flex-shrink-0"},ts=["disabled"],ss={key:0,class:"inline-flex items-center"},os={key:1},is={__name:"RestockFormModal",props:{show:Boolean,isEditing:Boolean,restockForm:Object,selectedLocation:String,selectedRoute:String,locationSearchText:String,locations:Array,routes:Array,locationMachines:Array,saving:Boolean},emits:["close","save","route-change","location-search","location-change"],setup(s){const y=s,a=()=>{const i=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=i}};let n=null;return ce(()=>y.show,i=>{i?n=a():n&&(n(),n=null)},{immediate:!0}),ue(()=>{n&&n()}),(i,t)=>s.show?(l(),d("div",xt,[e("div",ht,[e("form",{onSubmit:t[7]||(t[7]=K(o=>i.$emit("save"),["prevent"])),novalidate:"",class:"h-full flex flex-col"},[e("div",kt,[e("h3",wt,f(s.isEditing?"Edit Visit":"Record New Visit"),1),e("button",{type:"button",onClick:t[0]||(t[0]=o=>i.$emit("close")),class:"text-gray-400 hover:text-gray-500 focus:outline-none focus:text-gray-500 transition ease-in-out duration-150"},t[17]||(t[17]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",$t,[e("div",_t,[e("div",null,[t[20]||(t[20]=e("label",{for:"route-mobile",class:"block text-sm font-medium text-gray-700 mb-2"},"Filter by Route (Optional)",-1)),e("select",{id:"route-mobile",name:"route",value:s.selectedRoute,onChange:t[1]||(t[1]=o=>i.$emit("route-change",o.target.value)),class:"block w-full pl-3 pr-10 py-3 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 rounded-md"},[t[18]||(t[18]=e("option",{value:""},"All Routes",-1)),t[19]||(t[19]=e("option",{value:"unassigned"},"Unassigned",-1)),(l(!0),d(j,null,A(s.routes,o=>(l(),d("option",{key:o,value:o},f(o),9,Rt))),128))],40,Vt)]),e("div",null,[t[21]||(t[21]=e("label",{for:"location-search-mobile",class:"block text-sm font-medium text-gray-700 mb-2"},"Search Location",-1)),e("input",{id:"location-search-mobile",name:"location-search",type:"text",value:s.locationSearchText,onInput:t[2]||(t[2]=o=>i.$emit("location-search",o.target.value)),placeholder:"Type to search locations...",class:"block w-full pl-3 pr-3 py-3 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 rounded-md"},null,40,Ct)]),e("div",null,[e("label",Dt,[t[22]||(t[22]=F(" Location ")),e("span",St,"("+f(s.locations.length)+" locations)",1)]),e("select",{id:"location-mobile",name:"location",value:s.selectedLocation,onChange:t[3]||(t[3]=o=>i.$emit("location-change",o.target.value)),class:"block w-full pl-3 pr-10 py-3 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 rounded-md",required:""},[t[23]||(t[23]=e("option",{value:"",disabled:""},"Select a location",-1)),(l(!0),d(j,null,A(s.locations,o=>(l(),d("option",{key:o.id,value:o.id},[F(f(o.name)+" ",1),o.route?(l(),d("span",Ft," - "+f(o.route),1)):V("",!0)],8,Et))),128))],40,Mt)]),e("div",null,[t[24]||(t[24]=e("label",{for:"visit_date_mobile",class:"block text-sm font-medium text-gray-700 mb-2"},"Visit Date",-1)),z(e("input",{type:"datetime-local",name:"visit_date",id:"visit_date_mobile","onUpdate:modelValue":t[4]||(t[4]=o=>s.restockForm.visit_date=o),class:"focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm text-base border-gray-300 rounded-md text-gray-900 py-3",required:""},null,512),[[q,s.restockForm.visit_date]])]),s.locationMachines.length>0?(l(),me(X,{key:0,machines:s.locationMachines},null,8,["machines"])):V("",!0),e("div",null,[t[25]||(t[25]=e("label",{for:"notes-mobile",class:"block text-sm font-medium text-gray-700 mb-2"},"Visit Notes",-1)),z(e("textarea",{id:"notes-mobile",name:"notes",rows:"3","onUpdate:modelValue":t[5]||(t[5]=o=>s.restockForm.notes=o),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full text-base border border-gray-300 rounded-md py-3",placeholder:"Add any notes about this visit..."},null,512),[[q,s.restockForm.notes]])])])]),e("div",Bt,[e("button",{type:"submit",disabled:s.saving,class:"w-full inline-flex justify-center items-center rounded-md border border-transparent shadow-sm px-4 py-3 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed min-h-[48px]"},[s.saving?(l(),d("span",At,t[26]||(t[26]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),F(" Saving... ")]))):(l(),d("span",Lt,"Save Visit"))],8,jt),e("button",{type:"button",onClick:t[6]||(t[6]=o=>i.$emit("close")),class:"w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-3 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 min-h-[48px]"}," Cancel ")])],32)]),e("div",It,[e("div",Nt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[8]||(t[8]=o=>i.$emit("close"))}),e("div",Ut,[e("form",{onSubmit:t[16]||(t[16]=K(o=>i.$emit("save"),["prevent"])),novalidate:"",class:"flex flex-col h-full"},[e("div",Pt,[e("div",zt,[e("h3",qt,f(s.isEditing?"Edit Visit":"Record New Visit"),1),e("button",{type:"button",onClick:t[9]||(t[9]=o=>i.$emit("close")),class:"text-gray-400 hover:text-gray-500 focus:outline-none focus:text-gray-500 transition ease-in-out duration-150"},t[27]||(t[27]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])]),e("div",Tt,[e("div",Ot,[e("div",null,[t[30]||(t[30]=e("label",{for:"route",class:"block text-sm font-medium text-gray-700"},"Filter by Route (Optional)",-1)),e("select",{id:"route",name:"route",value:s.selectedRoute,onChange:t[10]||(t[10]=o=>i.$emit("route-change",o.target.value)),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md"},[t[28]||(t[28]=e("option",{value:""},"All Routes",-1)),t[29]||(t[29]=e("option",{value:"unassigned"},"Unassigned",-1)),(l(!0),d(j,null,A(s.routes,o=>(l(),d("option",{key:o,value:o},f(o),9,Wt))),128))],40,Ht)]),e("div",null,[t[31]||(t[31]=e("label",{for:"location-search",class:"block text-sm font-medium text-gray-700"},"Search Location",-1)),e("input",{id:"location-search",name:"location-search",type:"text",value:s.locationSearchText,onInput:t[11]||(t[11]=o=>i.$emit("location-search",o.target.value)),placeholder:"Type to search locations...",class:"mt-1 block w-full pl-3 pr-3 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md"},null,40,Qt)]),e("div",null,[e("label",Gt,[t[32]||(t[32]=F(" Location ")),e("span",Yt,"("+f(s.locations.length)+" locations)",1)]),e("select",{id:"location",name:"location",value:s.selectedLocation,onChange:t[12]||(t[12]=o=>i.$emit("location-change",o.target.value)),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},[t[33]||(t[33]=e("option",{value:"",disabled:""},"Select a location",-1)),(l(!0),d(j,null,A(s.locations,o=>(l(),d("option",{key:o.id,value:o.id},[F(f(o.name)+" ",1),o.route?(l(),d("span",Xt," - "+f(o.route),1)):V("",!0)],8,Kt))),128))],40,Jt)]),e("div",null,[t[34]||(t[34]=e("label",{for:"visit_date",class:"block text-sm font-medium text-gray-700"},"Visit Date",-1)),z(e("input",{type:"datetime-local",name:"visit_date",id:"visit_date","onUpdate:modelValue":t[13]||(t[13]=o=>s.restockForm.visit_date=o),class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md text-gray-900",required:""},null,512),[[q,s.restockForm.visit_date]])]),s.locationMachines.length>0?(l(),d("div",Zt,[B(X,{machines:s.locationMachines},null,8,["machines"])])):V("",!0),e("div",null,[t[35]||(t[35]=e("label",{for:"notes",class:"block text-sm font-medium text-gray-700"},"Visit Notes",-1)),z(e("textarea",{id:"notes",name:"notes",rows:"2","onUpdate:modelValue":t[14]||(t[14]=o=>s.restockForm.notes=o),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md"},null,512),[[q,s.restockForm.notes]])])])]),e("div",es,[e("button",{type:"submit",disabled:s.saving,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed"},[s.saving?(l(),d("span",ss,t[36]||(t[36]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),F(" Saving... ")]))):(l(),d("span",os,"Save Visit"))],8,ts),e("button",{type:"button",onClick:t[15]||(t[15]=o=>i.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])],32)])])])])):V("",!0)}},ns={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},as={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},rs={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full"},ls={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},ds={class:"sm:flex sm:items-start"},cs={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},us={key:0,class:"mt-4"},ms={class:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2"},fs={class:"sm:col-span-1"},vs={class:"mt-1 text-sm text-gray-900"},gs={class:"sm:col-span-1"},bs={class:"mt-1 text-sm text-gray-900"},ys={class:"sm:col-span-1"},ps={class:"mt-1 text-sm text-gray-900"},xs={class:"sm:col-span-2"},hs={class:"mt-1 text-sm text-gray-900"},ks={key:0,class:"mt-6"},ws={class:"text-sm font-semibold text-gray-700 mb-2 bg-gray-100 px-3 py-2 rounded-md"},$s={class:"border border-gray-200 rounded-md overflow-hidden"},_s={class:"divide-y divide-gray-200"},Vs={class:"grid grid-cols-6 gap-2 items-center"},Rs={class:"col-span-1 text-center bg-gray-100 rounded-md py-1 text-sm font-medium text-gray-900"},Cs={class:"col-span-1 text-sm font-medium text-gray-900"},Ds={class:"col-span-1 text-center text-sm text-gray-500"},Ss={class:"col-span-1 text-center text-sm text-gray-500"},Ms={class:"col-span-1 text-center text-sm text-green-600 font-medium"},Es={class:"col-span-1 text-center text-sm font-medium text-gray-900"},Fs={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Bs={__name:"RestockDetailsModal",props:{show:Boolean,restock:Object},emits:["close"],setup(s){const y=s,a=W(()=>{var i;if(!((i=y.restock)!=null&&i.entries))return{};const n={};return y.restock.entries.forEach(t=>{`${t.machine_name||"Unknown"}${t.machine_type||""}${t.machine_model||""}`;const o=`${t.machine_name||"Unknown Machine"} (${t.machine_type||"Unknown Type"}${t.machine_model?" "+t.machine_model:""})`;n[o]||(n[o]=[]),n[o].push(t)}),Object.keys(n).forEach(t=>{n[t].sort((o,w)=>{const x=o.slot||999,h=w.slot||999;return x-h})}),n});return(n,i)=>s.show?(l(),d("div",ns,[e("div",as,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:i[0]||(i[0]=t=>n.$emit("close"))}),i[9]||(i[9]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",rs,[e("div",ls,[e("div",ds,[e("div",cs,[i[8]||(i[8]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Restock Details ",-1)),s.restock?(l(),d("div",us,[e("dl",ms,[e("div",fs,[i[2]||(i[2]=e("dt",{class:"text-sm font-medium text-gray-500"},"Location",-1)),e("dd",vs,f(s.restock.location_name),1)]),e("div",gs,[i[3]||(i[3]=e("dt",{class:"text-sm font-medium text-gray-500"},"Visit Date",-1)),e("dd",bs,f(M(Q)(s.restock.visit_date)),1)]),e("div",ys,[i[4]||(i[4]=e("dt",{class:"text-sm font-medium text-gray-500"},"Restocked By",-1)),e("dd",ps,f(s.restock.user_name),1)]),e("div",xs,[i[5]||(i[5]=e("dt",{class:"text-sm font-medium text-gray-500"},"Notes",-1)),e("dd",hs,f(s.restock.notes||"No notes"),1)])]),s.restock.entries&&s.restock.entries.length>0?(l(),d("div",ks,[i[7]||(i[7]=e("h4",{class:"text-sm font-medium text-gray-500 mb-4"},"Restocked Items",-1)),(l(!0),d(j,null,A(a.value,(t,o)=>(l(),d("div",{key:o,class:"mb-6"},[e("h5",ws,f(o),1),e("div",$s,[i[6]||(i[6]=ee('<div class="px-4 py-3 bg-gray-50 text-xs font-medium text-gray-500 uppercase tracking-wider"><div class="grid grid-cols-6 gap-2"><div class="col-span-1 text-center">Slot</div><div class="col-span-1">Product</div><div class="col-span-1 text-center">Prev Qty</div><div class="col-span-1 text-center">Discarded</div><div class="col-span-1 text-center">Added</div><div class="col-span-1 text-center">New Qty</div></div></div>',1)),e("div",_s,[(l(!0),d(j,null,A(t,w=>(l(),d("div",{key:w.id,class:"px-4 py-3"},[e("div",Vs,[e("div",Rs,f(w.slot||"-"),1),e("div",Cs,f(w.product_name),1),e("div",Ds,f(w.previous_quantity),1),e("div",Ss,f(w.quantity_discarded),1),e("div",Ms," +"+f(w.quantity_added),1),e("div",Es,f(w.previous_quantity+w.quantity_added-w.quantity_discarded),1)])]))),128))])])]))),128))])):V("",!0)])):V("",!0)])])]),e("div",Fs,[e("button",{type:"button",onClick:i[1]||(i[1]=t=>n.$emit("close")),class:"w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:w-auto sm:text-sm"}," Close ")])])])])):V("",!0)}},js={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},As={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Ls={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Is={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Ns={class:"sm:flex sm:items-start"},Us={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},Ps={key:0,class:"mt-2"},zs={class:"text-sm text-gray-500"},qs={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Ts={__name:"DeleteConfirmationModal",props:{show:Boolean,restock:Object},emits:["close","confirm"],setup(s){return(y,a)=>s.show?(l(),d("div",js,[e("div",As,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:a[0]||(a[0]=n=>y.$emit("close"))}),a[5]||(a[5]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Ls,[e("div",Is,[e("div",Ns,[a[4]||(a[4]=e("div",{class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"},[e("svg",{class:"h-6 w-6 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),e("div",Us,[a[3]||(a[3]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Delete Visit ",-1)),s.restock?(l(),d("div",Ps,[e("p",zs," Are you sure you want to delete this visit to "+f(s.restock.location_name)+" on "+f(M(Q)(s.restock.visit_date))+"? This action will also reverse all inventory changes made during this visit. This action cannot be undone. ",1)])):V("",!0)])])]),e("div",qs,[e("button",{type:"button",onClick:a[1]||(a[1]=n=>y.$emit("confirm")),class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"}," Delete "),e("button",{type:"button",onClick:a[2]||(a[2]=n=>y.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])])])])):V("",!0)}},Js={__name:"Restocks",setup(s){const y=Z(),{restocks:a,loading:n,error:i,fetchRestocks:t,deleteVisit:o,getVisitDetails:w}=pe(),{filteredLocations:x,routes:h,selectedRoute:m,locationSearchText:r,fetchLocations:c,fetchRoutes:u,resetFilters:p}=ve(),{locationMachines:g,fetchLocationMachines:C,updateMachineProductData:S,resetMachineData:v}=ge(),{restockForm:b,isEditing:k,selectedLocation:_,saving:N,initializeForm:G,saveRestockOptimized:te}=xe(),I=E(!1),O=E(!1),U=E(!1),H=E(null),P=E(null),Y=()=>{G(),p(),v(),I.value=!0},se=async $=>{G($),p(),await C($.location_id);try{for(const D of g.value)await S($.id,D.id);I.value=!0}catch(D){console.error("Error loading visit for editing:",D),i.value="Failed to load visit details for editing. Please try again."}},oe=async $=>{H.value=$;try{const D=await w($.id);H.value={...$,entries:D},O.value=!0}catch(D){console.error("Error fetching visit details:",D),i.value="Failed to load visit details. Please try again."}},ie=$=>{P.value=$,U.value=!0},ne=async()=>{try{await o(P.value.id),U.value=!1,P.value=null}catch($){console.error("Error deleting visit:",$),i.value="Failed to delete visit. Please try again."}},ae=async()=>{await te(g.value)&&(I.value=!1,await t())},re=$=>{m.value=$,_.value="",v()},le=$=>{r.value=$},de=$=>{_.value=$,C($)};return fe(async()=>{y.isAuthenticated&&!y.user&&await y.fetchUser(),console.log("Current user:",y.user),await Promise.all([t(),c(),u()])}),($,D)=>(l(),d("div",null,[e("div",{class:"flex justify-between items-center mb-6"},[D[3]||(D[3]=e("h1",{class:"text-2xl font-semibold text-gray-900"},"Location Visits",-1)),e("button",{onClick:Y,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Record New Visit ")]),B(Ne,{restocks:M(a),loading:M(n),error:M(i),onAddRestock:Y,onViewDetails:oe,onEditRestock:se,onDeleteRestock:ie},null,8,["restocks","loading","error"]),B(is,{show:I.value,"is-editing":M(k),"restock-form":M(b),"selected-location":M(_),"selected-route":M(m),"location-search-text":M(r),locations:M(x),routes:M(h),"location-machines":M(g),saving:M(N),onClose:D[0]||(D[0]=J=>I.value=!1),onSave:ae,onRouteChange:re,onLocationSearch:le,onLocationChange:de},null,8,["show","is-editing","restock-form","selected-location","selected-route","location-search-text","locations","routes","location-machines","saving"]),B(Bs,{show:O.value,restock:H.value,onClose:D[1]||(D[1]=J=>O.value=!1)},null,8,["show","restock"]),B(Ts,{show:U.value,restock:P.value,onClose:D[2]||(D[2]=J=>U.value=!1),onConfirm:ne},null,8,["show","restock"])]))}};export{Js as default};
