import{r as C,y as H,c,o as d,b as e,t as u,F as S,e as F,u as R,d as Y,n as G,f as V,k as D,w as j,q as A,p as ae,l as le,x as de,j as ce,h as B}from"./index-ZwMbn-si.js";import{a as _}from"./api-DH3Ink8R.js";import{u as me}from"./useLocations-EKmqB_ns.js";import{u as ue}from"./useMachines-D_5AWAbs.js";import{g as fe,f as z}from"./dateUtils-CXdyRzwD.js";function ge(){const r=C([]),l=C(!1),t=C(null),o=async()=>{l.value=!0,t.value=null;try{const b=await _.getVisits();r.value=b.data.map(n=>({id:n.id,location_id:n.location,location_name:n.location_name,visit_date:n.visit_date,notes:n.notes,user_name:n.user_name}))}catch(b){console.error("Error fetching visits:",b),t.value="Failed to load visits. Please try again later."}finally{l.value=!1}};return{restocks:r,loading:l,error:t,fetchRestocks:o,createVisit:async b=>{try{return(await _.createVisit(b)).data}catch(n){throw console.error("Error creating visit:",n),n}},updateVisit:async(b,n)=>{try{return(await _.updateVisit(b,n)).data}catch(a){throw console.error("Error updating visit:",a),a}},deleteVisit:async b=>{try{await _.deleteVisit(b),await o()}catch(n){throw console.error("Error deleting visit:",n),n}},getVisitDetails:async b=>{try{const a=(await _.getRestocks({visit:b})).data;let y=[];for(const s of a){const E=(await _.getRestockEntries({visit_machine_restock:s.id})).data,m=(await _.getMachineItems({machine:s.machine})).data,x=E.map($=>{const M=m.find(I=>I.product===$.product);return{...$,slot:M?M.slot:null}});y.push(...x)}return y.sort((s,g)=>s.visit_machine_restock!==g.visit_machine_restock?0:(s.slot||999)-(g.slot||999)),y.map(s=>({id:s.id,product_name:s.product_name,product_id:s.product,previous_quantity:s.stock_before,quantity_discarded:s.discarded,quantity_added:s.restocked,machine_name:s.machine_name,machine_type:s.machine_type,machine_model:s.machine_model,slot:s.slot}))}catch(n){throw console.error("Error fetching visit details:",n),n}}}}function ve(){const r=H(),l=C(!1),t=C(""),o=C(null),i=C({id:null,visit_date:"",notes:"",location:"",machines:[]}),f=(s=null)=>{s?(l.value=!0,t.value=s.location_id,i.value={id:s.id,visit_date:s.visit_date,notes:s.notes,location:s.location_id}):(l.value=!1,t.value="",i.value={id:null,visit_date:fe(),notes:"",location:"",machines:[]})},k=s=>s.some(v=>v.products.some(m=>h(m)))?s.some(v=>v.products.some(m=>h(m)?m.stock_before===""||m.restocked==="":!1))?(o.value="Please complete all fields for products being restocked (stock before and restock amount are required)",!1):!0:(o.value="Please record stock levels for at least one product",!1),h=s=>s.stock_before!==""||s.restocked!==""||s.discarded!=="",b=async(s,g,E)=>{var v;try{if(o.value=null,!k(s))return!1;let m;const x={location:t.value,visit_date:i.value.visit_date,notes:i.value.notes,user:(v=r.user)==null?void 0:v.id};return console.log("Saving visit with data:",x),l.value&&i.value.id?m=(await E(i.value.id,x)).id:m=(await g(x)).id,await n(m,s),!0}catch(m){return console.error("Error saving restock visit:",m),o.value="Failed to save visit. Please try again.",!1}},n=async(s,g)=>{const E=g.filter(v=>v.products.some(m=>h(m)));for(const v of E){let m;if(l.value)try{const x=await _.getRestocks({visit:s,machine:v.id});if(x.data.length>0){const $=x.data[0],M={visit:s,machine:v.id,notes:$.notes||""};await _.updateRestock($.id,M),m=$.id}else{const $={visit:s,machine:v.id,notes:""};m=(await _.createRestock($)).data.id}}catch(x){throw console.error("Error handling machine restock:",x),x}else{const x={visit:s,machine:v.id,notes:""};m=(await _.createRestock(x)).data.id}await a(m,v.products)}},a=async(s,g)=>{const E=g.filter(v=>h(v));for(const v of E)try{const m={visit_machine_restock:s,product:v.id,stock_before:parseInt(v.stock_before)||0,discarded:parseInt(v.discarded)||0,restocked:parseInt(v.restocked)||0};if(l.value){const x=await _.getRestockEntries({visit_machine_restock:s,product:v.id});x.data.length>0?await _.updateRestockEntry(x.data[0].id,m):await _.createRestockEntry(m)}else await _.createRestockEntry(m)}catch(m){throw console.error("Error handling restock entry:",m),m}};return{restockForm:i,isEditing:l,selectedLocation:t,error:o,initializeForm:f,validateForm:k,saveRestock:b,resetForm:()=>{f(),o.value=null}}}const ye={key:0,class:"flex justify-center"},he={key:1,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-4"},xe={class:"flex"},pe={class:"ml-3"},be={class:"text-sm text-red-700"},ke={key:2,class:"bg-white shadow overflow-hidden sm:rounded-lg"},we={class:"px-4 py-5 sm:p-6 text-center"},_e={class:"mt-5"},$e={key:3,class:"bg-white shadow overflow-hidden sm:rounded-lg"},Re={role:"list",class:"divide-y divide-gray-200"},Ce={class:"flex items-center justify-between"},De={class:"flex-1 min-w-0"},Ve={class:"text-sm font-medium text-primary-600 truncate"},Ee={class:"text-sm text-gray-500"},Me={class:"ml-4 flex-shrink-0 flex space-x-2"},Se=["onClick"],Fe=["onClick"],Le=["onClick"],je={__name:"RestockList",props:{restocks:Array,loading:Boolean,error:String},emits:["add-restock","view-details","edit-restock","delete-restock"],setup(r){return(l,t)=>(d(),c("div",null,[r.loading?(d(),c("div",ye,t[1]||(t[1]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))):r.error?(d(),c("div",he,[e("div",xe,[t[2]||(t[2]=e("div",{class:"flex-shrink-0"},[e("span",{class:"text-red-400"},"⚠")],-1)),e("div",pe,[e("p",be,u(r.error),1)])])])):r.restocks.length===0?(d(),c("div",ke,[e("div",we,[t[3]||(t[3]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"No visits recorded",-1)),t[4]||(t[4]=e("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[e("p",null,"Get started by recording your first location visit.")],-1)),e("div",_e,[e("button",{onClick:t[0]||(t[0]=o=>l.$emit("add-restock")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Record New Visit ")])])])):(d(),c("div",$e,[e("ul",Re,[(d(!0),c(S,null,F(r.restocks,o=>(d(),c("li",{key:o.id,class:"px-4 py-4 sm:px-6"},[e("div",Ce,[e("div",De,[e("p",Ve,u(o.location_name),1),e("p",Ee,u(R(z)(o.visit_date)),1)]),e("div",Me,[e("button",{onClick:i=>l.$emit("view-details",o),class:"inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," View Details ",8,Se),e("button",{onClick:i=>l.$emit("edit-restock",o),class:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Edit ",8,Fe),e("button",{onClick:i=>l.$emit("delete-restock",o),class:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," Delete ",8,Le)])])]))),128))])]))]))}},Ae={class:"space-y-4"},Ie={class:"flex justify-between items-center mb-2"},Pe={class:"text-sm font-medium text-gray-900"},Ne={key:0,class:"ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"},Be={class:"text-sm text-gray-500"},qe={key:0,class:"ml-2 text-green-600"},Ue={class:"space-y-2"},Te={key:0,class:"text-sm text-gray-500 italic p-2 text-center"},ze={class:"col-span-1 text-sm font-medium text-gray-900 text-center bg-gray-100 rounded-md py-1"},Oe={class:"col-span-3 text-sm font-medium text-gray-900"},We={key:0,class:"ml-1 inline-flex items-center w-2 h-2 bg-green-500 rounded-full",title:"Will be restocked"},Qe={class:"col-span-2"},Ge={class:"mt-1 flex rounded-md shadow-sm"},He=["onClick"],Ye=["onUpdate:modelValue"],Je=["onClick"],Ke={class:"col-span-2"},Xe={class:"mt-1 flex rounded-md shadow-sm"},Ze=["onClick"],et=["onUpdate:modelValue"],tt=["onClick"],st={class:"col-span-2"},ot={class:"mt-1 flex rounded-md shadow-sm"},nt=["onClick"],it=["onUpdate:modelValue"],rt=["onClick"],at={class:"col-span-2 text-sm text-gray-500"},lt={__name:"MachineProductsSection",props:{machines:Array},setup(r){const l=(n,a)=>{const y=n[a]===""?0:parseInt(n[a])||0;n[a]=y+1},t=(n,a)=>{const y=n[a]===""?0:parseInt(n[a])||0;n[a]=Math.max(0,y-1)},o=n=>(parseInt(n.stock_before)||0)-(parseInt(n.discarded)||0)+(parseInt(n.restocked)||0),i=n=>n.stock_before!==""||n.restocked!==""||n.discarded!=="",f=n=>n.products.some(a=>i(a)),k=n=>n.products.filter(a=>i(a)).length,h=n=>f(n)?"border-green-300 bg-green-50":"border-gray-200",b=n=>i(n)?"bg-green-50 rounded-md p-2":"p-2";return(n,a)=>(d(),c("div",null,[a[9]||(a[9]=Y('<h4 class="text-sm font-medium text-gray-700 mb-2">Machines at Location</h4><div class="mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"><div class="flex items-center"><svg class="h-5 w-5 text-blue-400 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><div class="text-sm text-blue-700"><p class="font-medium">Partial Restock Allowed</p><p class="text-blue-600">You can restock only the machines/products you need. Leave others empty to skip them.</p></div></div></div>',2)),e("div",Ae,[(d(!0),c(S,null,F(r.machines,y=>(d(),c("div",{key:y.id,class:G(["border rounded-lg p-4",h(y)])},[e("div",Ie,[e("h5",Pe,[V(u(y.name)+" ("+u(y.machine_type)+" "+u(y.model)+") ",1),f(y)?(d(),c("span",Ne," Will be restocked ")):D("",!0)]),e("div",Be,[V(u(y.products.length)+" products ",1),f(y)?(d(),c("span",qe," ("+u(k(y))+" being restocked) ",1)):D("",!0)])]),e("div",Ue,[y.products.length===0?(d(),c("div",Te," No products in this machine ")):D("",!0),(d(!0),c(S,null,F(y.products,s=>(d(),c("div",{key:s.id,class:G(["grid grid-cols-12 gap-4 items-center",b(s)])},[e("div",ze,u(s.slot),1),e("div",Oe,[V(u(s.name)+" ",1),i(s)?(d(),c("span",We)):D("",!0)]),e("div",Qe,[a[2]||(a[2]=e("label",{class:"block text-xs text-gray-500"},"Current Stock",-1)),e("div",Ge,[e("button",{type:"button",onClick:g=>t(s,"stock_before"),class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},a[0]||(a[0]=[e("span",{class:"sr-only"},"Decrease",-1),V(" - ")]),8,He),j(e("input",{type:"number","onUpdate:modelValue":g=>s.stock_before=g,min:"0",class:"focus:ring-primary-500 focus:border-primary-500 block w-full border-gray-300 rounded-none text-center sm:text-sm",placeholder:"0"},null,8,Ye),[[A,s.stock_before]]),e("button",{type:"button",onClick:g=>l(s,"stock_before"),class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},a[1]||(a[1]=[e("span",{class:"sr-only"},"Increase",-1),V(" + ")]),8,Je)])]),e("div",Ke,[a[5]||(a[5]=e("label",{class:"block text-xs text-gray-500"},"Discarded Amount",-1)),e("div",Xe,[e("button",{type:"button",onClick:g=>t(s,"discarded"),class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},a[3]||(a[3]=[e("span",{class:"sr-only"},"Decrease",-1),V(" - ")]),8,Ze),j(e("input",{type:"number","onUpdate:modelValue":g=>s.discarded=g,min:"0",class:"focus:ring-primary-500 focus:border-primary-500 block w-full border-gray-300 rounded-none text-center sm:text-sm",placeholder:"0"},null,8,et),[[A,s.discarded]]),e("button",{type:"button",onClick:g=>l(s,"discarded"),class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},a[4]||(a[4]=[e("span",{class:"sr-only"},"Increase",-1),V(" + ")]),8,tt)])]),e("div",st,[a[8]||(a[8]=e("label",{class:"block text-xs text-gray-500"},"Restock Amount",-1)),e("div",ot,[e("button",{type:"button",onClick:g=>t(s,"restocked"),class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},a[6]||(a[6]=[e("span",{class:"sr-only"},"Decrease",-1),V(" - ")]),8,nt),j(e("input",{type:"number","onUpdate:modelValue":g=>s.restocked=g,min:"0",class:"focus:ring-primary-500 focus:border-primary-500 block w-full border-gray-300 rounded-none text-center sm:text-sm",placeholder:"0"},null,8,it),[[A,s.restocked]]),e("button",{type:"button",onClick:g=>l(s,"restocked"),class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},a[7]||(a[7]=[e("span",{class:"sr-only"},"Increase",-1),V(" + ")]),8,rt)])]),e("div",at," New Total: "+u(o(s)),1)],2))),128))])],2))),128))])]))}},dt={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},ct={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},mt={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full"},ut={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},ft={class:"sm:flex sm:items-start"},gt={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},vt={class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"},yt={class:"mt-4 space-y-4"},ht=["value"],xt=["value"],pt=["value"],bt={for:"location",class:"block text-sm font-medium text-gray-700"},kt={class:"text-xs text-gray-500 ml-1"},wt=["value"],_t=["value"],$t={key:0,class:"text-gray-500"},Rt={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Ct={__name:"RestockFormModal",props:{show:Boolean,isEditing:Boolean,restockForm:Object,selectedLocation:String,selectedRoute:String,locationSearchText:String,locations:Array,routes:Array,locationMachines:Array},emits:["close","save","route-change","location-search","location-change"],setup(r){return(l,t)=>r.show?(d(),c("div",dt,[e("div",ct,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=o=>l.$emit("close"))}),t[17]||(t[17]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",mt,[e("form",{onSubmit:t[7]||(t[7]=ae(o=>l.$emit("save"),["prevent"])),novalidate:""},[e("div",ut,[e("div",ft,[e("div",gt,[e("h3",vt,u(r.isEditing?"Edit Visit":"Record New Visit"),1),e("div",yt,[e("div",null,[t[10]||(t[10]=e("label",{for:"route",class:"block text-sm font-medium text-gray-700"},"Filter by Route (Optional)",-1)),e("select",{id:"route",name:"route",value:r.selectedRoute,onChange:t[1]||(t[1]=o=>l.$emit("route-change",o.target.value)),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md"},[t[8]||(t[8]=e("option",{value:""},"All Routes",-1)),t[9]||(t[9]=e("option",{value:"unassigned"},"Unassigned",-1)),(d(!0),c(S,null,F(r.routes,o=>(d(),c("option",{key:o,value:o},u(o),9,xt))),128))],40,ht)]),e("div",null,[t[11]||(t[11]=e("label",{for:"location-search",class:"block text-sm font-medium text-gray-700"},"Search Location",-1)),e("input",{id:"location-search",name:"location-search",type:"text",value:r.locationSearchText,onInput:t[2]||(t[2]=o=>l.$emit("location-search",o.target.value)),placeholder:"Type to search locations...",class:"mt-1 block w-full pl-3 pr-3 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md"},null,40,pt)]),e("div",null,[e("label",bt,[t[12]||(t[12]=V(" Location ")),e("span",kt,"("+u(r.locations.length)+" locations)",1)]),e("select",{id:"location",name:"location",value:r.selectedLocation,onChange:t[3]||(t[3]=o=>l.$emit("location-change",o.target.value)),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},[t[13]||(t[13]=e("option",{value:"",disabled:""},"Select a location",-1)),(d(!0),c(S,null,F(r.locations,o=>(d(),c("option",{key:o.id,value:o.id},[V(u(o.name)+" ",1),o.route?(d(),c("span",$t," - "+u(o.route),1)):D("",!0)],8,_t))),128))],40,wt)]),e("div",null,[t[14]||(t[14]=e("label",{for:"visit_date",class:"block text-sm font-medium text-gray-700"},"Visit Date",-1)),j(e("input",{type:"datetime-local",name:"visit_date",id:"visit_date","onUpdate:modelValue":t[4]||(t[4]=o=>r.restockForm.visit_date=o),class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md",required:""},null,512),[[A,r.restockForm.visit_date]])]),r.locationMachines.length>0?(d(),le(lt,{key:0,machines:r.locationMachines},null,8,["machines"])):D("",!0),e("div",null,[t[15]||(t[15]=e("label",{for:"notes",class:"block text-sm font-medium text-gray-700"},"Visit Notes",-1)),j(e("textarea",{id:"notes",name:"notes",rows:"2","onUpdate:modelValue":t[5]||(t[5]=o=>r.restockForm.notes=o),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md"},null,512),[[A,r.restockForm.notes]])])])])])]),e("div",Rt,[t[16]||(t[16]=e("button",{type:"submit",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm"}," Save Visit ",-1)),e("button",{type:"button",onClick:t[6]||(t[6]=o=>l.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])],32)])])])):D("",!0)}},Dt={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Vt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Et={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full"},Mt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},St={class:"sm:flex sm:items-start"},Ft={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},Lt={key:0,class:"mt-4"},jt={class:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2"},At={class:"sm:col-span-1"},It={class:"mt-1 text-sm text-gray-900"},Pt={class:"sm:col-span-1"},Nt={class:"mt-1 text-sm text-gray-900"},Bt={class:"sm:col-span-1"},qt={class:"mt-1 text-sm text-gray-900"},Ut={class:"sm:col-span-2"},Tt={class:"mt-1 text-sm text-gray-900"},zt={key:0,class:"mt-6"},Ot={class:"text-sm font-semibold text-gray-700 mb-2 bg-gray-100 px-3 py-2 rounded-md"},Wt={class:"border border-gray-200 rounded-md overflow-hidden"},Qt={class:"divide-y divide-gray-200"},Gt={class:"grid grid-cols-6 gap-2 items-center"},Ht={class:"col-span-1 text-center bg-gray-100 rounded-md py-1 text-sm font-medium text-gray-900"},Yt={class:"col-span-1 text-sm font-medium text-gray-900"},Jt={class:"col-span-1 text-center text-sm text-gray-500"},Kt={class:"col-span-1 text-center text-sm text-gray-500"},Xt={class:"col-span-1 text-center text-sm text-green-600 font-medium"},Zt={class:"col-span-1 text-center text-sm font-medium text-gray-900"},es={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},ts={__name:"RestockDetailsModal",props:{show:Boolean,restock:Object},emits:["close"],setup(r){const l=r,t=de(()=>{var i;if(!((i=l.restock)!=null&&i.entries))return{};const o={};return l.restock.entries.forEach(f=>{`${f.machine_name||"Unknown"}${f.machine_type||""}${f.machine_model||""}`;const k=`${f.machine_name||"Unknown Machine"} (${f.machine_type||"Unknown Type"}${f.machine_model?" "+f.machine_model:""})`;o[k]||(o[k]=[]),o[k].push(f)}),Object.keys(o).forEach(f=>{o[f].sort((k,h)=>{const b=k.slot||999,n=h.slot||999;return b-n})}),o});return(o,i)=>r.show?(d(),c("div",Dt,[e("div",Vt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:i[0]||(i[0]=f=>o.$emit("close"))}),i[9]||(i[9]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Et,[e("div",Mt,[e("div",St,[e("div",Ft,[i[8]||(i[8]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Restock Details ",-1)),r.restock?(d(),c("div",Lt,[e("dl",jt,[e("div",At,[i[2]||(i[2]=e("dt",{class:"text-sm font-medium text-gray-500"},"Location",-1)),e("dd",It,u(r.restock.location_name),1)]),e("div",Pt,[i[3]||(i[3]=e("dt",{class:"text-sm font-medium text-gray-500"},"Visit Date",-1)),e("dd",Nt,u(R(z)(r.restock.visit_date)),1)]),e("div",Bt,[i[4]||(i[4]=e("dt",{class:"text-sm font-medium text-gray-500"},"Restocked By",-1)),e("dd",qt,u(r.restock.user_name),1)]),e("div",Ut,[i[5]||(i[5]=e("dt",{class:"text-sm font-medium text-gray-500"},"Notes",-1)),e("dd",Tt,u(r.restock.notes||"No notes"),1)])]),r.restock.entries&&r.restock.entries.length>0?(d(),c("div",zt,[i[7]||(i[7]=e("h4",{class:"text-sm font-medium text-gray-500 mb-4"},"Restocked Items",-1)),(d(!0),c(S,null,F(t.value,(f,k)=>(d(),c("div",{key:k,class:"mb-6"},[e("h5",Ot,u(k),1),e("div",Wt,[i[6]||(i[6]=Y('<div class="px-4 py-3 bg-gray-50 text-xs font-medium text-gray-500 uppercase tracking-wider"><div class="grid grid-cols-6 gap-2"><div class="col-span-1 text-center">Slot</div><div class="col-span-1">Product</div><div class="col-span-1 text-center">Prev Qty</div><div class="col-span-1 text-center">Discarded</div><div class="col-span-1 text-center">Added</div><div class="col-span-1 text-center">New Qty</div></div></div>',1)),e("div",Qt,[(d(!0),c(S,null,F(f,h=>(d(),c("div",{key:h.id,class:"px-4 py-3"},[e("div",Gt,[e("div",Ht,u(h.slot||"-"),1),e("div",Yt,u(h.product_name),1),e("div",Jt,u(h.previous_quantity),1),e("div",Kt,u(h.quantity_discarded),1),e("div",Xt," +"+u(h.quantity_added),1),e("div",Zt,u(h.previous_quantity+h.quantity_added-h.quantity_discarded),1)])]))),128))])])]))),128))])):D("",!0)])):D("",!0)])])]),e("div",es,[e("button",{type:"button",onClick:i[1]||(i[1]=f=>o.$emit("close")),class:"w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:w-auto sm:text-sm"}," Close ")])])])])):D("",!0)}},ss={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},os={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},ns={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},is={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},rs={class:"sm:flex sm:items-start"},as={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},ls={key:0,class:"mt-2"},ds={class:"text-sm text-gray-500"},cs={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},ms={__name:"DeleteConfirmationModal",props:{show:Boolean,restock:Object},emits:["close","confirm"],setup(r){return(l,t)=>r.show?(d(),c("div",ss,[e("div",os,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=o=>l.$emit("close"))}),t[5]||(t[5]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",ns,[e("div",is,[e("div",rs,[t[4]||(t[4]=e("div",{class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"},[e("svg",{class:"h-6 w-6 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),e("div",as,[t[3]||(t[3]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Delete Visit ",-1)),r.restock?(d(),c("div",ls,[e("p",ds," Are you sure you want to delete this visit to "+u(r.restock.location_name)+" on "+u(R(z)(r.restock.visit_date))+"? This action will also reverse all inventory changes made during this visit. This action cannot be undone. ",1)])):D("",!0)])])]),e("div",cs,[e("button",{type:"button",onClick:t[1]||(t[1]=o=>l.$emit("confirm")),class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"}," Delete "),e("button",{type:"button",onClick:t[2]||(t[2]=o=>l.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])])])])):D("",!0)}},hs={__name:"Restocks",setup(r){const l=H(),{restocks:t,loading:o,error:i,fetchRestocks:f,createVisit:k,updateVisit:h,deleteVisit:b,getVisitDetails:n}=ge(),{filteredLocations:a,routes:y,selectedRoute:s,locationSearchText:g,fetchLocations:E,fetchRoutes:v,resetFilters:m}=me(),{locationMachines:x,fetchLocationMachines:$,updateMachineProductData:M,resetMachineData:I}=ue(),{restockForm:J,isEditing:K,selectedLocation:q,initializeForm:O,saveRestock:X}=ve(),L=C(!1),U=C(!1),P=C(!1),T=C(null),N=C(null),W=()=>{O(),m(),I(),L.value=!0},Z=async p=>{O(p),m(),await $(p.location_id);try{for(const w of x.value)await M(p.id,w.id);L.value=!0}catch(w){console.error("Error loading visit for editing:",w),i.value="Failed to load visit details for editing. Please try again."}},ee=async p=>{T.value=p;try{const w=await n(p.id);T.value={...p,entries:w},U.value=!0}catch(w){console.error("Error fetching visit details:",w),i.value="Failed to load visit details. Please try again."}},te=p=>{N.value=p,P.value=!0},se=async()=>{try{await b(N.value.id),P.value=!1,N.value=null}catch(p){console.error("Error deleting visit:",p),i.value="Failed to delete visit. Please try again."}},oe=async()=>{await X(x.value,k,h)&&(L.value=!1,await f())},ne=p=>{s.value=p,q.value="",I()},ie=p=>{g.value=p},re=p=>{q.value=p,$(p)};return ce(async()=>{l.isAuthenticated&&!l.user&&await l.fetchUser(),console.log("Current user:",l.user),await Promise.all([f(),E(),v()])}),(p,w)=>(d(),c("div",null,[e("div",{class:"flex justify-between items-center mb-6"},[w[3]||(w[3]=e("h1",{class:"text-2xl font-semibold text-gray-900"},"Location Visits",-1)),e("button",{onClick:W,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Record New Visit ")]),B(je,{restocks:R(t),loading:R(o),error:R(i),onAddRestock:W,onViewDetails:ee,onEditRestock:Z,onDeleteRestock:te},null,8,["restocks","loading","error"]),B(Ct,{show:L.value,"is-editing":R(K),"restock-form":R(J),"selected-location":R(q),"selected-route":R(s),"location-search-text":R(g),locations:R(a),routes:R(y),"location-machines":R(x),onClose:w[0]||(w[0]=Q=>L.value=!1),onSave:oe,onRouteChange:ne,onLocationSearch:ie,onLocationChange:re},null,8,["show","is-editing","restock-form","selected-location","selected-route","location-search-text","locations","routes","location-machines"]),B(ts,{show:U.value,restock:T.value,onClose:w[1]||(w[1]=Q=>U.value=!1)},null,8,["show","restock"]),B(ms,{show:P.value,restock:N.value,onClose:w[2]||(w[2]=Q=>P.value=!1),onConfirm:se},null,8,["show","restock"])]))}};export{hs as default};
