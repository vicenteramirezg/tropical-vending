import{r as c,o as E,c as l,a as e,t as n,e as V,f as v,h as w,k as A,v as D,F as y,b as f,g as b,n as u,d}from"./index-D9zG8uyo.js";import{a as g}from"./api-DAHrCf8K.js";const $={key:0,class:"flex justify-center"},U={key:1,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-4"},M={class:"flex"},N={class:"ml-3"},j={class:"text-sm text-red-700"},B={key:2},z={class:"bg-white p-4 shadow rounded-lg mb-6"},I={class:"flex flex-wrap items-center gap-4"},O={key:0,class:"flex space-x-2"},G=["value"],H={class:"bg-white shadow overflow-hidden sm:rounded-lg mb-6"},J={class:"border-t border-gray-200"},K={class:"grid grid-cols-1 md:grid-cols-3 divide-y md:divide-y-0 md:divide-x divide-gray-200"},Q={class:"px-4 py-5 sm:px-6"},W={class:"mt-1 text-3xl font-semibold text-gray-900"},X={class:"mt-1 text-sm text-gray-500"},Y={class:"px-4 py-5 sm:px-6"},Z={class:"mt-1 text-3xl font-semibold text-green-600"},q={class:"mt-1 text-sm text-gray-500"},ee={class:"px-4 py-5 sm:px-6"},te={class:"mt-1 text-3xl font-semibold text-gray-900"},se={class:"mt-1 text-sm text-gray-500"},ae={class:"bg-white shadow overflow-hidden sm:rounded-lg mb-6"},oe={class:"px-4 py-5 sm:px-6 flex justify-between items-center"},ne={class:"border-t border-gray-200"},re={role:"list",class:"divide-y divide-gray-200"},le={class:"flex items-center justify-between"},de={class:"text-sm font-medium text-primary-600 truncate"},ie={class:"text-sm text-gray-500"},ce={class:"bg-white shadow overflow-hidden sm:rounded-lg"},ue={class:"border-t border-gray-200"},me={class:"overflow-x-auto"},pe={class:"min-w-full divide-y divide-gray-200"},xe={class:"bg-white divide-y divide-gray-200"},ve={class:"px-6 py-4 whitespace-nowrap"},ge={class:"text-sm font-medium text-gray-900"},ye={class:"px-6 py-4 whitespace-nowrap text-center"},fe={class:"text-sm text-gray-900"},be={class:"px-6 py-4 whitespace-nowrap text-center"},he={class:"text-sm text-gray-900"},_e={class:"px-6 py-4 whitespace-nowrap text-center"},we={class:"text-sm text-gray-900"},De={class:"px-6 py-4 whitespace-nowrap text-center"},Se={__name:"Analytics",setup(ke){const m=c(!0),i=c(null),h=c([]),a=c({dateRange:"30",startDate:"",endDate:"",location:""}),r=c({revenue:{total:0,change:0},profit:{total:0,change:0},margin:{total:0,change:0}}),p=c({low_stock_count:0,items:[]}),_=c({products:[]}),k=s=>s<=0?"bg-red-100 text-red-800":s<=3?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800",R=s=>s>10?"bg-green-100 text-green-800":s<-10?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800",F=s=>`${s>=0?"+":""}${s.toFixed(1)}%`,S=async()=>{try{const s=await g.getLocations();h.value=s.data}catch(s){console.error("Error fetching locations:",s)}},L=async()=>{try{const s={days:a.value.dateRange!=="custom"?a.value.dateRange:void 0,start_date:a.value.dateRange==="custom"?a.value.startDate:void 0,end_date:a.value.dateRange==="custom"?a.value.endDate:void 0,location:a.value.location||void 0},t=await g.getRevenueProfitData(s);r.value=t.data}catch(s){console.error("Error fetching revenue/profit data:",s),i.value="Failed to load revenue and profit data"}},P=async()=>{try{const s={location:a.value.location||void 0},t=await g.getStockLevels(s);p.value=t.data}catch(s){console.error("Error fetching stock level data:",s),i.value="Failed to load stock level data"}},C=async()=>{try{const s={days:a.value.dateRange!=="custom"?a.value.dateRange:void 0,start_date:a.value.dateRange==="custom"?a.value.startDate:void 0,end_date:a.value.dateRange==="custom"?a.value.endDate:void 0,location:a.value.location||void 0},t=await g.getDemandAnalysis(s);_.value=t.data}catch(s){console.error("Error fetching demand analysis data:",s),i.value="Failed to load demand analysis data"}},x=async()=>{m.value=!0,i.value=null;try{if(a.value.dateRange==="custom"&&(!a.value.startDate||!a.value.endDate)){const s=new Date,t=new Date(s);t.setDate(s.getDate()-30),a.value.endDate||(a.value.endDate=s.toISOString().split("T")[0]),a.value.startDate||(a.value.startDate=t.toISOString().split("T")[0])}await Promise.all([L(),P(),C()])}catch(s){console.error("Error refreshing data:",s),i.value="Failed to refresh analytics data"}finally{m.value=!1}};return E(async()=>{try{await S(),await x()}catch(s){console.error("Error initializing analytics:",s),i.value="Failed to load analytics data"}finally{m.value=!1}}),(s,t)=>(d(),l("div",null,[t[22]||(t[22]=e("h1",{class:"text-2xl font-semibold text-gray-900 mb-6"},"Analytics",-1)),m.value?(d(),l("div",$,t[4]||(t[4]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))):i.value?(d(),l("div",U,[e("div",M,[t[5]||(t[5]=e("div",{class:"flex-shrink-0"},[e("span",{class:"text-red-400"},"âš ")],-1)),e("div",N,[e("p",j,n(i.value),1)])])])):(d(),l("div",B,[e("div",z,[e("div",I,[e("div",null,[t[7]||(t[7]=e("label",{for:"dateRange",class:"block text-sm font-medium text-gray-700 mb-1"},"Date Range",-1)),v(e("select",{id:"dateRange","onUpdate:modelValue":t[0]||(t[0]=o=>a.value.dateRange=o),class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",onChange:x},t[6]||(t[6]=[A('<option value="7">Last 7 days</option><option value="30">Last 30 days</option><option value="90">Last 90 days</option><option value="365">Last 12 months</option><option value="custom">Custom range</option>',5)]),544),[[w,a.value.dateRange]])]),a.value.dateRange==="custom"?(d(),l("div",O,[e("div",null,[t[8]||(t[8]=e("label",{for:"startDate",class:"block text-sm font-medium text-gray-700 mb-1"},"Start Date",-1)),v(e("input",{type:"date",id:"startDate","onUpdate:modelValue":t[1]||(t[1]=o=>a.value.startDate=o),class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm"},null,512),[[D,a.value.startDate]])]),e("div",null,[t[9]||(t[9]=e("label",{for:"endDate",class:"block text-sm font-medium text-gray-700 mb-1"},"End Date",-1)),v(e("input",{type:"date",id:"endDate","onUpdate:modelValue":t[2]||(t[2]=o=>a.value.endDate=o),class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm"},null,512),[[D,a.value.endDate]])])])):V("",!0),e("div",null,[t[11]||(t[11]=e("label",{for:"location",class:"block text-sm font-medium text-gray-700 mb-1"},"Location",-1)),v(e("select",{id:"location","onUpdate:modelValue":t[3]||(t[3]=o=>a.value.location=o),class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",onChange:x},[t[10]||(t[10]=e("option",{value:""},"All Locations",-1)),(d(!0),l(y,null,f(h.value,o=>(d(),l("option",{key:o.id,value:o.id},n(o.name),9,G))),128))],544),[[w,a.value.location]])]),e("div",{class:"self-end ml-auto mt-4"},[e("button",{type:"button",onClick:x,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Apply Filters ")])])]),e("div",H,[t[18]||(t[18]=e("div",{class:"px-4 py-5 sm:px-6"},[e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Revenue & Profit"),e("p",{class:"mt-1 max-w-2xl text-sm text-gray-500"}," Financial performance for the selected period ")],-1)),e("div",J,[e("div",K,[e("div",Q,[t[13]||(t[13]=e("div",{class:"text-sm font-medium text-gray-500"},"Total Revenue",-1)),e("div",W,"$"+n(r.value.revenue.total.toFixed(2)),1),e("div",X,[e("span",{class:u(r.value.revenue.change>=0?"text-green-600":"text-red-600")},n(r.value.revenue.change>=0?"+":"")+n(r.value.revenue.change.toFixed(1))+"% ",3),t[12]||(t[12]=b(" vs previous period "))])]),e("div",Y,[t[15]||(t[15]=e("div",{class:"text-sm font-medium text-gray-500"},"Total Profit",-1)),e("div",Z,"$"+n(r.value.profit.total.toFixed(2)),1),e("div",q,[e("span",{class:u(r.value.profit.change>=0?"text-green-600":"text-red-600")},n(r.value.profit.change>=0?"+":"")+n(r.value.profit.change.toFixed(1))+"% ",3),t[14]||(t[14]=b(" vs previous period "))])]),e("div",ee,[t[17]||(t[17]=e("div",{class:"text-sm font-medium text-gray-500"},"Profit Margin",-1)),e("div",te,n(r.value.margin.total.toFixed(1))+"%",1),e("div",se,[e("span",{class:u(r.value.margin.change>=0?"text-green-600":"text-red-600")},n(r.value.margin.change>=0?"+":"")+n(r.value.margin.change.toFixed(1))+"% ",3),t[16]||(t[16]=b(" vs previous period "))])])])])]),e("div",ae,[e("div",oe,[t[19]||(t[19]=e("div",null,[e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Stock Levels"),e("p",{class:"mt-1 max-w-2xl text-sm text-gray-500"}," Current inventory levels across machines ")],-1)),e("span",{class:u(["inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium",p.value.low_stock_count>0?"bg-red-100 text-red-800":"bg-green-100 text-green-800"])},n(p.value.low_stock_count)+" items low stock ",3)]),e("div",ne,[e("ul",re,[(d(!0),l(y,null,f(p.value.items,(o,T)=>(d(),l("li",{key:T,class:"px-4 py-4 sm:px-6"},[e("div",le,[e("div",null,[e("p",de,n(o.product_name),1),e("p",ie,n(o.machine_name)+" at "+n(o.location_name),1)]),e("div",null,[e("span",{class:u(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",k(o.current_stock)])}," Stock: "+n(o.current_stock),3)])])]))),128))])])]),e("div",ce,[t[21]||(t[21]=e("div",{class:"px-4 py-5 sm:px-6"},[e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Product Demand Analysis"),e("p",{class:"mt-1 max-w-2xl text-sm text-gray-500"}," Sales performance by product ")],-1)),e("div",ue,[e("div",me,[e("table",pe,[t[20]||(t[20]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Product "),e("th",{scope:"col",class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Units Sold "),e("th",{scope:"col",class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Revenue "),e("th",{scope:"col",class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Profit "),e("th",{scope:"col",class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Trend ")])],-1)),e("tbody",xe,[(d(!0),l(y,null,f(_.value.products,o=>(d(),l("tr",{key:o.product_id},[e("td",ve,[e("div",ge,n(o.product_name),1)]),e("td",ye,[e("div",fe,n(o.units_sold),1)]),e("td",be,[e("div",he,"$"+n(o.revenue.toFixed(2)),1)]),e("td",_e,[e("div",we,"$"+n(o.profit.toFixed(2)),1)]),e("td",De,[e("span",{class:u(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",R(o.trend)])},n(F(o.trend)),3)])]))),128))])])])])])]))]))}};export{Se as default};
