import{u as ve}from"./useMachines-6354BgwE.js";import{a as $}from"./api-CdhKsZ7p.js";import{r as y,q as xe,c as i,o as n,b as e,w as x,v as S,F as P,e as C,t as p,f as M,i as j,n as he,l as Q,m as E,g as be,h as U,j as we,u as f}from"./index-DV-V0oJl.js";function ke(){const s=y([]),d=y([]),t=y(!1),o=y(null),r=y({product:"",price:"",slot:""}),a=xe(()=>{const l=d.value.map(m=>m.product);return s.value.filter(m=>!l.includes(m.id))}),F=async()=>{try{const l=await $.getProducts();s.value=l.data}catch(l){console.error("Error fetching products:",l),o.value="Failed to load products. Please try again."}},w=async l=>{t.value=!0,o.value=null;try{const m={machine:l},v=await $.getMachineItems(m);if(v&&v.data){const N=v.data.filter(b=>b.machine==l);d.value=N.map(b=>({...b,editing:!1,editingSlot:!1,newPrice:b.price,newSlot:b.slot,price:typeof b.price=="string"?parseFloat(b.price):b.price}))}}catch(m){console.error("Error fetching machine products:",m),o.value="Failed to load machine products. Please try again."}finally{t.value=!1}};return{allProducts:s,machineProducts:d,loading:t,error:o,productForm:r,availableProducts:a,fetchAllProducts:F,fetchMachineProducts:w,addProductToMachine:async l=>{o.value=null;try{const m={machine:l,product:parseInt(r.value.product),price:parseFloat(r.value.price),slot:parseInt(r.value.slot)};return await $.createMachineItem(m),r.value={product:"",price:"",slot:""},await w(l),!0}catch(m){return console.error("Error adding product to machine:",m),m.response&&m.response.data?o.value=`Failed to add product: ${JSON.stringify(m.response.data)}`:o.value="Failed to add product to machine. Please try again.",!1}},updateProductPrice:async(l,m)=>{o.value=null;try{return await $.updateMachineItem(l.id,{machine:m,product:l.product,price:parseFloat(l.newPrice),slot:l.slot}),l.price=parseFloat(l.newPrice),l.editing=!1,await w(m),!0}catch(v){return console.error("Error updating product price:",v),o.value="Failed to update product price. Please try again.",!1}},updateProductSlot:async(l,m)=>{o.value=null;try{return await $.updateMachineItem(l.id,{machine:m,product:l.product,price:l.price,slot:parseInt(l.newSlot)}),l.slot=parseInt(l.newSlot),l.editingSlot=!1,await w(m),!0}catch(v){return console.error("Error updating product slot:",v),o.value="Failed to update product slot. Please try again.",v.response&&v.response.data&&v.response.data.non_field_errors&&(o.value=v.response.data.non_field_errors[0]),!1}},removeProductFromMachine:async(l,m)=>{try{return await $.deleteMachineItem(l.id),await w(m),!0}catch(v){return console.error("Error removing product from machine:",v),o.value="Failed to remove product from machine. Please try again.",!1}},editProductPrice:l=>{l.editing=!0,l.newPrice=l.price},editProductSlot:l=>{l.editingSlot=!0,l.newSlot=l.slot},resetState:()=>{d.value=[],r.value={product:"",price:"",slot:""},o.value=null},clearError:()=>{o.value=null}}}function $e(){const s=y([]),d=y([]),t=y({}),o=y({}),r=y({location:"",machineType:"",route:""});return{locations:s,availableRoutes:d,locationInfo:t,locationNames:o,filters:r,fetchLocations:async()=>{try{const g=await $.getLocations();s.value=g.data,g.data.forEach(k=>{o.value[k.id]=k.name,t.value[k.id]=k})}catch(g){console.error("Error fetching locations:",g)}},fetchRoutes:async()=>{try{const g=await $.getRoutes();d.value=g.data.routes}catch(g){console.error("Error fetching routes:",g)}},resetFilters:()=>{r.value={location:"",machineType:"",route:""}},openMapForLocation:g=>{if(!g||!g.address)return;const q=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(g.address)}`;window.open(q,"_blank")}}}const Me={class:"bg-white p-5 shadow-lg rounded-xl mb-6"},Pe={class:"flex flex-wrap items-center gap-4"},Ce=["value"],Fe=["value"],Se={class:"self-end ml-auto mt-4"},Ae={__name:"MachineFilters",props:{filters:{type:Object,required:!0},locations:{type:Array,required:!0},availableRoutes:{type:Array,required:!0}},emits:["filter-change"],setup(s){return(d,t)=>(n(),i("div",Me,[e("div",Pe,[e("div",null,[t[8]||(t[8]=e("label",{for:"locationFilter",class:"block text-sm font-medium text-gray-700 mb-1"},"Location",-1)),x(e("select",{id:"locationFilter","onUpdate:modelValue":t[0]||(t[0]=o=>s.filters.location=o),class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",onChange:t[1]||(t[1]=o=>d.$emit("filter-change"))},[t[7]||(t[7]=e("option",{value:""},"All Locations",-1)),(n(!0),i(P,null,C(s.locations,o=>(n(),i("option",{key:o.id,value:o.id},p(o.name),9,Ce))),128))],544),[[S,s.filters.location]])]),e("div",null,[t[10]||(t[10]=e("label",{for:"typeFilter",class:"block text-sm font-medium text-gray-700 mb-1"},"Machine Type",-1)),x(e("select",{id:"typeFilter","onUpdate:modelValue":t[2]||(t[2]=o=>s.filters.machineType=o),class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",onChange:t[3]||(t[3]=o=>d.$emit("filter-change"))},t[9]||(t[9]=[e("option",{value:""},"All Types",-1),e("option",{value:"Snack"},"Snack",-1),e("option",{value:"Soda"},"Soda",-1),e("option",{value:"Combo"},"Combo",-1)]),544),[[S,s.filters.machineType]])]),e("div",null,[t[13]||(t[13]=e("label",{for:"routeFilter",class:"block text-sm font-medium text-gray-700 mb-1"},"Route",-1)),x(e("select",{id:"routeFilter","onUpdate:modelValue":t[4]||(t[4]=o=>s.filters.route=o),class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm",onChange:t[5]||(t[5]=o=>d.$emit("filter-change"))},[t[11]||(t[11]=e("option",{value:""},"All Routes",-1)),t[12]||(t[12]=e("option",{value:"unassigned"},"Unassigned",-1)),(n(!0),i(P,null,C(s.availableRoutes,o=>(n(),i("option",{key:o,value:o},p(o),9,Fe))),128))],544),[[S,s.filters.route]])]),e("div",Se,[e("button",{type:"button",onClick:t[6]||(t[6]=o=>d.$emit("filter-change")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-150"},t[14]||(t[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})],-1),M(" Apply Filters ")]))])])]))}},je={class:"space-y-6"},Ve={class:"px-6 py-4 bg-gray-50 border-b border-gray-200 flex justify-between items-center"},Ee={class:"text-lg font-medium text-gray-900"},qe={class:"text-sm text-gray-500"},_e=["onClick"],Le={role:"list",class:"divide-y divide-gray-200"},Be={class:"flex items-center justify-between"},Ue={class:"flex items-center"},Te={class:"text-sm font-medium text-primary-600"},Ne={key:0,class:"text-sm text-gray-500 mt-1"},ze={key:1,class:"text-sm text-primary-600 mt-1"},Re={class:"inline-flex items-center"},Oe={class:"text-sm text-gray-500 mt-1"},He={key:0,class:"text-primary-600 font-medium"},De={key:1,class:"text-gray-400 italic"},Ie={class:"flex space-x-2"},Ge=["onClick"],Je=["onClick"],Ke=["onClick"],Qe={__name:"MachineList",props:{groupedMachines:{type:Object,required:!0},locationNames:{type:Object,required:!0},locationInfo:{type:Object,required:!0}},emits:["open-map","edit-machine","manage-products","confirm-delete"],setup(s){return(d,t)=>(n(),i("div",je,[(n(!0),i(P,null,C(s.groupedMachines,(o,r)=>(n(),i("div",{key:r,class:"bg-white shadow-lg rounded-xl overflow-hidden"},[e("div",Ve,[e("div",null,[e("h2",Ee,p(s.locationNames[r]),1),e("p",qe,p(o.length)+" machines",1)]),e("button",{onClick:a=>d.$emit("open-map",s.locationInfo[r]),class:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-150"},t[0]||(t[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1),M(" View on Maps ")]),8,_e)]),e("ul",Le,[(n(!0),i(P,null,C(o,a=>(n(),i("li",{key:a.id,class:"px-6 py-5 hover:bg-gray-50 transition-colors duration-150"},[e("div",Be,[e("div",null,[e("div",Ue,[e("p",Te,p(a.name),1),e("span",{class:he(["ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",{"bg-blue-100 text-blue-800":a.machine_type==="Soda","bg-green-100 text-green-800":a.machine_type==="Snack","bg-purple-100 text-purple-800":a.machine_type==="Combo"}])},p(a.machine_type),3)]),a.model?(n(),i("p",Ne,"Model: "+p(a.model),1)):j("",!0),a.route?(n(),i("p",ze,[e("span",Re,[t[1]||(t[1]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1 text-primary-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})],-1)),M(" Route: "+p(a.route),1)])])):j("",!0),e("p",Oe,[a.product_count?(n(),i("span",He,p(a.product_count)+" products",1)):(n(),i("span",De,"No products"))])]),e("div",Ie,[e("button",{onClick:F=>d.$emit("edit-machine",a),class:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-150"},t[2]||(t[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),M(" Edit ")]),8,Ge),e("button",{onClick:F=>d.$emit("manage-products",a),class:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-150"},t[3]||(t[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})],-1),M(" Products ")]),8,Je),e("button",{onClick:F=>d.$emit("confirm-delete",a),class:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-red-50 hover:text-red-700 hover:border-red-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-150"},t[4]||(t[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),M(" Delete ")]),8,Ke)])])]))),128))])]))),128))]))}},We={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Xe={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Ye={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Ze={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},et={class:"sm:flex sm:items-start"},tt={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},ot={class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"},st={class:"mt-4 space-y-4"},rt=["value"],nt=["value"],it={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},lt={type:"submit",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm"},at={__name:"MachineModal",props:{show:{type:Boolean,required:!0},isEditing:{type:Boolean,required:!0},machineForm:{type:Object,required:!0},locations:{type:Array,required:!0},machineModels:{type:Array,required:!0}},emits:["close","save"],setup(s){return(d,t)=>s.show?(n(),i("div",We,[e("div",Xe,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=o=>d.$emit("close"))}),t[14]||(t[14]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Ye,[e("form",{onSubmit:t[6]||(t[6]=Q(o=>d.$emit("save",s.machineForm),["prevent"]))},[e("div",Ze,[e("div",et,[e("div",tt,[e("h3",ot,p(s.isEditing?"Edit Machine":"Add New Machine"),1),e("div",st,[e("div",null,[t[7]||(t[7]=e("label",{for:"name",class:"block text-sm font-medium text-gray-700"},"Machine Name",-1)),x(e("input",{type:"text",name:"name",id:"name","onUpdate:modelValue":t[1]||(t[1]=o=>s.machineForm.name=o),placeholder:"e.g. Building A Snack Machine",class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md",required:""},null,512),[[E,s.machineForm.name]])]),e("div",null,[t[9]||(t[9]=e("label",{for:"location",class:"block text-sm font-medium text-gray-700"},"Location",-1)),x(e("select",{id:"location",name:"location","onUpdate:modelValue":t[2]||(t[2]=o=>s.machineForm.location=o),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},[t[8]||(t[8]=e("option",{value:"",disabled:""},"Select a location",-1)),(n(!0),i(P,null,C(s.locations,o=>(n(),i("option",{key:o.id,value:o.id},p(o.name),9,rt))),128))],512),[[S,s.machineForm.location]])]),e("div",null,[t[11]||(t[11]=e("label",{for:"machine_type",class:"block text-sm font-medium text-gray-700"},"Machine Type",-1)),x(e("select",{id:"machine_type",name:"machine_type","onUpdate:modelValue":t[3]||(t[3]=o=>s.machineForm.machine_type=o),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},t[10]||(t[10]=[e("option",{value:"",disabled:""},"Select a machine type",-1),e("option",{value:"Snack"},"Snack",-1),e("option",{value:"Soda"},"Soda",-1),e("option",{value:"Combo"},"Combo",-1)]),512),[[S,s.machineForm.machine_type]])]),e("div",null,[t[13]||(t[13]=e("label",{for:"model",class:"block text-sm font-medium text-gray-700"},"Model (Optional)",-1)),x(e("select",{id:"model",name:"model","onUpdate:modelValue":t[4]||(t[4]=o=>s.machineForm.model=o),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md"},[t[12]||(t[12]=e("option",{value:""},"Select a model (optional)",-1)),(n(!0),i(P,null,C(s.machineModels,o=>(n(),i("option",{key:o,value:o},p(o),9,nt))),128))],512),[[S,s.machineForm.model]])])])])])]),e("div",it,[e("button",lt,p(s.isEditing?"Update":"Add"),1),e("button",{type:"button",onClick:t[5]||(t[5]=o=>d.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])],32)])])])):j("",!0)}},dt={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},ut={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},ct={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},mt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},pt={class:"sm:flex sm:items-start"},ft={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},yt={class:"mt-2"},gt={class:"text-sm text-gray-500"},vt={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},xt={__name:"DeleteConfirmationModal",props:{show:{type:Boolean,required:!0},machineToDelete:{type:Object,default:null}},emits:["close","confirm"],setup(s){return(d,t)=>{var o,r;return s.show?(n(),i("div",dt,[e("div",ut,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=a=>d.$emit("close"))}),t[5]||(t[5]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",ct,[e("div",mt,[e("div",pt,[t[4]||(t[4]=e("div",{class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"},[e("svg",{class:"h-6 w-6 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),e("div",ft,[t[3]||(t[3]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Delete Machine ",-1)),e("div",yt,[e("p",gt," Are you sure you want to delete the "+p((o=s.machineToDelete)==null?void 0:o.name)+" ("+p((r=s.machineToDelete)==null?void 0:r.machine_type)+")? This action cannot be undone. ",1)])])])]),e("div",vt,[e("button",{type:"button",onClick:t[1]||(t[1]=a=>d.$emit("confirm")),class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"}," Delete "),e("button",{type:"button",onClick:t[2]||(t[2]=a=>d.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])])])])):j("",!0)}}},ht={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},bt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},wt={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-3xl sm:w-full"},kt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},$t={class:"sm:flex sm:items-start"},Mt={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},Pt={class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"},Ct={class:"mt-4"},Ft={class:"bg-gray-50 rounded-lg p-4 mb-4"},St={key:0,class:"mb-4 bg-red-50 border-l-4 border-red-400 p-4 rounded-r-lg"},At={class:"flex"},jt={class:"ml-3"},Vt={class:"text-sm text-red-700"},Et={class:"sm:col-span-6"},qt=["value"],_t={class:"sm:col-span-2"},Lt={class:"sm:col-span-2"},Bt={class:"mt-1 relative rounded-md shadow-sm"},Ut={key:0,class:"border border-gray-200 rounded-md overflow-hidden"},Tt={class:"overflow-x-auto -mx-4 sm:mx-0"},Nt={class:"inline-block min-w-full align-middle"},zt={class:"min-w-full divide-y divide-gray-200"},Rt={class:"bg-white divide-y divide-gray-200"},Ot={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Ht={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Dt={class:"flex items-center"},It={key:0},Gt={class:"relative rounded-md shadow-sm"},Jt=["onUpdate:modelValue"],Kt={key:1},Qt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Wt={class:"flex items-center"},Xt={key:0},Yt={class:"relative rounded-md shadow-sm"},Zt=["onUpdate:modelValue"],eo={key:1},to={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},oo={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2"},so=["onClick"],ro=["onClick"],no=["onClick"],io=["onClick"],lo=["onClick"],ao={key:1,class:"text-center p-6 bg-gray-50 rounded-md"},uo={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},co={__name:"MachineProductsModal",props:{show:{type:Boolean,required:!0},selectedMachine:{type:Object,default:null},machineProducts:{type:Array,required:!0},availableProducts:{type:Array,required:!0},productForm:{type:Object,required:!0},error:{type:String,default:null}},emits:["close","add-product","edit-price","update-price","edit-slot","update-slot","remove-product"],setup(s){return(d,t)=>{var o;return s.show?(n(),i("div",ht,[e("div",bt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=r=>d.$emit("close"))}),t[17]||(t[17]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",wt,[e("div",kt,[e("div",$t,[e("div",Mt,[e("h3",Pt," Manage Products for "+p((o=s.selectedMachine)==null?void 0:o.name),1),e("div",Ct,[e("div",Ft,[t[13]||(t[13]=e("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Add Product to Machine",-1)),s.error?(n(),i("div",St,[e("div",At,[t[6]||(t[6]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])],-1)),e("div",jt,[e("p",Vt,p(s.error),1)])])])):j("",!0),e("form",{onSubmit:t[4]||(t[4]=Q(r=>d.$emit("add-product"),["prevent"])),class:"grid grid-cols-1 gap-y-3 sm:grid-cols-12 sm:gap-x-3"},[e("div",Et,[t[8]||(t[8]=e("label",{for:"product",class:"block text-xs font-medium text-gray-700"},"Product",-1)),x(e("select",{id:"product","onUpdate:modelValue":t[1]||(t[1]=r=>s.productForm.product=r),class:"mt-1 block w-full pl-3 pr-10 py-2 text-sm border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 rounded-md",required:""},[t[7]||(t[7]=e("option",{value:"",disabled:""},"Select a product",-1)),(n(!0),i(P,null,C(s.availableProducts,r=>(n(),i("option",{key:r.id,value:r.id},p(r.name),9,qt))),128))],512),[[S,s.productForm.product]])]),e("div",_t,[t[9]||(t[9]=e("label",{for:"slot",class:"block text-xs font-medium text-gray-700"},"Slot #",-1)),x(e("input",{type:"number",id:"slot",min:"1","onUpdate:modelValue":t[2]||(t[2]=r=>s.productForm.slot=r),placeholder:"1",class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full py-2 px-3 sm:text-sm border-gray-300 rounded-md",required:""},null,512),[[E,s.productForm.slot]])]),e("div",Lt,[t[11]||(t[11]=e("label",{for:"price",class:"block text-xs font-medium text-gray-700"},"Price",-1)),e("div",Bt,[t[10]||(t[10]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 sm:text-sm"},"$")],-1)),x(e("input",{type:"number",id:"price",step:"0.01",min:"0.01","onUpdate:modelValue":t[3]||(t[3]=r=>s.productForm.price=r),placeholder:"0.00",class:"focus:ring-primary-500 focus:border-primary-500 block w-full pl-7 pr-3 py-2 sm:text-sm border-gray-300 rounded-md",required:""},null,512),[[E,s.productForm.price]])])]),t[12]||(t[12]=e("div",{class:"sm:col-span-2 flex items-end"},[e("button",{type:"submit",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-sm font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Add ")],-1))],32)]),s.machineProducts.length>0?(n(),i("div",Ut,[e("div",Tt,[e("div",Nt,[e("table",zt,[t[15]||(t[15]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Product "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Slot "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Price "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Current Stock "),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",Rt,[(n(!0),i(P,null,C(s.machineProducts,r=>(n(),i("tr",{key:r.id},[e("td",Ot,p(r.product_name),1),e("td",Ht,[e("div",Dt,[r.editingSlot?(n(),i("span",It,[e("div",Gt,[x(e("input",{type:"number",min:"1","onUpdate:modelValue":a=>r.newSlot=a,class:"focus:ring-primary-500 focus:border-primary-500 block w-full py-1 px-3 sm:text-sm border-gray-300 rounded-md"},null,8,Jt),[[E,r.newSlot]])])])):(n(),i("span",Kt,p(r.slot),1))])]),e("td",Qt,[e("div",Wt,[r.editing?(n(),i("span",Xt,[e("div",Yt,[t[14]||(t[14]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 sm:text-sm"},"$")],-1)),x(e("input",{type:"number",step:"0.01",min:"0.01","onUpdate:modelValue":a=>r.newPrice=a,class:"focus:ring-primary-500 focus:border-primary-500 block w-full pl-7 pr-3 py-1 sm:text-sm border-gray-300 rounded-md"},null,8,Zt),[[E,r.newPrice]])])])):(n(),i("span",eo,"$"+p(typeof r.price=="number"?r.price.toFixed(2):Number(r.price).toFixed(2)),1))])]),e("td",to,p(r.current_stock||"Not set"),1),e("td",oo,[r.editingSlot?(n(),i("button",{key:0,onClick:a=>d.$emit("update-slot",r),class:"text-primary-600 hover:text-primary-900"}," Save Slot ",8,so)):(n(),i("button",{key:1,onClick:a=>d.$emit("edit-slot",r),class:"text-primary-600 hover:text-primary-900"}," Edit Slot ",8,ro)),r.editing?(n(),i("button",{key:2,onClick:a=>d.$emit("update-price",r),class:"text-primary-600 hover:text-primary-900"}," Save Price ",8,no)):(n(),i("button",{key:3,onClick:a=>d.$emit("edit-price",r),class:"text-primary-600 hover:text-primary-900"}," Edit Price ",8,io)),e("button",{onClick:a=>d.$emit("remove-product",r),class:"text-red-600 hover:text-red-900"}," Remove ",8,lo)])]))),128))])])])])])):(n(),i("div",ao,t[16]||(t[16]=[e("p",{class:"text-sm text-gray-500"},"No products added to this machine yet.",-1)])))])])])]),e("div",uo,[e("button",{type:"button",onClick:t[5]||(t[5]=r=>d.$emit("close")),class:"w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm"}," Close ")])])])])):j("",!0)}}},mo={key:0,class:"flex justify-center py-20"},po={key:1,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-6 rounded-r-lg shadow-sm"},fo={class:"flex"},yo={class:"ml-3"},go={class:"text-sm text-red-700"},vo={key:2,class:"bg-white shadow-lg rounded-xl overflow-hidden"},ko={__name:"Machines",setup(s){const{loading:d,error:t,machineModels:o,groupedMachines:r,fetchMachines:a,createMachine:F,updateMachine:w,deleteMachine:T,clearError:g}=ve(),{machineProducts:k,productForm:q,availableProducts:O,error:H,fetchAllProducts:D,fetchMachineProducts:I,addProductToMachine:l,updateProductPrice:m,updateProductSlot:v,removeProductFromMachine:N,editProductPrice:b,editProductSlot:W,resetState:G}=ke(),{locations:J,availableRoutes:X,locationInfo:Y,locationNames:Z,filters:A,fetchLocations:ee,fetchRoutes:te,openMapForLocation:oe}=$e(),V=y(!1),_=y(!1),z=y(!1),L=y(!1),B=y(null),h=y(null),R=y({id:null,name:"",location:"",machine_type:"",model:""}),se=()=>{a(A.value)},K=()=>{L.value=!1,R.value={id:null,name:"",location:"",machine_type:"",model:""},V.value=!0},re=u=>{L.value=!0,R.value={id:u.id,name:u.name,location:u.location,machine_type:u.machine_type,model:u.model},V.value=!0},ne=()=>{V.value=!1,g()},ie=async u=>{let c=!1;L.value?c=await w(u.id,u):c=await F(u),c&&(V.value=!1,await a(A.value))},le=u=>{B.value=u,_.value=!0},ae=async()=>{if(!B.value)return;await T(B.value.id)&&(_.value=!1,await a(A.value))},de=async u=>{h.value=u,G();try{await D(),await I(u.id),z.value=!0}catch(c){console.error("Error opening products modal:",c)}},ue=()=>{z.value=!1,G(),h.value=null},ce=async()=>{if(!h.value)return;await l(h.value.id)&&await a(A.value)},me=u=>{b(u)},pe=async u=>{h.value&&await m(u,h.value.id)},fe=u=>{W(u)},ye=async u=>{h.value&&await v(u,h.value.id)},ge=async u=>{if(!confirm(`Are you sure you want to remove ${u.product_name} from this machine?`)||!h.value)return;await N(u,h.value.id)&&await a(A.value)};return be(async()=>{await Promise.all([ee(),te()]),await a()}),(u,c)=>(n(),i("div",null,[e("div",{class:"flex justify-between items-center mb-6"},[c[2]||(c[2]=e("h1",{class:"text-2xl font-bold text-gray-900"},"Machines",-1)),e("button",{onClick:K,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-150"},c[1]||(c[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),M(" Add Machine ")]))]),U(Ae,{filters:f(A),locations:f(J),"available-routes":f(X),onFilterChange:se},null,8,["filters","locations","available-routes"]),f(d)?(n(),i("div",mo,c[3]||(c[3]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))):f(t)?(n(),i("div",po,[e("div",fo,[c[4]||(c[4]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])],-1)),e("div",yo,[e("p",go,p(f(t)),1)])])])):Object.keys(f(r)).length===0?(n(),i("div",vo,[e("div",{class:"px-6 py-8 text-center"},[c[6]||(c[6]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 mx-auto text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"})],-1)),c[7]||(c[7]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900 mb-2"},"No machines found",-1)),c[8]||(c[8]=e("div",{class:"mt-2 max-w-xl text-sm text-gray-500 mx-auto mb-6"},[e("p",null,"Get started by adding your first machine.")],-1)),e("button",{onClick:K,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-150"},c[5]||(c[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),M(" Add Machine ")]))])])):(n(),we(Qe,{key:3,"grouped-machines":f(r),"location-names":f(Z),"location-info":f(Y),onOpenMap:f(oe),onEditMachine:re,onManageProducts:de,onConfirmDelete:le},null,8,["grouped-machines","location-names","location-info","onOpenMap"])),U(at,{show:V.value,"is-editing":L.value,"machine-form":R.value,locations:f(J),"machine-models":f(o),onClose:ne,onSave:ie},null,8,["show","is-editing","machine-form","locations","machine-models"]),U(xt,{show:_.value,"machine-to-delete":B.value,onClose:c[0]||(c[0]=xo=>_.value=!1),onConfirm:ae},null,8,["show","machine-to-delete"]),U(co,{show:z.value,"selected-machine":h.value,"machine-products":f(k),"available-products":f(O),"product-form":f(q),error:f(H),onClose:ue,onAddProduct:ce,onEditPrice:me,onUpdatePrice:pe,onEditSlot:fe,onUpdateSlot:ye,onRemoveProduct:ge},null,8,["show","selected-machine","machine-products","available-products","product-form","error"])]))}};export{ko as default};
