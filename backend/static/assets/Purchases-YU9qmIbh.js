import{r as d,g as q,o as A,c as l,a as e,h as P,t as n,F as S,d as F,i as B,w as c,v as D,j as y,b as L,f as i}from"./index-Co3GJSwP.js";import{a as p}from"./api-BtPiiZ-L.js";const z={key:0,class:"flex justify-center"},I={key:1,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-4"},O={class:"flex"},Q={class:"ml-3"},W={class:"text-sm text-red-700"},G={key:2,class:"bg-white shadow overflow-hidden sm:rounded-lg"},J={key:3,class:"bg-white shadow overflow-hidden sm:rounded-lg"},R={role:"list",class:"divide-y divide-gray-200"},Y={class:"flex items-center justify-between"},H={class:"flex items-center"},K={class:"text-sm font-medium text-primary-600"},X={class:"ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800"},Z={class:"ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"},tt={class:"mt-1"},et={class:"text-sm text-gray-500"},st={class:"text-sm text-gray-500"},ot={class:"flex space-x-2"},at=["onClick"],rt=["onClick"],lt={key:4,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},nt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},it={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},dt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},ut={class:"sm:flex sm:items-start"},mt={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},ct={class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"},pt={class:"mt-4 space-y-4"},ft=["value"],gt={class:"grid grid-cols-2 gap-4"},vt={class:"grid grid-cols-1 gap-4"},yt={class:"bg-gray-50 p-3 rounded-md"},xt={class:"text-lg font-bold text-primary-600"},bt={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},ht={type:"submit",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm"},wt={key:5,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},_t={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},kt={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Ct={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Ft={__name:"Purchases",setup(qt){const x=d([]),k=d([]),b=d(!0),u=d(null),m=d(!1),f=d(!1),g=d(!1),h=d(null),a=d({id:null,product:"",supplier:"",purchase_date:"",quantity:1,total_cost:0,notes:""});q(()=>(parseFloat(a.value.quantity),parseFloat(a.value.total_cost)||0));const $=q(()=>{const s=parseFloat(a.value.quantity)||0,t=parseFloat(a.value.total_cost)||0;return s>0?t/s:0}),j=s=>s?new Date(s).toLocaleDateString():"",w=async()=>{b.value=!0;try{const s=await p.getPurchases();console.log("Purchases data:",s.data),x.value=s.data.map(t=>{const o=t.cost_per_unit||t.unit_cost||(t.total_cost&&t.quantity?t.total_cost/t.quantity:0),r=t.purchase_date||t.purchased_at;return{...t,purchase_date:r,total_cost:t.total_cost||t.cost_per_unit*t.quantity,cost_per_unit:o}})}catch(s){console.error("Error fetching purchases:",s),u.value="Failed to load purchases. Please try again later."}finally{b.value=!1}},U=async()=>{try{const s=await p.getProducts();k.value=s.data}catch(s){console.error("Error fetching products:",s)}},C=()=>{g.value=!1;const s=new Date,t=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0"),r=String(s.getDate()).padStart(2,"0");a.value={id:null,product:"",supplier:"",purchase_date:`${t}-${o}-${r}`,quantity:1,total_cost:0,notes:""},m.value=!0},T=s=>{g.value=!0;const t=s.total_cost||s.cost_per_unit*s.quantity;let o=s.purchased_at||s.purchase_date,r=o?o.split("T")[0]:"";r||(r=new Date().toISOString().split("T")[0]),a.value={id:s.id,product:s.product,supplier:s.supplier||"",purchase_date:r,quantity:s.quantity,total_cost:t,notes:s.notes||""},_(),m.value=!0},M=async()=>{try{const s=parseInt(a.value.quantity)||0,t=parseFloat(a.value.total_cost)||0;if(s<=0){u.value="Quantity must be greater than zero";return}if(t<=0){u.value="Total cost must be greater than zero";return}const o=`${a.value.purchase_date}T12:00:00`,r={product:a.value.product,supplier:a.value.supplier,purchased_at:o,purchase_date:o,quantity:s,total_cost:t,notes:a.value.notes||""};console.log("Saving purchase with data:",r);let v;g.value?v=await p.updatePurchase(a.value.id,r):v=await p.createPurchase(r),console.log("Purchase saved successfully:",v.data);const N=await p.getProduct(a.value.product);console.log("Updated product cost:",N.data.average_cost),m.value=!1,await w()}catch(s){console.error("Error saving purchase:",s),s.response&&s.response.data?(console.error("Server error details:",s.response.data),u.value=`Failed to save purchase: ${JSON.stringify(s.response.data)}`):u.value="Failed to save purchase. Please try again."}},V=s=>{h.value=s,f.value=!0},E=async()=>{if(h.value)try{await p.deletePurchase(h.value.id),f.value=!1,await w()}catch(s){console.error("Error deleting purchase:",s),u.value="Failed to delete purchase. Please try again."}},_=()=>{const s=parseFloat(a.value.quantity)||0,t=parseFloat(a.value.total_cost)||0;s>0?a.value.cost_per_unit=t/s:a.value.cost_per_unit=0};return A(async()=>{await Promise.all([w(),U()])}),(s,t)=>(i(),l("div",null,[e("div",{class:"flex justify-between items-center mb-6"},[t[10]||(t[10]=e("h1",{class:"text-2xl font-semibold text-gray-900"},"Wholesale Purchases",-1)),e("button",{onClick:C,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Add Purchase ")]),b.value?(i(),l("div",z,t[11]||(t[11]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))):u.value?(i(),l("div",I,[e("div",O,[t[12]||(t[12]=e("div",{class:"flex-shrink-0"},[e("span",{class:"text-red-400"},"⚠")],-1)),e("div",Q,[e("p",W,n(u.value),1)])])])):x.value.length===0?(i(),l("div",G,[e("div",{class:"px-4 py-5 sm:p-6 text-center"},[t[13]||(t[13]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"No purchases found",-1)),t[14]||(t[14]=e("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[e("p",null,"Get started by recording your first wholesale purchase.")],-1)),e("div",{class:"mt-5"},[e("button",{onClick:C,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Add Purchase ")])])])):(i(),l("div",J,[e("ul",R,[(i(!0),l(S,null,F(x.value,o=>(i(),l("li",{key:o.id,class:"px-4 py-4 sm:px-6"},[e("div",Y,[e("div",null,[e("div",H,[e("p",K,n(o.product_name),1),e("span",X,n(o.quantity)+" units ",1),e("span",Z,n(o.supplier||"Unknown"),1)]),e("div",tt,[e("p",et," Date: "+n(j(o.purchase_date)),1),e("p",st," Total: $"+n(parseFloat(o.total_cost).toFixed(2))+" | Unit Cost: $"+n(parseFloat(o.cost_per_unit||o.total_cost/o.quantity).toFixed(2)),1)])]),e("div",ot,[e("button",{onClick:r=>T(o),class:"inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Edit ",8,at),e("button",{onClick:r=>V(o),class:"inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," Delete ",8,rt)])])]))),128))])])),m.value?(i(),l("div",lt,[e("div",nt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=o=>m.value=!1)}),t[24]||(t[24]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",it,[e("form",{onSubmit:B(M,["prevent"])},[e("div",dt,[e("div",ut,[e("div",mt,[e("h3",ct,n(g.value?"Edit Purchase":"Add New Purchase"),1),e("div",pt,[e("div",null,[t[16]||(t[16]=e("label",{for:"product",class:"block text-sm font-medium text-gray-700"},"Product",-1)),c(e("select",{id:"product",name:"product","onUpdate:modelValue":t[1]||(t[1]=o=>a.value.product=o),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},[t[15]||(t[15]=e("option",{value:"",disabled:""},"Select a product",-1)),(i(!0),l(S,null,F(k.value,o=>(i(),l("option",{key:o.id,value:o.id},n(o.name),9,ft))),128))],512),[[D,a.value.product]])]),e("div",null,[t[18]||(t[18]=e("label",{for:"supplier",class:"block text-sm font-medium text-gray-700"},"Supplier",-1)),c(e("select",{id:"supplier",name:"supplier","onUpdate:modelValue":t[2]||(t[2]=o=>a.value.supplier=o),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},t[17]||(t[17]=[e("option",{value:"",disabled:""},"Select a supplier",-1),e("option",{value:"Sams"},"Sams",-1),e("option",{value:"Star"},"Star",-1)]),512),[[D,a.value.supplier]])]),e("div",null,[t[19]||(t[19]=e("label",{for:"purchase_date",class:"block text-sm font-medium text-gray-700"},"Purchase Date",-1)),c(e("input",{type:"date",name:"purchase_date",id:"purchase_date","onUpdate:modelValue":t[3]||(t[3]=o=>a.value.purchase_date=o),class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md",required:""},null,512),[[y,a.value.purchase_date]])]),e("div",gt,[e("div",null,[t[20]||(t[20]=e("label",{for:"quantity",class:"block text-sm font-medium text-gray-700"},"Quantity",-1)),c(e("input",{type:"number",name:"quantity",id:"quantity","onUpdate:modelValue":t[4]||(t[4]=o=>a.value.quantity=o),min:"1",onChange:_,class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md",required:""},null,544),[[y,a.value.quantity]])]),e("div",null,[t[21]||(t[21]=e("label",{for:"total_cost",class:"block text-sm font-medium text-gray-700"},"Total Cost ($)",-1)),c(e("input",{type:"number",name:"total_cost",id:"total_cost","onUpdate:modelValue":t[5]||(t[5]=o=>a.value.total_cost=o),min:"0.01",step:"0.01",onChange:_,class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md",required:""},null,544),[[y,a.value.total_cost]])])]),e("div",null,[t[22]||(t[22]=e("label",{for:"notes",class:"block text-sm font-medium text-gray-700"},"Notes",-1)),c(e("textarea",{id:"notes",name:"notes",rows:"3","onUpdate:modelValue":t[6]||(t[6]=o=>a.value.notes=o),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md"},null,512),[[y,a.value.notes]])]),e("div",vt,[e("div",yt,[t[23]||(t[23]=e("div",{class:"text-sm font-medium text-gray-700"},"Unit Cost:",-1)),e("div",xt," $"+n($.value.toFixed(2))+" per unit ",1)])])])])])]),e("div",bt,[e("button",ht,n(g.value?"Update":"Add"),1),e("button",{type:"button",onClick:t[7]||(t[7]=o=>m.value=!1),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])],32)])])])):P("",!0),f.value?(i(),l("div",wt,[e("div",_t,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[8]||(t[8]=o=>f.value=!1)}),t[26]||(t[26]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",kt,[t[25]||(t[25]=L('<div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"><div class="sm:flex sm:items-start"><div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"><svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg></div><div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"><h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title"> Delete Purchase </h3><div class="mt-2"><p class="text-sm text-gray-500"> Are you sure you want to delete this purchase record? This action cannot be undone. </p></div></div></div></div>',1)),e("div",Ct,[e("button",{type:"button",onClick:E,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"}," Delete "),e("button",{type:"button",onClick:t[9]||(t[9]=o=>f.value=!1),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])])])])):P("",!0)]))}};export{Ft as default};
