import{r as $,s as W,c,o as r,b as e,t as d,F as E,e as F,u as w,i as C,w as M,f as D,m as j,l as ne,j as re,d as ae,g as le,h as B}from"./index-Br9KxP_x.js";import{a as k}from"./api-BWnkJ_0u.js";import{u as de}from"./useLocations-Ctos0ZWs.js";import{u as ce}from"./useMachines-uusFUrkT.js";import{g as me,f as O}from"./dateUtils-CXdyRzwD.js";function ue(){const o=$([]),i=$(!1),t=$(null),s=async()=>{i.value=!0,t.value=null;try{const l=await k.getVisits();o.value=l.data.map(f=>({id:f.id,location_id:f.location,location_name:f.location_name,visit_date:f.visit_date,notes:f.notes,user_name:f.user_name}))}catch(l){console.error("Error fetching visits:",l),t.value="Failed to load visits. Please try again later."}finally{i.value=!1}};return{restocks:o,loading:i,error:t,fetchRestocks:s,createVisit:async l=>{try{return(await k.createVisit(l)).data}catch(f){throw console.error("Error creating visit:",f),f}},updateVisit:async(l,f)=>{try{return(await k.updateVisit(l,f)).data}catch(V){throw console.error("Error updating visit:",V),V}},deleteVisit:async l=>{try{await k.deleteVisit(l),await s()}catch(f){throw console.error("Error deleting visit:",f),f}},getVisitDetails:async l=>{try{const V=(await k.getRestocks({visit:l})).data;let m=[];for(const u of V){const y=(await k.getRestockEntries({visit_machine_restock:u.id})).data,b=(await k.getMachineItems({machine:u.machine})).data,R=y.map(S=>{const I=b.find(N=>N.product===S.product);return{...S,slot:I?I.slot:null}});m.push(...R)}return m.sort((u,g)=>u.visit_machine_restock!==g.visit_machine_restock?0:(u.slot||999)-(g.slot||999)),m.map(u=>({id:u.id,product_name:u.product_name,product_id:u.product,previous_quantity:u.stock_before,quantity_discarded:u.discarded,quantity_added:u.restocked,machine_info:u.machine_info,slot:u.slot}))}catch(f){throw console.error("Error fetching visit details:",f),f}}}}function fe(){const o=W(),i=$(!1),t=$(""),s=$(null),a=$({id:null,visit_date:"",notes:"",location:"",machines:[]}),n=(m=null)=>{m?(i.value=!0,t.value=m.location_id,a.value={id:m.id,visit_date:m.visit_date,notes:m.notes,location:m.location_id}):(i.value=!1,t.value="",a.value={id:null,visit_date:me(),notes:"",location:"",machines:[]})},_=m=>m.some(g=>g.products.some(y=>y.stock_before===""||y.restocked===""))?(s.value="Please record stock levels for all products in all machines",!1):!0,v=async(m,u,g)=>{var y;try{if(s.value=null,!_(m))return!1;let p;const b={location:t.value,visit_date:a.value.visit_date,notes:a.value.notes,user:(y=o.user)==null?void 0:y.id};return console.log("Saving visit with data:",b),i.value&&a.value.id?p=(await g(a.value.id,b)).id:p=(await u(b)).id,await l(p,m),!0}catch(p){return console.error("Error saving restock visit:",p),s.value="Failed to save visit. Please try again.",!1}},l=async(m,u)=>{for(const g of u){let y;if(i.value)try{const p=await k.getRestocks({visit:m,machine:g.id});if(p.data.length>0){const b=p.data[0],R={visit:m,machine:g.id,notes:b.notes||""};await k.updateRestock(b.id,R),y=b.id}else{const b={visit:m,machine:g.id,notes:""};y=(await k.createRestock(b)).data.id}}catch(p){throw console.error("Error handling machine restock:",p),p}else{const p={visit:m,machine:g.id,notes:""};y=(await k.createRestock(p)).data.id}await f(y,g.products)}},f=async(m,u)=>{for(const g of u)try{const y={visit_machine_restock:m,product:g.id,stock_before:parseInt(g.stock_before)||0,discarded:parseInt(g.discarded)||0,restocked:parseInt(g.restocked)||0};if(i.value){const p=await k.getRestockEntries({visit_machine_restock:m,product:g.id});p.data.length>0?await k.updateRestockEntry(p.data[0].id,y):await k.createRestockEntry(y)}else await k.createRestockEntry(y)}catch(y){throw console.error("Error handling restock entry:",y),y}};return{restockForm:a,isEditing:i,selectedLocation:t,error:s,initializeForm:n,validateForm:_,saveRestock:v,resetForm:()=>{n(),s.value=null}}}const ge={key:0,class:"flex justify-center"},ve={key:1,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-4"},ye={class:"flex"},xe={class:"ml-3"},pe={class:"text-sm text-red-700"},he={key:2,class:"bg-white shadow overflow-hidden sm:rounded-lg"},be={class:"px-4 py-5 sm:p-6 text-center"},ke={class:"mt-5"},we={key:3,class:"bg-white shadow overflow-hidden sm:rounded-lg"},_e={role:"list",class:"divide-y divide-gray-200"},$e={class:"flex items-center justify-between"},Re={class:"flex-1 min-w-0"},Ce={class:"text-sm font-medium text-primary-600 truncate"},Ve={class:"text-sm text-gray-500"},De={class:"ml-4 flex-shrink-0 flex space-x-2"},Ee=["onClick"],Fe=["onClick"],Se=["onClick"],Le={__name:"RestockList",props:{restocks:Array,loading:Boolean,error:String},emits:["add-restock","view-details","edit-restock","delete-restock"],setup(o){return(i,t)=>(r(),c("div",null,[o.loading?(r(),c("div",ge,t[1]||(t[1]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))):o.error?(r(),c("div",ve,[e("div",ye,[t[2]||(t[2]=e("div",{class:"flex-shrink-0"},[e("span",{class:"text-red-400"},"âš ")],-1)),e("div",xe,[e("p",pe,d(o.error),1)])])])):o.restocks.length===0?(r(),c("div",he,[e("div",be,[t[3]||(t[3]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"No visits recorded",-1)),t[4]||(t[4]=e("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[e("p",null,"Get started by recording your first location visit.")],-1)),e("div",ke,[e("button",{onClick:t[0]||(t[0]=s=>i.$emit("add-restock")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Record New Visit ")])])])):(r(),c("div",we,[e("ul",_e,[(r(!0),c(E,null,F(o.restocks,s=>(r(),c("li",{key:s.id,class:"px-4 py-4 sm:px-6"},[e("div",$e,[e("div",Re,[e("p",Ce,d(s.location_name),1),e("p",Ve,d(w(O)(s.visit_date)),1)]),e("div",De,[e("button",{onClick:a=>i.$emit("view-details",s),class:"inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," View Details ",8,Ee),e("button",{onClick:a=>i.$emit("edit-restock",s),class:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Edit ",8,Fe),e("button",{onClick:a=>i.$emit("delete-restock",s),class:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," Delete ",8,Se)])])]))),128))])]))]))}},Me={class:"space-y-4"},je={class:"flex justify-between items-center mb-2"},Ie={class:"text-sm font-medium text-gray-900"},Ne={class:"text-sm text-gray-500"},qe={class:"space-y-2"},Ae={key:0,class:"text-sm text-gray-500 italic p-2 text-center"},Be={class:"col-span-1 text-sm font-medium text-gray-900 text-center bg-gray-100 rounded-md py-1"},Pe={class:"col-span-3 text-sm font-medium text-gray-900"},Te={class:"col-span-2"},Ue={class:"mt-1 flex rounded-md shadow-sm"},Oe=["onClick"],ze=["onUpdate:modelValue"],Qe=["onClick"],Ge={class:"col-span-2"},We={class:"mt-1 flex rounded-md shadow-sm"},He=["onClick"],Je=["onUpdate:modelValue"],Ke=["onClick"],Xe={class:"col-span-2"},Ye={class:"mt-1 flex rounded-md shadow-sm"},Ze=["onClick"],et=["onUpdate:modelValue"],tt=["onClick"],st={class:"col-span-2 text-sm text-gray-500"},ot={__name:"MachineProductsSection",props:{machines:Array},setup(o){const i=(a,n)=>{a[n]=(parseInt(a[n])||0)+1},t=(a,n)=>{a[n]=Math.max(0,(parseInt(a[n])||0)-1)},s=a=>(parseInt(a.stock_before)||0)-(parseInt(a.discarded)||0)+(parseInt(a.restocked)||0);return(a,n)=>(r(),c("div",null,[n[9]||(n[9]=e("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Machines at Location",-1)),e("div",Me,[(r(!0),c(E,null,F(o.machines,_=>(r(),c("div",{key:_.id,class:"border rounded-lg p-4"},[e("div",je,[e("h5",Ie,d(_.name)+" ("+d(_.machine_type)+" "+d(_.model)+") ",1),e("div",Ne,d(_.products.length)+" products ",1)]),e("div",qe,[_.products.length===0?(r(),c("div",Ae," No products in this machine ")):C("",!0),(r(!0),c(E,null,F(_.products,v=>(r(),c("div",{key:v.id,class:"grid grid-cols-12 gap-4 items-center"},[e("div",Be,d(v.slot),1),e("div",Pe,d(v.name),1),e("div",Te,[n[2]||(n[2]=e("label",{class:"block text-xs text-gray-500"},"Current Stock",-1)),e("div",Ue,[e("button",{type:"button",onClick:l=>t(v,"stock_before"),class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},n[0]||(n[0]=[e("span",{class:"sr-only"},"Decrease",-1),D(" - ")]),8,Oe),M(e("input",{type:"number","onUpdate:modelValue":l=>v.stock_before=l,min:"0",class:"focus:ring-primary-500 focus:border-primary-500 block w-full border-gray-300 rounded-none text-center sm:text-sm",required:""},null,8,ze),[[j,v.stock_before]]),e("button",{type:"button",onClick:l=>i(v,"stock_before"),class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},n[1]||(n[1]=[e("span",{class:"sr-only"},"Increase",-1),D(" + ")]),8,Qe)])]),e("div",Ge,[n[5]||(n[5]=e("label",{class:"block text-xs text-gray-500"},"Discarded Amount",-1)),e("div",We,[e("button",{type:"button",onClick:l=>t(v,"discarded"),class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},n[3]||(n[3]=[e("span",{class:"sr-only"},"Decrease",-1),D(" - ")]),8,He),M(e("input",{type:"number","onUpdate:modelValue":l=>v.discarded=l,min:"0",class:"focus:ring-primary-500 focus:border-primary-500 block w-full border-gray-300 rounded-none text-center sm:text-sm",required:""},null,8,Je),[[j,v.discarded]]),e("button",{type:"button",onClick:l=>i(v,"discarded"),class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},n[4]||(n[4]=[e("span",{class:"sr-only"},"Increase",-1),D(" + ")]),8,Ke)])]),e("div",Xe,[n[8]||(n[8]=e("label",{class:"block text-xs text-gray-500"},"Restock Amount",-1)),e("div",Ye,[e("button",{type:"button",onClick:l=>t(v,"restocked"),class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},n[6]||(n[6]=[e("span",{class:"sr-only"},"Decrease",-1),D(" - ")]),8,Ze),M(e("input",{type:"number","onUpdate:modelValue":l=>v.restocked=l,min:"0",class:"focus:ring-primary-500 focus:border-primary-500 block w-full border-gray-300 rounded-none text-center sm:text-sm",required:""},null,8,et),[[j,v.restocked]]),e("button",{type:"button",onClick:l=>i(v,"restocked"),class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},n[7]||(n[7]=[e("span",{class:"sr-only"},"Increase",-1),D(" + ")]),8,tt)])]),e("div",st," New Total: "+d(s(v)),1)]))),128))])]))),128))])]))}},it={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},nt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},rt={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full"},at={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},lt={class:"sm:flex sm:items-start"},dt={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},ct={class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"},mt={class:"mt-4 space-y-4"},ut=["value"],ft=["value"],gt=["value"],vt={for:"location",class:"block text-sm font-medium text-gray-700"},yt={class:"text-xs text-gray-500 ml-1"},xt=["value"],pt=["value"],ht={key:0,class:"text-gray-500"},bt={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},kt={__name:"RestockFormModal",props:{show:Boolean,isEditing:Boolean,restockForm:Object,selectedLocation:String,selectedRoute:String,locationSearchText:String,locations:Array,routes:Array,locationMachines:Array},emits:["close","save","route-change","location-search","location-change"],setup(o){return(i,t)=>o.show?(r(),c("div",it,[e("div",nt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=s=>i.$emit("close"))}),t[17]||(t[17]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"â€‹",-1)),e("div",rt,[e("form",{onSubmit:t[7]||(t[7]=ne(s=>i.$emit("save"),["prevent"]))},[e("div",at,[e("div",lt,[e("div",dt,[e("h3",ct,d(o.isEditing?"Edit Visit":"Record New Visit"),1),e("div",mt,[e("div",null,[t[10]||(t[10]=e("label",{for:"route",class:"block text-sm font-medium text-gray-700"},"Filter by Route (Optional)",-1)),e("select",{id:"route",name:"route",value:o.selectedRoute,onChange:t[1]||(t[1]=s=>i.$emit("route-change",s.target.value)),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md"},[t[8]||(t[8]=e("option",{value:""},"All Routes",-1)),t[9]||(t[9]=e("option",{value:"unassigned"},"Unassigned",-1)),(r(!0),c(E,null,F(o.routes,s=>(r(),c("option",{key:s,value:s},d(s),9,ft))),128))],40,ut)]),e("div",null,[t[11]||(t[11]=e("label",{for:"location-search",class:"block text-sm font-medium text-gray-700"},"Search Location",-1)),e("input",{id:"location-search",name:"location-search",type:"text",value:o.locationSearchText,onInput:t[2]||(t[2]=s=>i.$emit("location-search",s.target.value)),placeholder:"Type to search locations...",class:"mt-1 block w-full pl-3 pr-3 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md"},null,40,gt)]),e("div",null,[e("label",vt,[t[12]||(t[12]=D(" Location ")),e("span",yt,"("+d(o.locations.length)+" locations)",1)]),e("select",{id:"location",name:"location",value:o.selectedLocation,onChange:t[3]||(t[3]=s=>i.$emit("location-change",s.target.value)),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},[t[13]||(t[13]=e("option",{value:"",disabled:""},"Select a location",-1)),(r(!0),c(E,null,F(o.locations,s=>(r(),c("option",{key:s.id,value:s.id},[D(d(s.name)+" ",1),s.route?(r(),c("span",ht," - "+d(s.route),1)):C("",!0)],8,pt))),128))],40,xt)]),e("div",null,[t[14]||(t[14]=e("label",{for:"visit_date",class:"block text-sm font-medium text-gray-700"},"Visit Date",-1)),M(e("input",{type:"datetime-local",name:"visit_date",id:"visit_date","onUpdate:modelValue":t[4]||(t[4]=s=>o.restockForm.visit_date=s),class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md",required:""},null,512),[[j,o.restockForm.visit_date]])]),o.locationMachines.length>0?(r(),re(ot,{key:0,machines:o.locationMachines},null,8,["machines"])):C("",!0),e("div",null,[t[15]||(t[15]=e("label",{for:"notes",class:"block text-sm font-medium text-gray-700"},"Visit Notes",-1)),M(e("textarea",{id:"notes",name:"notes",rows:"2","onUpdate:modelValue":t[5]||(t[5]=s=>o.restockForm.notes=s),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md"},null,512),[[j,o.restockForm.notes]])])])])])]),e("div",bt,[t[16]||(t[16]=e("button",{type:"submit",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm"}," Save Visit ",-1)),e("button",{type:"button",onClick:t[6]||(t[6]=s=>i.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])],32)])])])):C("",!0)}},wt={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},_t={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},$t={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Rt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Ct={class:"sm:flex sm:items-start"},Vt={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},Dt={key:0,class:"mt-4"},Et={class:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2"},Ft={class:"sm:col-span-1"},St={class:"mt-1 text-sm text-gray-900"},Lt={class:"sm:col-span-1"},Mt={class:"mt-1 text-sm text-gray-900"},jt={class:"sm:col-span-1"},It={class:"mt-1 text-sm text-gray-900"},Nt={class:"sm:col-span-2"},qt={class:"mt-1 text-sm text-gray-900"},At={key:0,class:"mt-6"},Bt={class:"mt-2 border border-gray-200 rounded-md overflow-hidden"},Pt={class:"divide-y divide-gray-200"},Tt={class:"grid grid-cols-6 gap-2 items-center"},Ut={class:"col-span-1 text-center bg-gray-100 rounded-md py-1 text-sm font-medium text-gray-900"},Ot={class:"col-span-1 text-sm font-medium text-gray-900"},zt={class:"col-span-1 text-center text-sm text-gray-500"},Qt={class:"col-span-1 text-center text-sm text-gray-500"},Gt={class:"col-span-1 text-center text-sm text-green-600 font-medium"},Wt={class:"col-span-1 text-center text-sm font-medium text-gray-900"},Ht={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Jt={__name:"RestockDetailsModal",props:{show:Boolean,restock:Object},emits:["close"],setup(o){return(i,t)=>o.show?(r(),c("div",wt,[e("div",_t,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=s=>i.$emit("close"))}),t[9]||(t[9]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"â€‹",-1)),e("div",$t,[e("div",Rt,[e("div",Ct,[e("div",Vt,[t[8]||(t[8]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Restock Details ",-1)),o.restock?(r(),c("div",Dt,[e("dl",Et,[e("div",Ft,[t[2]||(t[2]=e("dt",{class:"text-sm font-medium text-gray-500"},"Location",-1)),e("dd",St,d(o.restock.location_name),1)]),e("div",Lt,[t[3]||(t[3]=e("dt",{class:"text-sm font-medium text-gray-500"},"Visit Date",-1)),e("dd",Mt,d(w(O)(o.restock.visit_date)),1)]),e("div",jt,[t[4]||(t[4]=e("dt",{class:"text-sm font-medium text-gray-500"},"Restocked By",-1)),e("dd",It,d(o.restock.user_name),1)]),e("div",Nt,[t[5]||(t[5]=e("dt",{class:"text-sm font-medium text-gray-500"},"Notes",-1)),e("dd",qt,d(o.restock.notes||"No notes"),1)])]),o.restock.entries&&o.restock.entries.length>0?(r(),c("div",At,[t[7]||(t[7]=e("h4",{class:"text-sm font-medium text-gray-500"},"Restocked Items",-1)),e("div",Bt,[t[6]||(t[6]=ae('<div class="px-4 py-3 bg-gray-50 text-xs font-medium text-gray-500 uppercase tracking-wider"><div class="grid grid-cols-6 gap-2"><div class="col-span-1 text-center">Slot</div><div class="col-span-1">Product</div><div class="col-span-1 text-center">Prev Qty</div><div class="col-span-1 text-center">Discarded</div><div class="col-span-1 text-center">Added</div><div class="col-span-1 text-center">New Qty</div></div></div>',1)),e("div",Pt,[(r(!0),c(E,null,F(o.restock.entries,s=>(r(),c("div",{key:s.id,class:"px-4 py-3"},[e("div",Tt,[e("div",Ut,d(s.slot||"-"),1),e("div",Ot,d(s.product_name),1),e("div",zt,d(s.previous_quantity),1),e("div",Qt,d(s.quantity_discarded),1),e("div",Gt," +"+d(s.quantity_added),1),e("div",Wt,d(s.previous_quantity+s.quantity_added-s.quantity_discarded),1)])]))),128))])])])):C("",!0)])):C("",!0)])])]),e("div",Ht,[e("button",{type:"button",onClick:t[1]||(t[1]=s=>i.$emit("close")),class:"w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:w-auto sm:text-sm"}," Close ")])])])])):C("",!0)}},Kt={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Xt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Yt={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Zt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},es={class:"sm:flex sm:items-start"},ts={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},ss={key:0,class:"mt-2"},os={class:"text-sm text-gray-500"},is={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},ns={__name:"DeleteConfirmationModal",props:{show:Boolean,restock:Object},emits:["close","confirm"],setup(o){return(i,t)=>o.show?(r(),c("div",Kt,[e("div",Xt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=s=>i.$emit("close"))}),t[5]||(t[5]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"â€‹",-1)),e("div",Yt,[e("div",Zt,[e("div",es,[t[4]||(t[4]=e("div",{class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"},[e("svg",{class:"h-6 w-6 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),e("div",ts,[t[3]||(t[3]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Delete Visit ",-1)),o.restock?(r(),c("div",ss,[e("p",os," Are you sure you want to delete this visit to "+d(o.restock.location_name)+" on "+d(w(O)(o.restock.visit_date))+"? This action will also reverse all inventory changes made during this visit. This action cannot be undone. ",1)])):C("",!0)])])]),e("div",is,[e("button",{type:"button",onClick:t[1]||(t[1]=s=>i.$emit("confirm")),class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"}," Delete "),e("button",{type:"button",onClick:t[2]||(t[2]=s=>i.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])])])])):C("",!0)}},ms={__name:"Restocks",setup(o){const i=W(),{restocks:t,loading:s,error:a,fetchRestocks:n,createVisit:_,updateVisit:v,deleteVisit:l,getVisitDetails:f}=ue(),{filteredLocations:V,routes:m,selectedRoute:u,locationSearchText:g,fetchLocations:y,fetchRoutes:p,resetFilters:b}=de(),{locationMachines:R,fetchLocationMachines:S,updateMachineProductData:I,resetMachineData:N}=ce(),{restockForm:H,isEditing:J,selectedLocation:P,initializeForm:z,saveRestock:K}=fe(),L=$(!1),T=$(!1),q=$(!1),U=$(null),A=$(null),Q=()=>{z(),b(),N(),L.value=!0},X=async x=>{z(x),b(),await S(x.location_id);try{for(const h of R.value)await I(x.id,h.id);L.value=!0}catch(h){console.error("Error loading visit for editing:",h),a.value="Failed to load visit details for editing. Please try again."}},Y=async x=>{U.value=x;try{const h=await f(x.id);U.value={...x,entries:h},T.value=!0}catch(h){console.error("Error fetching visit details:",h),a.value="Failed to load visit details. Please try again."}},Z=x=>{A.value=x,q.value=!0},ee=async()=>{try{await l(A.value.id),q.value=!1,A.value=null}catch(x){console.error("Error deleting visit:",x),a.value="Failed to delete visit. Please try again."}},te=async()=>{await K(R.value,_,v)&&(L.value=!1,await n())},se=x=>{u.value=x,P.value="",N()},oe=x=>{g.value=x},ie=x=>{P.value=x,S(x)};return le(async()=>{i.isAuthenticated&&!i.user&&await i.fetchUser(),console.log("Current user:",i.user),await Promise.all([n(),y(),p()])}),(x,h)=>(r(),c("div",null,[e("div",{class:"flex justify-between items-center mb-6"},[h[3]||(h[3]=e("h1",{class:"text-2xl font-semibold text-gray-900"},"Location Visits",-1)),e("button",{onClick:Q,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Record New Visit ")]),B(Le,{restocks:w(t),loading:w(s),error:w(a),onAddRestock:Q,onViewDetails:Y,onEditRestock:X,onDeleteRestock:Z},null,8,["restocks","loading","error"]),B(kt,{show:L.value,"is-editing":w(J),"restock-form":w(H),"selected-location":w(P),"selected-route":w(u),"location-search-text":w(g),locations:w(V),routes:w(m),"location-machines":w(R),onClose:h[0]||(h[0]=G=>L.value=!1),onSave:te,onRouteChange:se,onLocationSearch:oe,onLocationChange:ie},null,8,["show","is-editing","restock-form","selected-location","selected-route","location-search-text","locations","routes","location-machines"]),B(Jt,{show:T.value,restock:U.value,onClose:h[1]||(h[1]=G=>T.value=!1)},null,8,["show","restock"]),B(ns,{show:q.value,restock:A.value,onClose:h[2]||(h[2]=G=>q.value=!1),onConfirm:ee},null,8,["show","restock"])]))}};export{ms as default};
