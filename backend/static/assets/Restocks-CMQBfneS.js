import{r as b,h as ne,l as G,c as y,g as v,a as e,t as h,F as E,e as L,u as R,i as V,w as S,f as D,k as I,j as re,m as ae,d as le,o as de,b as A}from"./index-C_eu1tB3.js";import{a as x}from"./api-CnOhYW_x.js";import{g as ce,f as O}from"./dateUtils-CXdyRzwD.js";function me(){const o=b([]),i=b(!1),t=b(null),s=async()=>{i.value=!0,t.value=null;try{const a=await x.getVisits();o.value=a.data.map(m=>({id:m.id,location_id:m.location,location_name:m.location_name,visit_date:m.visit_date,notes:m.notes,user_name:m.user_name}))}catch(a){console.error("Error fetching visits:",a),t.value="Failed to load visits. Please try again later."}finally{i.value=!1}};return{restocks:o,loading:i,error:t,fetchRestocks:s,createVisit:async a=>{try{return(await x.createVisit(a)).data}catch(m){throw console.error("Error creating visit:",m),m}},updateVisit:async(a,m)=>{try{return(await x.updateVisit(a,m)).data}catch(f){throw console.error("Error updating visit:",f),f}},deleteVisit:async a=>{try{await x.deleteVisit(a),await s()}catch(m){throw console.error("Error deleting visit:",m),m}},getVisitDetails:async a=>{try{const f=(await x.getRestocks({visit:a})).data;let l=[];for(const d of f){const g=(await x.getRestockEntries({visit_machine_restock:d.id})).data,_=(await x.getMachineItems({machine:d.machine})).data,C=g.map(M=>{const j=_.find(P=>P.product===M.product);return{...M,slot:j?j.slot:null}});l.push(...C)}return l.sort((d,r)=>d.visit_machine_restock!==r.visit_machine_restock?0:(d.slot||999)-(r.slot||999)),l.map(d=>({id:d.id,product_name:d.product_name,product_id:d.product,previous_quantity:d.stock_before,quantity_discarded:d.discarded,quantity_added:d.restocked,machine_info:d.machine_info,slot:d.slot}))}catch(m){throw console.error("Error fetching visit details:",m),m}}}}function ue(){const o=b([]),i=b([]),t=b(""),s=b(""),c=b(!1),n=b(null),k=ne(()=>{let f=o.value;if(t.value&&(t.value==="unassigned"?f=f.filter(l=>!l.route||l.route.trim()===""):f=f.filter(l=>l.route===t.value)),s.value.trim()){const l=s.value.toLowerCase().trim();f=f.filter(d=>d.name.toLowerCase().includes(l)||d.address&&d.address.toLowerCase().includes(l))}return f});return{allLocations:o,routes:i,selectedRoute:t,locationSearchText:s,filteredLocations:k,loading:c,error:n,fetchLocations:async()=>{c.value=!0,n.value=null;try{const f=await x.getLocations();o.value=f.data}catch(f){console.error("Error fetching locations:",f),n.value="Failed to load locations. Please try again later."}finally{c.value=!1}},fetchRoutes:async()=>{try{const f=await x.getRoutes();i.value=f.data.routes}catch(f){console.error("Error fetching routes:",f),n.value="Failed to load routes. Please try again later."}},resetFilters:()=>{t.value="",s.value=""}}}function fe(){const o=b([]),i=b(!1),t=b(null);return{locationMachines:o,loading:i,error:t,fetchLocationMachines:async k=>{if(!k){o.value=[];return}i.value=!0,t.value=null;try{const a=(await x.getMachines({location:k})).data,m=[];for(const f of a){const d=(await x.getMachineItems({machine:f.id})).data.map(r=>({id:r.product,name:r.product_name,price:r.price,slot:r.slot,current_stock:r.current_stock||0,stock_before:r.current_stock||0,discarded:0,restocked:0})).sort((r,g)=>r.slot-g.slot);m.push({...f,products:d})}o.value=m}catch(u){console.error("Error fetching machines and products:",u),t.value="Failed to load machine products. Please try again."}finally{i.value=!1}},updateMachineProductData:async(k,u)=>{try{const a=await x.getRestocks({visit:k,machine:u});if(a.data.length>0){const m=a.data[0],l=(await x.getRestockEntries({visit_machine_restock:m.id})).data,d=o.value.findIndex(r=>r.id===u);if(d!==-1){const r=o.value[d];l.forEach(g=>{const p=r.products.findIndex(_=>_.id===g.product);p!==-1&&(r.products[p].stock_before=g.stock_before,r.products[p].discarded=g.discarded||0,r.products[p].restocked=g.restocked)})}}}catch(a){throw console.error("Error updating machine product data:",a),a}},resetMachineData:()=>{o.value=[]}}}function ge(){const o=G(),i=b(!1),t=b(""),s=b(null),c=b({id:null,visit_date:"",notes:"",location:"",machines:[]}),n=(l=null)=>{l?(i.value=!0,t.value=l.location_id,c.value={id:l.id,visit_date:l.visit_date,notes:l.notes,location:l.location_id}):(i.value=!1,t.value="",c.value={id:null,visit_date:ce(),notes:"",location:"",machines:[]})},k=l=>l.some(r=>r.products.some(g=>g.stock_before===""||g.restocked===""))?(s.value="Please record stock levels for all products in all machines",!1):!0,u=async(l,d,r)=>{var g;try{if(s.value=null,!k(l))return!1;let p;const _={location:t.value,visit_date:c.value.visit_date,notes:c.value.notes,user:(g=o.user)==null?void 0:g.id};return console.log("Saving visit with data:",_),i.value&&c.value.id?p=(await r(c.value.id,_)).id:p=(await d(_)).id,await a(p,l),!0}catch(p){return console.error("Error saving restock visit:",p),s.value="Failed to save visit. Please try again.",!1}},a=async(l,d)=>{for(const r of d){let g;if(i.value)try{const p=await x.getRestocks({visit:l,machine:r.id});if(p.data.length>0){const _=p.data[0],C={visit:l,machine:r.id,notes:_.notes||""};await x.updateRestock(_.id,C),g=_.id}else{const _={visit:l,machine:r.id,notes:""};g=(await x.createRestock(_)).data.id}}catch(p){throw console.error("Error handling machine restock:",p),p}else{const p={visit:l,machine:r.id,notes:""};g=(await x.createRestock(p)).data.id}await m(g,r.products)}},m=async(l,d)=>{for(const r of d)try{const g={visit_machine_restock:l,product:r.id,stock_before:parseInt(r.stock_before)||0,discarded:parseInt(r.discarded)||0,restocked:parseInt(r.restocked)||0};if(i.value){const p=await x.getRestockEntries({visit_machine_restock:l,product:r.id});p.data.length>0?await x.updateRestockEntry(p.data[0].id,g):await x.createRestockEntry(g)}else await x.createRestockEntry(g)}catch(g){throw console.error("Error handling restock entry:",g),g}};return{restockForm:c,isEditing:i,selectedLocation:t,error:s,initializeForm:n,validateForm:k,saveRestock:u,resetForm:()=>{n(),s.value=null}}}const ve={key:0,class:"flex justify-center"},he={key:1,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-4"},ye={class:"flex"},pe={class:"ml-3"},xe={class:"text-sm text-red-700"},be={key:2,class:"bg-white shadow overflow-hidden sm:rounded-lg"},ke={class:"px-4 py-5 sm:p-6 text-center"},we={class:"mt-5"},_e={key:3,class:"bg-white shadow overflow-hidden sm:rounded-lg"},$e={role:"list",class:"divide-y divide-gray-200"},Re={class:"flex items-center justify-between"},Ce={class:"flex-1 min-w-0"},Ve={class:"text-sm font-medium text-primary-600 truncate"},De={class:"text-sm text-gray-500"},Ee={class:"ml-4 flex-shrink-0 flex space-x-2"},Le=["onClick"],Me=["onClick"],Fe=["onClick"],Se={__name:"RestockList",props:{restocks:Array,loading:Boolean,error:String},emits:["add-restock","view-details","edit-restock","delete-restock"],setup(o){return(i,t)=>(v(),y("div",null,[o.loading?(v(),y("div",ve,t[1]||(t[1]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))):o.error?(v(),y("div",he,[e("div",ye,[t[2]||(t[2]=e("div",{class:"flex-shrink-0"},[e("span",{class:"text-red-400"},"⚠")],-1)),e("div",pe,[e("p",xe,h(o.error),1)])])])):o.restocks.length===0?(v(),y("div",be,[e("div",ke,[t[3]||(t[3]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"No visits recorded",-1)),t[4]||(t[4]=e("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[e("p",null,"Get started by recording your first location visit.")],-1)),e("div",we,[e("button",{onClick:t[0]||(t[0]=s=>i.$emit("add-restock")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Record New Visit ")])])])):(v(),y("div",_e,[e("ul",$e,[(v(!0),y(E,null,L(o.restocks,s=>(v(),y("li",{key:s.id,class:"px-4 py-4 sm:px-6"},[e("div",Re,[e("div",Ce,[e("p",Ve,h(s.location_name),1),e("p",De,h(R(O)(s.visit_date)),1)]),e("div",Ee,[e("button",{onClick:c=>i.$emit("view-details",s),class:"inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," View Details ",8,Le),e("button",{onClick:c=>i.$emit("edit-restock",s),class:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Edit ",8,Me),e("button",{onClick:c=>i.$emit("delete-restock",s),class:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," Delete ",8,Fe)])])]))),128))])]))]))}},Ie={class:"space-y-4"},je={class:"flex justify-between items-center mb-2"},Pe={class:"text-sm font-medium text-gray-900"},Ne={class:"text-sm text-gray-500"},qe={class:"space-y-2"},Ae={key:0,class:"text-sm text-gray-500 italic p-2 text-center"},Te={class:"col-span-1 text-sm font-medium text-gray-900 text-center bg-gray-100 rounded-md py-1"},Be={class:"col-span-3 text-sm font-medium text-gray-900"},Ue={class:"col-span-2"},Oe={class:"mt-1 flex rounded-md shadow-sm"},ze=["onClick"],Qe=["onUpdate:modelValue"],We=["onClick"],Ge={class:"col-span-2"},He={class:"mt-1 flex rounded-md shadow-sm"},Je=["onClick"],Ke=["onUpdate:modelValue"],Xe=["onClick"],Ye={class:"col-span-2"},Ze={class:"mt-1 flex rounded-md shadow-sm"},et=["onClick"],tt=["onUpdate:modelValue"],st=["onClick"],ot={class:"col-span-2 text-sm text-gray-500"},it={__name:"MachineProductsSection",props:{machines:Array},setup(o){const i=(c,n)=>{c[n]=(parseInt(c[n])||0)+1},t=(c,n)=>{c[n]=Math.max(0,(parseInt(c[n])||0)-1)},s=c=>(parseInt(c.stock_before)||0)-(parseInt(c.discarded)||0)+(parseInt(c.restocked)||0);return(c,n)=>(v(),y("div",null,[n[9]||(n[9]=e("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Machines at Location",-1)),e("div",Ie,[(v(!0),y(E,null,L(o.machines,k=>(v(),y("div",{key:k.id,class:"border rounded-lg p-4"},[e("div",je,[e("h5",Pe,h(k.name)+" ("+h(k.machine_type)+" "+h(k.model)+") ",1),e("div",Ne,h(k.products.length)+" products ",1)]),e("div",qe,[k.products.length===0?(v(),y("div",Ae," No products in this machine ")):V("",!0),(v(!0),y(E,null,L(k.products,u=>(v(),y("div",{key:u.id,class:"grid grid-cols-12 gap-4 items-center"},[e("div",Te,h(u.slot),1),e("div",Be,h(u.name),1),e("div",Ue,[n[2]||(n[2]=e("label",{class:"block text-xs text-gray-500"},"Current Stock",-1)),e("div",Oe,[e("button",{type:"button",onClick:a=>t(u,"stock_before"),class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},n[0]||(n[0]=[e("span",{class:"sr-only"},"Decrease",-1),D(" - ")]),8,ze),S(e("input",{type:"number","onUpdate:modelValue":a=>u.stock_before=a,min:"0",class:"focus:ring-primary-500 focus:border-primary-500 block w-full border-gray-300 rounded-none text-center sm:text-sm",required:""},null,8,Qe),[[I,u.stock_before]]),e("button",{type:"button",onClick:a=>i(u,"stock_before"),class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},n[1]||(n[1]=[e("span",{class:"sr-only"},"Increase",-1),D(" + ")]),8,We)])]),e("div",Ge,[n[5]||(n[5]=e("label",{class:"block text-xs text-gray-500"},"Discarded Amount",-1)),e("div",He,[e("button",{type:"button",onClick:a=>t(u,"discarded"),class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},n[3]||(n[3]=[e("span",{class:"sr-only"},"Decrease",-1),D(" - ")]),8,Je),S(e("input",{type:"number","onUpdate:modelValue":a=>u.discarded=a,min:"0",class:"focus:ring-primary-500 focus:border-primary-500 block w-full border-gray-300 rounded-none text-center sm:text-sm",required:""},null,8,Ke),[[I,u.discarded]]),e("button",{type:"button",onClick:a=>i(u,"discarded"),class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},n[4]||(n[4]=[e("span",{class:"sr-only"},"Increase",-1),D(" + ")]),8,Xe)])]),e("div",Ye,[n[8]||(n[8]=e("label",{class:"block text-xs text-gray-500"},"Restock Amount",-1)),e("div",Ze,[e("button",{type:"button",onClick:a=>t(u,"restocked"),class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},n[6]||(n[6]=[e("span",{class:"sr-only"},"Decrease",-1),D(" - ")]),8,et),S(e("input",{type:"number","onUpdate:modelValue":a=>u.restocked=a,min:"0",class:"focus:ring-primary-500 focus:border-primary-500 block w-full border-gray-300 rounded-none text-center sm:text-sm",required:""},null,8,tt),[[I,u.restocked]]),e("button",{type:"button",onClick:a=>i(u,"restocked"),class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},n[7]||(n[7]=[e("span",{class:"sr-only"},"Increase",-1),D(" + ")]),8,st)])]),e("div",ot," New Total: "+h(s(u)),1)]))),128))])]))),128))])]))}},nt={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},rt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},at={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full"},lt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},dt={class:"sm:flex sm:items-start"},ct={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},mt={class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"},ut={class:"mt-4 space-y-4"},ft=["value"],gt=["value"],vt=["value"],ht={for:"location",class:"block text-sm font-medium text-gray-700"},yt={class:"text-xs text-gray-500 ml-1"},pt=["value"],xt=["value"],bt={key:0,class:"text-gray-500"},kt={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},wt={__name:"RestockFormModal",props:{show:Boolean,isEditing:Boolean,restockForm:Object,selectedLocation:String,selectedRoute:String,locationSearchText:String,locations:Array,routes:Array,locationMachines:Array},emits:["close","save","route-change","location-search","location-change"],setup(o){return(i,t)=>o.show?(v(),y("div",nt,[e("div",rt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=s=>i.$emit("close"))}),t[17]||(t[17]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",at,[e("form",{onSubmit:t[7]||(t[7]=re(s=>i.$emit("save"),["prevent"]))},[e("div",lt,[e("div",dt,[e("div",ct,[e("h3",mt,h(o.isEditing?"Edit Visit":"Record New Visit"),1),e("div",ut,[e("div",null,[t[10]||(t[10]=e("label",{for:"route",class:"block text-sm font-medium text-gray-700"},"Filter by Route (Optional)",-1)),e("select",{id:"route",name:"route",value:o.selectedRoute,onChange:t[1]||(t[1]=s=>i.$emit("route-change",s.target.value)),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md"},[t[8]||(t[8]=e("option",{value:""},"All Routes",-1)),t[9]||(t[9]=e("option",{value:"unassigned"},"Unassigned",-1)),(v(!0),y(E,null,L(o.routes,s=>(v(),y("option",{key:s,value:s},h(s),9,gt))),128))],40,ft)]),e("div",null,[t[11]||(t[11]=e("label",{for:"location-search",class:"block text-sm font-medium text-gray-700"},"Search Location",-1)),e("input",{id:"location-search",name:"location-search",type:"text",value:o.locationSearchText,onInput:t[2]||(t[2]=s=>i.$emit("location-search",s.target.value)),placeholder:"Type to search locations...",class:"mt-1 block w-full pl-3 pr-3 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md"},null,40,vt)]),e("div",null,[e("label",ht,[t[12]||(t[12]=D(" Location ")),e("span",yt,"("+h(o.locations.length)+" locations)",1)]),e("select",{id:"location",name:"location",value:o.selectedLocation,onChange:t[3]||(t[3]=s=>i.$emit("location-change",s.target.value)),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},[t[13]||(t[13]=e("option",{value:"",disabled:""},"Select a location",-1)),(v(!0),y(E,null,L(o.locations,s=>(v(),y("option",{key:s.id,value:s.id},[D(h(s.name)+" ",1),s.route?(v(),y("span",bt," - "+h(s.route),1)):V("",!0)],8,xt))),128))],40,pt)]),e("div",null,[t[14]||(t[14]=e("label",{for:"visit_date",class:"block text-sm font-medium text-gray-700"},"Visit Date",-1)),S(e("input",{type:"datetime-local",name:"visit_date",id:"visit_date","onUpdate:modelValue":t[4]||(t[4]=s=>o.restockForm.visit_date=s),class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md",required:""},null,512),[[I,o.restockForm.visit_date]])]),o.locationMachines.length>0?(v(),ae(it,{key:0,machines:o.locationMachines},null,8,["machines"])):V("",!0),e("div",null,[t[15]||(t[15]=e("label",{for:"notes",class:"block text-sm font-medium text-gray-700"},"Visit Notes",-1)),S(e("textarea",{id:"notes",name:"notes",rows:"2","onUpdate:modelValue":t[5]||(t[5]=s=>o.restockForm.notes=s),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md"},null,512),[[I,o.restockForm.notes]])])])])])]),e("div",kt,[t[16]||(t[16]=e("button",{type:"submit",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm"}," Save Visit ",-1)),e("button",{type:"button",onClick:t[6]||(t[6]=s=>i.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])],32)])])])):V("",!0)}},_t={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},$t={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Rt={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Ct={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Vt={class:"sm:flex sm:items-start"},Dt={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},Et={key:0,class:"mt-4"},Lt={class:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2"},Mt={class:"sm:col-span-1"},Ft={class:"mt-1 text-sm text-gray-900"},St={class:"sm:col-span-1"},It={class:"mt-1 text-sm text-gray-900"},jt={class:"sm:col-span-1"},Pt={class:"mt-1 text-sm text-gray-900"},Nt={class:"sm:col-span-2"},qt={class:"mt-1 text-sm text-gray-900"},At={key:0,class:"mt-6"},Tt={class:"mt-2 border border-gray-200 rounded-md overflow-hidden"},Bt={class:"divide-y divide-gray-200"},Ut={class:"grid grid-cols-6 gap-2 items-center"},Ot={class:"col-span-1 text-center bg-gray-100 rounded-md py-1 text-sm font-medium text-gray-900"},zt={class:"col-span-1 text-sm font-medium text-gray-900"},Qt={class:"col-span-1 text-center text-sm text-gray-500"},Wt={class:"col-span-1 text-center text-sm text-gray-500"},Gt={class:"col-span-1 text-center text-sm text-green-600 font-medium"},Ht={class:"col-span-1 text-center text-sm font-medium text-gray-900"},Jt={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Kt={__name:"RestockDetailsModal",props:{show:Boolean,restock:Object},emits:["close"],setup(o){return(i,t)=>o.show?(v(),y("div",_t,[e("div",$t,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=s=>i.$emit("close"))}),t[9]||(t[9]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Rt,[e("div",Ct,[e("div",Vt,[e("div",Dt,[t[8]||(t[8]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Restock Details ",-1)),o.restock?(v(),y("div",Et,[e("dl",Lt,[e("div",Mt,[t[2]||(t[2]=e("dt",{class:"text-sm font-medium text-gray-500"},"Location",-1)),e("dd",Ft,h(o.restock.location_name),1)]),e("div",St,[t[3]||(t[3]=e("dt",{class:"text-sm font-medium text-gray-500"},"Visit Date",-1)),e("dd",It,h(R(O)(o.restock.visit_date)),1)]),e("div",jt,[t[4]||(t[4]=e("dt",{class:"text-sm font-medium text-gray-500"},"Restocked By",-1)),e("dd",Pt,h(o.restock.user_name),1)]),e("div",Nt,[t[5]||(t[5]=e("dt",{class:"text-sm font-medium text-gray-500"},"Notes",-1)),e("dd",qt,h(o.restock.notes||"No notes"),1)])]),o.restock.entries&&o.restock.entries.length>0?(v(),y("div",At,[t[7]||(t[7]=e("h4",{class:"text-sm font-medium text-gray-500"},"Restocked Items",-1)),e("div",Tt,[t[6]||(t[6]=le('<div class="px-4 py-3 bg-gray-50 text-xs font-medium text-gray-500 uppercase tracking-wider"><div class="grid grid-cols-6 gap-2"><div class="col-span-1 text-center">Slot</div><div class="col-span-1">Product</div><div class="col-span-1 text-center">Prev Qty</div><div class="col-span-1 text-center">Discarded</div><div class="col-span-1 text-center">Added</div><div class="col-span-1 text-center">New Qty</div></div></div>',1)),e("div",Bt,[(v(!0),y(E,null,L(o.restock.entries,s=>(v(),y("div",{key:s.id,class:"px-4 py-3"},[e("div",Ut,[e("div",Ot,h(s.slot||"-"),1),e("div",zt,h(s.product_name),1),e("div",Qt,h(s.previous_quantity),1),e("div",Wt,h(s.quantity_discarded),1),e("div",Gt," +"+h(s.quantity_added),1),e("div",Ht,h(s.previous_quantity+s.quantity_added-s.quantity_discarded),1)])]))),128))])])])):V("",!0)])):V("",!0)])])]),e("div",Jt,[e("button",{type:"button",onClick:t[1]||(t[1]=s=>i.$emit("close")),class:"w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:w-auto sm:text-sm"}," Close ")])])])])):V("",!0)}},Xt={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Yt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Zt={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},es={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},ts={class:"sm:flex sm:items-start"},ss={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},os={key:0,class:"mt-2"},is={class:"text-sm text-gray-500"},ns={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},rs={__name:"DeleteConfirmationModal",props:{show:Boolean,restock:Object},emits:["close","confirm"],setup(o){return(i,t)=>o.show?(v(),y("div",Xt,[e("div",Yt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=s=>i.$emit("close"))}),t[5]||(t[5]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Zt,[e("div",es,[e("div",ts,[t[4]||(t[4]=e("div",{class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"},[e("svg",{class:"h-6 w-6 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),e("div",ss,[t[3]||(t[3]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Delete Visit ",-1)),o.restock?(v(),y("div",os,[e("p",is," Are you sure you want to delete this visit to "+h(o.restock.location_name)+" on "+h(R(O)(o.restock.visit_date))+"? This action will also reverse all inventory changes made during this visit. This action cannot be undone. ",1)])):V("",!0)])])]),e("div",ns,[e("button",{type:"button",onClick:t[1]||(t[1]=s=>i.$emit("confirm")),class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"}," Delete "),e("button",{type:"button",onClick:t[2]||(t[2]=s=>i.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])])])])):V("",!0)}},cs={__name:"Restocks",setup(o){const i=G(),{restocks:t,loading:s,error:c,fetchRestocks:n,createVisit:k,updateVisit:u,deleteVisit:a,getVisitDetails:m}=me(),{filteredLocations:f,routes:l,selectedRoute:d,locationSearchText:r,fetchLocations:g,fetchRoutes:p,resetFilters:_}=ue(),{locationMachines:C,fetchLocationMachines:M,updateMachineProductData:j,resetMachineData:P}=fe(),{restockForm:H,isEditing:J,selectedLocation:T,initializeForm:z,saveRestock:K}=ge(),F=b(!1),B=b(!1),N=b(!1),U=b(null),q=b(null),Q=()=>{z(),_(),P(),F.value=!0},X=async w=>{z(w),_(),await M(w.location_id);try{for(const $ of C.value)await j(w.id,$.id);F.value=!0}catch($){console.error("Error loading visit for editing:",$),c.value="Failed to load visit details for editing. Please try again."}},Y=async w=>{U.value=w;try{const $=await m(w.id);U.value={...w,entries:$},B.value=!0}catch($){console.error("Error fetching visit details:",$),c.value="Failed to load visit details. Please try again."}},Z=w=>{q.value=w,N.value=!0},ee=async()=>{try{await a(q.value.id),N.value=!1,q.value=null}catch(w){console.error("Error deleting visit:",w),c.value="Failed to delete visit. Please try again."}},te=async()=>{await K(C.value,k,u)&&(F.value=!1,await n())},se=w=>{d.value=w,T.value="",P()},oe=w=>{r.value=w},ie=w=>{T.value=w,M(w)};return de(async()=>{i.isAuthenticated&&!i.user&&await i.fetchUser(),console.log("Current user:",i.user),await Promise.all([n(),g(),p()])}),(w,$)=>(v(),y("div",null,[e("div",{class:"flex justify-between items-center mb-6"},[$[3]||($[3]=e("h1",{class:"text-2xl font-semibold text-gray-900"},"Location Visits",-1)),e("button",{onClick:Q,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Record New Visit ")]),A(Se,{restocks:R(t),loading:R(s),error:R(c),onAddRestock:Q,onViewDetails:Y,onEditRestock:X,onDeleteRestock:Z},null,8,["restocks","loading","error"]),A(wt,{show:F.value,"is-editing":R(J),"restock-form":R(H),"selected-location":R(T),"selected-route":R(d),"location-search-text":R(r),locations:R(f),routes:R(l),"location-machines":R(C),onClose:$[0]||($[0]=W=>F.value=!1),onSave:te,onRouteChange:se,onLocationSearch:oe,onLocationChange:ie},null,8,["show","is-editing","restock-form","selected-location","selected-route","location-search-text","locations","routes","location-machines"]),A(Kt,{show:B.value,restock:U.value,onClose:$[1]||($[1]=W=>B.value=!1)},null,8,["show","restock"]),A(rs,{show:N.value,restock:q.value,onClose:$[2]||($[2]=W=>N.value=!1),onConfirm:ee},null,8,["show","restock"])]))}};export{cs as default};
