import{a as _}from"./api-BZqk93rT.js";import{a as B,f as V}from"./dateUtils-CXdyRzwD.js";import{r as g,q as z,c as m,o as f,b as t,t as c,F as L,e as O,i as k,u,l as W,g as G,h as T}from"./index-Dr1fHcBK.js";function J(){const n=g([]),v=g([]),d=g(!0),r=g(null),o=g(null),e=g(!1),a=g(!1),x=g(!1),w=g(null),l=g({id:null,product:"",supplier:"",purchase_date:"",quantity:1,total_cost:0,notes:""}),q=z(()=>(parseFloat(l.value.quantity),parseFloat(l.value.total_cost)||0)),D=z(()=>{const s=parseFloat(l.value.quantity)||0,i=parseFloat(l.value.total_cost)||0;return s>0?i/s:0}),$=async()=>{d.value=!0;try{const s=await _.getPurchases();console.log("Purchases data:",s.data),n.value=s.data.map(i=>{const y=i.cost_per_unit||i.unit_cost||(i.total_cost&&i.quantity?i.total_cost/i.quantity:0),p=i.purchase_date||i.purchased_at;return{...i,purchase_date:p,total_cost:i.total_cost||i.cost_per_unit*i.quantity,cost_per_unit:y}})}catch(s){console.error("Error fetching purchases:",s),r.value="Failed to load purchases. Please try again later."}finally{d.value=!1}},b=async()=>{try{const s=await _.getProducts();v.value=s.data}catch(s){console.error("Error fetching products:",s)}},F=()=>{if(l.value.product){if(o.value=v.value.find(s=>s.id==l.value.product),o.value&&o.value.latest_cost){const s=parseFloat(o.value.latest_cost);s>0&&(l.value.total_cost=s*l.value.quantity,C())}}else o.value=null},M=()=>{if(!o.value)return 0;const s=o.value.inventory_quantity||0,i=parseInt(l.value.quantity)||0;if(x.value){const y=n.value.find(h=>h.id===l.value.id),p=y&&parseInt(y.quantity)||0;return s+(i-p)}return s+i},I=()=>{x.value=!1,o.value=null,l.value={id:null,product:"",supplier:"",purchase_date:B(),quantity:1,total_cost:0,notes:""},e.value=!0},S=s=>{x.value=!0;const i=s.total_cost||s.cost_per_unit*s.quantity;let y=s.purchased_at||s.purchase_date,p=y?y.split("T")[0]:"";p||(p=B()),l.value={id:s.id,product:s.product,supplier:s.supplier||"",purchase_date:p,quantity:s.quantity,total_cost:i,notes:s.notes||""},s.product&&(o.value=v.value.find(h=>h.id==s.product)),C(),e.value=!0},j=async()=>{try{const s=parseInt(l.value.quantity)||0,i=parseFloat(l.value.total_cost)||0;if(s<=0){r.value="Quantity must be greater than zero";return}if(i<=0){r.value="Total cost must be greater than zero";return}const y=`${l.value.purchase_date}T12:00:00`,p={product:l.value.product,supplier:l.value.supplier,purchased_at:y,purchase_date:y,quantity:s,total_cost:i,notes:l.value.notes||"",cost_per_unit:Math.round(D.value*100)/100};console.log("Saving purchase with data:",p);let h;x.value?h=await _.updatePurchase(l.value.id,p):h=await _.createPurchase(p),console.log("Purchase saved successfully:",h.data);const Q=await _.getProduct(l.value.product);console.log("Updated product:",Q.data),e.value=!1,await Promise.all([$(),b()])}catch(s){console.error("Error saving purchase:",s),s.response&&s.response.data?(console.error("Server error details:",s.response.data),r.value=`Failed to save purchase: ${JSON.stringify(s.response.data)}`):r.value="Failed to save purchase. Please try again."}},E=s=>{w.value=s,a.value=!0},A=async()=>{if(w.value)try{await _.deletePurchase(w.value.id),a.value=!1,await Promise.all([$(),b()])}catch(s){console.error("Error deleting purchase:",s),r.value="Failed to delete purchase. Please try again."}},C=()=>{const s=parseFloat(l.value.quantity)||0,i=parseFloat(l.value.total_cost)||0;s>0?l.value.cost_per_unit=Math.round(i/s*100)/100:l.value.cost_per_unit=0};return{purchases:n,products:v,loading:d,error:r,selectedProduct:o,showModal:e,showDeleteModal:a,isEditing:x,purchaseToDelete:w,purchaseForm:l,totalCost:q,unitCost:D,fetchPurchases:$,fetchProducts:b,onProductChange:F,calculateNewInventory:M,openAddModal:I,editPurchase:S,savePurchase:j,confirmDelete:E,deletePurchase:A,calculateUnitCost:C,closeModal:()=>{e.value=!1},closeDeleteModal:()=>{a.value=!1},initialize:async()=>{await Promise.all([$(),b()])}}}const R={key:0,class:"flex justify-center"},H={key:1,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-4"},K={class:"flex"},X={class:"ml-3"},Y={class:"text-sm text-red-700"},Z={key:2,class:"bg-white shadow overflow-hidden sm:rounded-lg"},tt={class:"px-4 py-5 sm:p-6 text-center"},et={class:"mt-5"},st={key:3,class:"bg-white shadow overflow-hidden sm:rounded-lg"},ot={role:"list",class:"divide-y divide-gray-200"},rt={class:"flex items-center justify-between"},nt={class:"flex items-center"},at={class:"text-sm font-medium text-primary-600"},lt={class:"ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800"},it={class:"ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"},ut={key:0,class:"ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800"},dt={class:"mt-1"},ct={class:"text-sm text-gray-500"},mt={class:"text-sm text-gray-500"},ft={class:"flex space-x-2"},pt=["onClick"],yt=["onClick"],gt={__name:"PurchaseList",props:{purchases:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["add-purchase","edit-purchase","delete-purchase"],setup(n,{emit:v}){return(d,r)=>n.loading?(f(),m("div",R,r[1]||(r[1]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))):n.error?(f(),m("div",H,[t("div",K,[r[2]||(r[2]=t("div",{class:"flex-shrink-0"},[t("span",{class:"text-red-400"},"⚠")],-1)),t("div",X,[t("p",Y,c(n.error),1)])])])):n.purchases.length===0?(f(),m("div",Z,[t("div",tt,[r[3]||(r[3]=t("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"No purchases found",-1)),r[4]||(r[4]=t("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[t("p",null,"Get started by recording your first wholesale purchase.")],-1)),t("div",et,[t("button",{onClick:r[0]||(r[0]=o=>d.$emit("add-purchase")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Add Purchase ")])])])):(f(),m("div",st,[t("ul",ot,[(f(!0),m(L,null,O(n.purchases,o=>(f(),m("li",{key:o.id,class:"px-4 py-4 sm:px-6"},[t("div",rt,[t("div",null,[t("div",nt,[t("p",at,c(o.product_name),1),t("span",lt,c(o.quantity)+" units ",1),t("span",it,c(o.supplier||"Unknown"),1),o.current_inventory?(f(),m("span",ut," Inventory: "+c(o.current_inventory),1)):k("",!0)]),t("div",dt,[t("p",ct," Date: "+c(u(V)(o.purchase_date)),1),t("p",mt," Total: $"+c(parseFloat(o.total_cost).toFixed(2))+" | Unit Cost: $"+c(parseFloat(o.cost_per_unit||o.total_cost/o.quantity).toFixed(2)),1)])]),t("div",ft,[t("button",{onClick:e=>d.$emit("edit-purchase",o),class:"inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Edit ",8,pt),t("button",{onClick:e=>d.$emit("delete-purchase",o),class:"inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," Delete ",8,yt)])])]))),128))])]))}},vt={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},bt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},xt={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},ht={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},wt={class:"sm:flex sm:items-start"},$t={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},_t={class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"},Ct={class:"mt-4 space-y-4"},Pt=["value"],kt=["value"],qt=["value"],Dt=["value"],Ft={class:"grid grid-cols-2 gap-4"},Mt=["value"],It=["value"],St=["value"],jt={class:"grid grid-cols-2 gap-4"},Et={class:"bg-gray-50 p-3 rounded-md"},At={class:"text-lg font-bold text-primary-600"},Nt={key:0,class:"bg-gray-50 p-3 rounded-md"},Tt={class:"text-lg font-bold text-primary-600"},Ut={class:"text-xs text-gray-500 mt-1"},Bt={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},zt={type:"submit",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm"},Lt={__name:"PurchaseFormModal",props:{show:{type:Boolean,default:!1},isEditing:{type:Boolean,default:!1},form:{type:Object,required:!0},products:{type:Array,default:()=>[]},selectedProduct:{type:Object,default:null},unitCost:{type:Number,default:0}},emits:["close","save","update:form","product-change","calculate-unit-cost"],setup(n,{emit:v}){const d=n,r=()=>{if(!d.selectedProduct)return 0;const o=d.selectedProduct.inventory_quantity||0,e=parseInt(d.form.quantity)||0;return o+e};return(o,e)=>n.show?(f(),m("div",vt,[t("div",bt,[t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:e[0]||(e[0]=a=>o.$emit("close"))}),e[22]||(e[22]=t("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),t("div",xt,[t("form",{onSubmit:e[11]||(e[11]=W(a=>o.$emit("save"),["prevent"]))},[t("div",ht,[t("div",wt,[t("div",$t,[t("h3",_t,c(n.isEditing?"Edit Purchase":"Add New Purchase"),1),t("div",Ct,[t("div",null,[e[13]||(e[13]=t("label",{for:"product",class:"block text-sm font-medium text-gray-700"},"Product",-1)),t("select",{id:"product",name:"product",value:n.form.product,onInput:e[1]||(e[1]=a=>o.$emit("update:form",{...n.form,product:a.target.value})),onChange:e[2]||(e[2]=a=>o.$emit("product-change")),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},[e[12]||(e[12]=t("option",{value:"",disabled:""},"Select a product",-1)),(f(!0),m(L,null,O(n.products,a=>(f(),m("option",{key:a.id,value:a.id},c(a.name)+" ("+c(a.inventory_quantity)+" in stock) ",9,kt))),128))],40,Pt)]),t("div",null,[e[15]||(e[15]=t("label",{for:"supplier",class:"block text-sm font-medium text-gray-700"},"Supplier",-1)),t("select",{id:"supplier",name:"supplier",value:n.form.supplier,onInput:e[3]||(e[3]=a=>o.$emit("update:form",{...n.form,supplier:a.target.value})),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},e[14]||(e[14]=[t("option",{value:"",disabled:""},"Select a supplier",-1),t("option",{value:"Sams"},"Sams",-1),t("option",{value:"Star"},"Star",-1)]),40,qt)]),t("div",null,[e[16]||(e[16]=t("label",{for:"purchase_date",class:"block text-sm font-medium text-gray-700"},"Purchase Date",-1)),t("input",{type:"date",name:"purchase_date",id:"purchase_date",value:n.form.purchase_date,onInput:e[4]||(e[4]=a=>o.$emit("update:form",{...n.form,purchase_date:a.target.value})),class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md",required:""},null,40,Dt)]),t("div",Ft,[t("div",null,[e[17]||(e[17]=t("label",{for:"quantity",class:"block text-sm font-medium text-gray-700"},"Quantity",-1)),t("input",{type:"number",name:"quantity",id:"quantity",value:n.form.quantity,onInput:e[5]||(e[5]=a=>o.$emit("update:form",{...n.form,quantity:a.target.value})),onChange:e[6]||(e[6]=a=>o.$emit("calculate-unit-cost")),min:"1",class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md",required:""},null,40,Mt)]),t("div",null,[e[18]||(e[18]=t("label",{for:"total_cost",class:"block text-sm font-medium text-gray-700"},"Total Cost ($)",-1)),t("input",{type:"number",name:"total_cost",id:"total_cost",value:n.form.total_cost,onInput:e[7]||(e[7]=a=>o.$emit("update:form",{...n.form,total_cost:a.target.value})),onChange:e[8]||(e[8]=a=>o.$emit("calculate-unit-cost")),min:"0.01",step:"0.01",class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md",required:""},null,40,It)])]),t("div",null,[e[19]||(e[19]=t("label",{for:"notes",class:"block text-sm font-medium text-gray-700"},"Notes",-1)),t("textarea",{id:"notes",name:"notes",rows:"3",value:n.form.notes,onInput:e[9]||(e[9]=a=>o.$emit("update:form",{...n.form,notes:a.target.value})),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md"},null,40,St)]),t("div",jt,[t("div",Et,[e[20]||(e[20]=t("div",{class:"text-sm font-medium text-gray-700"},"Unit Cost:",-1)),t("div",At," $"+c(n.unitCost.toFixed(2))+" per unit ",1)]),n.selectedProduct?(f(),m("div",Nt,[e[21]||(e[21]=t("div",{class:"text-sm font-medium text-gray-700"},"Current Inventory:",-1)),t("div",Tt,c(n.selectedProduct.inventory_quantity||0)+" units ",1),t("div",Ut," After purchase: "+c(r())+" units ",1)])):k("",!0)])])])])]),t("div",Bt,[t("button",zt,c(n.isEditing?"Update":"Add"),1),t("button",{type:"button",onClick:e[10]||(e[10]=a=>o.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])],32)])])])):k("",!0)}},Ot={key:0,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Qt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Vt={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Wt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Gt={class:"sm:flex sm:items-start"},Jt={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},Rt={class:"mt-2"},Ht={key:0,class:"text-sm text-red-500 mt-2"},Kt={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Xt={__name:"DeleteConfirmationModal",props:{show:{type:Boolean,default:!1},purchase:{type:Object,default:null}},emits:["close","confirm"],setup(n,{emit:v}){return(d,r)=>n.show?(f(),m("div",Ot,[t("div",Qt,[t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:r[0]||(r[0]=o=>d.$emit("close"))}),r[6]||(r[6]=t("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),t("div",Vt,[t("div",Wt,[t("div",Gt,[r[5]||(r[5]=t("div",{class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"},[t("svg",{class:"h-6 w-6 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),t("div",Jt,[r[4]||(r[4]=t("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Delete Purchase ",-1)),t("div",Rt,[r[3]||(r[3]=t("p",{class:"text-sm text-gray-500"}," Are you sure you want to delete this purchase record? This action cannot be undone. ",-1)),n.purchase?(f(),m("p",Ht," Note: This will also reduce your inventory by "+c(n.purchase.quantity)+" units. ",1)):k("",!0)])])])]),t("div",Kt,[t("button",{type:"button",onClick:r[1]||(r[1]=o=>d.$emit("confirm")),class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"}," Delete "),t("button",{type:"button",onClick:r[2]||(r[2]=o=>d.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])])])])):k("",!0)}},Yt={class:"flex justify-between items-center mb-6"},se={__name:"Purchases",setup(n){const{purchases:v,products:d,loading:r,error:o,selectedProduct:e,showModal:a,showDeleteModal:x,isEditing:w,purchaseToDelete:l,purchaseForm:q,unitCost:D,onProductChange:$,openAddModal:b,editPurchase:F,savePurchase:M,confirmDelete:I,deletePurchase:S,calculateUnitCost:j,closeModal:E,closeDeleteModal:A,initialize:C}=J(),U=N=>{Object.assign(q.value,N)};return G(async()=>{await C()}),(N,P)=>(f(),m("div",null,[t("div",Yt,[P[1]||(P[1]=t("h1",{class:"text-2xl font-semibold text-gray-900"},"Wholesale Purchases",-1)),t("button",{onClick:P[0]||(P[0]=(...s)=>u(b)&&u(b)(...s)),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Add Purchase ")]),T(gt,{purchases:u(v),loading:u(r),error:u(o),onAddPurchase:u(b),onEditPurchase:u(F),onDeletePurchase:u(I)},null,8,["purchases","loading","error","onAddPurchase","onEditPurchase","onDeletePurchase"]),T(Lt,{show:u(a),"is-editing":u(w),form:u(q),products:u(d),"selected-product":u(e),"unit-cost":u(D),onClose:u(E),onSave:u(M),"onUpdate:form":U,onProductChange:u($),onCalculateUnitCost:u(j)},null,8,["show","is-editing","form","products","selected-product","unit-cost","onClose","onSave","onProductChange","onCalculateUnitCost"]),T(Xt,{show:u(x),purchase:u(l),onClose:u(A),onConfirm:u(S)},null,8,["show","purchase","onClose","onConfirm"])]))}};export{se as default};
