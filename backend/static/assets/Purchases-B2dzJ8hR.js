import{r as u,h as D,o as L,c as n,a as e,i as b,t as l,F as $,e as j,j as Q,w as v,v as U,k,g as i}from"./index-v0bwaa3R.js";import{a as y}from"./api-CIjKO-gr.js";const z={key:0,class:"flex justify-center"},O={key:1,class:"bg-red-50 border-l-4 border-red-400 p-4 mb-4"},W={class:"flex"},G={class:"ml-3"},J={class:"text-sm text-red-700"},R={key:2,class:"bg-white shadow overflow-hidden sm:rounded-lg"},Y={key:3,class:"bg-white shadow overflow-hidden sm:rounded-lg"},H={role:"list",class:"divide-y divide-gray-200"},K={class:"flex items-center justify-between"},X={class:"flex items-center"},Z={class:"text-sm font-medium text-primary-600"},tt={class:"ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800"},et={class:"ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"},st={key:0,class:"ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800"},ot={class:"mt-1"},at={class:"text-sm text-gray-500"},lt={class:"text-sm text-gray-500"},rt={class:"flex space-x-2"},nt=["onClick"],it=["onClick"],dt={key:4,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},ut={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},ct={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},mt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},pt={class:"sm:flex sm:items-start"},ft={class:"mt-3 text-center sm:mt-0 sm:text-left w-full"},vt={class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"},yt={class:"mt-4 space-y-4"},gt=["value"],xt={class:"grid grid-cols-2 gap-4"},bt={class:"grid grid-cols-2 gap-4"},ht={class:"bg-gray-50 p-3 rounded-md"},_t={class:"text-lg font-bold text-primary-600"},wt={key:0,class:"bg-gray-50 p-3 rounded-md"},kt={class:"text-lg font-bold text-primary-600"},qt={class:"text-xs text-gray-500 mt-1"},Ct={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Pt={type:"submit",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm"},Ft={key:5,class:"fixed inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},St={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Dt={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},$t={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},jt={class:"sm:flex sm:items-start"},Ut={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},Tt={class:"mt-2"},Mt={key:0,class:"text-sm text-red-500 mt-2"},Et={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},At={__name:"Purchases",setup(It){const h=u([]),_=u([]),q=u(!0),c=u(null),d=u(null),p=u(!1),g=u(!1),f=u(!1),x=u(null),a=u({id:null,product:"",supplier:"",purchase_date:"",quantity:1,total_cost:0,notes:""});D(()=>(parseFloat(a.value.quantity),parseFloat(a.value.total_cost)||0));const F=D(()=>{const s=parseFloat(a.value.quantity)||0,t=parseFloat(a.value.total_cost)||0;return s>0?t/s:0}),T=()=>{if(!d.value)return 0;const s=d.value.inventory_quantity||0,t=parseInt(a.value.quantity)||0;if(f.value){const o=h.value.find(m=>m.id===a.value.id),r=o&&parseInt(o.quantity)||0;return s+(t-r)}return s+t},M=s=>s?new Date(s).toLocaleDateString():"",C=async()=>{q.value=!0;try{const s=await y.getPurchases();console.log("Purchases data:",s.data),h.value=s.data.map(t=>{const o=t.cost_per_unit||t.unit_cost||(t.total_cost&&t.quantity?t.total_cost/t.quantity:0),r=t.purchase_date||t.purchased_at;return{...t,purchase_date:r,total_cost:t.total_cost||t.cost_per_unit*t.quantity,cost_per_unit:o}})}catch(s){console.error("Error fetching purchases:",s),c.value="Failed to load purchases. Please try again later."}finally{q.value=!1}},P=async()=>{try{const s=await y.getProducts();_.value=s.data}catch(s){console.error("Error fetching products:",s)}},E=()=>{if(a.value.product){if(d.value=_.value.find(s=>s.id==a.value.product),d.value&&d.value.latest_cost){const s=parseFloat(d.value.latest_cost);s>0&&(a.value.total_cost=s*a.value.quantity,w())}}else d.value=null},S=()=>{f.value=!1,d.value=null;const s=new Date,t=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0"),r=String(s.getDate()).padStart(2,"0");a.value={id:null,product:"",supplier:"",purchase_date:`${t}-${o}-${r}`,quantity:1,total_cost:0,notes:""},p.value=!0},I=s=>{f.value=!0;const t=s.total_cost||s.cost_per_unit*s.quantity;let o=s.purchased_at||s.purchase_date,r=o?o.split("T")[0]:"";r||(r=new Date().toISOString().split("T")[0]),a.value={id:s.id,product:s.product,supplier:s.supplier||"",purchase_date:r,quantity:s.quantity,total_cost:t,notes:s.notes||""},s.product&&(d.value=_.value.find(m=>m.id==s.product)),w(),p.value=!0},N=async()=>{try{const s=parseInt(a.value.quantity)||0,t=parseFloat(a.value.total_cost)||0;if(s<=0){c.value="Quantity must be greater than zero";return}if(t<=0){c.value="Total cost must be greater than zero";return}const o=`${a.value.purchase_date}T12:00:00`,r={product:a.value.product,supplier:a.value.supplier,purchased_at:o,purchase_date:o,quantity:s,total_cost:t,notes:a.value.notes||"",cost_per_unit:F.value};console.log("Saving purchase with data:",r);let m;f.value?m=await y.updatePurchase(a.value.id,r):m=await y.createPurchase(r),console.log("Purchase saved successfully:",m.data);const B=await y.getProduct(a.value.product);console.log("Updated product:",B.data),p.value=!1,await Promise.all([C(),P()])}catch(s){console.error("Error saving purchase:",s),s.response&&s.response.data?(console.error("Server error details:",s.response.data),c.value=`Failed to save purchase: ${JSON.stringify(s.response.data)}`):c.value="Failed to save purchase. Please try again."}},V=s=>{x.value=s,g.value=!0},A=async()=>{if(x.value)try{await y.deletePurchase(x.value.id),g.value=!1,await Promise.all([C(),P()])}catch(s){console.error("Error deleting purchase:",s),c.value="Failed to delete purchase. Please try again."}},w=()=>{const s=parseFloat(a.value.quantity)||0,t=parseFloat(a.value.total_cost)||0;s>0?a.value.cost_per_unit=t/s:a.value.cost_per_unit=0};return L(async()=>{await Promise.all([C(),P()])}),(s,t)=>(i(),n("div",null,[e("div",{class:"flex justify-between items-center mb-6"},[t[10]||(t[10]=e("h1",{class:"text-2xl font-semibold text-gray-900"},"Wholesale Purchases",-1)),e("button",{onClick:S,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Add Purchase ")]),q.value?(i(),n("div",z,t[11]||(t[11]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"},null,-1)]))):c.value?(i(),n("div",O,[e("div",W,[t[12]||(t[12]=e("div",{class:"flex-shrink-0"},[e("span",{class:"text-red-400"},"⚠")],-1)),e("div",G,[e("p",J,l(c.value),1)])])])):h.value.length===0?(i(),n("div",R,[e("div",{class:"px-4 py-5 sm:p-6 text-center"},[t[13]||(t[13]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"No purchases found",-1)),t[14]||(t[14]=e("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[e("p",null,"Get started by recording your first wholesale purchase.")],-1)),e("div",{class:"mt-5"},[e("button",{onClick:S,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Add Purchase ")])])])):(i(),n("div",Y,[e("ul",H,[(i(!0),n($,null,j(h.value,o=>(i(),n("li",{key:o.id,class:"px-4 py-4 sm:px-6"},[e("div",K,[e("div",null,[e("div",X,[e("p",Z,l(o.product_name),1),e("span",tt,l(o.quantity)+" units ",1),e("span",et,l(o.supplier||"Unknown"),1),o.current_inventory?(i(),n("span",st," Inventory: "+l(o.current_inventory),1)):b("",!0)]),e("div",ot,[e("p",at," Date: "+l(M(o.purchase_date)),1),e("p",lt," Total: $"+l(parseFloat(o.total_cost).toFixed(2))+" | Unit Cost: $"+l(parseFloat(o.cost_per_unit||o.total_cost/o.quantity).toFixed(2)),1)])]),e("div",rt,[e("button",{onClick:r=>I(o),class:"inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Edit ",8,nt),e("button",{onClick:r=>V(o),class:"inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," Delete ",8,it)])])]))),128))])])),p.value?(i(),n("div",dt,[e("div",ut,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[0]||(t[0]=o=>p.value=!1)}),t[25]||(t[25]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",ct,[e("form",{onSubmit:Q(N,["prevent"])},[e("div",mt,[e("div",pt,[e("div",ft,[e("h3",vt,l(f.value?"Edit Purchase":"Add New Purchase"),1),e("div",yt,[e("div",null,[t[16]||(t[16]=e("label",{for:"product",class:"block text-sm font-medium text-gray-700"},"Product",-1)),v(e("select",{id:"product",name:"product","onUpdate:modelValue":t[1]||(t[1]=o=>a.value.product=o),onChange:E,class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},[t[15]||(t[15]=e("option",{value:"",disabled:""},"Select a product",-1)),(i(!0),n($,null,j(_.value,o=>(i(),n("option",{key:o.id,value:o.id},l(o.name)+" ("+l(o.inventory_quantity)+" in stock) ",9,gt))),128))],544),[[U,a.value.product]])]),e("div",null,[t[18]||(t[18]=e("label",{for:"supplier",class:"block text-sm font-medium text-gray-700"},"Supplier",-1)),v(e("select",{id:"supplier",name:"supplier","onUpdate:modelValue":t[2]||(t[2]=o=>a.value.supplier=o),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md",required:""},t[17]||(t[17]=[e("option",{value:"",disabled:""},"Select a supplier",-1),e("option",{value:"Sams"},"Sams",-1),e("option",{value:"Star"},"Star",-1)]),512),[[U,a.value.supplier]])]),e("div",null,[t[19]||(t[19]=e("label",{for:"purchase_date",class:"block text-sm font-medium text-gray-700"},"Purchase Date",-1)),v(e("input",{type:"date",name:"purchase_date",id:"purchase_date","onUpdate:modelValue":t[3]||(t[3]=o=>a.value.purchase_date=o),class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md",required:""},null,512),[[k,a.value.purchase_date]])]),e("div",xt,[e("div",null,[t[20]||(t[20]=e("label",{for:"quantity",class:"block text-sm font-medium text-gray-700"},"Quantity",-1)),v(e("input",{type:"number",name:"quantity",id:"quantity","onUpdate:modelValue":t[4]||(t[4]=o=>a.value.quantity=o),min:"1",onChange:w,class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md",required:""},null,544),[[k,a.value.quantity]])]),e("div",null,[t[21]||(t[21]=e("label",{for:"total_cost",class:"block text-sm font-medium text-gray-700"},"Total Cost ($)",-1)),v(e("input",{type:"number",name:"total_cost",id:"total_cost","onUpdate:modelValue":t[5]||(t[5]=o=>a.value.total_cost=o),min:"0.01",step:"0.01",onChange:w,class:"mt-1 focus:ring-primary-500 focus:border-primary-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md",required:""},null,544),[[k,a.value.total_cost]])])]),e("div",null,[t[22]||(t[22]=e("label",{for:"notes",class:"block text-sm font-medium text-gray-700"},"Notes",-1)),v(e("textarea",{id:"notes",name:"notes",rows:"3","onUpdate:modelValue":t[6]||(t[6]=o=>a.value.notes=o),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md"},null,512),[[k,a.value.notes]])]),e("div",bt,[e("div",ht,[t[23]||(t[23]=e("div",{class:"text-sm font-medium text-gray-700"},"Unit Cost:",-1)),e("div",_t," $"+l(F.value.toFixed(2))+" per unit ",1)]),d.value?(i(),n("div",wt,[t[24]||(t[24]=e("div",{class:"text-sm font-medium text-gray-700"},"Current Inventory:",-1)),e("div",kt,l(d.value.inventory_quantity||0)+" units ",1),e("div",qt," After purchase: "+l(T())+" units ",1)])):b("",!0)])])])])]),e("div",Ct,[e("button",Pt,l(f.value?"Update":"Add"),1),e("button",{type:"button",onClick:t[7]||(t[7]=o=>p.value=!1),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])],32)])])])):b("",!0),g.value?(i(),n("div",Ft,[e("div",St,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[8]||(t[8]=o=>g.value=!1)}),t[29]||(t[29]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Dt,[e("div",$t,[e("div",jt,[t[28]||(t[28]=e("div",{class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"},[e("svg",{class:"h-6 w-6 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),e("div",Ut,[t[27]||(t[27]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Delete Purchase ",-1)),e("div",Tt,[t[26]||(t[26]=e("p",{class:"text-sm text-gray-500"}," Are you sure you want to delete this purchase record? This action cannot be undone. ",-1)),x.value?(i(),n("p",Mt," Note: This will also reduce your inventory by "+l(x.value.quantity)+" units. ",1)):b("",!0)])])])]),e("div",Et,[e("button",{type:"button",onClick:A,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"}," Delete "),e("button",{type:"button",onClick:t[9]||(t[9]=o=>g.value=!1),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])])])])):b("",!0)]))}};export{At as default};
